/* eslint-disable */
var serverHost="https://boost-recommend.mediacorp.sg",crCookieDomain="todayonline.com"||"localhost",page_session_id="47816b78-4cfd-43c8-8774-6c3d2af2c57c",WIDGET_LIB_VERSION="1.1"||"1.0",engineEnabled="YES",meidtagEnabled="NO",meidtagHost="https://uid.mediacorp.sg",UIDKey="UID";!function(){var e=window.recApp=window.recApp||{};if(!e.tagLoaded||!e.context||e.context.isWebView){e.tagLoaded=!0,page_session_id=page_session_id+"-"+Date.now(),e.page_session_id=page_session_id,e.engineEnabled="YES"===engineEnabled,window.mcRecommendationEnabled=e.engineEnabled;try{window.localStorage&&window.localStorage.setItem("mcRecommendationEnabled",e.engineEnabled?"YES":"")}catch(e){}var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=function(){var e=!!document.addEventListener,t=!1,n=[];if(e)document.addEventListener("DOMContentLoaded",i,!0),window.addEventListener("load",o,!1);else{document.attachEvent("onreadystatechange",i),window.attachEvent("onload",o);try{null===window.frameElement}catch(e){}}function i(){e?document.removeEventListener("DOMContentLoaded",i,!0):"complete"===document.readyState&&document.detachEvent("onreadystatechange",i),o()}function o(){if(!t){t=!0;for(var e=n.length,i=0;i<e;i++)n[i].call(document)}}return function(e){return t?e.call(document):n.push(e)}}();e.context=s(),window.addEventListener("message",function(t){t.data&&"resp_meid"===t.data.type&&(o(UIDKey,t.data.msg),e.context.meid=t.data.msg)},!1),window.self!==window.parent&&window.parent.postMessage({type:"req_meid"},"*"),function(){if("YES"===meidtagEnabled){var t,s=i(UIDKey),l="",u="264851a0-e470-489c-8dc4-8e0ad628cf7f",g="mediacorp",m="todayonline",w=l||s||u;s||l?s&&!l?f(s):l&&s!==l&&o(UIDKey,l):(o(UIDKey,u),f(u)),(t={})["event_type"]="pv",t["meid"]=w||i(UIDKey),t["network"]=g,t["site"]=m,t["page_session_id"]=e.page_session_id,t["url"]=e.context.url||window.location.href,t["referrer"]=e.context.referrer||document.referrer,t["title"]=document.title,t["canonical_url"]=document.querySelector('[rel="canonical"]').href,t["publish_time"]=a("cXenseParse:recs:publishtime"),t["date"]=(new Date).getTime(),d(t,"clickstream"),function(){var t=-1,o=0,r=0;function a(){var t={};t["event_type"]="heartbeat",t["meid"]=w||i(UIDKey),t["network"]=g,t["site"]=m,t["page_session_id"]=e.page_session_id,t["url"]=e.context.url||window.location.href,t["referrer"]=e.context.referrer||document.referrer,t["date"]=(new Date).getTime(),d(t,"clickstream")}n(function(){try{function e(){o=0,r=0}window.addEventListener("mousemove",e),window.addEventListener("scroll",e),window.addEventListener("keydown",e),window.addEventListener("resize",e)}catch(e){}t=(new Date).getTime(),a()}),c(function(){if(!(t<0)){o++;var e=Math.floor(Math.log(o)/Math.log(4));e!==r&&(r=e,a())}},1e3)}()}function f(e){var t="SuccessUID_callback_"+(new Date).getTime();window[t]=function(n){n!==e&&(e=n,o(UIDKey,n)),delete window[t]},r(meidtagHost+"/api/scripts/meid_sync.js?MeID="+encodeURIComponent(e)+"&meid_callback="+t)}}(),function(){if(e.engineEnabled){var t={};e.context.isWebView&&(window.onerror=function(t,n,i,o,r){var a="Error: "+t+"\nurl: "+n+"\nline: "+i+" col: "+o;e.trackEvent({id:"unknown"},e.context,"tag_error",{error:{message:t,stack:a}})}),e.buildPixelData=function(n,o,r,a){var c={};return c["event_type"]=r,c["site"]=o.site,c["page_session_id"]=e.page_session_id,c["meid"]=o.meid||i(UIDKey),c["widget_id"]=n.id,c["is_webview"]=!!o.isWebView,o.request_id&&(c["request_id"]=o.request_id),o.endpoint&&(c["endpoint"]=o.endpoint),o.abtesting&&(c["abtesting_id"]=o.abtesting.id||"not_found",c["targeted"]=!!o.abtesting.targeted),n.tags&&n.tags.length&&(c["tags"]=n.tags.join(",")),c["site"]=o.site||n.site,c["content_id"]=o.content_id,c["url"]=o.url||window.location.href,c["referrer"]=o.referrer||document.referrer,c["user_agent"]=navigator.userAgent,c["date"]=Date.now(),c.url&&0===c.url.indexOf("data:")&&delete c.url,"impression"===r||"visible_impression"===r?(c["response_time"]=o.response_time||Date.now()-t[o.loadid],c["recs"]=(n.items||[]).map(function(e){return e.site=e.site||c["site"],m(e)}).join(",")):"click"===r&&a.clickItem?(a.clickItem.site=a.clickItem.site||c["site"],c["click_item"]=m(a.clickItem),"cxense"===a.clickItem.algorithm&&(c["click_url"]=a.clickItem.click_url),c["recs"]=(n.items||[]).map(function(e){return e.site=e.site||c["site"],m(e)}).join(",")):"error"===r&&a.error?(c["error"]=a.error.message,c["stacktrace"]=a.error.stack):"tag_error"===r&&a.error&&(c["error"]=a.error.message,c["stacktrace"]=a.error.stack),c},e.trackEvent=function(t,n,i,o){return d(e.buildPixelData(t,n,i,o))},e.sendFeedbackSignal=function(t,n){t=t||{};var i=e.context||{};return t.meid=t.meid||i.meid,t.context_site=t.context_site||i.site,t.context_url=t.context_url||i.url,t.context_content_id=t.context_content_id||i.content_id,t.site=t.site||i.site,t.event_type="feedback",d(t,"feedback",n)},e._widgets=[];var o,a=0,l={},u={};e.loadWidget=function(e,n,i,o){var c=s();setTimeout(function(){c.meid||(c=s()),a+=1,c.loadid=a,c.exclude=i.exclude,c.custom_params=i.custom_params,isNaN(i.content_id)||(c.content_id=i.content_id),i.url&&/^http/i.test(i.url)&&(c.url=i.url),l[a]=o,u[a]=c,(o||{}).widgetId=e,t[a]=(new Date).getTime(),r(serverHost+"/"+(n||"universal")+"/"+t[a]+"/loader?id="+e+"&context="+encodeURIComponent(JSON.stringify(c)))},c.meid?5:200)};["todayonline.com","channelnewsasia.com","mewatch.sg","toggle.sg","8days.sg","mediacorp.sg","merewards.sg","melisten.sg"].indexOf(crCookieDomain)>=0?o=c(p,20):r(serverHost+"/static/js/recApp."+WIDGET_LIB_VERSION+".js",function(){o=c(p,20)});var g=c(f,50);c(function(){for(var e=0;e<=a;e++)u[e],l[e],t[e]},1e3);n(function(){setTimeout(function(){g.clear(),o.clear(),e.context.isWebView||(g=c(f,200),o=c(p,200))},1e3*5)},!1)}function m(e){var t=e.id;return t&&!isNaN(t)&&e.site&&(t=e.site+"-"+t),(t||"")+"|"+(e.algorithm||"")+"|"+(e.ranking_algorithm||"")+"|"+(e.is_backfill?"backfill":"")+"|"+(e.slot_group||"")}function w(t){try{var n=e.context.site;if("cna"!==n||e.context.isWebView){if("8world"===n&&!e.context.isWebView){var i=t.closest(".partial-view-container");if(i&&!i.classList.contains("article-full-view"))return!1}}else{var o=t.closest(".article-endless-scroll-wrapper-inner");if(o&&"hidden"===o.style.overflow)return!1}}catch(e){console.log(e.message)}return!0}function f(){if(e.callQueue){var n=e.callQueue.pop();if(n&&"insertWidget"===n[0]&&n[1]){var i=n[1].widgetId,o=n[1].type,c=n[1].context||{};"todayonline.com"===crCookieDomain&&(delete c.content_id,delete c.url),c.exclude=c.exclude||n[1].exclude;var d=n[1].renderFunction;e.loadWidget(i,o,c,d)}}for(var l=[],u=document.querySelectorAll('[data-role="rec-widget"]'),g=0;g<u.length;g++){var m=u[g],f=(i=m.getAttribute("id"),m.getAttribute("data-exclude"));"yes"!==m.getAttribute("data-processed")&&w(m)&&(l.push({type:"widget",id:i,loadid:a,exclude:f}),m.setAttribute("data-loadid",i+"-"+a),m.setAttribute("data-processed","yes"),a+=1)}var p=document.querySelectorAll('[data-role="rec-abtesting"]');for(g=0;g<p.length;g++){var _=p[g],v=_.getAttribute("id"),x=_.getAttribute("data-exclude");"yes"!==_.getAttribute("data-processed")&&w(_)&&(l.push({type:"abtesting",id:v,loadid:a,exclude:x}),_.setAttribute("data-loadid",v+"-"+a),_.setAttribute("data-processed","yes"),a+=1)}function y(n){setTimeout(function(){var i=s();i.loadid=n.loadid,i.exclude=n.exclude,t[n.loadid]=(new Date).getTime();var o=serverHost+"/"+n.type+"/loader?id="+n.id+"&context="+encodeURIComponent(JSON.stringify(i));e.dynamicWidget&&(o+="&dynamicWidget="+encodeURIComponent(JSON.stringify(e.dynamicWidget))),r(o)},n.loadid>0?200:10)}for(g=0;g<l.length;g++)y(l[g])}function p(){var t=e._widgets.pop();if(t)try{if(t.context.loadid&&l[t.context.loadid]){var n=l[t.context.loadid];"function"==typeof n&&(n(t.widget,t.context,t.errMsg?new Error(t.errMsg):void 0),t.widget&&t.widget.items&&t.widget.items.length&&e.trackEvent(t.widget,t.context,"impression"))}else!function(t,n){if(!t.disabled){var i=t.id;n.abtesting&&(i=n.abtesting.id);var o=document.querySelector('[data-loadid="'+i+"-"+n.loadid+'"]');(o=o||document.getElementById(i))&&(e.renderWidget(t,n),o.setAttribute("data-mounted","yes"),t.items&&t.items.length&&e.trackEvent(t,n,"impression"),"function"==typeof e.onWidgetLoaded&&e.onWidgetLoaded())}}(t.widget,t.context)}catch(e){console.error(e.message)}}}()}function i(e){try{var n="",i=("; "+document.cookie).split("; "+e+"=");if(i.length>=2&&(n=i.pop().split(";").shift()),t&&e===UIDKey&&window.localStorage){var r=window.localStorage.getItem(e);r&&r!==n&&(n=r,o(e,r))}return n}catch(e){}}function o(e,n){try{var i=new Date,o="."+(crCookieDomain||location.host.split(".").slice(-2).join("."));i.setTime(i.getTime()+365*24*60*60*1e3);var r="expires="+i.toUTCString();if(document.cookie=e+"="+n+"; "+r+"; domain="+o+"; path=/",t&&e===UIDKey&&window.localStorage)window.localStorage.getItem(e)!==n&&(window.localStorage.setItem(e,n),window.localStorage.setItem(e+"-created-time",(new Date).getTime()))}catch(e){}}function r(e,t){var n=document.createElement("script");n.onload=t,n.src=e,n.async=!0,document.head.appendChild(n)}function a(e){try{var t=document.querySelector("meta[name='"+CSS.escape(e)+"']");if(t)return t.getAttribute("content")}catch(e){console.error(e)}}function c(e,t){var n,i=Date.now,o=window.requestAnimationFrame,r=i(),a=function(){i()-r<t||(r+=t,e()),n||o(a)};return o(a),{clear:function(){n=1}}}function d(t,n,i){if(e.trackingDisabled)console.log(o);else{var o=document.createElement("img"),r=function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}(t),a={clickstream:"/cs/pixel.gif",feedback:"/feedback/pixel.gif",default:"/pixel.gif"}[n||"default"];"function"==typeof i&&(o.onload=function(){i(null,"success")},o.onerror=function(e){i(new Error("failed"))}),o.src=serverHost+a+"?"+r,o.width=1,o.height=1,o.border=0,(o.style||{}).display="none",document.body.appendChild(o)}}function s(){e.context=e.context||{},e.context.userAgent=navigator.userAgent,e.context.page_session_id=e.page_session_id,e.context.meid=i(UIDKey)||e.context.meid,e.context.cxense_id=i("cX_P")||e.context.cxense_id,(i("sso_id")||"").length>10&&(e.context.is_login=!0),e.context.isWebView||(e.context.url=window.location.href,e.context.referrer=window.referrer);var t=a("cXenseParse:articleid");if(e.context.content_id||(e.context.content_id=t),["channelnewsasia.com","todayonline.com","mediacorp.sg"].indexOf(crCookieDomain)>=0&&!isNaN(t)){var n=window.location.pathname.split("-").pop(),o=window.location.href;try{for(var r=document.querySelectorAll("article[role='article']"),c=r[r.length-1],d=0;d<r.length-1;d++)r[d].getAttribute("data-node-id")===e.context.content_id&&(c=r[d+1]);if(n=c.getAttribute("data-node-id"),c.getAttribute("about"))o=window.location.protocol+"//"+window.location.hostname+c.getAttribute("about")}catch(e){}isNaN(n)||n===t||(e.context.content_id=n,e.context.url=o)}var s=window.mcDataLayer;if(!s)try{s=parent.mcDataLayer}catch(e){}return s&&("NA"!==!s.contentid&&(e.context["content_id"]=s.contentid),s.pagename&&!e.context.site&&(s.pagename.indexOf("sg:cna")>=0?e.context["site"]="cna":s.pagename.indexOf("sg:8world")>=0&&(e.context["site"]="8world")),s.language&&!e.context.lang&&(e.context["lang"]=s.language),s.ciaKeywords&&!e.context.ciaKeywords&&(e.context["ciaKeywords"]=s.ciaKeywords),(s.ssoid||"").length>10&&(e.context["is_login"]=!0),s.omniture&&(s.omniture.ssoid||"").length>10&&(e.context["is_login"]=!0)),e.context["date"]=Date.now(),e.context}}();