/**
 * CBSI-PLAYER v2.8.3
 * Built 03/26/2018 at 8:42:19 AM (PDT)
 * Includes:
 *   - hls.js v0.8.9
 */
(function(){var define, require;
!function(){var a,b;(function(){function b(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&b(a[c],c,a)!==!1;);return a}function d(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function e(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}function f(a,b){var c=null==a?0:a.length;return!!c&&n(a,b,0)>-1}function g(a,b,c){for(var d=-1,e=null==a?0:a.length;++d<e;)if(c(b,a[d]))return!0;return!1}function h(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function i(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function j(a,b,c,d){var e=-1,f=null==a?0:a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function k(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function l(a){return a.split("")}function m(a,b,c,d){for(var e=a.length,f=c+(d?1:-1);d?f--:++f<e;)if(b(a[f],f,a))return f;return-1}function n(a,b,c){return b===b?G(a,b,c):m(a,p,c)}function o(a,b,c,d){for(var e=c-1,f=a.length;++e<f;)if(d(a[e],b))return e;return-1}function p(a){return a!==a}function q(a){return function(b){return null==b?Yd:b[a]}}function r(a){return function(b){return null==a?Yd:a[b]}}function s(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function t(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function u(a){return function(b){return a(b)}}function v(a,b){return h(b,function(b){return a[b]})}function w(a,b){return a.has(b)}function x(a,b){for(var c=a.length,d=0;c--;)a[c]===b&&++d;return d}function y(a){return"\\"+fg[a]}function z(a,b){return null==a?Yd:a[b]}function A(a){return ag.test(a)}function B(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}function C(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function D(a,b){return function(c){return a(b(c))}}function E(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c];g!==b&&g!==ce||(a[c]=ce,f[e++]=c)}return f}function F(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function G(a,b,c){for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function H(a){return A(a)?J(a):tg(a)}function I(a){return A(a)?K(a):l(a)}function J(a){for(var b=_f.lastIndex=0;_f.test(a);)++b;return b}function K(a){return a.match(_f)||[]}function L(a){if(ld(a)&&!Hh(a)&&!(a instanceof O)){if(a instanceof N)return a;if(Ag.call(a,"__wrapped__"))return Ac(a)}return new N(a)}function M(){}function N(a,b){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=Yd}function O(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Be,this.__views__=[]}function P(){var a=new O(this.__wrapped__);return a.__actions__=yb(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=yb(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=yb(this.__views__),a}function Q(){if(this.__filtered__){var a=new O(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function R(){var a=this.__wrapped__.value(),b=this.__dir__,c=Hh(a),d=b<0,e=c?a.length:0,f=$b(0,e,this.__views__),g=f.start,h=f.end,i=h-g,j=d?h:g-1,k=this.__iteratees__,l=k.length,m=0,n=Yg(i,this.__takeCount__);if(!c||!d&&e==i&&n==i)return lb(a,this.__actions__);var o=[];a:for(;i--&&m<n;){j+=b;for(var p=-1,q=a[j];++p<l;){var r=k[p],s=r.iteratee,t=r.type,u=s(q);if(t==ve)q=u;else if(!u){if(t==ue)continue a;break a}}o[m++]=q}return o}function S(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function T(){this.__data__=eh?eh(null):{},this.size=0}function U(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b}function V(a){var b=this.__data__;if(eh){var c=b[a];return c===ae?Yd:c}return Ag.call(b,a)?b[a]:Yd}function W(a){var b=this.__data__;return eh?b[a]!==Yd:Ag.call(b,a)}function X(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=eh&&b===Yd?ae:b,this}function Y(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function Z(){this.__data__=[],this.size=0}function $(a){var b=this.__data__,c=ta(b,a);if(c<0)return!1;var d=b.length-1;return c==d?b.pop():Ng.call(b,c,1),--this.size,!0}function _(a){var b=this.__data__,c=ta(b,a);return c<0?Yd:b[c][1]}function aa(a){return ta(this.__data__,a)>-1}function ba(a,b){var c=this.__data__,d=ta(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this}function ca(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function da(){this.size=0,this.__data__={hash:new S,map:new(ah||Y),string:new S}}function ea(a){var b=Wb(this,a).delete(a);return this.size-=b?1:0,b}function fa(a){return Wb(this,a).get(a)}function ga(a){return Wb(this,a).has(a)}function ha(a,b){var c=Wb(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this}function ia(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new ca;++b<c;)this.add(a[b])}function ja(a){return this.__data__.set(a,ae),this}function ka(a){return this.__data__.has(a)}function la(a){var b=this.__data__=new Y(a);this.size=b.size}function ma(){this.__data__=new Y,this.size=0}function na(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c}function oa(a){return this.__data__.get(a)}function pa(a){return this.__data__.has(a)}function qa(a,b){var c=this.__data__;if(c instanceof Y){var d=c.__data__;if(!ah||d.length<$d-1)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new ca(d)}return c.set(a,b),this.size=c.size,this}function ra(a,b){var c=Hh(a),d=!c&&Gh(a),e=!c&&!d&&Ih(a),f=!c&&!d&&!e&&Mh(a),g=c||d||e||f,h=g?t(a.length,String):[],i=h.length;for(var j in a)!b&&!Ag.call(a,j)||g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||gc(j,i))||h.push(j);return h}function sa(a,b,c){var d=a[b];Ag.call(a,b)&&cd(d,c)&&(c!==Yd||b in a)||wa(a,b,c)}function ta(a,b){for(var c=a.length;c--;)if(cd(a[c][0],b))return c;return-1}function ua(a,b){return a&&zb(b,Cd(b),a)}function va(a,b){return a&&zb(b,Dd(b),a)}function wa(a,b,c){"__proto__"==b&&Rg?Rg(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c}function xa(a,b){for(var c=-1,d=b.length,e=Array(d),f=null==a;++c<d;)e[c]=f?Yd:zd(a,b[c]);return e}function ya(a,b,c){return a===a&&(c!==Yd&&(a=a<=c?a:c),b!==Yd&&(a=a>=b?a:b)),a}function za(a,b,d,e,f,g){var h,i=b&de,j=b&ee,k=b&fe;if(d&&(h=f?d(a,e,f,g):d(a)),h!==Yd)return h;if(!kd(a))return a;var l=Hh(a);if(l){if(h=bc(a),!i)return yb(a,h)}else{var m=xh(a),n=m==Ke||m==Le;if(Ih(a))return ob(a,i);if(m==Pe||m==De||n&&!f){if(h=j||n?{}:cc(a),!i)return j?Bb(a,va(h,a)):Ab(a,ua(h,a))}else{if(!dg[m])return f?a:{};h=dc(a,m,i)}}g||(g=new la);var o=g.get(a);if(o)return o;if(g.set(a,h),Lh(a))return a.forEach(function(c){h.add(za(c,b,d,c,a,g))}),h;if(Kh(a))return a.forEach(function(c,e){h.set(e,za(c,b,d,e,a,g))}),h;var p=k?j?Sb:Rb:j?Dd:Cd,q=l?Yd:p(a);return c(q||a,function(c,e){q&&(e=c,c=a[e]),sa(h,e,za(c,b,d,e,a,g))}),h}function Aa(a,b,c,d){var e=-1,i=f,j=!0,k=a.length,l=[],m=b.length;if(!k)return l;c&&(b=h(b,u(c))),d?(i=g,j=!1):b.length>=$d&&(i=w,j=!1,b=new ia(b));a:for(;++e<k;){var n=a[e],o=null==c?n:c(n);if(n=d||0!==n?n:0,j&&o===o){for(var p=m;p--;)if(b[p]===o)continue a;l.push(n)}else i(b,o,d)||l.push(n)}return l}function Ba(a,b){var c=!0;return qh(a,function(a,d,e){return c=!!b(a,d,e)}),c}function Ca(a,b,c){for(var d=-1,e=a.length;++d<e;){var f=a[d],g=b(f);if(null!=g&&(h===Yd?g===g&&!rd(g):c(g,h)))var h=g,i=f}return i}function Da(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=fc),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?Da(h,b-1,c,d,e):i(e,h):d||(e[e.length]=h)}return e}function Ea(a,b){return a&&rh(a,b,Cd)}function Fa(a,b){return e(b,function(b){return id(a[b])})}function Ga(a,b){b=mb(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[xc(b[c++])];return c&&c==d?a:Yd}function Ha(a,b,c){var d=b(a);return Hh(a)?d:i(d,c(a))}function Ia(a){return null==a?a===Yd?We:Oe:Qg&&Qg in Object(a)?Zb(a):rc(a)}function Ja(a,b){return null!=a&&Ag.call(a,b)}function Ka(a,b){return null!=a&&b in Object(a)}function La(a,b,c){return a>=Yg(b,c)&&a<Xg(b,c)}function Ma(a,c,d){c=mb(c,a),a=tc(a,c);var e=null==a?a:a[xc(Gc(c))];return null==e?Yd:b(e,a,d)}function Na(a){return ld(a)&&Ia(a)==De}function Oa(a){return ld(a)&&Ia(a)==He}function Pa(a,b,c,d,e){return a===b||(null==a||null==b||!ld(a)&&!ld(b)?a!==a&&b!==b:Qa(a,b,c,d,Pa,e))}function Qa(a,b,c,d,e,f){var g=Hh(a),h=Hh(b),i=g?Ee:xh(a),j=h?Ee:xh(b);i=i==De?Pe:i,j=j==De?Pe:j;var k=i==Pe,l=j==Pe,m=i==j;if(m&&Ih(a)){if(!Ih(b))return!1;g=!0,k=!1}if(m&&!k)return f||(f=new la),g||Mh(a)?Nb(a,b,c,d,e,f):Ob(a,b,i,c,d,e,f);if(!(c&ge)){var n=k&&Ag.call(a,"__wrapped__"),o=l&&Ag.call(b,"__wrapped__");if(n||o){var p=n?a.value():a,q=o?b.value():b;return f||(f=new la),e(p,q,c,d,f)}}return!!m&&(f||(f=new la),Pb(a,b,c,d,e,f))}function Ra(a){return ld(a)&&xh(a)==Me}function Sa(a,b,c,d){var e=c.length,f=e,g=!d;if(null==a)return!f;for(a=Object(a);e--;){var h=c[e];if(g&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++e<f;){h=c[e];var i=h[0],j=a[i],k=h[1];if(g&&h[2]){if(j===Yd&&!(i in a))return!1}else{var l=new la;if(d)var m=d(j,k,i,a,b,l);if(!(m===Yd?Pa(k,j,ge|he,d,l):m))return!1}}return!0}function Ta(a){if(!kd(a)||lc(a))return!1;var b=id(a)?Fg:Df;return b.test(yc(a))}function Ua(a){return ld(a)&&xh(a)==Te}function Va(a){return ld(a)&&jd(a.length)&&!!cg[Ia(a)]}function Wa(a){return"function"==typeof a?a:null==a?Pd:"object"==typeof a?Hh(a)?ab(a[0],a[1]):_a(a):Ud(a)}function Xa(a){if(!mc(a))return Wg(a);var b=[];for(var c in Object(a))Ag.call(a,c)&&"constructor"!=c&&b.push(c);return b}function Ya(a){if(!kd(a))return qc(a);var b=mc(a),c=[];for(var d in a)("constructor"!=d||!b&&Ag.call(a,d))&&c.push(d);return c}function Za(a,b){return a<b}function $a(a,b){var c=-1,d=dd(a)?Array(a.length):[];return qh(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function _a(a){var b=Xb(a);return 1==b.length&&b[0][2]?oc(b[0][0],b[0][1]):function(c){return c===a||Sa(c,a,b)}}function ab(a,b){return ic(a)&&nc(b)?oc(xc(a),b):function(c){var d=zd(c,a);return d===Yd&&d===b?Bd(c,a):Pa(b,d,ge|he)}}function bb(a,b,c){var d=-1;b=h(b.length?b:[Pd],u(Vb()));var e=$a(a,function(a,c,e){var f=h(b,function(b){return b(a)});return{criteria:f,index:++d,value:a}});return s(e,function(a,b){return vb(a,b,c)})}function cb(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=Ga(a,g);c(h,g)&&hb(f,mb(g,a),h)}return f}function db(a){return function(b){return Ga(b,a)}}function eb(a,b,c,d){var e=d?o:n,f=-1,g=b.length,i=a;for(a===b&&(b=yb(b)),c&&(i=h(a,u(c)));++f<g;)for(var j=0,k=b[f],l=c?c(k):k;(j=e(i,l,j,d))>-1;)i!==a&&Ng.call(i,j,1),Ng.call(a,j,1);return a}function fb(a,b){var c="";if(!a||b<1||b>ye)return c;do b%2&&(c+=a),b=Tg(b/2),b&&(a+=a);while(b);return c}function gb(a,b){return zh(sc(a,b,Pd),a+"")}function hb(a,b,c,d){if(!kd(a))return a;b=mb(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=xc(b[e]),j=c;if(e!=g){var k=h[i];j=d?d(k,i,h):Yd,j===Yd&&(j=kd(k)?k:gc(b[e+1])?[]:{})}sa(h,i,j),h=h[i]}return a}function ib(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),c=c>e?e:c,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function jb(a,b){var c;return qh(a,function(a,d,e){return c=b(a,d,e),!c}),!!c}function kb(a){if("string"==typeof a)return a;if(Hh(a))return h(a,kb)+"";if(rd(a))return oh?oh.call(a):"";var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function lb(a,b){var c=a;return c instanceof O&&(c=c.value()),j(b,function(a,b){return b.func.apply(b.thisArg,i([a],b.args))},c)}function mb(a,b){return Hh(a)?a:ic(a,b)?[a]:Ah(xd(a))}function nb(a,b,c){var d=a.length;return c=c===Yd?d:c,!b&&c>=d?a:ib(a,b,c)}function ob(a,b){if(b)return a.slice();var c=a.length,d=Jg?Jg(c):new a.constructor(c);return a.copy(d),d}function pb(a){var b=new a.constructor(a.byteLength);return new Ig(b).set(new Ig(a)),b}function qb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)}function rb(a){var b=new a.constructor(a.source,Af.exec(a));return b.lastIndex=a.lastIndex,b}function sb(a){return nh?Object(nh.call(a)):{}}function tb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)}function ub(a,b){if(a!==b){var c=a!==Yd,d=null===a,e=a===a,f=rd(a),g=b!==Yd,h=null===b,i=b===b,j=rd(b);if(!h&&!j&&!f&&a>b||f&&g&&i&&!h&&!j||d&&g&&i||!c&&i||!e)return 1;if(!d&&!f&&!j&&a<b||j&&c&&e&&!d&&!f||h&&c&&e||!g&&e||!i)return-1}return 0}function vb(a,b,c){for(var d=-1,e=a.criteria,f=b.criteria,g=e.length,h=c.length;++d<g;){var i=ub(e[d],f[d]);if(i){if(d>=h)return i;var j=c[d];return i*("desc"==j?-1:1)}}return a.index-b.index}function wb(a,b,c,d){for(var e=-1,f=a.length,g=c.length,h=-1,i=b.length,j=Xg(f-g,0),k=Array(i+j),l=!d;++h<i;)k[h]=b[h];for(;++e<g;)(l||e<f)&&(k[c[e]]=a[e]);for(;j--;)k[h++]=a[e++];return k}function xb(a,b,c,d){for(var e=-1,f=a.length,g=-1,h=c.length,i=-1,j=b.length,k=Xg(f-h,0),l=Array(k+j),m=!d;++e<k;)l[e]=a[e];for(var n=e;++i<j;)l[n+i]=b[i];for(;++g<h;)(m||e<f)&&(l[n+c[g]]=a[e++]);return l}function yb(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}function zb(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):Yd;i===Yd&&(i=a[h]),e?wa(c,h,i):sa(c,h,i)}return c}function Ab(a,b){return zb(a,vh(a),b)}function Bb(a,b){return zb(a,wh(a),b)}function Cb(a){return gb(function(b,c){var d=-1,e=c.length,f=e>1?c[e-1]:Yd,g=e>2?c[2]:Yd;for(f=a.length>3&&"function"==typeof f?(e--,f):Yd,g&&hc(c[0],c[1],g)&&(f=e<3?Yd:f,e=1),b=Object(b);++d<e;){var h=c[d];h&&a(b,h,d,f)}return b})}function Db(a,b){return function(c,d){if(null==c)return c;if(!dd(c))return a(c,d);for(var e=c.length,f=b?e:-1,g=Object(c);(b?f--:++f<e)&&d(g[f],f,g)!==!1;);return c}}function Eb(a){return function(b,c,d){for(var e=-1,f=Object(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(c(f[i],i,f)===!1)break}return b}}function Fb(a){return function(b){b=xd(b);var c=A(b)?I(b):Yd,d=c?c[0]:b.charAt(0),e=c?nb(c,1).join(""):b.slice(1);return d[a]()+e}}function Gb(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=ph(a.prototype),d=a.apply(c,b);return kd(d)?d:c}}function Hb(a){return function(b,c,d){var e=Object(b);if(!dd(b)){var f=Vb(c,3);b=Cd(b),c=function(a){return f(e[a],a,e)}}var g=a(b,c,d);return g>-1?e[f?b[g]:g]:Yd}}function Ib(a,b,c,d,e,f,g,h,i,j){function k(){for(var r=arguments.length,s=Array(r),t=r;t--;)s[t]=arguments[t];if(o)var u=Ub(k),v=x(s,u);if(d&&(s=wb(s,d,e,o)),f&&(s=xb(s,f,g,o)),r-=v,o&&r<j){var w=E(s,u);return Kb(a,b,Ib,k.placeholder,c,s,w,h,i,j-r)}var y=m?c:this,z=n?y[a]:a;return r=s.length,h?s=uc(s,h):p&&r>1&&s.reverse(),l&&i<r&&(s.length=i),this&&this!==jg&&this instanceof k&&(z=q||Gb(z)),z.apply(y,s)}var l=b&pe,m=b&ie,n=b&je,o=b&(le|me),p=b&re,q=n?Yd:Gb(a);return k}function Jb(a,b){b=b===Yd?" ":kb(b);var c=b.length;if(c<2)return c?fb(b,a):b;var d=fb(b,Sg(a/H(b)));return A(b)?nb(I(d),0,a).join(""):d.slice(0,a)}function Kb(a,b,c,d,e,f,g,h,i,j){var k=b&le,l=k?g:Yd,m=k?Yd:g,n=k?f:Yd,o=k?Yd:f;b|=k?ne:oe,b&=~(k?oe:ne),b&ke||(b&=~(ie|je));var p=[a,b,e,n,l,o,m,h,i,j],q=c.apply(Yd,p);return kc(a)&&yh(q,p),q.placeholder=d,vc(q,a,b)}function Lb(a){var b=Math[a];return function(a,c){if(a=wd(a),c=null==c?0:Yg(vd(c),292)){var d=(xd(a)+"e").split("e"),e=b(d[0]+"e"+(+d[1]+c));return d=(xd(e)+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}function Mb(a,b,c,d){return a===Yd||cd(a,xg[c])&&!Ag.call(d,c)?b:a}function Nb(a,b,c,d,e,f){var g=c&ge,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var l=-1,m=!0,n=c&he?new ia:Yd;for(f.set(a,b),f.set(b,a);++l<h;){var o=a[l],p=b[l];if(d)var q=g?d(p,o,l,b,a,f):d(o,p,l,a,b,f);if(q!==Yd){if(q)continue;m=!1;break}if(n){if(!k(b,function(a,b){if(!w(n,b)&&(o===a||e(o,a,c,d,f)))return n.push(b)})){m=!1;break}}else if(o!==p&&!e(o,p,c,d,f)){m=!1;break}}return f.delete(a),f.delete(b),m}function Ob(a,b,c,d,e,f,g){switch(c){case Ze:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case Ye:return!(a.byteLength!=b.byteLength||!f(new Ig(a),new Ig(b)));case Ge:case He:case Ne:return cd(+a,+b);case Je:return a.name==b.name&&a.message==b.message;case Se:case Ue:return a==b+"";case Me:var h=C;case Te:var i=d&ge;if(h||(h=F),a.size!=b.size&&!i)return!1;var j=g.get(a);if(j)return j==b;d|=he,g.set(a,b);var k=Nb(h(a),h(b),d,e,f,g);return g.delete(a),k;case Ve:if(nh)return nh.call(a)==nh.call(b)}return!1}function Pb(a,b,c,d,e,f){var g=c&ge,h=Rb(a),i=h.length,j=Rb(b),k=j.length;if(i!=k&&!g)return!1;for(var l=i;l--;){var m=h[l];if(!(g?m in b:Ag.call(b,m)))return!1}var n=f.get(a);if(n&&f.get(b))return n==b;var o=!0;f.set(a,b),f.set(b,a);for(var p=g;++l<i;){m=h[l];var q=a[m],r=b[m];if(d)var s=g?d(r,q,m,b,a,f):d(q,r,m,a,b,f);if(!(s===Yd?q===r||e(q,r,c,d,f):s)){o=!1;break}p||(p="constructor"==m)}if(o&&!p){var t=a.constructor,u=b.constructor;t!=u&&"constructor"in a&&"constructor"in b&&!("function"==typeof t&&t instanceof t&&"function"==typeof u&&u instanceof u)&&(o=!1)}return f.delete(a),f.delete(b),o}function Qb(a){return zh(sc(a,Yd,Ec),a+"")}function Rb(a){return Ha(a,Cd,vh)}function Sb(a){return Ha(a,Dd,wh)}function Tb(a){for(var b=a.name+"",c=gh[b],d=Ag.call(gh,b)?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function Ub(a){var b=Ag.call(L,"placeholder")?L:a;return b.placeholder}function Vb(){var a=L.iteratee||Qd;return a=a===Qd?Wa:a,arguments.length?a(arguments[0],arguments[1]):a}function Wb(a,b){var c=a.__data__;return jc(b)?c["string"==typeof b?"string":"hash"]:c.map}function Xb(a){for(var b=Cd(a),c=b.length;c--;){var d=b[c],e=a[d];b[c]=[d,e,nc(e)]}return b}function Yb(a,b){var c=z(a,b);return Ta(c)?c:Yd}function Zb(a){var b=Ag.call(a,Qg),c=a[Qg];try{a[Qg]=Yd;var d=!0}catch(a){}var e=Cg.call(a);return d&&(b?a[Qg]=c:delete a[Qg]),e}function $b(a,b,c){for(var d=-1,e=c.length;++d<e;){var f=c[d],g=f.size;switch(f.type){case"drop":a+=g;break;case"dropRight":b-=g;break;case"take":b=Yg(b,a+g);break;case"takeRight":a=Xg(a,b-g)}}return{start:a,end:b}}function _b(a){var b=a.match(wf);return b?b[1].split(xf):[]}function ac(a,b,c){b=mb(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=xc(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f||++d!=e?f:(e=null==a?0:a.length,!!e&&jd(e)&&gc(g,e)&&(Hh(a)||Gh(a)))}function bc(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&Ag.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function cc(a){return"function"!=typeof a.constructor||mc(a)?{}:ph(Kg(a))}function dc(a,b,c){var d=a.constructor;switch(b){case Ye:return pb(a);case Ge:case He:return new d(+a);case Ze:return qb(a,c);case $e:case _e:case af:case bf:case cf:case df:case ef:case ff:case gf:return tb(a,c);case Me:return new d;case Ne:case Ue:return new d(a);case Se:return rb(a);case Te:return new d;case Ve:return sb(a)}}function ec(a,b){var c=b.length;if(!c)return a;var d=c-1;return b[d]=(c>1?"& ":"")+b[d],b=b.join(c>2?", ":" "),a.replace(vf,"{\n/* [wrapped with "+b+"] */\n")}function fc(a){return Hh(a)||Gh(a)||!!(Og&&a&&a[Og])}function gc(a,b){var c=typeof a;return b=null==b?ye:b,!!b&&("number"==c||"symbol"!=c&&Ff.test(a))&&a>-1&&a%1==0&&a<b}function hc(a,b,c){if(!kd(c))return!1;var d=typeof b;return!!("number"==d?dd(c)&&gc(b,c.length):"string"==d&&b in c)&&cd(c[b],a)}function ic(a,b){if(Hh(a))return!1;var c=typeof a;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=a&&!rd(a))||(rf.test(a)||!qf.test(a)||null!=b&&a in Object(b))}function jc(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a}function kc(a){var b=Tb(a),c=L[b];if("function"!=typeof c||!(b in O.prototype))return!1;if(a===c)return!0;var d=uh(c);return!!d&&a===d[0]}function lc(a){return!!Bg&&Bg in a}function mc(a){var b=a&&a.constructor,c="function"==typeof b&&b.prototype||xg;return a===c}function nc(a){return a===a&&!kd(a)}function oc(a,b){return function(c){return null!=c&&(c[a]===b&&(b!==Yd||a in Object(c)))}}function pc(a){var b=Zc(a,function(a){return c.size===be&&c.clear(),a}),c=b.cache;return b}function qc(a){var b=[];if(null!=a)for(var c in Object(a))b.push(c);return b}function rc(a){return Cg.call(a)}function sc(a,c,d){return c=Xg(c===Yd?a.length-1:c,0),function(){for(var e=arguments,f=-1,g=Xg(e.length-c,0),h=Array(g);++f<g;)h[f]=e[c+f];f=-1;for(var i=Array(c+1);++f<c;)i[f]=e[f];return i[c]=d(h),b(a,this,i)}}function tc(a,b){return b.length<2?a:Ga(a,ib(b,0,-1))}function uc(a,b){for(var c=a.length,d=Yg(b.length,c),e=yb(a);d--;){var f=b[d];a[d]=gc(f,c)?e[f]:Yd}return a}function vc(a,b,c){var d=b+"";return zh(a,ec(d,zc(_b(d),c)))}function wc(a){var b=0,c=0;return function(){var d=Zg(),e=te-(d-c);if(c=d,e>0){if(++b>=se)return arguments[0]}else b=0;return a.apply(Yd,arguments)}}function xc(a){if("string"==typeof a||rd(a))return a;var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function yc(a){if(null!=a){try{return zg.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function zc(a,b){return c(Ce,function(c){var d="_."+c[0];b&c[1]&&!f(a,d)&&a.push(d)}),a.sort()}function Ac(a){if(a instanceof O)return a.clone();var b=new N(a.__wrapped__,a.__chain__);return b.__actions__=yb(a.__actions__),b.__index__=a.__index__,b.__values__=a.__values__,b}function Bc(a){for(var b=-1,c=null==a?0:a.length,d=0,e=[];++b<c;){var f=a[b];f&&(e[d++]=f)}return e}function Cc(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===Yd?1:vd(b),ib(a,b<0?0:b,d)):[]}function Dc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),m(a,Vb(b,3),e)}function Ec(a){var b=null==a?0:a.length;return b?Da(a,1):[]}function Fc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),n(a,b,e)}function Gc(a){var b=null==a?0:a.length;return b?a[b-1]:Yd}function Hc(a,b){return a&&a.length&&b&&b.length?eb(a,b):a}function Ic(a){return null==a?a:$g.call(a)}function Jc(a){var b=L(a);return b.__chain__=!0,b}function Kc(a,b){return b(a),a}function Lc(a,b){return b(a)}function Mc(){return Jc(this)}function Nc(){return new N(this.value(),this.__chain__)}function Oc(){this.__values__===Yd&&(this.__values__=td(this.value()));var a=this.__index__>=this.__values__.length,b=a?Yd:this.__values__[this.__index__++];return{done:a,value:b}}function Pc(){return this}function Qc(a){for(var b,c=this;c instanceof M;){var d=Ac(c);d.__index__=0,d.__values__=Yd,b?e.__wrapped__=d:b=d;var e=d;c=c.__wrapped__}return e.__wrapped__=a,b}function Rc(){var a=this.__wrapped__;if(a instanceof O){var b=a;return this.__actions__.length&&(b=new O(this)),b=b.reverse(),b.__actions__.push({func:Lc,args:[Ic],thisArg:Yd}),new N(b,this.__chain__)}return this.thru(Ic)}function Sc(){return lb(this.__wrapped__,this.__actions__)}function Tc(a,b,c){var e=Hh(a)?d:Ba;return c&&hc(a,b,c)&&(b=Yd),e(a,Vb(b,3))}function Uc(a,b){var d=Hh(a)?c:qh;return d(a,Vb(b,3))}function Vc(a,b,c,d){a=dd(a)?a:Gd(a),c=c&&!d?vd(c):0;var e=a.length;return c<0&&(c=Xg(e+c,0)),qd(a)?c<=e&&a.indexOf(b,c)>-1:!!e&&n(a,b,c)>-1}function Wc(a,b){var c=Hh(a)?h:$a;return c(a,Vb(b,3))}function Xc(a,b,c){var d=Hh(a)?k:jb;return c&&hc(a,b,c)&&(b=Yd),d(a,Vb(b,3))}function Yc(a,b,c){function d(b){var c=m,d=n;return m=n=Yd,s=b,p=a.apply(d,c)}function e(a){return s=a,q=setTimeout(h,b),t?d(a):p}function f(a){var c=a-r,d=a-s,e=b-c;return u?Yg(e,o-d):e}function g(a){var c=a-r,d=a-s;return r===Yd||c>=b||c<0||u&&d>=o}function h(){var a=Fh();return g(a)?i(a):void(q=setTimeout(h,f(a)))}function i(a){return q=Yd,v&&m?d(a):(m=n=Yd,p)}function j(){q!==Yd&&clearTimeout(q),s=0,m=r=n=q=Yd}function k(){return q===Yd?p:i(Fh())}function l(){var a=Fh(),c=g(a);if(m=arguments,n=this,r=a,c){if(q===Yd)return e(r);if(u)return q=setTimeout(h,b),d(r)}return q===Yd&&(q=setTimeout(h,b)),p}var m,n,o,p,q,r,s=0,t=!1,u=!1,v=!0;if("function"!=typeof a)throw new TypeError(_d);return b=wd(b)||0,kd(c)&&(t=!!c.leading,u="maxWait"in c,o=u?Xg(wd(c.maxWait)||0,b):o,v="trailing"in c?!!c.trailing:v),l.cancel=j,l.flush=k,l}function Zc(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError(_d);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(Zc.Cache||ca),c}function $c(a){if("function"!=typeof a)throw new TypeError(_d);return function(){var b=arguments;switch(b.length){case 0:return!a.call(this);case 1:return!a.call(this,b[0]);case 2:return!a.call(this,b[0],b[1]);case 3:return!a.call(this,b[0],b[1],b[2])}return!a.apply(this,b)}}function _c(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new TypeError(_d);return kd(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),Yc(a,b,{leading:d,maxWait:b,trailing:e})}function ad(a){return za(a,fe)}function bd(a){return za(a,de|fe)}function cd(a,b){return a===b||a!==a&&b!==b}function dd(a){return null!=a&&jd(a.length)&&!id(a)}function ed(a){return ld(a)&&dd(a)}function fd(a){return a===!0||a===!1||ld(a)&&Ia(a)==Ge}function gd(a){if(null==a)return!0;if(dd(a)&&(Hh(a)||"string"==typeof a||"function"==typeof a.splice||Ih(a)||Mh(a)||Gh(a)))return!a.length;var b=xh(a);if(b==Me||b==Te)return!a.size;if(mc(a))return!Xa(a).length;for(var c in a)if(Ag.call(a,c))return!1;return!0}function hd(a){if(!ld(a))return!1;var b=Ia(a);return b==Je||b==Ie||"string"==typeof a.message&&"string"==typeof a.name&&!pd(a)}function id(a){if(!kd(a))return!1;var b=Ia(a);return b==Ke||b==Le||b==Fe||b==Re}function jd(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=ye}function kd(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function ld(a){return null!=a&&"object"==typeof a}function md(a){return od(a)&&a!=+a}function nd(a){return null===a}function od(a){return"number"==typeof a||ld(a)&&Ia(a)==Ne}function pd(a){if(!ld(a)||Ia(a)!=Pe)return!1;var b=Kg(a);if(null===b)return!0;var c=Ag.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&zg.call(c)==Dg}function qd(a){return"string"==typeof a||!Hh(a)&&ld(a)&&Ia(a)==Ue}function rd(a){return"symbol"==typeof a||ld(a)&&Ia(a)==Ve}function sd(a){return a===Yd}function td(a){if(!a)return[];if(dd(a))return qd(a)?I(a):yb(a);if(Pg&&a[Pg])return B(a[Pg]());var b=xh(a),c=b==Me?C:b==Te?F:Gd;return c(a)}function ud(a){if(!a)return 0===a?a:0;if(a=wd(a),a===xe||a===-xe){var b=a<0?-1:1;return b*ze}return a===a?a:0}function vd(a){var b=ud(a),c=b%1;return b===b?c?b-c:b:0}function wd(a){if("number"==typeof a)return a;if(rd(a))return Ae;if(kd(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=kd(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(uf,"");var c=Cf.test(a);return c||Ef.test(a)?gg(a.slice(2),c?2:8):Bf.test(a)?Ae:+a}function xd(a){return null==a?"":kb(a)}function yd(a,b){return a&&Ea(a,Vb(b,3))}function zd(a,b,c){var d=null==a?Yd:Ga(a,b);return d===Yd?c:d}function Ad(a,b){return null!=a&&ac(a,b,Ja)}function Bd(a,b){return null!=a&&ac(a,b,Ka)}function Cd(a){return dd(a)?ra(a):Xa(a)}function Dd(a){return dd(a)?ra(a,!0):Ya(a)}function Ed(a,b){return Fd(a,$c(Vb(b)))}function Fd(a,b){if(null==a)return{};var c=h(Sb(a),function(a){return[a]});return b=Vb(b),cb(a,c,function(a,c){return b(a,c[0])})}function Gd(a){return null==a?[]:v(a,Cd(a))}function Hd(a,b,c){return b=ud(b),c===Yd?(c=b,b=0):c=ud(c),a=wd(a),La(a,b,c)}function Id(a){return Qh(xd(a).toLowerCase())}function Jd(a,b,c){a=xd(a),b=kb(b);var d=a.length;c=c===Yd?d:ya(vd(c),0,d);var e=c;return c-=b.length,c>=0&&a.slice(c,e)==b}function Kd(a){return a=xd(a),a&&mf.test(a)?a.replace(lf,ug):a}function Ld(a,b,c){a=xd(a),b=vd(b);var d=b?H(a):0;return b&&d<b?Jb(b-d,c)+a:a}function Md(a,b,c){return a=xd(a),c=null==c?0:ya(vd(c),0,a.length),b=kb(b),a.slice(c,c+b.length)==b}function Nd(a,b,c){var d=L.templateSettings;c&&hc(a,b,c)&&(b=Yd),a=xd(a),b=Ph({},b,d,Mb);var e,f,g=Ph({},b.imports,d.imports,Mb),h=Cd(g),i=v(g,h),j=0,k=b.interpolate||Gf,l="__p += '",m=RegExp((b.escape||Gf).source+"|"+k.source+"|"+(k===pf?zf:Gf).source+"|"+(b.evaluate||Gf).source+"|$","g"),n="//# sourceURL="+("sourceURL"in b?b.sourceURL:"lodash.templateSources["+ ++bg+"]")+"\n";a.replace(m,function(b,c,d,g,h,i){return d||(d=g),l+=a.slice(j,i).replace(Hf,y),c&&(e=!0,l+="' +\n__e("+c+") +\n'"),h&&(f=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var o=b.variable;o||(l="with (obj) {\n"+l+"\n}\n"),l=(f?l.replace(hf,""):l).replace(jf,"$1").replace(kf,"$1;"),l="function("+(o||"obj")+") {\n"+(o?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(e?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var p=Rh(function(){return Function(h,n+"return "+l).apply(Yd,i)});if(p.source=l,hd(p))throw p;return p}function Od(a){return function(){return a}}function Pd(a){return a}function Qd(a){return Wa("function"==typeof a?a:za(a,de))}function Rd(a,b,d){var e=Cd(b),f=Fa(b,e);null!=d||kd(b)&&(f.length||!e.length)||(d=b,b=a,a=this,f=Fa(b,Cd(b)));var g=!(kd(d)&&"chain"in d&&!d.chain),h=id(a);return c(f,function(c){var d=b[c];a[c]=d,h&&(a.prototype[c]=function(){var b=this.__chain__;if(g||b){var c=a(this.__wrapped__),e=c.__actions__=yb(this.__actions__);return e.push({func:d,args:arguments,thisArg:a}),c.__chain__=b,c}return d.apply(a,i([this.value()],arguments))})}),a}function Sd(){return jg._===this&&(jg._=Eg),this}function Td(){}function Ud(a){return ic(a)?q(xc(a)):db(a)}function Vd(){return[]}function Wd(){return!1}function Xd(a){return a&&a.length?Ca(a,Pd,Za):Yd}var Yd,Zd="4.17.5",$d=200,_d="Expected a function",ae="__lodash_hash_undefined__",be=500,ce="__lodash_placeholder__",de=1,ee=2,fe=4,ge=1,he=2,ie=1,je=2,ke=4,le=8,me=16,ne=32,oe=64,pe=128,qe=256,re=512,se=800,te=16,ue=1,ve=2,we=3,xe=1/0,ye=9007199254740991,ze=1.7976931348623157e308,Ae=NaN,Be=4294967295,Ce=[["ary",pe],["bind",ie],["bindKey",je],["curry",le],["curryRight",me],["flip",re],["partial",ne],["partialRight",oe],["rearg",qe]],De="[object Arguments]",Ee="[object Array]",Fe="[object AsyncFunction]",Ge="[object Boolean]",He="[object Date]",Ie="[object DOMException]",Je="[object Error]",Ke="[object Function]",Le="[object GeneratorFunction]",Me="[object Map]",Ne="[object Number]",Oe="[object Null]",Pe="[object Object]",Qe="[object Promise]",Re="[object Proxy]",Se="[object RegExp]",Te="[object Set]",Ue="[object String]",Ve="[object Symbol]",We="[object Undefined]",Xe="[object WeakMap]",Ye="[object ArrayBuffer]",Ze="[object DataView]",$e="[object Float32Array]",_e="[object Float64Array]",af="[object Int8Array]",bf="[object Int16Array]",cf="[object Int32Array]",df="[object Uint8Array]",ef="[object Uint8ClampedArray]",ff="[object Uint16Array]",gf="[object Uint32Array]",hf=/\b__p \+= '';/g,jf=/\b(__p \+=) '' \+/g,kf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,lf=/[&<>"']/g,mf=RegExp(lf.source),nf=/<%-([\s\S]+?)%>/g,of=/<%([\s\S]+?)%>/g,pf=/<%=([\s\S]+?)%>/g,qf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rf=/^\w*$/,sf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tf=/[\\^$.*+?()[\]{}|]/g,uf=/^\s+|\s+$/g,vf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wf=/\{\n\/\* \[wrapped with (.+)\] \*/,xf=/,? & /,yf=/\\(\\)?/g,zf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Af=/\w*$/,Bf=/^[-+]0x[0-9a-f]+$/i,Cf=/^0b[01]+$/i,Df=/^\[object .+?Constructor\]$/,Ef=/^0o[0-7]+$/i,Ff=/^(?:0|[1-9]\d*)$/,Gf=/($^)/,Hf=/['\n\r\u2028\u2029\\]/g,If="\\ud800-\\udfff",Jf="\\u0300-\\u036f",Kf="\\ufe20-\\ufe2f",Lf="\\u20d0-\\u20ff",Mf=Jf+Kf+Lf,Nf="\\ufe0e\\ufe0f",Of="["+If+"]",Pf="["+Mf+"]",Qf="\\ud83c[\\udffb-\\udfff]",Rf="(?:"+Pf+"|"+Qf+")",Sf="[^"+If+"]",Tf="(?:\\ud83c[\\udde6-\\uddff]){2}",Uf="[\\ud800-\\udbff][\\udc00-\\udfff]",Vf="\\u200d",Wf=Rf+"?",Xf="["+Nf+"]?",Yf="(?:"+Vf+"(?:"+[Sf,Tf,Uf].join("|")+")"+Xf+Wf+")*",Zf=Xf+Wf+Yf,$f="(?:"+[Sf+Pf+"?",Pf,Tf,Uf,Of].join("|")+")",_f=RegExp(Qf+"(?="+Qf+")|"+$f+Zf,"g"),ag=RegExp("["+Vf+If+Mf+Nf+"]"),bg=-1,cg={};
cg[$e]=cg[_e]=cg[af]=cg[bf]=cg[cf]=cg[df]=cg[ef]=cg[ff]=cg[gf]=!0,cg[De]=cg[Ee]=cg[Ye]=cg[Ge]=cg[Ze]=cg[He]=cg[Je]=cg[Ke]=cg[Me]=cg[Ne]=cg[Pe]=cg[Se]=cg[Te]=cg[Ue]=cg[Xe]=!1;var dg={};dg[De]=dg[Ee]=dg[Ye]=dg[Ze]=dg[Ge]=dg[He]=dg[$e]=dg[_e]=dg[af]=dg[bf]=dg[cf]=dg[Me]=dg[Ne]=dg[Pe]=dg[Se]=dg[Te]=dg[Ue]=dg[Ve]=dg[df]=dg[ef]=dg[ff]=dg[gf]=!0,dg[Je]=dg[Ke]=dg[Xe]=!1;var eg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gg=parseInt,hg="object"==typeof global&&global&&global.Object===Object&&global,ig="object"==typeof self&&self&&self.Object===Object&&self,jg=hg||ig||Function("return this")(),kg="object"==typeof exports&&exports&&!exports.nodeType&&exports,lg=kg&&"object"==typeof module&&module&&!module.nodeType&&module,mg=lg&&lg.exports===kg,ng=mg&&hg.process,og=function(){try{return ng&&ng.binding&&ng.binding("util")}catch(a){}}(),pg=og&&og.isDate,qg=og&&og.isMap,rg=og&&og.isSet,sg=og&&og.isTypedArray,tg=q("length"),ug=r(eg),vg=Array.prototype,wg=Function.prototype,xg=Object.prototype,yg=jg["__core-js_shared__"],zg=wg.toString,Ag=xg.hasOwnProperty,Bg=function(){var a=/[^.]+$/.exec(yg&&yg.keys&&yg.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),Cg=xg.toString,Dg=zg.call(Object),Eg=jg._,Fg=RegExp("^"+zg.call(Ag).replace(tf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gg=mg?jg.Buffer:Yd,Hg=jg.Symbol,Ig=jg.Uint8Array,Jg=Gg?Gg.allocUnsafe:Yd,Kg=D(Object.getPrototypeOf,Object),Lg=Object.create,Mg=xg.propertyIsEnumerable,Ng=vg.splice,Og=Hg?Hg.isConcatSpreadable:Yd,Pg=Hg?Hg.iterator:Yd,Qg=Hg?Hg.toStringTag:Yd,Rg=function(){try{var a=Yb(Object,"defineProperty");return a({},"",{}),a}catch(a){}}(),Sg=Math.ceil,Tg=Math.floor,Ug=Object.getOwnPropertySymbols,Vg=Gg?Gg.isBuffer:Yd,Wg=D(Object.keys,Object),Xg=Math.max,Yg=Math.min,Zg=Date.now,$g=vg.reverse,_g=Yb(jg,"DataView"),ah=Yb(jg,"Map"),bh=Yb(jg,"Promise"),ch=Yb(jg,"Set"),dh=Yb(jg,"WeakMap"),eh=Yb(Object,"create"),fh=dh&&new dh,gh={},hh=yc(_g),ih=yc(ah),jh=yc(bh),kh=yc(ch),lh=yc(dh),mh=Hg?Hg.prototype:Yd,nh=mh?mh.valueOf:Yd,oh=mh?mh.toString:Yd,ph=function(){function a(){}return function(b){if(!kd(b))return{};if(Lg)return Lg(b);a.prototype=b;var c=new a;return a.prototype=Yd,c}}();L.templateSettings={escape:nf,evaluate:of,interpolate:pf,variable:"",imports:{_:L}},L.prototype=M.prototype,L.prototype.constructor=L,N.prototype=ph(M.prototype),N.prototype.constructor=N,O.prototype=ph(M.prototype),O.prototype.constructor=O,S.prototype.clear=T,S.prototype.delete=U,S.prototype.get=V,S.prototype.has=W,S.prototype.set=X,Y.prototype.clear=Z,Y.prototype.delete=$,Y.prototype.get=_,Y.prototype.has=aa,Y.prototype.set=ba,ca.prototype.clear=da,ca.prototype.delete=ea,ca.prototype.get=fa,ca.prototype.has=ga,ca.prototype.set=ha,ia.prototype.add=ia.prototype.push=ja,ia.prototype.has=ka,la.prototype.clear=ma,la.prototype.delete=na,la.prototype.get=oa,la.prototype.has=pa,la.prototype.set=qa;var qh=Db(Ea),rh=Eb(),sh=fh?function(a,b){return fh.set(a,b),a}:Pd,th=Rg?function(a,b){return Rg(a,"toString",{configurable:!0,enumerable:!1,value:Od(b),writable:!0})}:Pd,uh=fh?function(a){return fh.get(a)}:Td,vh=Ug?function(a){return null==a?[]:(a=Object(a),e(Ug(a),function(b){return Mg.call(a,b)}))}:Vd,wh=Ug?function(a){for(var b=[];a;)i(b,vh(a)),a=Kg(a);return b}:Vd,xh=Ia;(_g&&xh(new _g(new ArrayBuffer(1)))!=Ze||ah&&xh(new ah)!=Me||bh&&xh(bh.resolve())!=Qe||ch&&xh(new ch)!=Te||dh&&xh(new dh)!=Xe)&&(xh=function(a){var b=Ia(a),c=b==Pe?a.constructor:Yd,d=c?yc(c):"";if(d)switch(d){case hh:return Ze;case ih:return Me;case jh:return Qe;case kh:return Te;case lh:return Xe}return b});var yh=wc(sh),zh=wc(th),Ah=pc(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(sf,function(a,c,d,e){b.push(d?e.replace(yf,"$1"):c||a)}),b}),Bh=gb(Hc),Ch=gb(function(a,b){return ed(a)?Aa(a,b):[]}),Dh=(Qb(function(a){var b=a.length,c=b?a[0]:0,d=this.__wrapped__,e=function(b){return xa(b,a)};return!(b>1||this.__actions__.length)&&d instanceof O&&gc(c)?(d=d.slice(c,+c+(b?1:0)),d.__actions__.push({func:Lc,args:[e],thisArg:Yd}),new N(d,this.__chain__).thru(function(a){return b&&!a.length&&a.push(Yd),a})):this.thru(e)}),Hb(Dc)),Eh=gb(function(a,b){if(null==a)return[];var c=b.length;return c>1&&hc(a,b[0],b[1])?b=[]:c>2&&hc(b[0],b[1],b[2])&&(b=[b[0]]),bb(a,Da(b,1),[])}),Fh=function(){return jg.Date.now()};Zc.Cache=ca;var Gh=Na(function(){return arguments}())?Na:function(a){return ld(a)&&Ag.call(a,"callee")&&!Mg.call(a,"callee")},Hh=Array.isArray,Ih=Vg||Wd,Jh=pg?u(pg):Oa,Kh=qg?u(qg):Ra,Lh=rg?u(rg):Ua,Mh=sg?u(sg):Va,Nh=Cb(function(a,b){if(mc(b)||dd(b))return void zb(b,Cd(b),a);for(var c in b)Ag.call(b,c)&&sa(a,c,b[c])}),Oh=Cb(function(a,b){zb(b,Dd(b),a)}),Ph=Cb(function(a,b,c,d){zb(b,Dd(b),a,d)}),Qh=Fb("toUpperCase"),Rh=gb(function(a,c){try{return b(a,Yd,c)}catch(a){return hd(a)?a:new Error(a)}}),Sh=Lb("round");L.assign=Nh,L.assignIn=Oh,L.assignInWith=Ph,L.chain=Jc,L.compact=Bc,L.constant=Od,L.debounce=Yc,L.drop=Cc,L.flatten=Ec,L.iteratee=Qd,L.keys=Cd,L.keysIn=Dd,L.map=Wc,L.memoize=Zc,L.mixin=Rd,L.negate=$c,L.omitBy=Ed,L.pickBy=Fd,L.property=Ud,L.pull=Bh,L.pullAll=Hc,L.reverse=Ic,L.sortBy=Eh,L.tap=Kc,L.throttle=_c,L.thru=Lc,L.toArray=td,L.values=Gd,L.without=Ch,L.extend=Oh,L.extendWith=Ph,Rd(L,L),L.attempt=Rh,L.capitalize=Id,L.clone=ad,L.cloneDeep=bd,L.endsWith=Jd,L.eq=cd,L.escape=Kd,L.every=Tc,L.find=Dh,L.findIndex=Dc,L.forEach=Uc,L.forOwn=yd,L.get=zd,L.has=Ad,L.hasIn=Bd,L.identity=Pd,L.includes=Vc,L.indexOf=Fc,L.inRange=Hd,L.isArguments=Gh,L.isArray=Hh,L.isArrayLike=dd,L.isArrayLikeObject=ed,L.isBoolean=fd,L.isBuffer=Ih,L.isDate=Jh,L.isEmpty=gd,L.isError=hd,L.isFunction=id,L.isLength=jd,L.isMap=Kh,L.isNaN=md,L.isNull=nd,L.isNumber=od,L.isObject=kd,L.isObjectLike=ld,L.isPlainObject=pd,L.isSet=Lh,L.isString=qd,L.isSymbol=rd,L.isTypedArray=Mh,L.isUndefined=sd,L.last=Gc,L.min=Xd,L.stubArray=Vd,L.stubFalse=Wd,L.noConflict=Sd,L.noop=Td,L.now=Fh,L.padStart=Ld,L.round=Sh,L.some=Xc,L.startsWith=Md,L.template=Nd,L.toFinite=ud,L.toInteger=vd,L.toNumber=wd,L.toString=xd,L.upperFirst=Qh,L.each=Uc,Rd(L,function(){var a={};return Ea(L,function(b,c){Ag.call(L.prototype,c)||(a[c]=b)}),a}(),{chain:!1}),L.VERSION=Zd,c(["drop","take"],function(a,b){O.prototype[a]=function(c){c=c===Yd?1:Xg(vd(c),0);var d=this.__filtered__&&!b?new O(this):this.clone();return d.__filtered__?d.__takeCount__=Yg(c,d.__takeCount__):d.__views__.push({size:Yg(c,Be),type:a+(d.__dir__<0?"Right":"")}),d},O.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()}}),c(["filter","map","takeWhile"],function(a,b){var c=b+1,d=c==ue||c==we;O.prototype[a]=function(a){var b=this.clone();return b.__iteratees__.push({iteratee:Vb(a,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),c(["head","last"],function(a,b){var c="take"+(b?"Right":"");O.prototype[a]=function(){return this[c](1).value()[0]}}),c(["initial","tail"],function(a,b){var c="drop"+(b?"":"Right");O.prototype[a]=function(){return this.__filtered__?new O(this):this[c](1)}}),O.prototype.compact=function(){return this.filter(Pd)},O.prototype.find=function(a){return this.filter(a).head()},O.prototype.findLast=function(a){return this.reverse().find(a)},O.prototype.invokeMap=gb(function(a,b){return"function"==typeof a?new O(this):this.map(function(c){return Ma(c,a,b)})}),O.prototype.reject=function(a){return this.filter($c(Vb(a)))},O.prototype.slice=function(a,b){a=vd(a);var c=this;return c.__filtered__&&(a>0||b<0)?new O(c):(a<0?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==Yd&&(b=vd(b),c=b<0?c.dropRight(-b):c.take(b-a)),c)},O.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},O.prototype.toArray=function(){return this.take(Be)},Ea(O.prototype,function(a,b){var c=/^(?:filter|find|map|reject)|While$/.test(b),d=/^(?:head|last)$/.test(b),e=L[d?"take"+("last"==b?"Right":""):b],f=d||/^find/.test(b);e&&(L.prototype[b]=function(){var b=this.__wrapped__,g=d?[1]:arguments,h=b instanceof O,j=g[0],k=h||Hh(b),l=function(a){var b=e.apply(L,i([a],g));return d&&m?b[0]:b};k&&c&&"function"==typeof j&&1!=j.length&&(h=k=!1);var m=this.__chain__,n=!!this.__actions__.length,o=f&&!m,p=h&&!n;if(!f&&k){b=p?b:new O(this);var q=a.apply(b,g);return q.__actions__.push({func:Lc,args:[l],thisArg:Yd}),new N(q,m)}return o&&p?a.apply(this,g):(q=this.thru(l),o?d?q.value()[0]:q.value():q)})}),c(["pop","push","shift","sort","splice","unshift"],function(a){var b=vg[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:pop|shift)$/.test(a);L.prototype[a]=function(){var a=arguments;if(d&&!this.__chain__){var e=this.value();return b.apply(Hh(e)?e:[],a)}return this[c](function(c){return b.apply(Hh(c)?c:[],a)})}}),Ea(O.prototype,function(a,b){var c=L[b];if(c){var d=c.name+"",e=gh[d]||(gh[d]=[]);e.push({name:b,func:c})}}),gh[Ib(Yd,je).name]=[{name:"wrapper",func:Yd}],O.prototype.clone=P,O.prototype.reverse=Q,O.prototype.value=R,L.prototype.chain=Mc,L.prototype.commit=Nc,L.prototype.next=Oc,L.prototype.plant=Qc,L.prototype.reverse=Rc,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=Sc,L.prototype.first=L.prototype.head,Pg&&(L.prototype[Pg]=Pc),"function"==typeof a&&"object"==typeof a.amd&&a.amd?(jg._=L,a(function(){return L})):lg?((lg.exports=L)._=L,kg._=L):jg._=L}).call(this),function(b,c){"object"==typeof exports&&"object"==typeof module?module.exports=c():"function"==typeof a&&a.amd?a([],c):"object"==typeof exports?exports.Hls=c():b.Hls=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s=8)}([function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}c.d(b,"a",function(){return k}),c.d(b,"b",function(){return l});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i,k=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(a){j=i}}else j=i},l=j},function(a,b,c){"use strict";b.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(a,b,c){"use strict";c.d(b,"b",function(){return d}),c.d(b,"a",function(){return e});var d={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},e={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}c.d(b,"b",function(){return f});var e=function(){function a(){d(this,a)}return a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);){e+=10;var f=a._readSize(b,c+6);e+=f,a.isFooter(b,c+10)&&(e+=10),c+=e}if(e>0)return b.subarray(d,d+e)},a._readSize=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},a.getTimeStamp=function(b){for(var c=a.getID3Frames(b),d=0;d<c.length;d++){var e=c[d];if(a.isTimeStampFrame(e))return a._readTimeStamp(e)}},a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4),e=10;return{type:c,size:d,data:b.subarray(e,e+d)}},a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){var e=a._readSize(b,c+6);c+=10;for(var f=c+e;c+8<f;){var g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g);h&&d.push(h),c+=g.size+10}a.isFooter(b,c)&&(c+=10)}return d},a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0},a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}},a._decodePrivFrame=function(b){if(!(b.size<2)){var c=a._utf8ArrayToStr(b.data,!0),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}}},a._decodeTextFrame=function(b){if(!(b.size<2)){if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data.subarray(1));return{key:b.type,data:f}}},a._decodeURLFrame=function(b){if("WXXX"===b.type){if(b.size<2)return;var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data);return{key:b.type,data:f}},a._utf8ArrayToStr=function(a){for(var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=a.length,d=void 0,e=void 0,f=void 0,g="",h=0;h<c;){if(d=a[h++],0===d&&b)return g;if(0!==d&&3!==d)switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(d);break;case 12:case 13:e=a[h++],g+=String.fromCharCode((31&d)<<6|63&e);break;case 14:e=a[h++],f=a[h++],g+=String.fromCharCode((15&d)<<12|(63&e)<<6|(63&f)<<0)}}return g},a}(),f=e._utf8ArrayToStr;b.a=e},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var h=function(){function a(b,c){d(this,a),this.subtle=b,this.aesIV=c}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}(),i=h,j=function(){function a(b,c){e(this,a),this.subtle=b,this.key=c}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}(),k=j,l=function(){function a(){f(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a.prototype.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<4;d++)c[d]=b.getUint32(4*d);return c},a.prototype.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;p<256;p++)p<128?m[p]=p<<1:m[p]=p<<1^283;for(p=0;p<256;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},a.prototype.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(f),j=this.invKeySchedule=new Uint32Array(f),k=this.sBox,l=this.rcon,m=this.invSubMix,n=m[0],o=m[1],p=m[2],q=m[3],r=void 0,s=void 0;for(g=0;g<f;g++)g<e?r=i[g]=b[g]:(s=r,g%e===0?(s=s<<8|s>>>24,s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s],s^=l[g/e|0]<<24):e>6&&g%e===4&&(s=k[s>>>24]<<24|k[s>>>16&255]<<16|k[s>>>8&255]<<8|k[255&s]),i[g]=r=(i[g-e]^s)>>>0);for(h=0;h<f;h++)g=f-h,s=3&h?i[g]:i[g-4],h<4||g<=4?j[h]=s:j[h]=n[k[s>>>24]]^o[k[s>>>16&255]]^p[k[s>>>8&255]]^q[k[255&s]],j[h]=j[h]>>>0}},a.prototype.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.prototype.decrypt=function(a,b,c){for(var d,e,f=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix,j=i[0],k=i[1],l=i[2],m=i[3],n=this.uint8ArrayToUint32Array_(c),o=n[0],p=n[1],q=n[2],r=n[3],s=new Int32Array(a),t=new Int32Array(s.length),u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=this.networkToHostOrderSwap;b<s.length;){for(C=G(s[b]),D=G(s[b+1]),E=G(s[b+2]),F=G(s[b+3]),y=C^g[0],z=F^g[1],A=E^g[2],B=D^g[3],d=4,e=1;e<f;e++)u=j[y>>>24]^k[z>>16&255]^l[A>>8&255]^m[255&B]^g[d],v=j[z>>>24]^k[A>>16&255]^l[B>>8&255]^m[255&y]^g[d+1],w=j[A>>>24]^k[B>>16&255]^l[y>>8&255]^m[255&z]^g[d+2],x=j[B>>>24]^k[y>>16&255]^l[z>>8&255]^m[255&A]^g[d+3],y=u,z=v,A=w,B=x,d+=4;u=h[y>>>24]<<24^h[z>>16&255]<<16^h[A>>8&255]<<8^h[255&B]^g[d],v=h[z>>>24]<<24^h[A>>16&255]<<16^h[B>>8&255]<<8^h[255&y]^g[d+1],w=h[A>>>24]<<24^h[B>>16&255]<<16^h[y>>8&255]<<8^h[255&z]^g[d+2],x=h[B>>>24]<<24^h[y>>16&255]<<16^h[z>>8&255]<<8^h[255&A]^g[d+3],d+=3,t[b]=G(u^o),t[b+1]=G(x^p),t[b+2]=G(w^q),t[b+3]=G(v^r),o=C,p=D,q=E,r=F,b+=4}return t.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a}(),m=l,n=c(2),o=c(0),p=function(){function a(b,c){g(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(a){}this.disableWebCrypto=!this.subtle}return a.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.prototype.decrypt=function(a,b,c,d){var e=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(o.b.log("JS AES decrypt"),this.logEnabled=!1);var f=this.decryptor;f||(this.decryptor=f=new m),f.expandKey(b),d(f.decrypt(a,0,c))}else{this.logEnabled&&(o.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var g=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new k(g,b)),this.fastAesKey.expandKey().then(function(f){var h=new i(g,c);h.decrypt(a,f).catch(function(f){e.onWebCryptoError(f,a,b,c,d)}).then(function(a){d(a)})}).catch(function(f){e.onWebCryptoError(f,a,b,c,d)})}},a.prototype.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(o.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(o.b.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))},a.prototype.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)},a}();b.a=p},function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;i<e;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(e<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},function(a,b,c){!function(b){var c=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/;?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;var e=this.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=this.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=this.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}(this)},function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i,j=navigator.userAgent.toLowerCase(),k=d,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=((192&b[c+2])>>>6)+1,f=(60&b[c+2])>>>2,f>l.length-1?void a.trigger(Event.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(h=(1&b[c+2])<<2,h|=(192&b[c+3])>>>6,B.b.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+f+"["+l[f]+"Hz],channelConfig:"+h),/firefox/i.test(j)?f>=6?(e=5,i=new Array(4),g=f-3):(e=2,i=new Array(2),g=f):j.indexOf("android")!==-1?(e=2,i=new Array(2),g=f):(e=5,i=new Array(4),d&&(d.indexOf("mp4a.40.29")!==-1||d.indexOf("mp4a.40.5")!==-1)||!d&&f>=6?g=f-3:((d&&d.indexOf("mp4a.40.2")!==-1&&(f>=6&&1===h||/vivaldi/i.test(j))||!d&&1===h)&&(e=2,i=new Array(2)),g=f)),i[0]=e<<3,i[0]|=(14&f)>>1,i[1]|=(1&f)<<7,i[1]|=h<<3,5===e&&(i[1]|=(14&g)>>1,i[2]=(1&g)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:l[f],channelCount:h,codec:"mp4a.40."+e,manifestCodec:k})}function e(a,b){return 255===a[b]&&240===(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a,b){return!!(b+1<a.length&&e(a,b))}function i(a,b){if(b+1<a.length&&e(a,b)){var c=f(a,b),d=c;b+5<a.length&&(d=g(a,b));var h=b+d;if(h===a.length||h+1<a.length&&e(a,h))return!0}return!1}function j(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,B.b.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}}function k(a){return 9216e4/a}function l(a,b,c,d,e){var h,i,j,k=a.length;if(h=f(a,b),i=g(a,b),i-=h,i>0&&b+h+i<=k)return j=c+d*e,{headerLength:h,frameLength:i,stamp:j}}function m(a,b,c,d,e){var f=k(a.samplerate),g=l(b,c,d,e,f);if(g){var h=g.stamp,i=g.headerLength,j=g.frameLength,m={unit:b.subarray(c+i,c+i+j),pts:h,dts:h};return a.samples.push(m),a.len+=j,{sample:m,length:j+i}}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function s(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function u(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function v(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function w(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function x(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var y=c(1),z=c(2),A=c(4),B=c(0),C=c(3),D=function(){function a(b,c,d){n(this,a),this.observer=b,this.config=d,this.remuxer=c}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){if(!a)return!1;for(var b=C.a.getID3Data(a,0)||[],c=b.length,d=a.length;c<d;c++)if(i(a,c))return B.b.log("ADTS sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,d){for(var e=this._audioTrack,f=C.a.getID3Data(a,0)||[],g=C.a.getTimeStamp(f),i=g?90*g:9e4*b,k=0,l=i,n=a.length,o=f.length,p=[{pts:l,dts:l,data:f}];o<n-1;)if(h(a,o)&&o+5<n){j(e,this.observer,a,o,e.manifestCodec);var q=m(e,a,o,i,k);if(!q){B.b.log("Unable to parse AAC frame");break}o+=q.length,l=q.sample.pts,k++}else C.a.isHeader(a,o)?(f=C.a.getID3Data(a,o),p.push({pts:l,dts:l,data:f}),o+=f.length):o++;this.remuxer.remux(e,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},b,c,d)},a.prototype.destroy=function(){},a}(),E=D,F=Math.pow(2,32)-1,G=function(){function a(b,c){o(this,a),this.observer=b,this.remuxer=c;
}return a.prototype.resetTimeStamp=function(a){this.initPTS=a},a.prototype.resetInitSegment=function(b,c,d,e){if(b&&b.byteLength){var f=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5"),null==d&&(d="avc1.42e01e");var g={};f.audio&&f.video?g.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:e?b:null}:(f.audio&&(g.audio={container:"audio/mp4",codec:c,initSegment:e?b:null}),f.video&&(g.video={container:"video/mp4",codec:d,initSegment:e?b:null})),this.observer.trigger(y.a.FRAG_PARSING_INIT_SEGMENT,{tracks:g})}else c&&(this.audioCodec=c),d&&(this.videoCodec=d)},a.probe=function(b){return a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length>0},a.bin2str=function(a){return String.fromCharCode.apply(null,a)},a.readUint32=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return c<0?4294967296+c:c},a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c},a.findBox=function(b,c){var d,e,f,g,h,i,j,k=[];if(b.data?(i=b.start,g=b.end,b=b.data):(i=0,g=b.byteLength),!c.length)return null;for(d=i;d<g;)e=a.readUint32(b,d),f=a.bin2str(b.subarray(d+4,d+8)),j=e>1?d+e:g,f===c[0]&&(1===c.length?k.push({data:b,start:d+8,end:j}):(h=a.findBox({data:b,start:d+8,end:j},c.slice(1)),h.length&&(k=k.concat(h)))),d=j;return k},a.parseInitSegment=function(b){var c=[],d=a.findBox(b,["moov","trak"]);return d.forEach(function(b){var d=a.findBox(b,["tkhd"])[0];if(d){var e=d.data[d.start],f=0===e?12:20,g=a.readUint32(d,f),h=a.findBox(b,["mdia","mdhd"])[0];if(h){e=h.data[h.start],f=0===e?12:20;var i=a.readUint32(h,f),j=a.findBox(b,["mdia","hdlr"])[0];if(j){var k=a.bin2str(j.data.subarray(j.start+8,j.start+12)),l={soun:"audio",vide:"video"}[k];if(l){var m=a.findBox(b,["mdia","minf","stbl","stsd"]);if(m.length){m=m[0];var n=a.bin2str(m.data.subarray(m.start+12,m.start+16));B.b.log("MP4Demuxer:"+l+":"+n+" found")}c[g]={timescale:i,type:l},c[l]={timescale:i,id:g}}}}}}),c},a.getStartDTS=function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=a.readUint32(d,4),f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0],g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0},a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var f=a.readUint32(e,4),g=b[f].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);if(0===c)a.writeUint32(b,4,e-d*g);else{e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*g,e=Math.max(e,0);var f=Math.floor(e/(F+1)),h=Math.floor(e%(F+1));a.writeUint32(b,4,f),a.writeUint32(b,8,h)}})})})},a.prototype.append=function(b,c,d,e){var f=this.initData;f||(this.resetInitSegment(b,this.audioCodec,this.videoCodec),f=this.initData);var g=void 0,h=this.initPTS;if(void 0===h){var i=a.getStartDTS(f,b);this.initPTS=h=i-c,this.observer.trigger(y.a.INIT_PTS_FOUND,{initPTS:h})}a.offsetStartDTS(f,b,h),g=a.getStartDTS(f,b),this.remuxer.remux(f.audio,f.video,null,null,g,d,e,b)},a.prototype.destroy=function(){},a}(),H=G,I={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(a,b,c,d,e){if(!(c+24>b.length)){var f=this.parseHeader(b,c);if(f&&c+f.frameLength<=b.length){var g=9e4*f.samplesPerFrame/f.sampleRate,h=d+e*g,i={unit:b.subarray(c,c+f.frameLength),pts:h,dts:h};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(i),a.len+=f.frameLength,{sample:i,length:f.frameLength}}}},parseHeader:function(a,b){var c=a[b+1]>>3&3,d=a[b+1]>>1&3,e=a[b+2]>>4&15,f=a[b+2]>>2&3,g=a[b+2]>>1&1;if(1!==c&&0!==e&&15!==e&&3!==f){var h=3===c?3-d:3===d?3:4,i=1e3*I.BitratesMap[14*h+e-1],j=3===c?0:2===c?1:2,k=I.SamplingRateMap[3*j+f],l=a[b+3]>>6===3?1:2,m=I.SamplesCoefficients[c][d],n=I.BytesInSlot[d],o=8*m*n,p=parseInt(m*i/k+g,10)*n;return{sampleRate:k,channelCount:l,frameLength:p,samplesPerFrame:o}}},isHeaderPattern:function(a,b){return 255===a[b]&&224===(224&a[b+1])&&0!==(6&a[b+1])},isHeader:function(a,b){return!!(b+1<a.length&&this.isHeaderPattern(a,b))},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=4,d=this.parseHeader(a,b),e=c;d&&d.frameLength&&(e=d.frameLength);var f=b+e;if(f===a.length||f+1<a.length&&this.isHeaderPattern(a,f))return!0}return!1}},J=I,K=function(){function a(b){p(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return a.prototype.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},a.prototype.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.prototype.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&B.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c},a.prototype.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.prototype.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(a){var b,c,d=8,e=8;for(b=0;b<a;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e},a.prototype.readSPS=function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;i<h;i++)q()&&u(i<6?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;i<d;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}(),L=K,M=function(){function a(b,c,d,e){q(this,a),this.decryptdata=d,this.discardEPB=e,this.decrypter=new A.a(b,c)}return a.prototype.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)},a.prototype.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})},a.prototype.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},a.prototype.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},a.prototype.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a},a.prototype.decryptAvcSample=function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})},a.prototype.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}(),N=M,O={video:0,audio:1,id3:2,text:3},P=function(){function a(b,c,d,e){r(this,a),this.observer=b,this.config=d,this.typeSupported=e,this.remuxer=c,this.sampleAes=null}return a.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new N(this.observer,this.config,a,this.discardEPB):this.sampleAes=null},a.probe=function(b){var c=a._syncOffset(b);return!(c<0)&&(c&&B.b.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a._syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;c<b;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:O[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a||void 0,duration:"audio"===a?b:void 0}},a.prototype.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",e),this._audioTrack=a.createTrack("audio",e),this._id3Track=a.createTrack("id3",e),this._txtTrack=a.createTrack("text",e),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e},a.prototype.resetTimeStamp=function(){},a.prototype.append=function(b,c,d,e){var f,g,h,i,j,k,l=b.length,m=!1;this.contiguous=d;var n=this.pmtParsed,o=this._avcTrack,p=this._audioTrack,q=this._id3Track,r=o.pid,s=p.pid,t=q.pid,u=this._pmtId,v=o.pesData,w=p.pesData,x=q.pesData,A=this._parsePAT,C=this._parsePMT,D=this._parsePES,E=this._parseAVCPES.bind(this),F=this._parseAACPES.bind(this),G=this._parseMPEGPES.bind(this),H=this._parseID3PES.bind(this),I=a._syncOffset(b);for(l-=(l+I)%188,f=I;f<l;f+=188)if(71===b[f]){if(g=!!(64&b[f+1]),h=((31&b[f+1])<<8)+b[f+2],i=(48&b[f+3])>>4,i>1){if(j=f+5+b[f+4],j===f+188)continue}else j=f+4;switch(h){case r:g&&(v&&(k=D(v))&&E(k,!1),v={data:[],size:0}),v&&(v.data.push(b.subarray(j,f+188)),v.size+=f+188-j);break;case s:g&&(w&&(k=D(w))&&(p.isAAC?F(k):G(k)),w={data:[],size:0}),w&&(w.data.push(b.subarray(j,f+188)),w.size+=f+188-j);break;case t:g&&(x&&(k=D(x))&&H(k),x={data:[],size:0}),x&&(x.data.push(b.subarray(j,f+188)),x.size+=f+188-j);break;case 0:g&&(j+=b[j]+1),u=this._pmtId=A(b,j);break;case u:g&&(j+=b[j]+1);var J=C(b,j,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);r=J.avc,r>0&&(o.pid=r),s=J.audio,s>0&&(p.pid=s,p.isAAC=J.isAAC),t=J.id3,t>0&&(q.pid=t),m&&!n&&(B.b.log("reparse from beginning"),m=!1,f=I-188),n=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=!0}}else this.observer.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});v&&(k=D(v))?(E(k,!0),o.pesData=null):o.pesData=v,w&&(k=D(w))?(p.isAAC?F(k):G(k),p.pesData=null):(w&&w.size&&B.b.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=w),x&&(k=D(x))?(H(k),q.pesData=null):q.pesData=x,null==this.sampleAes?this.remuxer.remux(p,o,q,this._txtTrack,c,d,e):this.decryptAndRemux(p,o,q,this._txtTrack,c,d,e)},a.prototype.decryptAndRemux=function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)},a.prototype.decryptAndRemuxAvc=function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)},a.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},a.prototype._parsePAT=function(a,b){return(31&a[b+10])<<8|a[b+11]},a.prototype._parsePMT=function(a,b,c,d){var e,f,g,h,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;b<f;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){B.b.log("unkown stream type:"+a[b]);break}case 15:i.audio===-1&&(i.audio=h);break;case 21:i.id3===-1&&(i.id3=h);break;case 219:if(!d){B.b.log("unkown stream type:"+a[b]);break}case 27:i.avc===-1&&(i.avc=h);break;case 3:case 4:c?i.audio===-1&&(i.audio=h,i.isAAC=!1):B.b.log("MPEG audio found, not supported in this browser for now");break;case 36:B.b.warn("HEVC stream type found, not supported for now");break;default:B.b.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return i},a.prototype._parsePES=function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592),h-i>54e5&&(B.b.warn(Math.round((h-i)/9e4)+"s delta between PTS and DTS, align them"),h=i)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);for(var n=0,o=l.length;n<o;n++){b=l[n];var p=b.byteLength;if(j){if(j>p){j-=p;continue}b=b.subarray(j),p-=j,j=0}g.set(b,k),k+=p}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null},a.prototype.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&B.b.log(a.pts+"/"+a.dts+":"+a.debug)},a.prototype._parseAVCPES=function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample,k=!1,l=this.pushAccesUnit.bind(this),m=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,j&&h.length&&!g.audFound&&(l(j,g),j=this.avcSample=m(!1,a.pts,a.dts,"")),h.forEach(function(b){switch(b.type){case 1:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),i&&(j.debug+="NDR "),j.frame=!0;var h=b.data;if(k&&h.length>4){var n=new L(h).readSliceType();2!==n&&4!==n&&7!==n&&9!==n||(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=m(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0,j.frame=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new L(f.discardEPB(b.data)),c.readUByte();for(var o=0,p=0,q=!1,r=0;!q&&c.bytesAvailable>1;){o=0;do r=c.readUByte(),o+=r;while(255===r);p=0;do r=c.readUByte(),p+=r;while(255===r);if(4===o&&0!==c.bytesAvailable){q=!0;var s=c.readUByte();if(181===s){var t=c.readUShort();if(49===t){var u=c.readUInt();if(1195456820===u){var v=c.readUByte();if(3===v){var w=c.readUByte(),x=c.readUByte(),y=31&w,z=[w,x];for(e=0;e<y;e++)z.push(c.readUByte()),z.push(c.readUByte()),z.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:z})}}}}}else if(p<c.bytesAvailable)for(e=0;e<p;e++)c.readUByte()}break;case 7:if(d=!0,k=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new L(b.data);var A=c.readSPS();g.width=A.width,g.height=A.height,g.pixelRatio=A.pixelRatio,g.sps=[b.data],g.duration=f._duration;var B=b.data.subarray(1,4),C="avc1.";for(e=0;e<3;e++){var D=B[e].toString(16);D.length<2&&(D="0"+D),C+=D}g.codec=C}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,g.audFound=!0,j&&l(j,g),j=f.avcSample=m(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var E=j.units;E.push(b)}}),b&&j&&(l(j,g),this.avcSample=null)},a.prototype._insertSampleInOrder=function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)},a.prototype._getLastNalUnit=function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units;b=e[e.length-1]}return b},a.prototype._parseAVCNALu=function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(j===-1&&(m=0,f=31&a[0],j=0,g=1);g<h;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&g<=4-k&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}g<h?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l},a.prototype.discardEPB=function(a){for(var b,c,d=a.byteLength,e=[],f=1;f<d-2;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;f<b;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},a.prototype._parseAACPES=function(a){var b,c,d,e,f,g=this._audioTrack,i=a.data,l=a.pts,n=0,o=this.aacOverFlow,p=this.aacLastPTS;if(o){var q=new Uint8Array(o.byteLength+i.byteLength);q.set(o,0),q.set(i,o.byteLength),i=q}for(d=n,f=i.length;d<f-1&&!h(i,d);d++);if(d){var r,s;if(d<f-1?(r="AAC PES did not start with ADTS header,offset:"+d,s=!1):(r="no ADTS header found in AAC PES",s=!0),B.b.warn("parsing error:"+r),this.observer.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:s,reason:r}),s)return}if(j(g,this.observer,i,d,this.audioCodec),c=0,b=k(g.samplerate),o&&p){var t=p+b;Math.abs(t-l)>1&&(B.b.log("AAC: align PTS for overlapping frames by "+Math.round((t-l)/90)),l=t)}for(;d<f;)if(h(i,d)&&d+5<f){var u=m(g,i,d,l,c);if(!u)break;d+=u.length,e=u.sample.pts,c++}else d++;o=d<f?i.subarray(d,f):null,this.aacOverFlow=o,this.aacLastPTS=e},a.prototype._parseMPEGPES=function(a){for(var b=a.data,c=b.length,d=0,e=0,f=a.pts;e<c;)if(J.isHeader(b,e)){var g=J.appendFrame(this._audioTrack,b,e,f,d);if(!g)break;e+=g.length,d++}else e++},a.prototype._parseID3PES=function(a){this._id3Track.samples.push(a)},a}(),Q=P,R=function(){function a(b,c,d){s(this,a),this.observer=b,this.config=d,this.remuxer=c}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){var b,c,d=C.a.getID3Data(a,0);if(d&&void 0!==C.a.getTimeStamp(d))for(b=d.length,c=Math.min(a.length-1,b+100);b<c;b++)if(J.probe(a,b))return B.b.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,d){for(var e=C.a.getID3Data(a,0),f=C.a.getTimeStamp(e),g=f?90*f:9e4*b,h=e.length,i=a.length,j=0,k=0,l=this._audioTrack,m=[{pts:g,dts:g,data:e}];h<i;)if(J.isHeader(a,h)){var n=J.appendFrame(l,a,h,g,j);if(!n)break;h+=n.length,k=n.sample.pts,j++}else C.a.isHeader(a,h)?(e=C.a.getID3Data(a,h),m.push({pts:k,dts:k,data:e}),h+=e.length):h++;this.remuxer.remux(l,{samples:[]},{samples:m,inputTimeScale:9e4},{samples:[]},b,c,d)},a.prototype.destroy=function(){},a}(),S=R,T=function(){function a(){t(this,a)}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}(),U=T,V=Math.pow(2,32)-1,W=function(){function a(){u(this,a)}return a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;e<f;e++)b.set(c[e],d),d+=c[e].byteLength;return b},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var d=Math.floor(c/(V+1)),e=Math.floor(c%(V+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var d=Math.floor(c/(V+1)),e=Math.floor(c%(V+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,d>>24,d>>16&255,d>>8&255,255&d,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,f)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,f=b.height,g=Math.floor(d/(V+1)),h=Math.floor(d%(V+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,f>>8&255,255&f,0,0]))},a.traf=function(b,c){var d=a.sdtp(b),e=b.id,f=Math.floor(c/(V+1)),g=Math.floor(c%(V+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,g>>24,g>>16&255,g>>8&255,255&g])),a.trun(b,d.length+16+20+8+16+8+8),d)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c},a}(),X=W,Y=1e4,Z=function(){function a(b,c,d,e){v(this,a),this.observer=b,this.config=c,this.typeSupported=d;var f=navigator.userAgent;this.isSafari=e&&e.indexOf("Apple")>-1&&f&&!f.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(a){this._initPTS=this._initDTS=a},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.remux=function(a,b,c,d,e,f,g){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated){var h=a.samples.length,i=b.samples.length,j=e,k=e;if(h&&i){var l=(a.samples[0].dts-b.samples[0].dts)/b.inputTimeScale;j+=Math.max(0,l),k+=Math.max(0,-l)}if(h){a.timescale||(B.b.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var m=this.remuxAudio(a,j,f,g);if(i){var n=void 0;m&&(n=m.endPTS-m.startPTS),b.timescale||(B.b.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,k,f,n,g)}}else{var o=void 0;i&&(o=this.remuxVideo(b,k,f,g)),o&&a.codec&&this.remuxEmptyAudio(a,j,f,o)}}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(y.a.FRAG_PARSED)},a.prototype.generateIS=function(a,b,c){var d,e,f=this.observer,g=a.samples,h=b.samples,i=this.typeSupported,j="audio/mp4",k={},l={tracks:k},m=void 0===this._initPTS;if(m&&(d=e=1/0),a.config&&g.length&&(a.timescale=a.samplerate,B.b.log("audio sampling rate : "+a.samplerate),a.isAAC||(i.mpeg?(j="audio/mpeg",a.codec=""):i.mp3&&(a.codec="mp3")),k.audio={container:j,codec:a.codec,initSegment:!a.isAAC&&i.mpeg?new Uint8Array:X.initSegment([a]),metadata:{channelCount:a.channelCount}},m&&(d=e=g[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&h.length){var n=b.inputTimeScale;b.timescale=n,k.video={container:"video/mp4",codec:b.codec,initSegment:X.initSegment([b]),metadata:{width:b.width,height:b.height}},m&&(d=Math.min(d,h[0].pts-n*c),e=Math.min(e,h[0].dts-n*c),this.observer.trigger(y.a.INIT_PTS_FOUND,{initPTS:d}))}Object.keys(k).length?(f.trigger(y.a.FRAG_PARSING_INIT_SEGMENT,l),this.ISGenerated=!0,m&&(this._initPTS=d,this._initDTS=e)):f.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n=8,o=a.timescale,p=a.samples,q=[],r=p.length,s=this._PTSNormalize,t=this._initDTS,u=this.nextAvcDts,v=this.isSafari;v&&(c|=p.length&&u&&(e&&Math.abs(b-u/o)<.1||Math.abs(p[0].pts-u-t)<o/5)),c||(u=b*o),p.forEach(function(a){a.pts=s(a.pts-t,u),a.dts=s(a.dts-t,u)}),p.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c?c:d?d:a.id-b.id});var w=p.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(w<0){B.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(w/90)+" ms to overcome this issue");for(var x=0;x<p.length;x++)p[x].dts+=w}var A=p[0];j=Math.max(A.dts,0),i=Math.max(A.pts,0);var C=Math.round((j-u)/90);c&&C&&(C>1?B.b.log("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&B.b.log("AVC:"+-C+" ms overlapping between fragments detected"),j=u,p[0].dts=j,i=Math.max(i-C,u),p[0].pts=i,B.b.log("Video/PTS/DTS adjusted: "+Math.round(i/90)+"/"+Math.round(j/90)+",delta:"+C+" ms")),k=j,A=p[p.length-1],m=Math.max(A.dts,0),l=Math.max(A.pts,0,m),v&&(f=Math.round((m-j)/(p.length-1)));for(var D=0,E=0,F=0;F<r;F++){for(var G=p[F],H=G.units,I=H.length,J=0,K=0;K<I;K++)J+=H[K].data.length;
E+=J,D+=I,G.length=J,v?G.dts=j+F*f:G.dts=Math.max(G.dts,j),G.pts=Math.max(G.pts,G.dts)}var L=E+4*D+8;try{g=new Uint8Array(L)}catch(a){return void this.observer.trigger(y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:L,reason:"fail allocating video mdat "+L})}var M=new DataView(g.buffer);M.setUint32(0,L),g.set(X.types.mdat,4);for(var N=0;N<r;N++){for(var O=p[N],P=O.units,Q=0,R=void 0,S=0,T=P.length;S<T;S++){var U=P[S],V=U.data,W=U.data.byteLength;M.setUint32(n,W),n+=4,g.set(V,n),n+=W,Q+=4+W}if(v)R=Math.max(0,f*Math.round((O.pts-O.dts)/f));else{if(N<r-1)f=p[N+1].dts-O.dts;else{var Y=this.config,Z=O.dts-p[N>0?N-1:N].dts;if(Y.stretchShortVideoTrack){var $=Y.maxBufferHole,_=Y.maxSeekHole,aa=Math.floor(Math.min($,_)*o),ba=(d?i+d*o:this.nextAudioPts)-O.pts;ba>aa?(f=ba-Z,f<0&&(f=Z),B.b.log("It is approximately "+ba/90+" ms to the next segment; using duration "+f/90+" ms for the last video frame.")):f=Z}else f=Z}R=Math.round(O.pts-O.dts)}q.push({size:Q,duration:f,cts:R,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:O.key?2:1,isNonSync:O.key?0:1}})}this.nextAvcDts=m+f;var ca=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,q.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var da=q[0].flags;da.dependsOn=2,da.isNonSync=0}a.samples=q,h=X.moof(a.sequenceNumber++,j,a),a.samples=[];var ea={data1:h,data2:g,startPTS:i/o,endPTS:(l+f)/o,startDTS:j/o,endDTS:this.nextAvcDts/o,type:"video",nb:q.length,dropped:ca};return this.observer.trigger(y.a.FRAG_PARSING_DATA,ea),ea},a.prototype.remuxAudio=function(a,b,c,d){var e,f,g,h,i,j,k,l=a.inputTimeScale,m=a.timescale,n=l/m,o=a.isAAC?1024:1152,p=o*n,q=this._PTSNormalize,r=this._initDTS,s=!a.isAAC&&this.typeSupported.mpeg,t=a.samples,u=[],v=this.nextAudioPts;if(c|=t.length&&v&&(d&&Math.abs(b-v/l)<.1||Math.abs(t[0].pts-v-r)<20*p),t.forEach(function(a){a.pts=a.dts=q(a.pts-r,b*l)}),t=t.filter(function(a){return a.pts>=0}),0!==t.length){if(c||(v=d?b*l:t[0].pts),a.isAAC)for(var w=this.config.maxAudioFramesDrift,x=0,A=v;x<t.length;){var C,D=t[x],E=D.pts;C=E-A;var F=Math.abs(1e3*C/l);if(C<=-w*p)B.b.warn("Dropping 1 audio frame @ "+(A/l).toFixed(3)+"s due to "+Math.round(F)+" ms overlap."),t.splice(x,1),a.len-=D.unit.length;else if(C>=w*p&&F<Y&&A){var G=Math.round(C/p);B.b.warn("Injecting "+G+" audio frame @ "+(A/l).toFixed(3)+"s due to "+Math.round(1e3*C/l)+" ms gap.");for(var H=0;H<G;H++){var I=Math.max(A,0);g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(B.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=D.unit.subarray()),t.splice(x,0,{unit:g,pts:I,dts:I}),a.len+=g.length,A+=p,x++}D.pts=D.dts=A,A+=p,x++}else Math.abs(C)>.1*p,D.pts=D.dts=A,A+=p,x++}for(var J=0,K=t.length;J<K;J++){var L=t[J],M=L.unit,N=L.pts;if(void 0!==k)f.duration=Math.round((N-k)/n);else{var O=Math.round(1e3*(N-v)/l),P=0;if(c&&a.isAAC&&O){if(O>0&&O<Y)P=Math.round((N-v)/p),B.b.log(O+" ms hole between AAC samples detected,filling it"),P>0&&(g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(g=M.subarray()),a.len+=P*g.length);else if(O<-12){B.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(v/l).toFixed(3)+"s/"+(N/l).toFixed(3)+"s/"+-O+"ms"),a.len-=M.byteLength;continue}N=v}if(j=N,!(a.len>0))return;var Q=s?a.len:a.len+8;e=s?0:8;try{h=new Uint8Array(Q)}catch(a){return void this.observer.trigger(y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating audio mdat "+Q})}if(!s){var R=new DataView(h.buffer);R.setUint32(0,Q),h.set(X.types.mdat,4)}for(var S=0;S<P;S++)g=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),g||(B.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=M.subarray()),h.set(g,e),e+=g.byteLength,f={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},u.push(f)}h.set(M,e);var T=M.byteLength;e+=T,f={size:T,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},u.push(f),k=N}var V=0,W=u.length;if(W>=2&&(V=u[W-2].duration,f.duration=V),W){this.nextAudioPts=v=k+n*V,a.len=0,a.samples=u,i=s?new Uint8Array:X.moof(a.sequenceNumber++,j/n,a),a.samples=[];var Z=j/l,$=v/l,_={data1:i,data2:h,startPTS:Z,endPTS:$,startDTS:Z,endDTS:$,type:"audio",nb:W};return this.observer.trigger(y.a.FRAG_PARSING_DATA,_),_}return null}},a.prototype.remuxEmptyAudio=function(a,b,c,d){var e=a.inputTimeScale,f=a.samplerate?a.samplerate:e,g=e/f,h=this.nextAudioPts,i=(void 0!==h?h:d.startDTS*e)+this._initDTS,j=d.endDTS*e+this._initDTS,k=1024,l=g*k,m=Math.ceil((j-i)/l),n=U.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(B.b.warn("remux empty Audio"),!n)return void B.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var o=[],p=0;p<m;p++){var q=i+p*l;o.push({unit:n,pts:q,dts:q}),a.len+=n.length}a.samples=o,this.remuxAudio(a,b,c)},a.prototype.remuxID3=function(a,b){var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS,g=this._initDTS;if(d){for(var h=0;h<d;h++)c=a.samples[h],c.pts=(c.pts-f)/e,c.dts=(c.dts-g)/e;this.observer.trigger(y.a.FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[],b=b},a.prototype.remuxText=function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length,e=a.inputTimeScale,f=this._initPTS;if(d){for(var g=0;g<d;g++)c=a.samples[g],c.pts=(c.pts-f)/e;this.observer.trigger(y.a.FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[],b=b},a.prototype._PTSNormalize=function(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a},a}(),$=Z,_=function(){function a(b){w(this,a),this.observer=b}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(){},a.prototype.resetInitSegment=function(){},a.prototype.remux=function(a,b,c,d,e,f,g,h){var i=this.observer,j="";a&&(j+="audio"),b&&(j+="video"),i.trigger(y.a.FRAG_PARSING_DATA,{data1:h,startPTS:e,startDTS:e,type:j,nb:1,dropped:0}),i.trigger(y.a.FRAG_PARSED)},a}(),aa=_,ba=function(){function a(b,c,d,e){x(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=e}return a.prototype.destroy=function(){var a=this.demuxer;a&&a.destroy()},a.prototype.push=function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var m=this.decrypter;null==m&&(m=this.decrypter=new A.a(this.observer,this.config));var n,o=this;try{n=performance.now()}catch(a){n=Date.now()}m.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var m;try{m=performance.now()}catch(a){m=Date.now()}o.observer.trigger(y.a.FRAG_DECRYPTED,{stats:{tstart:n,tdecrypt:m}}),o.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,h,i,j,k,l)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,f,g,h,i,j,k,l)},a.prototype.pushDecrypted=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this.demuxer;if(!m||g&&!this.probe(a)){for(var n=this.observer,o=this.typeSupported,p=this.config,q=[{demux:Q,remux:$},{demux:H,remux:aa},{demux:E,remux:$},{demux:S,remux:$}],r=0,s=q.length;r<s;r++){var t=q[r],u=t.demux.probe;if(u(a)){var v=this.remuxer=new t.remux(n,p,o,this.vendor);m=new t.demux(n,v,p,o),this.probe=u;break}}if(!m)return void n.trigger(y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=m}var w=this.remuxer;(g||h)&&(m.resetInitSegment(c,d,e,j),w.resetInitSegment()),g&&(m.resetTimeStamp(l),w.resetTimeStamp(l)),"function"==typeof m.setDecryptData&&m.setDecryptData(b),m.append(a,f,i,k)},a}();b.a=ba},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){var c=Pa[b];return!!c&&c[a.slice(0,4)]===!0}function g(a,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)return null;for(var c=null,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function p(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function s(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function t(a,b,c){var d=a[b],e=a[c],f=e.startPTS;isNaN(f)?c>b?e.start=d.start+d.duration:e.start=Math.max(d.start-e.duration,0):c>b?(d.duration=f-d.start,d.duration<0&&Ha.b.warn("negative duration computed for frag "+d.sn+",level "+d.level+", there should be some duration drift between playlist and fragment!")):(e.duration=d.start-f,e.duration<0&&Ha.b.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"))}function u(a,b,c,d,e,f){var g=c;if(!isNaN(b.startPTS)){var h=Math.abs(b.startPTS-c);isNaN(b.deltaPTS)?b.deltaPTS=h:b.deltaPTS=Math.max(h,b.deltaPTS),g=Math.max(c,b.startPTS),c=Math.min(c,b.startPTS),d=Math.max(d,b.endPTS),e=Math.min(e,b.startDTS),f=Math.max(f,b.endDTS)}var i=c-b.start;b.start=b.startPTS=c,b.maxStartPTS=g,b.endPTS=d,b.startDTS=e,b.endDTS=f,b.duration=d-c;var j=b.sn;if(!a||j<a.startSN||j>a.endSN)return 0;var k,l,m;for(k=j-a.startSN,l=a.fragments,l[k]=b,m=k;m>0;m--)t(l,m,m-1);for(m=k;m<l.length-1;m++)t(l,m,m+1);return a.PTSKnown=!0,i}function v(a,b){var c,d=Math.max(a.startSN,b.startSN)-b.startSN,e=Math.min(a.endSN,b.endSN)-b.startSN,f=b.startSN-a.startSN,g=a.fragments,h=b.fragments,i=0;if(e<d)return void(b.PTSKnown=!1);for(var j=d;j<=e;j++){var k=g[f+j],l=h[j];l&&k&&(i=k.cc-l.cc,isNaN(k.startPTS)||(l.start=l.startPTS=k.startPTS,l.endPTS=k.endPTS,l.duration=k.duration,l.backtracked=k.backtracked,l.dropped=k.dropped,c=l))}if(i)for(Ha.b.log("discontinuity sliding from playlist, take drift into account"),j=0;j<h.length;j++)h[j].cc+=i;if(c)u(b,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS);else if(f>=0&&f<g.length){var m=g[f].start;for(j=0;j<h.length;j++)h[j].start+=m}b.PTSKnown=a.PTSKnown}function w(a,b){for(var c=null,d=0;d<a.length;d+=1){var e=a[d];if(e&&e.cc===b){c=e;break}}return c}function x(a,b){return cb.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}function y(a,b,c){var d=!1;return b&&b.details&&c&&(c.endCC>c.startCC||a&&a.cc<c.startCC)&&(d=!0),d}function z(a,b){var c=a.fragments,d=b.fragments;if(!d.length||!c.length)return void Ha.b.log("No fragments to align");var e=w(c,d[0].cc);return!e||e&&!e.startPTS?void Ha.b.log("No frag in previous level to align on"):e}function A(a,b){b.fragments.forEach(function(b){if(b){var c=b.start+a;b.start=b.startPTS=c,b.endPTS=c+b.duration}}),b.PTSKnown=!0}function B(a,b,c){if(y(a,b,c)){var d=z(b.details,c);d&&(Ha.b.log("Adjusting PTS using last level due to CC increase within current level"),A(d.start,c))}if(c.PTSKnown===!1&&b&&b.details){var e=b.details.programDateTime,f=c.programDateTime,g=(f-e)/1e3+b.details.fragments[0].start;isNaN(g)||(Ha.b.log("adjusting PTS using programDateTime delta, sliding:"+g.toFixed(3)),A(g,c))}}function C(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function D(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function E(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function F(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function G(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function H(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function I(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function J(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function K(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function L(){var a=r(),b=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!d}function M(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function N(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function O(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function P(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function R(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function S(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function T(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function U(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function V(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function W(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function X(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function Y(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Z(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function $(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function aa(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function ba(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ca(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function da(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function ea(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function fa(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Yb,this.regionList=[]}function ga(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function ha(){this.values=Object.create(null)}function ia(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function ja(a,b,c){function d(){var b=ga(a);if(null===b)throw new Error("Malformed timestamp: "+g);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function e(a,b){var d=new ha;ia(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",$b,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",$b,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",$b,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&Zb.line===-1&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",$b);var f=d.get("position","auto");"auto"===f&&50===Zb.position&&(f="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=f}function f(){a=a.replace(/^\s+/,"")}var g=a;if(f(),b.startTime=d(),f(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+g);a=a.substr(3),f(),b.endTime=d(),f(),e(a,b)}function ka(a){return a.replace(/<br(?: \/)?>/gi,"\n")}function la(a,b,c,d){for(var e,f,g,h,i,j=window.VTTCue||window.TextTrackCue,k=0;k<d.rows.length;k++)if(e=d.rows[k],g=!0,h=0,i="",!e.isEmpty()){for(var l=0;l<e.chars.length;l++)e.chars[l].uchar.match(/\s/)&&g?h++:(i+=e.chars[l].uchar,g=!1);e.cueStartTime=b,b===c&&(c+=1e-4),f=new j(b,c,ka(i.trim())),h>=16?h--:h++,navigator.userAgent.match(/Firefox\//)?f.line=k+1:f.line=k>7?k-2:k+1,f.align="left",f.position=Math.max(0,Math.min(100,100*(h/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(f)}}function ma(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function na(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function oa(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function pa(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function qa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function ra(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}function sa(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function ta(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}function ua(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function va(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function wa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function xa(a){for(var b=[],c=0;c<a.length;c++)"subtitles"===a[c].kind&&b.push(a[c]);return b}function ya(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function za(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function Aa(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function Ba(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var Ca={};c.d(Ca,"newCue",function(){return la});var Da=c(6),Ea=c.n(Da),Fa=c(1),Ga=c(2),Ha=c(0),Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ja=function(){function a(b){d(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,e=Array(c>1?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}return a.prototype.destroy=function(){this.unregisterListeners()},a.prototype.isEventHandler=function(){return"object"===Ia(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},a.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)},this)},a.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},a.prototype.onEvent=function(a,b){this.onEventGeneric(a,b)},a.prototype.onEventGeneric=function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(b){Ha.b.error("internal error happened while processing "+a+":"+b.message),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.OTHER_ERROR,details:Ga.a.INTERNAL_EXCEPTION,fatal:!1,event:a,err:b})}},a}(),Ka=Ja,La=/^(\d+)x(\d+)$/,Ma=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Na=function(){function a(b){e(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return a.prototype.decimalInteger=function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b},a.prototype.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},a.prototype.hexadecimalIntegerAsNumber=function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b},a.prototype.decimalFloatingPoint=function(a){return parseFloat(this[a])},a.prototype.enumeratedString=function(a){return this[a]},a.prototype.decimalResolution=function(a){var b=La.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}},a.parseAttrList=function(a){var b,c={};for(Ma.lastIndex=0;null!==(b=Ma.exec(a));){var d=b[2],e='"';0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c},a}(),Oa=Na,Pa={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Qa=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Ra=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Sa=/#EXT-X-MEDIA:(.*)/g,Ta=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ua=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,Va=function(){function a(){j(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return Qa(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Ea.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),Wa=function(){function a(){j(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return a.prototype.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b},a.prototype.fragmentDecryptdataFromLevelkey=function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new Va,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c},a.prototype.cloneObj=function(a){return JSON.parse(JSON.stringify(a))},Qa(a,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Ea.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var a=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c?c:0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),Xa=function(a){function b(c){j(this,b);var d=h(this,a.call(this,c,Fa.a.MANIFEST_LOADING,Fa.a.LEVEL_LOADING,Fa.a.AUDIO_TRACK_LOADING,Fa.a.SUBTITLE_TRACK_LOADING));return d.loaders={},d}return i(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},Ka.prototype.destroy.call(this)},b.prototype.onManifestLoading=function(a){this.load(a.url,{type:"manifest"})},b.prototype.onLevelLoading=function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})},b.prototype.onAudioTrackLoading=function(a){this.load(a.url,{type:"audioTrack",id:a.id})},b.prototype.onSubtitleTrackLoading=function(a){this.load(a.url,{type:"subtitleTrack",id:a.id})},b.prototype.load=function(a,b){var c=this.loaders[b.type];if(void 0!==c){var d=c.context;if(d&&d.url===a)return void Ha.b.trace("playlist request ongoing");Ha.b.warn("abort previous loader for type:"+b.type),c.abort()}var e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0;"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):"level"===b.type?(f=0,g=e.levelLoadingTimeOut):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,Ha.b.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)},b.prototype.resolve=function(a,b){return Ea.a.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},b.prototype.parseMasterPlaylist=function(a,b){function c(a,b){["video","audio"].forEach(function(c){var d=a.filter(function(a){return f(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return d.indexOf(a)===-1})}}),b.unknownCodecs=a}var d=[],e=void 0;for(Ra.lastIndex=0;null!=(e=Ra.exec(a));){var g={},h=g.attrs=new Oa(e[1]);g.url=this.resolve(e[2],b);var i=h.decimalResolution("RESOLUTION");i&&(g.width=i.width,g.height=i.height),g.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),g.name=h.NAME,c([].concat((h.CODECS||"").split(/[ ,]+/)),g),g.videoCodec&&g.videoCodec.indexOf("avc1")!==-1&&(g.videoCodec=this.avc1toavcoti(g.videoCodec)),d.push(g)}return d},b.prototype.parseMasterPlaylistMedia=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],e=void 0,f=[],g=0;for(Sa.lastIndex=0;null!==(e=Sa.exec(a));){var h={},i=new Oa(e[1]);if(i.TYPE===c){if(h.groupId=i["GROUP-ID"],h.name=i.NAME,h.type=c,h.default="YES"===i.DEFAULT,
h.autoselect="YES"===i.AUTOSELECT,h.forced="YES"===i.FORCED,i.URI&&(h.url=this.resolve(i.URI,b)),h.lang=i.LANGUAGE,h.name||(h.name=h.lang),d.length){var j=k(d,h.groupId);h.audioCodec=j?j.codec:d[0].codec}h.id=g++,f.push(h)}}return f},b.prototype.avc1toavcoti=function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b},b.prototype.parseLevelPlaylist=function(a,b,c,d){var e,f,g=0,h=0,i={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},j=new Va,k=0,l=null,m=new Wa;for(Ta.lastIndex=0;null!==(e=Ta.exec(a));){var n=e[1];if(n){m.duration=parseFloat(n);var o=(" "+e[2]).slice(1);m.title=o?o:null,m.tagList.push(o?["INF",n,o]:["INF",n])}else if(e[3]){if(!isNaN(m.duration)){var p=g++;m.type=d,m.start=h,m.levelkey=j,m.sn=p,m.level=c,m.cc=k,m.baseurl=b,m.relurl=(" "+e[3]).slice(1),i.fragments.push(m),l=m,h+=m.duration,m=new Wa}}else if(e[4]){if(m.rawByteRange=(" "+e[4]).slice(1),l){var q=l.byteRangeEndOffset;q&&(m.lastByteRangeEndOffset=q)}}else if(e[5])m.rawProgramDateTime=(" "+e[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),void 0===i.programDateTime&&(i.programDateTime=new Date(new Date(Date.parse(e[5]))-1e3*h));else{for(e=e[0].match(Ua),f=1;f<e.length&&void 0===e[f];f++);var r=(" "+e[f+1]).slice(1),s=(" "+e[f+2]).slice(1);switch(e[f]){case"#":m.tagList.push(s?[r,s]:[r]);break;case"PLAYLIST-TYPE":i.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":g=i.startSN=parseInt(r);break;case"TARGETDURATION":i.targetduration=parseFloat(r);break;case"VERSION":i.version=parseInt(r);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"DIS":k++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":k=parseInt(r);break;case"KEY":var t=r,u=new Oa(t),v=u.enumeratedString("METHOD"),w=u.URI,x=u.hexadecimalInteger("IV");v&&(j=new Va,w&&["AES-128","SAMPLE-AES"].indexOf(v)>=0&&(j.method=v,j.baseuri=b,j.reluri=w,j.key=null,j.iv=x));break;case"START":var y=r,z=new Oa(y),A=z.decimalFloatingPoint("TIME-OFFSET");isNaN(A)||(i.startTimeOffset=A);break;case"MAP":var B=new Oa(r);m.relurl=B.URI,m.rawByteRange=B.BYTERANGE,m.baseurl=b,m.level=c,m.type=d,m.sn="initSegment",i.initSegment=m,m=new Wa;break;default:Ha.b.warn("line parsed but not handled: "+e)}}}return m=l,m&&!m.relurl&&(i.fragments.pop(),h-=m.duration),i.totalduration=h,i.averagetargetduration=h/i.fragments.length,i.endSN=g-1,i.startCC=i.fragments[0]?i.fragments[0].cc:0,i.endCC=k,i},b.prototype.loadsuccess=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,f=a.url,g=c.type,h=c.id,i=c.level,j=this.hls;if(this.loaders[g]=void 0,void 0!==f&&0!==f.indexOf("data:")||(f=c.url),b.tload=performance.now(),0===e.indexOf("#EXTM3U"))if(e.indexOf("#EXTINF:")>0){var k="audioTrack"!==g&&"subtitleTrack"!==g,l=isNaN(i)?isNaN(h)?0:h:i,m=this.parseLevelPlaylist(e,f,l,"audioTrack"===g?"audio":"subtitleTrack"===g?"subtitle":"main");m.tload=b.tload,"manifest"===g&&j.trigger(Fa.a.MANIFEST_LOADED,{levels:[{url:f,details:m}],audioTracks:[],url:f,stats:b,networkDetails:d}),b.tparsed=performance.now(),m.targetduration?k?j.trigger(Fa.a.LEVEL_LOADED,{details:m,level:i||0,id:h||0,stats:b,networkDetails:d}):"audioTrack"===g?j.trigger(Fa.a.AUDIO_TRACK_LOADED,{details:m,id:h,stats:b,networkDetails:d}):"subtitleTrack"===g&&j.trigger(Fa.a.SUBTITLE_TRACK_LOADED,{details:m,id:h,stats:b,networkDetails:d}):j.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"invalid targetduration",networkDetails:d})}else{var n=this.parseMasterPlaylist(e,f);if(n.length){var o=n.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}}),p=this.parseMasterPlaylistMedia(e,f,"AUDIO",o),q=this.parseMasterPlaylistMedia(e,f,"SUBTITLES");if(p.length){var r=!1;p.forEach(function(a){a.url||(r=!0)}),r===!1&&n[0].audioCodec&&!n[0].attrs.AUDIO&&(Ha.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main"}))}j.trigger(Fa.a.MANIFEST_LOADED,{levels:n,audioTracks:p,subtitles:q,url:f,stats:b,networkDetails:d})}else j.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no level found in manifest",networkDetails:d})}else j.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no EXTM3U delimiter",networkDetails:d})},b.prototype.loaderror=function(a,b){var c,d,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":c=Ga.a.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=Ga.a.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=Ga.a.AUDIO_TRACK_LOAD_ERROR,d=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:c,fatal:d,url:f.url,loader:f,response:a,context:b,networkDetails:e})},b.prototype.loadtimeout=function(a,b){var c,d,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":c=Ga.a.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=Ga.a.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=Ga.a.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:c,fatal:d,url:f.url,loader:f,context:b,networkDetails:e})},b}(Ka),Ya=Xa,Za=function(a){function b(c){l(this,b);var d=m(this,a.call(this,c,Fa.a.FRAG_LOADING));return d.loaders={},d}return n(b,a),b.prototype.destroy=function(){var a=this.loaders;for(var b in a){var c=a[b];c&&c.destroy()}this.loaders={},Ka.prototype.destroy.call(this)},b.prototype.onFragLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(Ha.b.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)},b.prototype.loadsuccess=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,f=c.frag;f.loader=void 0,this.loaders[f.type]=void 0,this.hls.trigger(Fa.a.FRAG_LOADED,{payload:e,frag:f,stats:b,networkDetails:d})},b.prototype.loaderror=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})},b.prototype.loadtimeout=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})},b.prototype.loadprogress=function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=b.frag;e.loaded=a.loaded,this.hls.trigger(Fa.a.FRAG_LOAD_PROGRESS,{frag:e,stats:a,networkDetails:d})},b}(Ka),$a=Za,_a=function(a){function b(c){o(this,b);var d=p(this,a.call(this,c,Fa.a.KEY_LOADING));return d.loaders={},d.decryptkey=null,d.decrypturl=null,d}return q(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},Ka.prototype.destroy.call(this)},b.prototype.onKeyLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(Ha.b.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,j=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},j={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,j)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(Fa.a.KEY_LOADED,{frag:b}))},b.prototype.loadsuccess=function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(Fa.a.KEY_LOADED,{frag:d})},b.prototype.loaderror=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.prototype.loadtimeout=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(Fa.a.ERROR,{type:Ga.b.NETWORK_ERROR,details:Ga.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},b}(Ka),ab=_a,bb={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}},cb=bb,db={isBuffered:function(a,b){try{if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0}catch(a){}return!1},bufferInfo:function(a,b,c){try{if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}}catch(a){}return{len:0,start:b,end:b,nextStart:void 0}},bufferedInfo:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&b<m)e=l,f=m,d=f-b;else if(b+c<l){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}},eb=db,fb=c(7),gb=c(5),hb=c.n(gb),ib=c(9),jb=c.n(ib),kb=r(),lb=function(){function a(b,c){s(this,a),this.hls=b,this.id=c;var d=this.observer=new hb.a,e=b.config;d.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];d.emit.apply(d,[a,a].concat(c))},d.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];d.removeListener.apply(d,[a].concat(c))};var f=function(a,c){c=c||{},c.frag=this.frag,c.id=this.id,b.trigger(a,c)}.bind(this);d.on(Fa.a.FRAG_DECRYPTED,f),d.on(Fa.a.FRAG_PARSING_INIT_SEGMENT,f),d.on(Fa.a.FRAG_PARSING_DATA,f),d.on(Fa.a.FRAG_PARSED,f),d.on(Fa.a.ERROR,f),d.on(Fa.a.FRAG_PARSING_METADATA,f),d.on(Fa.a.FRAG_PARSING_USERDATA,f),d.on(Fa.a.INIT_PTS_FOUND,f);var g={mp4:kb.isTypeSupported("video/mp4"),mpeg:kb.isTypeSupported("audio/mpeg"),mp3:kb.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(e.enableWorker&&"undefined"!=typeof Worker){Ha.b.log("demuxing in webworker");var i=void 0;try{i=this.w=jb()(10),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(a){b.trigger(Fa.a.ERROR,{type:Ga.b.OTHER_ERROR,details:Ga.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},i.postMessage({cmd:"init",typeSupported:g,vendor:h,id:c,config:JSON.stringify(e)})}catch(a){Ha.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),i&&URL.revokeObjectURL(i.objectURL),this.demuxer=new fb.a(d,g,e,h),this.w=void 0}}else this.demuxer=new fb.a(d,g,e,h)}return a.prototype.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},a.prototype.push=function(a,b,c,d,e,f,g,h){var i=this.w,j=isNaN(e.startDTS)?e.start:e.startDTS,k=e.decryptdata,l=this.frag,m=!(l&&e.cc===l.cc),n=!(l&&e.level===l.level),o=l&&e.sn===l.sn+1,p=!n&&o;if(m&&Ha.b.log(this.id+":discontinuity detected"),n&&Ha.b.log(this.id+":switch detected"),this.frag=e,i)i.postMessage({cmd:"demux",data:a,decryptdata:k,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:j,discontinuity:m,trackSwitch:n,contiguous:p,duration:f,accurateTimeOffset:g,defaultInitPTS:h},a instanceof ArrayBuffer?[a]:[]);else{var q=this.demuxer;q&&q.push(a,k,b,c,d,j,m,n,p,f,g,h)}},a.prototype.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case Fa.a.FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},a}(),mb=lb,nb={toString:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}},ob=nb,pb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),qb={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},rb=function(a){function b(c){C(this,b);var d=D(this,a.call(this,c,Fa.a.MEDIA_ATTACHED,Fa.a.MEDIA_DETACHING,Fa.a.MANIFEST_LOADING,Fa.a.MANIFEST_PARSED,Fa.a.LEVEL_LOADED,Fa.a.KEY_LOADED,Fa.a.FRAG_LOADED,Fa.a.FRAG_LOAD_EMERGENCY_ABORTED,Fa.a.FRAG_PARSING_INIT_SEGMENT,Fa.a.FRAG_PARSING_DATA,Fa.a.FRAG_PARSED,Fa.a.ERROR,Fa.a.AUDIO_TRACK_SWITCHING,Fa.a.AUDIO_TRACK_SWITCHED,Fa.a.BUFFER_CREATED,Fa.a.BUFFER_APPENDED,Fa.a.BUFFER_FLUSHED));return d.config=c.config,d.audioCodecSwap=!1,d.ticks=0,d._state=qb.STOPPED,d.ontick=d.tick.bind(d),d}return E(b,a),b.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ka.prototype.destroy.call(this),this.state=qb.STOPPED},b.prototype.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;d===-1&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&a===-1&&(Ha.b.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=qb.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=qb.STOPPED},b.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=qb.STOPPED,this.forceStartLoad=!1},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){switch(this.state){case qb.ERROR:break;case qb.BUFFER_FLUSHING:this.fragLoadError=0;break;case qb.IDLE:this._doTickIdle();break;case qb.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=qb.IDLE);break;case qb.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(Ha.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=qb.IDLE);break;case qb.ERROR:case qb.STOPPED:case qb.FRAG_LOADING:case qb.PARSING:case qb.PARSED:case qb.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},b.prototype._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||!this.startFragRequested&&b.startFragPrefetch)){var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e];if(f){var g=f.bitrate,h=void 0;h=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,h=Math.min(h,b.maxMaxBufferLength);var i=eb.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),j=i.len;if(!(j>=h)){Ha.b.trace("buffer length of "+j.toFixed(3)+" is below max of "+h.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var k=f.details;if(void 0===k||k.live===!0&&this.levelLastLoaded!==e)return void(this.state=qb.WAITING_LEVEL);var l=this.fragPrevious;if(!k.live&&l&&!l.backtracked&&l.sn===k.endSN&&!i.nextStart){var m=Math.min(c.duration,l.start+l.duration);if(m-Math.max(i.end,l.start)<=Math.max(.2,l.duration)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(Fa.a.BUFFER_EOS,n),void(this.state=qb.ENDED)}}this._fetchPayloadOrEos(d,i,k)}}}},b.prototype._fetchPayloadOrEos=function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0;if(c.initSegment&&!c.initSegment.data)k=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(g<l)return void Ha.b.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return}else j<h&&(k=f[0]);k||(k=this._findFragment(h,d,g,f,j,i,c)),k&&this._loadFragmentOrKey(k,e,c,a,j)}},b.prototype._ensureFragmentAtLivePoint=function(a,b,c,d,e,f,g){var h=this.hls.config,i=this.media,j=void 0,k=void 0!==h.liveMaxLatencyDuration?h.liveMaxLatencyDuration:h.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-h.maxFragLookUpTolerance,d-k)){var l=this.liveSyncPosition=this.computeLivePosition(c,a);Ha.b.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+l.toFixed(3)),b=l,i&&i.readyState&&i.duration>l&&(i.currentTime=l),this.nextLoadPosition=l}if(a.PTSKnown&&b>d&&i&&i.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(e){var m=e.sn+1;if(m>=a.startSN&&m<=a.endSN){var n=f[m-a.startSN];e.cc===n.cc&&(j=n,Ha.b.log("live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=cb.search(f,function(a){return e.cc-a.cc}),j&&Ha.b.log("live playlist, switching playlist, load frag with same CC: "+j.sn))}j||(j=f[Math.min(g-1,Math.round(g/2))],Ha.b.log("live playlist, switching playlist, unknown, load middle frag : "+j.sn))}return j},b.prototype._findFragment=function(a,b,c,d,e,f,g){var h=this.hls.config,i=void 0,j=void 0,k=h.maxFragLookUpTolerance,l=b?d[b.sn-d[0].sn+1]:void 0,m=function(a){var b=Math.min(k,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-b<=e?1:a.start-b>e&&a.start?-1:0};if(e<f?(e>f-k&&(k=0),j=l&&!m(l)?l:cb.search(d,m)):j=d[c-1],j){i=j;var n=i.sn-g.startSN,o=b&&i.level===b.level,p=d[n-1],q=d[n+1];if(b&&i.sn===b.sn)if(o&&!i.backtracked)if(i.sn<g.endSN){var r=b.deltaPTS;r&&r>h.maxBufferHole&&b.dropped&&n?(i=p,Ha.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(i=q,Ha.b.log("SN just loaded, load next one: "+i.sn))}else i=null;else i.backtracked&&(q&&q.backtracked?(Ha.b.warn("Already backtracked from fragment "+q.sn+", will not backtrack to fragment "+i.sn+". Loading fragment "+q.sn),i=q):(Ha.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),i.dropped=0,p?(p.loadCounter&&p.loadCounter--,i=p,i.backtracked=!0):n&&(i=null)))}return i},b.prototype._loadFragmentOrKey=function(a,b,c,d,e){var f=this.hls,g=f.config;if(!a.decryptdata||null==a.decryptdata.uri||null!=a.decryptdata.key){if(Ha.b.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var h=g.fragLoadingLoopThreshold;if(a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return void f.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a})}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||a.bitrateTest||(this.nextLoadPosition=a.start+a.duration),f.trigger(Fa.a.FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new mb(f,"main")),void(this.state=qb.FRAG_LOADING)}Ha.b.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=qb.KEY_LOADING,f.trigger(Fa.a.KEY_LOADING,{frag:a})},b.prototype.getBufferedFrag=function(a){return cb.search(this._bufferedFrags,function(b){return a<b.startPTS?-1:a>b.endPTS?1:0})},b.prototype.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.endPTS+.5):null},b.prototype._checkFragmentChanged=function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),eb.isBuffered(c,b)?a=this.getBufferedFrag(b):eb.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(Fa.a.FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(Fa.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}},b.prototype.immediateLevelSwitch=function(){if(Ha.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},b.prototype.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,eb.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())},b.prototype.nextLevelSwitch=function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),c=this.getBufferedFrag(a.currentTime),c&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferedFrag(a.currentTime+b),d&&(d=this.followingBufferedFrag(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.maxStartPTS,Number.POSITIVE_INFINITY)}}},b.prototype.flushMainBuffer=function(a,b){this.state=qb.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(Fa.a.BUFFER_FLUSHING,c)},b.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)},b.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(Ha.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeking=function(){var a=this.media,b=a?a.currentTime:void 0,c=this.config;isNaN(b)||Ha.b.log("media seeking to "+b.toFixed(3));var d=this.mediaBuffer?this.mediaBuffer:a,e=eb.bufferInfo(d,b,this.config.maxBufferHole);if(this.state===qb.FRAG_LOADING){var f=this.fragCurrent;if(0===e.len&&f){var g=c.maxFragLookUpTolerance,h=f.start-g,i=f.start+f.duration+g;b<h||b>i?(f.loader&&(Ha.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=qb.IDLE):Ha.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===qb.ENDED&&(0===e.len&&(this.fragPrevious=0),this.state=qb.IDLE);a&&(this.lastCurrentTime=b),this.state!==qb.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()},b.prototype.onMediaSeeked=function(){var a=this.media,b=a?a.currentTime:void 0;isNaN(b)||Ha.b.log("media seeked to "+b.toFixed(3)),this.tick()},b.prototype.onMediaEnded=function(){Ha.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestLoading=function(){Ha.b.log("trigger BUFFER_RESET"),this.hls.trigger(Fa.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},b.prototype.onManifestParsed=function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(b.indexOf("mp4a.40.2")!==-1&&(c=!0),b.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&Ha.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},b.prototype.onLevelLoaded=function(a){var b=a.details,c=a.level,d=this.levels[this.levelLastLoaded],e=this.levels[c],f=b.totalduration,g=0;if(Ha.b.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+f),b.live){var h=e.details;h&&b.fragments.length>0?(v(h,b),g=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(g,h),b.PTSKnown&&!isNaN(g)?Ha.b.log("live playlist sliding:"+g.toFixed(3)):(Ha.b.log("live playlist - outdated PTS, unknown sliding"),B(this.fragPrevious,d,b))):(Ha.b.log("live playlist - first load, unknown sliding"),b.PTSKnown=!1,B(this.fragPrevious,d,b))}else b.PTSKnown=!1;if(e.details=b,this.levelLastLoaded=c,this.hls.trigger(Fa.a.LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var i=b.startTimeOffset;isNaN(i)?b.live?(this.startPosition=this.computeLivePosition(g,b),Ha.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(i<0&&(Ha.b.log("negative start time offset "+i+", count from end of last fragment"),i=g+f+i),Ha.b.log("start time offset found in playlist, adjust startPosition to "+i),this.startPosition=i),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===qb.WAITING_LEVEL&&(this.state=qb.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===qb.KEY_LOADING&&(this.state=qb.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===qb.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats,e=this.levels[b.level],f=e.details;if(Ha.b.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,this.stats=d,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=qb.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(Fa.a.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else if("initSegment"===c.sn)this.state=qb.IDLE,d.tparsed=d.tbuffered=performance.now(),f.initSegment.data=a.payload,this.hls.trigger(Fa.a.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=qb.PARSING;var g=f.totalduration,h=b.level,i=b.sn,j=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(Ha.b.log("swapping playlist audio codec"),void 0===j&&(j=this.lastAudioCodec),j&&(j=j.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,Ha.b.log("Parsing "+i+" of ["+f.startSN+" ,"+f.endSN+"],level "+h+", cc "+b.cc);var k=this.demuxer;k||(k=this.demuxer=new mb(this.hls,"main"));var l=this.media,m=l&&l.seeking,n=!m&&(f.PTSKnown||!f.live),o=f.initSegment?f.initSegment.data:[];k.push(a.payload,o,j,e.videoCodec,b,g,n,void 0)}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===qb.PARSING){var d,e,f=a.tracks;if(f.audio&&this.altAudio&&delete f.audio,e=f.audio){var g=this.levels[this.level].audioCodec,h=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(Ha.b.log("swapping playlist audio codec"),g=g.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==e.metadata.channelCount&&h.indexOf("firefox")===-1&&(g="mp4a.40.5"),h.indexOf("android")!==-1&&"audio/mpeg"!==e.container&&(g="mp4a.40.2",Ha.b.log("Android: force audio codec to "+g)),e.levelCodec=g,e.id=a.id}e=f.video,e&&(e.levelCodec=this.levels[this.level].videoCodec,e.id=a.id),this.hls.trigger(Fa.a.BUFFER_CODECS,f);for(d in f){e=f[d],Ha.b.log("main track:"+d+",container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var i=e.initSegment;i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Fa.a.BUFFER_APPENDING,{type:d,data:i,parent:"main",content:"initSegment"}))}this.tick()}},b.prototype.onFragParsingData=function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"main"===a.id&&d.sn===c.sn&&d.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===qb.PARSING){var e=this.levels[this.level],f=c;if(isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),Ha.b.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),"video"===a.type)if(f.dropped=a.dropped,f.dropped)if(f.backtracked)Ha.b.warn("Already backtracked on this fragment, appending with the gap");else{var g=e.details;if(!g||f.sn!==g.startSN)return Ha.b.warn("missing video frame(s), backtracking fragment"),f.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=qb.IDLE,this.fragPrevious=f,void this.tick();Ha.b.warn("missing video frame(s) on first frag, appending with gap")}else f.backtracked=!1;var h=u(e.details,f,a.startPTS,a.endPTS,a.startDTS,a.endDTS),i=this.hls;i.trigger(Fa.a.LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:h,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(c){c&&c.length&&b.state===qb.PARSING&&(b.appended=!0,b.pendingBuffering=!0,i.trigger(Fa.a.BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}},b.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===qb.PARSING&&(this.stats.tparsed=performance.now(),this.state=qb.PARSED,this._checkAppendedParsed())},b.prototype.onAudioTrackSwitching=function(a){var b=!!a.url,c=a.id;if(!b){if(this.mediaBuffer!==this.media){Ha.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var d=this.fragCurrent;d.loader&&(Ha.b.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=qb.IDLE}var e=this.hls;e.trigger(Fa.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(Fa.a.AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1}},b.prototype.onAudioTrackSwitched=function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(Ha.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},b.prototype.onBufferCreated=function(a){
var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(Ha.b.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},b.prototype.onBufferAppended=function(a){if("main"===a.parent){var b=this.state;b!==qb.PARSING&&b!==qb.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==qb.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;Ha.b.log("main buffered : "+ob.toString(b.buffered));var c=this._bufferedFrags.filter(function(a){return eb.isBuffered(b,(a.startPTS+a.endPTS)/2)});c.push(a),this._bufferedFrags=c.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=a;var d=this.stats;d.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*d.total/(d.tbuffered-d.tfirst)),this.hls.trigger(Fa.a.FRAG_BUFFERED,{stats:d,frag:a,id:"main"}),this.state=qb.IDLE}this.tick()}},b.prototype.onError=function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=!!this.media&&eb.isBuffered(this.media,this.media.currentTime)&&eb.isBuffered(this.media,this.media.currentTime+.5);switch(a.details){case Ga.a.FRAG_LOAD_ERROR:case Ga.a.FRAG_LOAD_TIMEOUT:case Ga.a.KEY_LOAD_ERROR:case Ga.a.KEY_LOAD_TIMEOUT:if(!a.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var d=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);b.loadCounter=0,Ha.b.warn("mediaController: frag loading failed, retry in "+d+" ms"),this.retryDate=performance.now()+d,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=qb.FRAG_LOADING_WAITING_RETRY}else Ha.b.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=qb.ERROR;break;case Ga.a.FRAG_LOOP_LOADING_ERROR:a.fatal||(c?(this._reduceMaxBufferLength(b.duration),this.state=qb.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.state=qb.ERROR));break;case Ga.a.LEVEL_LOAD_ERROR:case Ga.a.LEVEL_LOAD_TIMEOUT:this.state!==qb.ERROR&&(a.fatal?(this.state=qb.ERROR,Ha.b.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):a.levelRetry||this.state!==qb.WAITING_LEVEL||(this.state=qb.IDLE));break;case Ga.a.BUFFER_FULL_ERROR:"main"!==a.parent||this.state!==qb.PARSING&&this.state!==qb.PARSED||(c?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=qb.IDLE):(Ha.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},b.prototype._reduceMaxBufferLength=function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,Ha.b.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*b.fragLoadingLoopThreshold))},b.prototype._checkBuffer=function(){var a=this.media,b=this.config;if(a&&a.readyState){var c=a.currentTime,d=this.mediaBuffer?this.mediaBuffer:a,e=d.buffered;if(!this.loadedmetadata&&e.length){this.loadedmetadata=!0;var f=a.seeking?c:this.startPosition,g=eb.isBuffered(d,f),h=e.start(0),i=!g&&Math.abs(f-h)<b.maxSeekHole;(c!==f||i)&&(Ha.b.log("target start position:"+f),i&&(f=h,Ha.b.log("target start position not buffered, seek to buffered.start(0) "+f)),Ha.b.log("adjust currentTime from "+c+" to "+f),a.currentTime=f)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var j=eb.bufferInfo(a,c,0),k=!(a.paused||a.ended||0===a.buffered.length),l=.5,m=c!==this.lastCurrentTime;if(m)this.stallReported&&(Ha.b.warn("playback not stuck anymore @"+c+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(k){var n=performance.now(),o=this.hls;if(this.stalled){var p=n-this.stalled,q=j.len,r=this.nudgeRetry||0;if(q<=l&&p>1e3*b.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,Ha.b.warn("playback stalling in low buffer @"+c),o.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:q}));var s=j.nextStart,t=s-c;if(s&&t<b.maxSeekHole&&t>0){this.nudgeRetry=++r;var u=r*b.nudgeOffset;Ha.b.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+s+" + nudge "+u),a.currentTime=s+u,this.stalled=void 0,o.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:s+u-c})}}else if(q>l&&p>1e3*b.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,Ha.b.warn("playback stalling in high buffer @"+c),o.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:q})),this.stalled=void 0,this.nudgeRetry=++r,r<b.nudgeMaxRetry){var v=a.currentTime,w=v+r*b.nudgeOffset;Ha.b.log("adjust currentTime from "+v+" to "+w),a.currentTime=w,o.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Ha.b.error("still stuck in high buffer @"+c+" after "+b.nudgeMaxRetry+", raise fatal error"),o.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=n,this.stallReported=!1}}}},b.prototype.onFragLoadEmergencyAborted=function(){this.state=qb.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},b.prototype.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(b){return eb.isBuffered(a,(b.startPTS+b.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=qb.IDLE,this.fragPrevious=null},b.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.prototype.computeLivePosition=function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)},pb(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,Ha.b.log("main stream:"+b+"->"+a),this.hls.trigger(Fa.a.STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(Ka),sb=rb,tb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ub=function(a){function b(c){F(this,b);var d=G(this,a.call(this,c,Fa.a.MANIFEST_LOADED,Fa.a.LEVEL_LOADED,Fa.a.FRAG_LOADED,Fa.a.ERROR));return d.canload=!1,d.currentLevelIndex=null,d.manualLevelIndex=-1,d.timer=null,d}return H(b,a),b.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},b.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.startLoad=function(){var a=this._levels;this.canload=!0,this.levelRetryCount=0,a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),null!==this.timer&&this.loadLevel()},b.prototype.stopLoad=function(){this.canload=!1},b.prototype.onManifestLoaded=function(a){var b=[],c=void 0,d={},e=null,f=!1,h=!1,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),j=[];if(a.levels.forEach(function(a){a.loadError=0,a.fragmentError=!1,f=f||!!a.videoCodec,h=h||!!a.audioCodec||!(!a.attrs||!a.attrs.AUDIO),i===!0&&a.audioCodec&&a.audioCodec.indexOf("mp4a.40.34")!==-1&&(a.audioCodec=void 0),e=d[a.bitrate],void 0===e?(a.url=[a.url],a.urlId=0,d[a.bitrate]=a,b.push(a)):e.url.push(a.url)}),f===!0&&h===!0&&(b=b.filter(function(a){var b=a.videoCodec;return!!b})),b=b.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||g(b))&&(!c||g(c))}),a.audioTracks&&(j=a.audioTracks.filter(function(a){return!a.audioCodec||g(a.audioCodec,"audio")})),b.length>0){c=b[0].bitrate,b.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=b;for(var k=0;k<b.length;k++)if(b[k].bitrate===c){this._firstLevel=k,Ha.b.log("manifest loaded,"+b.length+" level(s) found, first bitrate:"+c);break}this.hls.trigger(Fa.a.MANIFEST_PARSED,{levels:b,audioTracks:j,firstLevel:this._firstLevel,stats:a.stats,audio:h,video:f,altAudio:j.length>0})}else this.hls.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},b.prototype.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.cleanTimer(),this.currentLevelIndex!==a){Ha.b.log("switching to level "+a),this.currentLevelIndex=a;var d=b[a];d.level=a,c.trigger(Fa.a.LEVEL_SWITCH,d),c.trigger(Fa.a.LEVEL_SWITCHING,d)}var e=b[a],f=e.details;if(!f||f.live===!0){var g=e.urlId;c.trigger(Fa.a.LEVEL_LOADING,{url:e.url[g],level:a,id:g})}}else c.trigger(Fa.a.ERROR,{type:Ga.b.OTHER_ERROR,details:Ga.a.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},b.prototype.onError=function(a){if(a.fatal===!0)return void(a.type===Ga.b.NETWORK_ERROR&&this.cleanTimer());var b=!1,c=!1,d=void 0;switch(a.details){case Ga.a.FRAG_LOAD_ERROR:case Ga.a.FRAG_LOAD_TIMEOUT:case Ga.a.FRAG_LOOP_LOADING_ERROR:case Ga.a.KEY_LOAD_ERROR:case Ga.a.KEY_LOAD_TIMEOUT:d=a.frag.level,c=!0;break;case Ga.a.LEVEL_LOAD_ERROR:case Ga.a.LEVEL_LOAD_TIMEOUT:d=a.context.level,b=!0;break;case Ga.a.REMUX_ALLOC_ERROR:d=a.level,b=!0}void 0!==d&&this.recoverLevel(a,d,b,c)},b.prototype.recoverLevel=function(a,b,c,d){var e=this,f=this.hls.config,g=a.details,h=this._levels[b],i=void 0,j=void 0,k=void 0;if(h.loadError++,h.fragmentError=d,c===!0){if(!(this.levelRetryCount+1<=f.levelLoadingMaxRetry))return Ha.b.error("level controller, cannot recover from "+g+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(a.fatal=!0);j=Math.min(Math.pow(2,this.levelRetryCount)*f.levelLoadingRetryDelay,f.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return e.loadLevel()},j),a.levelRetry=!0,this.levelRetryCount++,Ha.b.warn("level controller, "+g+", retry in "+j+" ms, current retry count is "+this.levelRetryCount)}c!==!0&&d!==!0||(i=h.url.length,i>1&&h.loadError<i?(Ha.b.warn("level controller, "+g+" for level "+b+": switching to redundant stream id "+h.urlId),h.urlId=(h.urlId+1)%i,h.details=void 0):this.manualLevelIndex===-1?(k=0===b?this._levels.length-1:b-1,Ha.b.warn("level controller, "+g+": switch to "+k),this.hls.nextAutoLevel=this.currentLevelIndex=k):d===!0&&(Ha.b.warn("level controller, "+g+": reload a fragment"),this.currentLevelIndex=null))},b.prototype.onFragLoaded=function(a){var b=a.frag;if(void 0!==b&&"main"===b.type){var c=this._levels[b.level];void 0!==c&&(c.fragmentError=!1,c.loadError=0,this.levelRetryCount=0)}},b.prototype.onLevelLoaded=function(a){var b=this,c=a.level;if(c===this.currentLevelIndex){var d=this._levels[c];d.fragmentError===!1&&(d.loadError=0,this.levelRetryCount=0);var e=a.details;if(e.live){var f=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),g=d.details;g&&e.endSN===g.endSN&&(f/=2,Ha.b.log("same live playlist, reload twice faster")),f-=performance.now()-a.stats.trequest,f=Math.max(1e3,Math.round(f)),Ha.b.log("live playlist, reload in "+f+" ms"),this.timer=setTimeout(function(){return b.loadLevel()},f)}else this.cleanTimer()}},b.prototype.loadLevel=function(){var a=void 0,b=void 0;null!==this.currentLevelIndex&&this.canload===!0&&(a=this._levels[this.currentLevelIndex],void 0!==a&&a.url.length>0&&(b=a.urlId,this.hls.trigger(Fa.a.LEVEL_LOADING,{url:a.url[b],level:this.currentLevelIndex,id:b})))},tb(b,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),this.currentLevelIndex===a&&void 0!==b[a].details||this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=a)}}]),b}(Ka),vb=ub,wb=c(3),xb=function(a){function b(c){I(this,b);var d=J(this,a.call(this,c,Fa.a.MEDIA_ATTACHED,Fa.a.MEDIA_DETACHING,Fa.a.FRAG_PARSING_METADATA));return d.id3Track=void 0,d.media=void 0,d}return K(b,a),b.prototype.destroy=function(){Ka.prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){this.media=a.media,!this.media},b.prototype.onMediaDetaching=function(){this.media=void 0},b.prototype.onFragParsingMetadata=function(a){var b=a.frag,c=a.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<c.length;e++){var f=wb.a.getID3Frames(c[e].data);if(f){var g=c[e].pts,h=e<c.length-1?c[e+1].pts:b.endPTS;g===h&&(h+=1e-4);for(var i=0;i<f.length;i++){var j=f[i];if(!wb.a.isTimeStampFrame(j)){var k=new d(g,h,"");k.value=j,this.id3Track.addCue(k)}}}}},b}(Ka),yb=xb,zb=function(){function a(b){M(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return a.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},a.prototype.getTotalWeight=function(){return this.totalWeight_},a.prototype.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_},a}(),Ab=zb,Bb=function(){function a(b,c,d,e){N(this,a),this.hls=b,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ab(c),this.fast_=new Ab(d)}return a.prototype.sample=function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)},a.prototype.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a}(),Cb=Bb,Db=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Eb=function(a){function b(c){O(this,b);var d=P(this,a.call(this,c,Fa.a.FRAG_LOADING,Fa.a.FRAG_LOADED,Fa.a.FRAG_BUFFERED,Fa.a.ERROR));return d.lastLoadedFragLevel=0,d._nextAutoLevel=-1,d.hls=c,d.timer=null,d._bwEstimator=null,d.onCheck=d._abandonRulesCheck.bind(d),d}return Q(b,a),b.prototype.destroy=function(){this.clearTimer(),Ka.prototype.destroy.call(this)},b.prototype.onFragLoading=function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this._bwEstimator=new Cb(c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}},b.prototype._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return Ha.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var f=d.stats;if(b&&f&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var g=performance.now()-f.trequest,h=Math.abs(b.playbackRate);if(g>500*c.duration/h){var i=a.levels,j=Math.max(1,f.bw?f.bw/8:1e3*f.loaded/g),k=i[c.level],l=k.realBitrate?Math.max(k.realBitrate,k.bitrate):k.bitrate,m=f.total?f.total:Math.max(f.loaded,Math.round(c.duration*l/8)),n=b.currentTime,o=(m-f.loaded)/j,p=(eb.bufferInfo(b,n,a.config.maxBufferHole).end-n)/h;if(p<2*c.duration/h&&o>p){var q=void 0,r=void 0;for(r=c.level-1;r>e;r--){var s=i[r].realBitrate?Math.max(i[r].realBitrate,i[r].bitrate):i[r].bitrate;if(q=c.duration*s/(6.4*j),q<p)break}q<o&&(Ha.b.warn("loading too slow, abort fragment loading and switch to level "+r+":fragLoadedDelay["+r+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+q.toFixed(1)+"<"+o.toFixed(1)+":"+p.toFixed(1)),a.nextLoadLevel=r,this._bwEstimator.sample(g,f.loaded),d.abort(),this.clearTimer(),a.trigger(Fa.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:f}))}}}},b.prototype.onFragLoaded=function(a){var b=a.frag;if("main"===b.type&&!isNaN(b.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration;c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e)}if(a.frag.bitrateTest){var f=a.stats;f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)}}},b.prototype.onFragBuffered=function(a){var b=a.stats,c=a.frag;if(!(b.aborted===!0||1!==c.loadCounter||"main"!==c.type||isNaN(c.sn)||c.bitrateTest&&b.tload!==b.tbuffered)){var d=b.tparsed-b.trequest;Ha.b.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this._bwEstimator.sample(d,b.loaded),b.bwEstimate=this._bwEstimator.getEstimate(),c.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},b.prototype.onError=function(a){switch(a.details){case Ga.a.FRAG_LOAD_ERROR:case Ga.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},b.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},b.prototype._findBestLevel=function(a,b,c,d,e,f,g,h,i){for(var j=e;j>=d;j--){var k=i[j],l=k.details,m=l?l.totalduration/l.fragments.length:b,n=!!l&&l.live,o=void 0;o=j<=a?g*c:h*c;var p=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,q=p*m/o;if(Ha.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(o)+"/"+p+"/"+m+"/"+f+"/"+q),o>p&&(!q||n&&!this.bitrateTestDelay||q<f))return j}return-1},Db(b,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(a===-1||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return a!==-1&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,j=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,k=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,l=(eb.bufferInfo(f,i,d.maxBufferHole).end-i)/j,m=this._findBestLevel(g,h,k,e,b,l,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(m>=0)return m;Ha.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var n=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,o=d.abrBandWidthFactor,p=d.abrBandWidthUpFactor;if(0===l){var q=this.bitrateTestDelay;if(q){var r=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay;n=r-q,Ha.b.trace("bitrate test took "+Math.round(1e3*q)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*n)+" ms"),o=p=1}}return m=this._findBestLevel(g,h,k,e,b,l+n,o,p,c),Math.max(m,0)}}]),b}(Ka),Fb=Eb,Gb=r(),Hb=function(a){function b(c){R(this,b);var d=S(this,a.call(this,c,Fa.a.MEDIA_ATTACHING,Fa.a.MEDIA_DETACHING,Fa.a.MANIFEST_PARSED,Fa.a.BUFFER_RESET,Fa.a.BUFFER_APPENDING,Fa.a.BUFFER_CODECS,Fa.a.BUFFER_EOS,Fa.a.BUFFER_FLUSHING,Fa.a.LEVEL_PTS_UPDATED,Fa.a.LEVEL_UPDATED));return d._msDuration=null,d._levelDuration=null,d._live=null,d._objectUrl=null,d.onsbue=d.onSBUpdateEnd.bind(d),d.onsbe=d.onSBUpdateError.bind(d),d.pendingTracks={},d.tracks={},d}return T(b,a),b.prototype.destroy=function(){Ka.prototype.destroy.call(this)},b.prototype.onLevelPtsUpdated=function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(a){f=!0,Ha.b.warn("can not abort audio buffer: "+a)}f?this.audioTimestampOffset=a.start:(Ha.b.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},b.prototype.onManifestParsed=function(a){var b=a.audio,c=a.video||a.levels.length&&a.audio,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),Ha.b.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d},b.prototype.onMediaAttaching=function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new Gb;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c),this._objectUrl=b.src}},b.prototype.onMediaDetaching=function(){Ha.b.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(a){Ha.b.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):Ha.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(Fa.a.MEDIA_DETACHED)},b.prototype.onMediaSourceOpen=function(){Ha.b.log("media source opened"),this.hls.trigger(Fa.a.MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},b.prototype.checkPendingTracks=function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())},b.prototype.onMediaSourceClose=function(){Ha.b.log("media source closed")},b.prototype.onMediaSourceEnded=function(){Ha.b.log("media source ended")},b.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;Ha.b.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);this.hls.trigger(Fa.a.BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},b.prototype.onSBUpdateError=function(a){Ha.b.error("sourceBuffer error:",a),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_APPENDING_ERROR,fatal:!1})},b.prototype.onBufferReset=function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},b.prototype.onBufferCodecs=function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}},b.prototype.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;Ha.b.log("creating sourceBuffer("+g+")");try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),this.tracks[d]={codec:f,container:e.container},e.buffer=h}catch(a){Ha.b.error("error while trying to add sourceBuffer:"+a.message),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:a,mimeType:g})}}this.hls.trigger(Fa.a.BUFFER_CREATED,{tracks:a})},b.prototype.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())},b.prototype.onBufferAppendFail=function(a){Ha.b.error("sourceBuffer error:",a.event),this.hls.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.BUFFER_APPENDING_ERROR,fatal:!1})},b.prototype.onBufferEos=function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,Ha.b.log(d+" sourceBuffer now EOS"));this.checkEos()},b.prototype.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}Ha.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(a){Ha.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},b.prototype.onBufferFlushing=function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()},b.prototype.onLevelUpdated=function(a){var b=a.details;b.fragments.length>0&&(this._levelDuration=b.totalduration+b.fragments[0].start,this._live=b.live,this.updateMediaElementDuration())},b.prototype.updateMediaElementDuration=function(){var a=this.hls.config,b=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var c in this.sourceBuffer)if(this.sourceBuffer[c].updating===!0)return;b=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),this._live===!0&&a.liveDurationInfinity===!0?(Ha.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>b||b===1/0||isNaN(b))&&(Ha.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},b.prototype.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(a){Ha.b.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(Fa.a.BUFFER_FLUSHED)}},b.prototype.doAppending=function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void Ha.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type,f=b[e];f?f.updating?c.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(b){Ha.b.error("error while trying to append buffer:"+b.message),c.unshift(d);var g={type:Ga.b.MEDIA_ERROR,parent:d.parent};if(22===b.code)return this.segments=[],g.details=Ga.a.BUFFER_FULL_ERROR,g.fatal=!1,void a.trigger(Fa.a.ERROR,g);if(this.appendError?this.appendError++:this.appendError=1,g.details=Ga.a.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry)return Ha.b.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],g.fatal=!0,void a.trigger(Fa.a.ERROR,g);g.fatal=!1,a.trigger(Fa.a.ERROR,g)}}}},b.prototype.flushBuffer=function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(Ha.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return Ha.b.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,Ha.b.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}catch(a){Ha.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else Ha.b.warn("abort flushing too many retries");Ha.b.log("buffer flushed")}return!0},b}(Ka),Ib=Hb,Jb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Kb=function(a){function b(c){return U(this,b),V(this,a.call(this,c,Fa.a.FPS_DROP_LEVEL_CAPPING,Fa.a.MEDIA_ATTACHING,Fa.a.MANIFEST_PARSED))}return W(b,a),b.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},b.prototype.onFpsDropLevelCapping=function(a){b.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},b.prototype.onMediaAttaching=function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null},b.prototype.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[],b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.prototype.detectPlayerSize=function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},b.prototype.getMaxLevel=function(a){var c=this;if(!this.levels)return-1;var d=this.levels.filter(function(d,e){return b.isLevelAllowed(e,c.restrictedLevels)&&e<=a});return b.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},b.isLevelAllowed=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return b.indexOf(a)===-1},b.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var d=function(a,b){return!b||(a.width!==b.width||a.height!==b.height)},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},Jb(b,[{key:"mediaWidth",get:function(){var a=void 0,c=this.media;return c&&(a=c.width||c.clientWidth||c.offsetWidth,a*=b.contentScaleFactor),a}},{key:"mediaHeight",get:function(){
var a=void 0,c=this.media;return c&&(a=c.height||c.clientHeight||c.offsetHeight,a*=b.contentScaleFactor),a}}],[{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(a){}return a}}]),b}(Ka),Lb=Kb,Mb=function(a){function b(c){return X(this,b),Y(this,a.call(this,c,Fa.a.MEDIA_ATTACHING))}return Z(b,a),b.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},b.prototype.onMediaAttaching=function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},b.prototype.checkFPS=function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e,i=this.hls;if(i.trigger(Fa.a.FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>i.config.fpsDroppedMonitoringThreshold*g){var j=i.currentLevel;Ha.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+j),j>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=j)&&(j-=1,i.trigger(Fa.a.FPS_DROP_LEVEL_CAPPING,{level:j,droppedLevel:i.currentLevel}),i.autoLevelCapping=j,i.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.prototype.checkFPSInterval=function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},b}(Ka),Nb=Mb,Ob=function(){function a(b){$(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var a,b=this.context;a=this.loader=new XMLHttpRequest;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(c){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(c){return void this.callbacks.onError({code:a.status,text:c.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},a.prototype.readystatechange=function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,f=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var g=b.status;if(g>=200&&g<300){d.tload=Math.max(d.tfirst,performance.now());var h=void 0,i=void 0;"arraybuffer"===e.responseType?(h=b.response,i=h.byteLength):(h=b.responseText,i=h.length),d.loaded=d.total=i;var j={url:b.responseURL,data:h};this.callbacks.onSuccess(j,d,e,b)}else d.retry>=f.maxRetry||g>=400&&g<499?(Ha.b.error(g+" while loading "+e.url),this.callbacks.onError({code:g,text:b.statusText},e,b)):(Ha.b.warn(g+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,f.maxRetryDelay),d.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),f.timeout)},a.prototype.loadtimeout=function(){Ha.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)},a}(),Pb=Ob,Qb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Rb=function(a){function b(c){_(this,b);var d=aa(this,a.call(this,c,Fa.a.MANIFEST_LOADING,Fa.a.MANIFEST_PARSED,Fa.a.AUDIO_TRACK_LOADED,Fa.a.ERROR));return d.ticks=0,d.ontick=d.tick.bind(d),d}return ba(b,a),b.prototype.destroy=function(){this.cleanTimer(),Ka.prototype.destroy.call(this)},b.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){this.updateTrack(this.trackId)},b.prototype.onError=function(a){a.fatal&&a.type===Ga.b.NETWORK_ERROR&&this.cleanTimer()},b.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},b.prototype.onManifestParsed=function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(Fa.a.AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a.default&&!d?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(Ha.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},b.prototype.onAudioTrackLoaded=function(a){a.id<this.tracks.length&&(Ha.b.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&this.cleanTimer())},b.prototype.setAudioTrackInternal=function(a){if(a>=0&&a<this.tracks.length){this.cleanTimer(),this.trackId=a,Ha.b.log("switching to audioTrack "+a);var b=this.tracks[a],c=this.hls,d=b.type,e=b.url,f={id:a,type:d,url:e};c.trigger(Fa.a.AUDIO_TRACK_SWITCH,f),c.trigger(Fa.a.AUDIO_TRACK_SWITCHING,f);var g=b.details;!e||void 0!==g&&g.live!==!0||(Ha.b.log("(re)loading playlist for audioTrack "+a),c.trigger(Fa.a.AUDIO_TRACK_LOADING,{url:e,id:a}))}},b.prototype.updateTrack=function(a){if(a>=0&&a<this.tracks.length){this.cleanTimer(),this.trackId=a,Ha.b.log("updating audioTrack "+a);var b=this.tracks[a],c=b.url,d=b.details;!c||void 0!==d&&d.live!==!0||(Ha.b.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(Fa.a.AUDIO_TRACK_LOADING,{url:c,id:a}))}},Qb(b,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.trackId===a&&void 0!==this.tracks[a].details||this.setAudioTrackInternal(a)}}]),b}(Ka),Sb=Rb,Tb=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Ub={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},Vb=function(a){function b(c){ca(this,b);var d=da(this,a.call(this,c,Fa.a.MEDIA_ATTACHED,Fa.a.MEDIA_DETACHING,Fa.a.AUDIO_TRACKS_UPDATED,Fa.a.AUDIO_TRACK_SWITCHING,Fa.a.AUDIO_TRACK_LOADED,Fa.a.KEY_LOADED,Fa.a.FRAG_LOADED,Fa.a.FRAG_PARSING_INIT_SEGMENT,Fa.a.FRAG_PARSING_DATA,Fa.a.FRAG_PARSED,Fa.a.ERROR,Fa.a.BUFFER_RESET,Fa.a.BUFFER_CREATED,Fa.a.BUFFER_APPENDED,Fa.a.BUFFER_FLUSHED,Fa.a.INIT_PTS_FOUND));return d.config=c.config,d.audioCodecSwap=!1,d.ticks=0,d._state=Ub.STOPPED,d.ontick=d.tick.bind(d),d.initPTS=[],d.waitingFragment=null,d.videoTrackCC=null,d}return ea(b,a),b.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ka.prototype.destroy.call(this),this.state=Ub.STOPPED},b.prototype.onInitPtsFound=function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,Ha.b.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===Ub.WAITING_INIT_PTS&&this.tick())},b.prototype.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&a===-1?(Ha.b.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=Ub.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=Ub.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=Ub.STOPPED},b.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ub.STOPPED},b.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},b.prototype.doTick=function(){var a,b,c,d=this.hls,e=d.config;switch(this.state){case Ub.ERROR:case Ub.PAUSED:case Ub.BUFFER_FLUSHING:break;case Ub.STARTING:this.state=Ub.WAITING_TRACK,this.loadedmetadata=!1;break;case Ub.IDLE:var f=this.tracks;if(!f)break;if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;if(this.loadedmetadata)a=this.media.currentTime;else if(a=this.nextLoadPosition,void 0===a)break;var g=this.mediaBuffer?this.mediaBuffer:this.media,h=this.videoBuffer?this.videoBuffer:this.media,i=eb.bufferInfo(g,a,e.maxBufferHole),j=eb.bufferInfo(h,a,e.maxBufferHole),k=i.len,l=i.end,m=this.fragPrevious,n=Math.max(e.maxBufferLength,j.len),o=this.audioSwitch,p=this.trackId;if((k<n||o)&&p<f.length){if(c=f[p].details,"undefined"==typeof c){this.state=Ub.WAITING_TRACK;break}if(!o&&!c.live&&m&&m.sn===c.endSN&&!i.nextStart&&(!this.media.seeking||this.media.duration-l<m.duration/2)){this.hls.trigger(Fa.a.BUFFER_EOS,{type:"audio"}),this.state=Ub.ENDED;break}var q=c.fragments,r=q.length,s=q[0].start,t=q[r-1].start+q[r-1].duration,u=void 0;if(o)if(c.live&&!c.PTSKnown)Ha.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),l=0;else if(l=a,c.PTSKnown&&a<s){if(!(i.end>s||i.nextStart))return;Ha.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=s+.05}if(c.initSegment&&!c.initSegment.data)u=c.initSegment;else if(l<=s){if(u=q[0],null!==this.videoTrackCC&&u.cc!==this.videoTrackCC&&(u=x(q,this.videoTrackCC)),c.live&&u.loadIdx&&u.loadIdx===this.fragLoadIdx){var v=i.nextStart?i.nextStart:s;return Ha.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(v+.05)),void(this.media.currentTime=v+.05)}}else{var w=void 0,y=e.maxFragLookUpTolerance,z=m?q[m.sn-q[0].sn+1]:void 0,A=function(a){var b=Math.min(y,a.duration);return a.start+a.duration-b<=l?1:a.start-b>l&&a.start?-1:0};l<t?(l>t-y&&(y=0),w=z&&!A(z)?z:cb.search(q,A)):w=q[r-1],w&&(u=w,s=w.start,m&&u.level===m.level&&u.sn===m.sn&&(u.sn<c.endSN?(u=q[u.sn+1-c.startSN],Ha.b.log("SN just loaded, load next one: "+u.sn)):u=null))}if(u)if(u.decryptdata&&null!=u.decryptdata.uri&&null==u.decryptdata.key)Ha.b.log("Loading key for "+u.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+p),this.state=Ub.KEY_LOADING,d.trigger(Fa.a.KEY_LOADING,{frag:u});else{if(Ha.b.log("Loading "+u.sn+", cc: "+u.cc+" of ["+c.startSN+" ,"+c.endSN+"],track "+p+", currentTime:"+a+",bufferEnd:"+l.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,u.loadCounter){u.loadCounter++;var B=e.fragLoadingLoopThreshold;if(u.loadCounter>B&&Math.abs(this.fragLoadIdx-u.loadIdx)<B)return void d.trigger(Fa.a.ERROR,{type:Ga.b.MEDIA_ERROR,details:Ga.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:u})}else u.loadCounter=1;u.loadIdx=this.fragLoadIdx,this.fragCurrent=u,this.startFragRequested=!0,isNaN(u.sn)||(this.nextLoadPosition=u.start+u.duration),d.trigger(Fa.a.FRAG_LOADING,{frag:u}),this.state=Ub.FRAG_LOADING}}break;case Ub.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=Ub.IDLE);break;case Ub.FRAG_LOADING_WAITING_RETRY:var C=performance.now(),D=this.retryDate;g=this.media;var E=g&&g.seeking;(!D||C>=D||E)&&(Ha.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Ub.IDLE);break;case Ub.WAITING_INIT_PTS:var F=this.videoTrackCC;if(void 0===this.initPTS[F])break;var G=this.waitingFragment;if(G){var H=G.frag.cc;F!==H?(b=this.tracks[this.trackId],b.details&&b.details.live&&(Ha.b.warn("Waiting fragment CC ("+H+") does not match video track CC ("+F+")"),this.waitingFragment=null,this.state=Ub.IDLE)):(this.state=Ub.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Ub.IDLE;break;case Ub.STOPPED:case Ub.FRAG_LOADING:case Ub.PARSING:case Ub.PARSED:case Ub.ENDED:}},b.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)},b.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(Ha.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},b.prototype.onMediaSeeking=function(){this.state===Ub.ENDED&&(this.state=Ub.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},b.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.prototype.onAudioTracksUpdated=function(a){Ha.b.log("audio tracks updated"),this.tracks=a.audioTracks},b.prototype.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=Ub.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=Ub.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},b.prototype.onAudioTrackLoaded=function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;if(Ha.b.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live){var g=d.details;g&&b.fragments.length>0?(v(g,b),f=b.fragments[0].start,b.PTSKnown?Ha.b.log("live audio playlist sliding:"+f.toFixed(3)):Ha.b.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,Ha.b.log("live audio playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,!this.startFragRequested){if(this.startPosition===-1){var h=b.startTimeOffset;isNaN(h)?this.startPosition=0:(Ha.b.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===Ub.WAITING_TRACK&&(this.state=Ub.IDLE),this.tick()},b.prototype.onKeyLoaded=function(){this.state===Ub.KEY_LOADING&&(this.state=Ub.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===Ub.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,g=b.level,h=b.sn,i=b.cc,j=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",k=this.stats=a.stats;if("initSegment"===h)this.state=Ub.IDLE,k.tparsed=k.tbuffered=performance.now(),e.initSegment.data=a.payload,this.hls.trigger(Fa.a.FRAG_BUFFERED,{stats:k,frag:b,id:"audio"}),this.tick();else{this.state=Ub.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new mb(this.hls,"audio"));var l=this.initPTS[i],m=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==l){this.pendingBuffering=!0,Ha.b.log("Demuxing "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g);var n=!1;this.demuxer.push(a.payload,m,j,null,b,f,n,l)}else Ha.b.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),this.waitingFragment=a,this.state=Ub.WAITING_INIT_PTS}}this.fragLoadError=0},b.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===Ub.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(Fa.a.BUFFER_CODECS,d),Ha.b.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Fa.a.BUFFER_APPENDING,g))}this.tick()}}},b.prototype.onFragParsingData=function(a){var b=this,c=this.fragCurrent,d=a.frag;if(c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&this.state===Ub.PARSING){var e=this.trackId,f=this.tracks[e],g=this.hls;isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),Ha.b.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),u(f.details,c,a.startPTS,a.endPTS);var h=this.audioSwitch,i=this.media,j=!1;if(h&&i)if(i.readyState){var k=i.currentTime;Ha.b.log("switching audio track : currentTime:"+k),k>=a.startPTS&&(Ha.b.log("switching audio track : flushing all audio"),this.state=Ub.BUFFER_FLUSHING,g.trigger(Fa.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),j=!0,this.audioSwitch=!1,g.trigger(Fa.a.AUDIO_TRACK_SWITCHED,{id:e}))}else this.audioSwitch=!1,g.trigger(Fa.a.AUDIO_TRACK_SWITCHED,{id:e});var l=this.pendingData;this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&l.push({type:a.type,data:b,parent:"audio",content:"data"})}),!j&&l.length&&(l.forEach(function(a){b.state===Ub.PARSING&&(b.pendingBuffering=!0,b.hls.trigger(Fa.a.BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}},b.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===Ub.PARSING&&(this.stats.tparsed=performance.now(),this.state=Ub.PARSED,this._checkAppendedParsed())},b.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},b.prototype.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},b.prototype.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;b!==Ub.PARSING&&b!==Ub.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},b.prototype._checkAppendedParsed=function(){if(!(this.state!==Ub.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(Fa.a.FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;Ha.b.log("audio buffered : "+ob.toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(Fa.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ub.IDLE}this.tick()}},b.prototype.onError=function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case Ga.a.FRAG_LOAD_ERROR:case Ga.a.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);Ha.b.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=Ub.FRAG_LOADING_WAITING_RETRY}else Ha.b.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=Ub.ERROR}break;case Ga.a.FRAG_LOOP_LOADING_ERROR:case Ga.a.AUDIO_TRACK_LOAD_ERROR:case Ga.a.AUDIO_TRACK_LOAD_TIMEOUT:case Ga.a.KEY_LOAD_ERROR:case Ga.a.KEY_LOAD_TIMEOUT:this.state!==Ub.ERROR&&(this.state=a.fatal?Ub.ERROR:Ub.IDLE,Ha.b.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case Ga.a.BUFFER_FULL_ERROR:if("audio"===a.parent&&(this.state===Ub.PARSING||this.state===Ub.PARSED)){var f=this.mediaBuffer,g=this.media.currentTime,h=f&&eb.isBuffered(f,g)&&eb.isBuffered(f,g+.5);if(h){var i=this.config;i.maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,Ha.b.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=Ub.IDLE}else Ha.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ub.BUFFER_FLUSHING,this.hls.trigger(Fa.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},b.prototype.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(Ha.b.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(Fa.a.BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=Ub.PARSED):(this.state=Ub.IDLE,this.fragPrevious=null,this.tick())},Tb(b,[{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,Ha.b.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(Ka),Wb=Vb,Xb=function(){function a(a){if("string"!=typeof a)return!1;var b=f[a.toLowerCase()];return!!b&&a.toLowerCase()}function b(a){if("string"!=typeof a)return!1;var b=g[a.toLowerCase()];return!!b&&a.toLowerCase()}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";if(Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i)return h}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)},d}(),Yb=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};ha.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return!!((c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&b<=100))&&(this.set(a,b),!0)}};var Zb=new Xb(0,0,0),$b="middle"===Zb.align?"middle":"center";fa.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=ka(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){ia(a,function(a,b){switch(a){case"Region":console.log("parse region",b)}},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var g=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(g?g=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new Xb(0,0,""),d.state="CUE",e.indexOf("-->")===-1){d.cue.id=e;continue}case"CUE":try{ja(e,d.cue,d.regionList)}catch(a){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var h=e.indexOf("-->")!==-1;if(!e||h&&(g=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(a){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(a){throw a}return a.onflush&&a.onflush(),this}};var _b=fa,ac={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},bc=function(a){var b=a;return ac.hasOwnProperty(a)&&(b=ac[a]),String.fromCharCode(b)},cc=15,dc=100,ec={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},fc={17:2,18:4,21:6,22:8,23:10,19:13,20:15},gc={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},hc={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ic=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],jc={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},kc=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},lc=function(){function a(b,c,d,e,f){ma(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=d||!1,this.background=e||"black",this.flash=f||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.prototype.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),mc=function(){function a(b,c,d,e,f,g){ma(this,a),this.uchar=b||" ",this.penState=new lc(c,d,e,f,g)}return a.prototype.reset=function(){this.uchar=" ",this.penState.reset()},a.prototype.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.prototype.setPenState=function(a){this.penState.copy(a)},a.prototype.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.prototype.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),nc=function(){function a(){ma(this,a),this.chars=[];for(var b=0;b<dc;b++)this.chars.push(new mc);this.pos=0,this.currPenState=new lc}return a.prototype.equals=function(a){for(var b=!0,c=0;c<dc;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;b<dc;b++)this.chars[b].copy(a.chars[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;b<dc;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},a.prototype.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(jc.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>dc&&(jc.log("ERROR","Too large cursor position "+this.pos),this.pos=dc)},a.prototype.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},a.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.prototype.insertChar=function(a){a>=144&&this.backSpace();var b=bc(a);return this.pos>=dc?void jc.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))},a.prototype.clearFromPos=function(a){var b;for(b=a;b<dc;b++)this.chars[b].reset()},a.prototype.clear=function(){
this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.prototype.getTextString=function(){for(var a=[],b=!0,c=0;c<dc;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},a.prototype.setPenStyles=function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)},a}(),oc=function(){function a(){ma(this,a),this.rows=[];for(var b=0;b<cc;b++)this.rows.push(new nc);this.currRow=cc-1,this.nrRollUpRows=null,this.reset()}return a.prototype.reset=function(){for(var a=0;a<cc;a++)this.rows[a].clear();this.currRow=cc-1},a.prototype.equals=function(a){for(var b=!0,c=0;c<cc;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;b<cc;b++)this.rows[b].copy(a.rows[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;b<cc;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},a.prototype.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},a.prototype.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},a.prototype.insertChar=function(a){var b=this.rows[this.currRow];b.insertChar(a)},a.prototype.setPen=function(a){var b=this.rows[this.currRow];b.setPenStyles(a)},a.prototype.moveCursor=function(a){var b=this.rows[this.currRow];b.moveCursor(a)},a.prototype.setCursor=function(a){jc.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)},a.prototype.setPAC=function(a){jc.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;c<cc;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var f=e.rows[d].cueStartTime;if(f&&f<jc.time)for(var g=0;g<this.nrRollUpRows;g++)this.rows[b-this.nrRollUpRows+g+1].copy(e.rows[d+g])}}this.currRow=b;var h=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);h.setCursor(a.indent),a.color=h.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},a.prototype.setBkgData=function(a){jc.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.prototype.setRollUpRows=function(a){this.nrRollUpRows=a},a.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void jc.log("DEBUG","roll_up but nrRollUpRows not set yet");jc.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),jc.log("INFO","Rolling up")},a.prototype.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<cc;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},a.prototype.getTextAndFormat=function(){return this.rows},a}(),pc=function(){function a(b,c){ma(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new oc,this.nonDisplayedMemory=new oc,this.lastOutputScreen=new oc,this.currRollUpRow=this.displayedMemory.rows[cc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[cc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},a.prototype.getHandler=function(){return this.outputFilter},a.prototype.setHandler=function(a){this.outputFilter=a},a.prototype.setPAC=function(a){this.writeScreen.setPAC(a)},a.prototype.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.prototype.setMode=function(a){a!==this.mode&&(this.mode=a,jc.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.prototype.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";jc.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(jc.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.prototype.ccRCL=function(){jc.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.prototype.ccBS=function(){jc.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.prototype.ccAOF=function(){},a.prototype.ccAON=function(){},a.prototype.ccDER=function(){jc.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.prototype.ccRU=function(a){jc.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.prototype.ccFON=function(){jc.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.prototype.ccRDC=function(){jc.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.prototype.ccTR=function(){jc.log("INFO","TR"),this.setMode("MODE_TEXT")},a.prototype.ccRTD=function(){jc.log("INFO","RTD"),this.setMode("MODE_TEXT")},a.prototype.ccEDM=function(){jc.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.prototype.ccCR=function(){jc.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.prototype.ccENM=function(){jc.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.prototype.ccEOC=function(){if(jc.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,jc.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.prototype.ccTO=function(a){jc.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.prototype.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}jc.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},a.prototype.outputDataUpdate=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=jc.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),a===!0&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},a.prototype.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),qc=function(){function a(b,c,d){ma(this,a),this.field=b||1,this.outputs=[c,d],this.channels=[new pc(1,c),new pc(2,d)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return a.prototype.getHandler=function(a){return this.channels[a].getHandler()},a.prototype.setHandler=function(a,b){this.channels[a].setHandler(b)},a.prototype.addData=function(a,b){var c,d,e,f=!1;this.lastTime=a,jc.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(jc.log("DATA","["+kc([b[g],b[g+1]])+"] -> ("+kc([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else jc.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters.char+=2:(this.dataCounters.other+=2,jc.log("WARNING","Couldn't parse cleaned data "+kc([d,e])+" orig: "+kc([b[g],b[g+1]])))}else this.dataCounters.padding+=2},a.prototype.parseCmd=function(a,b){var c=null,d=(20===a||28===a)&&32<=b&&b<=47,e=(23===a||31===a)&&33<=b&&b<=35;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,jc.log("DEBUG","Repeated command ("+kc([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.parseMidrow=function(a,b){var c=null;if((17===a||25===a)&&32<=b&&b<=47){if(c=17===a?1:2,c!==this.currChNr)return jc.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),jc.log("DEBUG","MIDROW ("+kc([a,b])+")"),!0}return!1},a.prototype.parsePAC=function(a,b){var c=null,d=null,e=(17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127,f=(16===a||24===a)&&64<=b&&b<=95;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=a<=23?1:2,d=64<=b&&b<=95?1===c?ec[a]:gc[a]:1===c?fc[a]:hc[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.interpretPAC=function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},a.prototype.parseChars=function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),17<=e&&e<=19){var f=b;f=17===e?b+80:18===e?b+112:b+144,jc.log("INFO","Special char '"+bc(f)+"' in channel "+c),d=[f]}else 32<=a&&a<=127&&(d=0===b?[a]:[a,b]);if(d){var g=kc(d);jc.log("DEBUG","Char codes =  "+g.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d},a.prototype.parseBackgroundAttributes=function(a,b){var c,d,e,f,g=(16===a||24===a)&&32<=b&&b<=47,h=(23===a||31===a)&&45<=b&&b<=47;return!(!g&&!h)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=ic[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=a<24?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)},a.prototype.reset=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},a.prototype.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)},a}(),rc=qc,sc=function(){function a(b,c){na(this,a),this.timelineController=b,this.track=c,this.startTime=null,this.endTime=null,this.screen=null}return a.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},a.prototype.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.track)},a}(),tc=sc,uc=function(a,b,c){return a.substr(c||0,b.length)===b},vc=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return isNaN(b)||isNaN(c)||isNaN(d)||isNaN(e)?-1:(b+=1e3*c,b+=6e4*d,b+=36e5*e)},wc=function a(b){for(var a=5381,c=b.length;c;)a=33*a^b.charCodeAt(--c);return(a>>>0).toString()},xc=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e.new&&d.new)return a.ccOffset=a.presentationOffset=d.start,void(d.new=!1);for(;e&&e.new;)a.ccOffset+=d.start-e.start,d.new=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},yc={parse:function(a,b,c,d,e,f){var g=/\r\n|\n\r|\n|\r/g,h=Object(wb.b)(new Uint8Array(a)).trim().replace(g,"\n").split("\n"),i="00:00.000",j=0,k=0,l=0,m=[],n=void 0,o=!0,p=new _b;p.oncue=function(a){var b=c[d],e=c.ccOffset;b&&b.new&&(void 0!==k?e=c.ccOffset=b.start:xc(c,d,l)),l&&(e=l+c.ccOffset-c.presentationOffset),a.startTime+=e-k,a.endTime+=e-k,a.id=wc(a.startTime.toString())+wc(a.endTime.toString())+wc(a.text),a.text=decodeURIComponent(encodeURIComponent(a.text)),a.endTime>0&&m.push(a)},p.onparsingerror=function(a){n=a},p.onflush=function(){return n&&f?void f(n):void e(m)},h.forEach(function(a){if(o){if(uc(a,"X-TIMESTAMP-MAP=")){o=!1,a.substr(16).split(",").forEach(function(a){uc(a,"LOCAL:")?i=a.substr(6):uc(a,"MPEGTS:")&&(j=parseInt(a.substr(7)))});try{b=b<0?b+8589934592:b,j-=b,k=vc(i)/1e3,l=j/9e4,k===-1&&(n=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(b){n=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(o=!1)}p.parse(a+"\n")}),p.flush()}},zc=yc,Ac=function(a){function b(c){oa(this,b);var d=pa(this,a.call(this,c,Fa.a.MEDIA_ATTACHING,Fa.a.MEDIA_DETACHING,Fa.a.FRAG_PARSING_USERDATA,Fa.a.FRAG_DECRYPTED,Fa.a.MANIFEST_LOADING,Fa.a.MANIFEST_LOADED,Fa.a.FRAG_LOADED,Fa.a.LEVEL_SWITCHING,Fa.a.INIT_PTS_FOUND));if(d.hls=c,d.config=c.config,d.enabled=!0,d.Cues=c.config.cueHandler,d.textTracks=[],d.tracks=[],d.unparsedVttFrags=[],d.initPTS=void 0,d.cueRanges=[],d.config.enableCEA708Captions){var e=new tc(d,1),f=new tc(d,2);d.cea608Parser=new rc(0,e,f)}return d}return qa(b,a),b.prototype.addCues=function(a,b,c,d){for(var e=this.cueRanges,f=!1,g=e.length;g--;){var h=e[g],i=ta(h[0],h[1],b,c);if(i>=0&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),f=!0,i/(c-b)>.5))return}f||e.push([b,c]),this.Cues.newCue(this[a],b,c,d)},b.prototype.onInitPtsFound=function(a){var b=this;"undefined"==typeof this.initPTS&&(this.initPTS=a.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(a){b.onFragLoaded(a)}),this.unparsedVttFrags=[])},b.prototype.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null},b.prototype.sendAddTrackEvent=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(a){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},b.prototype.createCaptionsTrack=function(a){var b="textTrack"+a;if(!this[b]){var c=this.getExistingTrack(a);if(c)this[b]=c,ra(this[b]),this.sendAddTrackEvent(this[b],this.media);else{var d=this.createTextTrack("captions",this.config["captionsTextTrack"+a+"Label"],this.config.captionsTextTrack1LanguageCode);d&&(d[b]=!0,this[b]=d)}}},b.prototype.createTextTrack=function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)},b.prototype.destroy=function(){Ka.prototype.destroy.call(this)},b.prototype.onMediaAttaching=function(a){this.media=a.media,this._cleanTracks()},b.prototype.onMediaDetaching=function(){ra(this.textTrack1),ra(this.textTrack2)},b.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},b.prototype._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)ra(b[c])}},b.prototype.onManifestLoaded=function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,d){var e=void 0;if(d<c.length){var f=c[d];sa(f,a)&&(e=f)}e||(e=b.createTextTrack("subtitles",a.name,a.lang)),e.mode=a.default?"showing":"hidden",b.textTracks.push(e)})}},b.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},b.prototype.onFragLoaded=function(a){var b=a.frag,c=a.payload;if("main"===b.type){var d=b.sn;if(d!==this.lastSn+1){var e=this.cea608Parser;e&&e.reset()}this.lastSn=d}else if("subtitle"===b.type)if(c.byteLength){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);var f=b.decryptdata;null!=f&&null!=f.key&&"AES-128"===f.method||this._parseVTTs(b,c)}else this.hls.trigger(Fa.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})},b.prototype._parseVTTs=function(a,b){var c=this.vttCCs;c[a.cc]||(c[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc);var d=this.textTracks,e=this.hls;zc.parse(b,this.initPTS,c,a.cc,function(b){var c=d[a.trackId];b.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(d){var b=new window.TextTrackCue(a.startTime,a.endTime,a.text);b.id=a.id,c.addCue(b)}}),e.trigger(Fa.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){Ha.b.log("Failed to parse VTT cue: "+b),e.trigger(Fa.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})},b.prototype.onFragDecrypted=function(a){var b=a.payload,c=a.frag;if("subtitle"===c.type){if("undefined"==typeof this.initPTS)return void this.unparsedVttFrags.push(a);this._parseVTTs(c,b)}},b.prototype.onFragParsingUserdata=function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}},b.prototype.extractCea608Data=function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;j<g;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,0===c&&0===d||e&&0===f&&(i.push(c),i.push(d));return i},b}(Ka),Bc=Ac,Cc=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Dc=function(a){function b(c){ua(this,b);var d=va(this,a.call(this,c,Fa.a.MEDIA_ATTACHED,Fa.a.MEDIA_DETACHING,Fa.a.MANIFEST_LOADING,Fa.a.MANIFEST_LOADED,Fa.a.SUBTITLE_TRACK_LOADED));return d.tracks=[],d.trackId=-1,d.media=void 0,d.subtitleDisplay=!1,d}return wa(b,a),b.prototype._onTextTracksChanged=function(){if(this.media){for(var a=-1,b=xa(this.media.textTracks),c=0;c<b.length;c++)"showing"===b[c].mode&&(a=c);this.subtitleTrack=a}},b.prototype.destroy=function(){Ka.prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){var b=this;this.media=a.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},b.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},b.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},b.prototype.onManifestLoaded=function(a){var b=this,c=a.subtitles||[];this.tracks=c,this.trackId=-1,this.hls.trigger(Fa.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a.default&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})},b.prototype.onTick=function(){var a=this.trackId,b=this.tracks[a];if(b){var c=b.details;void 0!==c&&c.live!==!0||(Ha.b.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(Fa.a.SUBTITLE_TRACK_LOADING,{url:b.url,id:a}))}},b.prototype.onSubtitleTrackLoaded=function(a){var b=this;a.id<this.tracks.length&&(Ha.b.log("subtitle track "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(function(){b.onTick()},1e3*a.details.targetduration,this)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},b.prototype.setSubtitleTrackInternal=function(a){if(!(a<-1||a>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var b=xa(this.media.textTracks);if(this.trackId!==-1&&this.subtitleDisplay&&(b[this.trackId].mode="hidden"),this.trackId=a,Ha.b.log("switching to subtitle track "+a),this.hls.trigger(Fa.a.SUBTITLE_TRACK_SWITCH,{id:a}),a!==-1){var c=this.tracks[a];this.subtitleDisplay&&(b[a].mode="showing");var d=c.details;void 0!==d&&d.live!==!0||(Ha.b.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(Fa.a.SUBTITLE_TRACK_LOADING,{url:c.url,id:a}))}}},Cc(b,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&this.setSubtitleTrackInternal(a)}}]),b}(Ka),Ec=Dc,Fc=c(4),Gc={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Hc=function(a){function b(c){ya(this,b);var d=za(this,a.call(this,c,Fa.a.MEDIA_ATTACHED,Fa.a.ERROR,Fa.a.KEY_LOADED,Fa.a.FRAG_LOADED,Fa.a.SUBTITLE_TRACKS_UPDATED,Fa.a.SUBTITLE_TRACK_SWITCH,Fa.a.SUBTITLE_TRACK_LOADED,Fa.a.SUBTITLE_FRAG_PROCESSED));return d.config=c.config,d.vttFragSNsProcessed={},d.vttFragQueues=void 0,d.currentlyProcessing=null,d.state=Gc.STOPPED,d.currentTrackId=-1,d.ticks=0,d.decrypter=new Fc.a(c.observer,c.config),d}return Aa(b,a),b.prototype.destroy=function(){Ka.prototype.destroy.call(this),this.state=Gc.STOPPED},b.prototype.clearVttFragQueues=function(){var a=this;this.vttFragQueues={},this.tracks.forEach(function(b){a.vttFragQueues[b.id]=[]})},b.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var a=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=a,this.hls.trigger(Fa.a.FRAG_LOADING,{frag:a}),this.state=Gc.FRAG_LOADING}},b.prototype.onSubtitleFragProcessed=function(a){a.success&&this.vttFragSNsProcessed[a.frag.trackId].push(a.frag.sn),this.currentlyProcessing=null,this.state=Gc.IDLE,this.nextFrag()},b.prototype.onMediaAttached=function(){this.state=Gc.IDLE},b.prototype.onError=function(a){var b=a.frag;b&&"subtitle"!==b.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},b.prototype.tick=function(){var a=this;this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(function(){a.tick()},1),this.ticks=0)},b.prototype.doTick=function(){var a=this;switch(this.state){case Gc.IDLE:var b=this.tracks,c=this.currentTrackId,d=this.vttFragSNsProcessed[c],e=this.vttFragQueues[c],f=this.currentlyProcessing?this.currentlyProcessing.sn:-1,g=function(a){return d.indexOf(a.sn)>-1},h=function(a){return e.some(function(b){return b.sn===a.sn})};if(!b)break;var i;if(c<b.length&&(i=b[c].details),"undefined"==typeof i)break;i.fragments.forEach(function(b){g(b)||b.sn===f||h(b)||(b.decryptdata&&null!=b.decryptdata.uri&&null==b.decryptdata.key?(Ha.b.log("Loading key for "+b.sn),a.state=Gc.KEY_LOADING,a.hls.trigger(Fa.a.KEY_LOADING,{frag:b})):(b.trackId=c,e.push(b),a.nextFrag()))})}},b.prototype.onSubtitleTracksUpdated=function(a){var b=this;Ha.b.log("subtitle tracks updated"),this.tracks=a.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(a){b.vttFragSNsProcessed[a.id]=[]})},b.prototype.onSubtitleTrackSwitch=function(a){this.currentTrackId=a.id,this.clearVttFragQueues()},b.prototype.onSubtitleTrackLoaded=function(){this.tick()},b.prototype.onKeyLoaded=function(){this.state===Gc.KEY_LOADING&&(this.state=Gc.IDLE,this.tick())},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,e=this.hls;if(this.state===Gc.FRAG_LOADING&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&a.payload.byteLength>0&&null!=c&&null!=c.key&&"AES-128"===c.method){var f;try{f=performance.now()}catch(a){f=Date.now()}this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b;try{b=performance.now()}catch(a){b=Date.now()}e.trigger(Fa.a.FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:f,tdecrypt:b}})})}},b}(Ka),Ic=Hc,Jc={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Pb,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Fb,bufferController:Ib,capLevelController:Lb,fpsController:Nb,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Jc.subtitleStreamController=Ic,Jc.subtitleTrackController=Ec,Jc.timelineController=Bc,Jc.cueHandler=Ca,Jc.enableCEA708Captions=!0,Jc.enableWebVTT=!0,Jc.captionsTextTrack1Label="English",Jc.captionsTextTrack1LanguageCode="en",Jc.captionsTextTrack2Label="Spanish",Jc.captionsTextTrack2LanguageCode="es",Jc.audioStreamController=Wb,Jc.audioTrackController=Sb;var Kc=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Lc=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ba(this,a);var d=a.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var e in d)e in c||(c[e]=d[e]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Ha.a)(c.debug),this.config=c,this._autoLevelCapping=-1;var f=this.observer=new hb.a;f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))},this.on=f.on.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f);var g=this.abrController=new c.abrController(this),h=new c.bufferController(this),i=new c.capLevelController(this),j=new c.fpsController(this),k=new Ya(this),l=new $a(this),m=new ab(this),n=new yb(this),o=this.levelController=new vb(this),p=this.streamController=new sb(this),q=[o,p],r=c.audioStreamController;r&&q.push(new r(this)),this.networkControllers=q;var s=[k,l,m,g,h,i,j,n];if(r=c.audioTrackController){var t=new r(this);this.audioTrackController=t,s.push(t)}if(r=c.subtitleTrackController){var u=new r(this);this.subtitleTrackController=u,s.push(u)}[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&s.push(new a(b))}),this.coreComponents=s}return a.isSupported=function(){return L()},Kc(a,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return Fa.a}},{key:"ErrorTypes",get:function(){return Ga.b}},{key:"ErrorDetails",get:function(){return Ga.a}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:Jc},set:function(b){a.defaultConfig=b}}]),a.prototype.destroy=function(){Ha.b.log("destroy"),this.trigger(Fa.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},a.prototype.attachMedia=function(a){Ha.b.log("attachMedia"),this.media=a,this.trigger(Fa.a.MEDIA_ATTACHING,{media:a})},a.prototype.detachMedia=function(){Ha.b.log("detachMedia"),this.trigger(Fa.a.MEDIA_DETACHING),this.media=null},a.prototype.loadSource=function(a){a=Ea.a.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),Ha.b.log("loadSource:"+a),this.url=a,this.trigger(Fa.a.MANIFEST_LOADING,{url:a})},a.prototype.startLoad=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;Ha.b.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},a.prototype.stopLoad=function(){Ha.b.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},a.prototype.swapAudioCodec=function(){Ha.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.prototype.recoverMediaError=function(){Ha.b.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)},Kc(a,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){Ha.b.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){Ha.b.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){Ha.b.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){Ha.b.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){Ha.b.log("set startLevel:"+a);var b=this;a!==-1&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){Ha.b.log("set autoLevelCapping:"+a),this._autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;e<d;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0}},{key:"maxAutoLevel",get:function(){var a=this,b=a.levels,c=a.autoLevelCapping,d=void 0;return d=c===-1&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a);
}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)}}]),a}();b.default=Lc},function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw console.error(a),a};var d=b(b.s=ENTRY_MODULE);return d.default||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){var b=[],c=a.toString(),d=c.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return b;for(var f,g=d[1],h=new RegExp("(\\\\n|\\W)"+e(g)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");f=h.exec(c);)b.push(f[3]);return b}function g(a,b){for(var c=[b],d=[],e={};c.length;){var g=c.pop();if(!e[g]&&a[g]){e[g]=!0,d.push(g);var h=f(a[g]);c=c.concat(h)}}return d}a.exports=function(a,b){b=b||{};var e=c.m,f=b.all?Object.keys(e):g(e,a),h="("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.map(function(a){return""+JSON.stringify(a)+": "+e[a].toString()}).join(",")+"})(self);",i=new window.Blob([h],{type:"text/javascript"});if(b.bare)return i;var j=window.URL||window.webkitURL||window.mozURL||window.msURL,k=j.createObjectURL(i),l=new window.Worker(k);return l.objectURL=k,l}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(7),e=c(1),f=c(0),g=c(5),h=c.n(g),i=function(a){var b=new h.a;b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.demuxer=new d.a(b,g.typeSupported,h,g.vendor);try{Object(f.a)(h.debug===!0)}catch(a){console.warn("demuxerWorker: unable to enable logs")}c("init",null);break;case"demux":a.demuxer.push(g.data,g.decryptdata,g.initSegment,g.audioCodec,g.videoCodec,g.timeOffset,g.discontinuity,g.trackSwitch,g.contiguous,g.duration,g.accurateTimeOffset,g.defaultInitPTS)}}),b.on(e.a.FRAG_DECRYPTED,c),b.on(e.a.FRAG_PARSING_INIT_SEGMENT,c),b.on(e.a.FRAG_PARSED,c),b.on(e.a.ERROR,c),b.on(e.a.FRAG_PARSING_METADATA,c),b.on(e.a.FRAG_PARSING_USERDATA,c),b.on(e.a.INIT_PTS_FOUND,c),b.on(e.a.FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};b.default=i}]).default}),function(c){"use strict";function d(){var a=c.crypto||c.msCrypto;if(!j&&a&&a.getRandomValues)try{var b=new Uint8Array(16);m=j=function(){return a.getRandomValues(b),b},j()}catch(a){}if(!j){var d=new Array(16);k=j=function(){for(var a,b=0;b<16;b++)0===(3&b)&&(a=4294967296*Math.random()),d[b]=a>>>((3&b)<<3)&255;return d},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function e(){if("function"==typeof b)try{var a=b("crypto").randomBytes;l=j=a&&function(){return a(16)},j()}catch(a){}}function f(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=q[a])});e<16;)b[d+e++]=0;return b}function g(a,b){var c=b||0,d=p;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function h(a,b,c){var d=b&&c||0,e=b||[];a=a||{};var f=null!=a.clockseq?a.clockseq:u,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:w+1,j=h-v+(i-w)/1e4;if(j<0&&null==a.clockseq&&(f=f+1&16383),(j<0||h>v)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=h,w=i,u=f,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;e[d++]=k>>>24&255,e[d++]=k>>>16&255,e[d++]=k>>>8&255,e[d++]=255&k;var l=h/4294967296*1e4&268435455;e[d++]=l>>>8&255,e[d++]=255&l,e[d++]=l>>>24&15|16,e[d++]=l>>>16&255,e[d++]=f>>>8|128,e[d++]=255&f;for(var m=a.node||t,n=0;n<6;n++)e[d+n]=m[n];return b?b:g(e)}function i(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new o(16):null,a=null),a=a||{};var e=a.random||(a.rng||j)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,b)for(var f=0;f<16;f++)b[d+f]=e[f];return b||g(e)}var j,k,l,m,n;c?d():e();for(var o="function"==typeof Buffer?Buffer:Array,p=[],q={},r=0;r<256;r++)p[r]=(r+256).toString(16).substr(1),q[p[r]]=r;var s=j(),t=[1|s[0],s[1],s[2],s[3],s[4],s[5]],u=16383&(s[6]<<8|s[7]),v=0,w=0,x=i;x.v1=h,x.v4=i,x.parse=f,x.unparse=g,x.BufferClass=o,x._rng=j,x._mathRNG=k,x._nodeRNG=l,x._whatwgRNG=m,"undefined"!=typeof module&&module.exports?module.exports=x:"function"==typeof a&&a.amd?a(function(){return x}):(n=c.uuid,x.noConflict=function(){return c.uuid=n,x},c.uuid=x)}("undefined"!=typeof window?window:null),function(){function a(a){var b=a.__resizeTriggers__,c=b.firstElementChild,d=b.lastElementChild,e=c.firstElementChild;d.scrollLeft=d.scrollWidth,d.scrollTop=d.scrollHeight,e.style.width=c.offsetWidth+1+"px",e.style.height=c.offsetHeight+1+"px",c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight}function b(a){return a.offsetWidth!=a.__resizeLast__.width||a.offsetHeight!=a.__resizeLast__.height}function c(c){var d=this;a(this),this.__resizeRAF__&&h(this.__resizeRAF__),this.__resizeRAF__=g(function(){b(d)&&(d.__resizeLast__.width=d.offsetWidth,d.__resizeLast__.height=d.offsetHeight,d.__resizeListeners__.forEach(function(a){a.call(d,c)}))})}function d(){if(!f){var a=(s?s:"")+".resize-triggers { "+(t?t:"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c),f=!0}}var e=document.attachEvent,f=!1;if(!e){var g=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),h=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}(),i=!1,j="animation",k="",l="animationstart",m="Webkit Moz O ms".split(" "),n="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),o="",p=document.createElement("fakeelement");if(void 0!==p.style.animationName&&(i=!0),i===!1)for(var q=0;q<m.length;q++)if(void 0!==p.style[m[q]+"AnimationName"]){o=m[q],j=o+"Animation",k="-"+o.toLowerCase()+"-",l=n[q],i=!0;break}var r="resizeanim",s="@"+k+"keyframes "+r+" { from { opacity: 0; } to { opacity: 0; } } ",t=k+"animation: 1ms "+r+"; "}window.addResizeListener=function(b,f){e?b.attachEvent("onresize",f):(b.__resizeTriggers__||("static"==getComputedStyle(b).position&&(b.style.position="relative"),d(),b.__resizeLast__={},b.__resizeListeners__=[],(b.__resizeTriggers__=document.createElement("div")).className="resize-triggers",b.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',b.appendChild(b.__resizeTriggers__),a(b),b.addEventListener("scroll",c,!0),l&&b.__resizeTriggers__.addEventListener(l,function(c){c.animationName==r&&a(b)})),b.__resizeListeners__.push(f))},window.removeResizeListener=function(a,b){e?a.detachEvent("onresize",b):(a.__resizeListeners__.splice(a.__resizeListeners__.indexOf(b),1),a.__resizeListeners__.length||(a.removeEventListener("scroll",c),a.__resizeTriggers__=!a.removeChild(a.__resizeTriggers__)))}}(),!function(b,c){"object"==typeof module&&module.exports?module.exports=c():"function"==typeof a&&a.amd?a(c):b.Spinner=c()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function a(){h++;for(var b=0;b<d.lines;b++)g=Math.max(1-(h+(d.lines-b)*n)%l*m,d.opacity),c.opacity(f,b*d.direction+i,g,d);c.timeout=c.el&&setTimeout(a,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(a){var b,c,d=a.split("."),e=window,f=d.length;for(b=0;b<f;b++)c=d[b],void 0===e[c]&&(e[c]={}),e=e[c];return e},getClass:function(a){var b,c,d,e,f,g;if("string"!=typeof a)return a;for(b=a.split("."),c=window,d=b.length,e="",f=0;f<d;f++){if(g=b[f],e+=g,void 0===c[g])throw new Error("uvpjs.getClass(): "+e+" is undefined.");f<d-1&&(e+="."),c=c[g]}return c},getObject:function(a){return uvpjs.getClass(a)}},function(){var a=!1,b=/xyz/.test(function(){var a;a=null})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e,f,g,h,i=this.prototype;a=!0,f=new this,a=!1,e=function(a,b){return function(){var c,d=this._super;return this._super=i[a],c=b.apply(this,arguments),this._super=d,c}};for(h in c)c.hasOwnProperty(h)&&(g=c[h],f[h]="function"==typeof g&&"function"==typeof i[h]&&b.test(g)?e(h,g):g);return d.prototype=f,d.prototype.constructor=d,d.subClass=arguments.callee,d}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(a){a.b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA=="}(uvpjs.register("uvpjs")),function(a){"use strict";a.util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(a){return a&&this.xhrMessages[a]||"XHR status: "+a},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(a){var b=document.createElement("a");return b.href=a,{host:b.hostname,pathname:b.pathname,protocol:b.protocol,search:b.search}},objFromQueryStr:function(a){var b,c,d,e="string"==typeof a?a:"",f=e.indexOf("?")>-1?e.split("?")[1]:e,g=f.split("&"),h={};for(c=0,d=g.length;c<d;c++)b=g[c].split("="),h[b[0]]=b[1];return h},queryStrFromObj:function(a,b){var c,d="",e=!1;for(c in a)d+=(e?"&":"")+c+"="+(b?encodeURIComponent(a[c]):a[c]),e=!0;return d},uid8:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()},getUserStatusForQuery:function(a){var b="";switch(a){case"anon":b="sb=0";break;case"reg;sub;pay":b="sb=1";break;case"reg":b="sb=2";break;case"reg;sub;susp":b="sb=3";break;case"reg;sub;exsub":b="sb=4";break;case"reg;sub;trial":b="sb=5";break;default:if(a.indexOf("|")>-1){var c,d,e,f,g,h="",i=a.split(","),j=i.length;for(i.sort(),g=0;g<j;g++)c=i[g],d=c.split("|"),2==d.length&&(e=d[0],f=d[1],h!=e?(b.length>0&&(b+="&"),b+=e+"="+f):b+=","+f,h=e)}}return""==b&&(b="sb=0"),b},firstInt:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],parseInt(a)===a)return a},inRange:function(a,b,c){return"number"==typeof a&&a>=b&&a<=c},isEmpty:function(a){return null===a||void 0===a||Array.isArray(a)&&0===a.length||"object"==typeof a&&0===Object.keys(a).length||"string"==typeof a&&""===a},isPlainObject:function(a){return a&&"object"==typeof a&&a.constructor===Object},isFunction:function(a){return"function"==typeof a},isDefinedString:function(a){return!!(a&&"string"==typeof a&&a.length>0)},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isFlagTrue:function(a){return a===!0||"true"===a||1===a||"1"===a},getDefinedString:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],this.isDefinedString(a))return a;return""},supportsLocalStorage:function(){var a,b="test";if(null===this.isLocalStorageSupported)try{localStorage.setItem(b,"1"),a=localStorage.getItem(b),this.isLocalStorageSupported="1"===a,localStorage.removeItem(b)}catch(a){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild},createStyleSheet:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=document.styleSheets,o=n.length;for(l=function(){m||(a(g),m=!0)},c=0;c<o;c++){g=n[c];try{if(i=g.href&&g.href.replace(/http(s)?:/,""),i===b)return void l()}catch(a){i=null}}d="string"==typeof b&&""!==b,e=uvpjs.mediaCapabilities.isFirefox(),f=!d||e?"style":"link",g=document.createElement(f),g.setAttribute("type","text/css"),g.appendChild(document.createTextNode("")),d&&(g.setAttribute("rel","stylesheet"),g.setAttribute("href",b),g.textContent='@import "'+b+'"'),"function"==typeof a&&(g.onload=l,g.addEventListener&&g.addEventListener("load",l,!1),g.onreadystatechange=function(){h=g.readyState,"loaded"!==h&&"complete"!==h||(link.onreadystatechange=null,l())},j=setInterval(function(){document.styleSheets.length>o&&(l(),clearInterval(j))},10),e&&(k=setInterval(function(){try{g.sheet.cssRules,clearInterval(k),l()}catch(a){}},10)),document.getElementsByTagName("head")[0].appendChild(g))},addCSSObject:function(a,b,c,d){var e,f=uvpjs.util,g="#"+b.id+" "+(d||"");for(e in c)f.addCSSRule(a,g,e,c[e])},addCSSRule:function(a,b,c,d){var e,f,g,h;a&&(e=a.sheet,f=e.rules||e.cssRules,g=f.length,h=c+":"+d,e.insertRule?e.insertRule(b+"{"+h+"}",g):e.addRule&&e.addRule(b,h,g))},addCSSRules:function(a,b,c){for(var d,e=c.length;e--;)d=c[e],uvpjs.util.addCSSRule(a,b,d.name,d.value)},copyObjectWithKeyMap:function(a){var b=a,c=null;return this.from=function(a){return c=a,this},this.to=function(a){if(!(b&&c&&a))return a;for(var d in b)b.hasOwnProperty(d)&&c.hasOwnProperty(d)&&null!==c[d]&&(a[b[d]]=c[d]);return a},this}}}(uvpjs.register("uvpjs")),function(a){var b=uvpjs._,c={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};a.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(a,d,e,f){var g,h,i,j,k,l,m,n,o=uvpjs.util,p="cust_params",q=a.split("?"),r=q[1],s=a.indexOf("{ptype}")>-1,t=this.getAdParams(d,e,f);return r=r.replace(c.mediaRefId,t.vid).replace(c.partner,t.partner),r.indexOf("VGUID")>-1&&(r=r.replace(s?c.vguidAlt:c.vguid,t.vguid)),r=r.replace(s?c.ptypeAlt:c.ptype,t.ptype),h=o.objFromQueryStr(r),this.isExcludedFromVpaid(d)&&delete h.pp,i=h[p],i&&(g=o.objFromQueryStr(decodeURIComponent(i)),delete h[p]),j=t[p],delete t[p],delete t.partner,delete t.vguid,delete t.ptype,k=b.assign(t,h),l=b.assign(j,g||{}),d.isMuteAtPlayStart&&!d.userHasUnmuted&&(k.sz="640x483"),this.removeEmpty(k),this.removeEmpty(l),m=o.queryStrFromObj(k,!1),n=o.queryStrFromObj(l,!1),m+="&"+p+"="+encodeURIComponent(n),q[0]+"?"+m},getAdParams:function(a,b,c){var d,e,f=a.dwPageParams,g=this.getDwViewGuid(a),h=this.getPpidValue(a),i=a.contentVideoState,j=encodeURIComponent(a.sessionOptions.partner),k=f.pagetype||"",l=this.getUserStatusKey(a.getSessionOption("userStatus")),m=""!==i.contPlayState,n=m&&!uvpjs.util.isFlagTrue(c)?"1":"0",o=a.getSessionOption("isEmbedded")?"1":"0",p=this.getHost("1"===o,a),q=i.pid,r={cust_params:{}},s=uvpjs.Configuration.env;d=b?i.cmsRefGuid:"",r.vid=d,r.partner=j,r.ptype=k,r.vguid=g,r.cust_params.vguid=g,r.cust_params.embed=o,p&&(r.cust_params.host=p),this.populateCustParamsWithAdSessionValues(r.cust_params,q),i.podsToSkip.length>0&&(r.cust_params.resume=1,r.cust_params.skippod=i.podsToSkip);for(e in l)r.cust_params[e]=l[e];return h&&(r.ppid=h,r.cust_params.ppid=h),"cbs"===j&&(r.cust_params.cpSession=n,r.cust_params.cpPre=n),this.isExcludedFromVpaid(a)?r.pp="ssai":("local"===s||"dev"===s)&&(r.pp="vpaid_js"),r},isExcludedFromVpaid:function(a){return"AA Original"===a.contentVideoState.contentType},getDwViewGuid:function(a){var b=a.dwPageParams;return b&&b.viewguid||b.pguid||""},extractAdInfo:function(a,c){var d,e,f=c===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(a)||!c?(!c&&console.error("No 'context' arg supplied"),null):(d={adId:a.getAdId(),adSystem:a.getAdSystem(),creativeAdId:a.getCreativeAdId(),creativeId:a.getCreativeId()},d.adPodInfo=this.extractPodInfo(a.getAdPodInfo()),e=this[f](a),b.assign(d,e))},extractAdStateData:function(a,b){var c=a.getAdPodInfo(),d=c.getPodIndex(),e=c.getAdPosition(),f=a.getDuration(),g=0===d?"pre":d>=1?"mid":d===-1?"post":"",h=("mid"!==g?g+"_0":"mid_"+d)+"_"+e,i=b===this.context.IMA,j=i?this.extractIdInfo(a):null,k=this.getAdStateBlank();return k.adPosition=e,k.adServerName=i?this.context.IMA:this.context.DAI,k.adVideoTitle=a.getTitle(),k.duration=f,k.adType=g,k.adClipID=h,k.wrapperAdId=i?j.wrapperAdId||"":"",k.adVideoId=i?j.wrapperAdId||j.adId:a.getAdId(),k.creativeId=i?j.wrapperCreativeId||j.creativeId:a.getCreativeId(),b===this.context.DAI&&(k.sourceWidth=a.getVastMediaWidth(),k.sourceHeight=a.getVastMediaHeight()),k},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(a){var b=a.getWrapperAdIds(),c=a.getWrapperCreativeIds(),d=Array.isArray(b)&&b.length||0,e=Array.isArray(c)&&c.length||0,f=null,g=null,h=a.getAdId()||"",i=a.getCreativeId()||"";return d&&(d>1&&(f=b[1]),h=b[0]),e&&(e>1&&(g=c[1]),i=c[0]),{adId:h,wrapperAdId:f,creativeId:i,wrapperCreativeId:g}},getHost:function(a,b){var c,d,e;return a?(c=b.getSessionOption("referrer"),c&&(d=uvpjs.util.parseUrl(c),e=d.host)):e=window.location.hostname,e&&""!==e?e:null},getUserStatusKey:function(a){for(var b,c=uvpjs.util.getUserStatusForQuery(a),d=c.split("&"),e=d.length,f={};e--;)b=d[e].split("="),f[b[0]]=b[1];return f},trackAd:function(a){var b,c,d,e=a.model,f=a.context,g=e.getAdVideoState(),h=f===this.context.IMA,i=f===this.context.DAI,j=h||i;return j?(c=e.dwPageParams.pagetype||"",b={level1:"",level2:"",level3:g.adVideoId,level4:g.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:c,moatVASTSystem:g.adServerName,moatVASTAdID:g.wrapperAdId},d=this.getDwViewGuid(e),""!==d&&(b.zMoatVGUID=d),""!==c&&(b.zMoatPT=c),this.initMoatTracking(a.adVideoContainer,b,g.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(a){var b=this.getVpaidEventForEvent(a.eventName,a.context);b&&a.trackingHandle.dispatchEvent({type:b,adVolume:a.volume})},checkForAdBlocker:function(a){var b=a.getSessionOption("adBlockerCallback");return b&&b()},populateCustParamsWithAdSessionValues:function(a,b){var d,e,f;if("function"==typeof window.getVideoAdSessionValues&&(d=window.getVideoAdSessionValues(b),"string"==typeof d&&""!==d)){d=d.replace(c.session,"&"),e=uvpjs.util.objFromQueryStr(d);for(f in e)a[f]=e[f]}},removeEmpty:function(a){for(var b in a)(null===a[b]||""===a[b])&&delete a[b]},extractAdInfoIma:function(a){return{contentType:a.getContentType(),isLinear:a.isLinear()}},extractAdInfoDai:function(a){return{advertiserName:a.getAdvertiserName(),description:a.getDescription(),duration:a.getDuration(),title:a.getTitle()}},extractPodInfo:function(a){return a?{adPosition:a.getAdPosition(),podIndex:a.getPodIndex(),timeOffset:a.getTimeOffset(),totalAds:a.getTotalAds()}:null},getPpidValue:function(a){var b=a.getSessionOption("userPPID");return uvpjs.util.isDefinedString(b)?b:null},initMoatTracking:function(a,b,c,d,e){var f,g,h,i=document.createElement("script"),j=[];b={adData:{ids:b,duration:c,url:e},dispatchEvent:function(a){this.sendEvent?(j&&(j.push(a),a=j,j=!1),this.sendEvent(a)):j.push(a)}},h="_moatApi"+Math.floor(1e8*Math.random());try{f=a.ownerDocument,g=f.defaultView||f.parentWindow}catch(a){g=window}return g[h]=b,i.type="text/javascript",a&&a.insertBefore(i,a.childNodes[0]||null),i.src="https://z.moatads.com/"+d+"/moatvideo.js#"+h,b},getVpaidEventForEvent:function(a,b){var c=this.moatEventMapping[b][a];return uvpjs.util.isEmpty(c)?null:this.vpaidEvents[c]}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.Configuration={env:"prod",hostname:"vidtech.cbsinteractive.com",name:"UVPJS",version:"2.8.3",date:"03/26/18 8:42:19 AM (PDT)",path:"//vidtech.cbsinteractive.com/uvpjs/2.8.3/",playerName:"CBSI-PLAYER"}}(uvpjs),function(a){a.AutoplayDetectionService=uvpjs.Class.subClass({init:function(a){this.mc=a.mediaCapabilities,this.completeCallback=a.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=a.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(a,b){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:a,supportsMutedAutoplay:b})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(a,b){this.killVid(),this.setInfo(a,b),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var a,b;this.vidEl=b=this.createVideoElement(!1),b.load(),a=b.play(),void 0===a?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):a.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var a,b;return this.killVid(),this.checkForEarlySafari()?void this.finishCheck(!1,!1):(this.vidEl=b=this.createVideoElement(!0),b.load(),a=b.play(),void a.then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1)))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),
this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var a=this.mc.getBrowserName()===this.mc.SAFARI,b=this.mc.isDesktop(),c=a&&b?this.mc.getBrowserVersion():null,d=c&&c.split("."),e=d?11===parseInt(d[0])&&0===parseInt(d[1]):null;return null!==c&&(e&&(!d[2]||parseInt(d[2])<3))},detectMobileCapabilities:function(){var a=!1,b=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(a,b)},isAutoplayEligibleAndroid:function(){var a=this.mc.isAndroid(),b=a&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return b},isAutoplayEligibleIos:function(){var a=this.mc.isIOSTen(),b=a&&this.mc.isSafari(),c=a&&!b&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return b||c},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(a){var b=document.createElement("video");return a&&(b.muted=!0,b.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(b,!0),b.volume=.005,b.style.width="100%",b.style.height="100%",b.src=this.testVidPath,this.testDom.appendChild(b),b},createTestDom:function(){var a=document.createElement("div"),b=a.style,c="-1000px";return b.position="absolute",b.top=c,b.left=c,b.width="320px",b.height="180px",document.body.appendChild(a),a}})}(uvpjs.register("uvpjs")),uvpjs.MediaCapabilities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=uvpjs._,p=uuid.noConflict(),q=!1,r=!1,s={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLACEHOLDER_M3U8_URL:"//vidtech.cbsinteractive.com/h5/blanks/blank.m3u8",PLACEHOLDER_MP4_URL:uvpjs.b64TestVideo,MP4_BLANK_FILE:"//vidtech.cbsinteractive.com/h5/blanks/uvp_blank.mp4",PLATFORM_OUTLET_ACCOUNT_ID:"dJ5BDC",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"http://can.cbs.com/thunder/player/videoManifest.php?assetType=HLS&authn=",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null},apDetectionService:null,_detectEnvironment:function(c,d){var g=this.systemInfo;return typeof c===this.STRING?(a=c,b=!0):(a=navigator.userAgent||null,b=!1),e=document.createElement(this.VIDEO),f=document.createElement(this.AUDIO),typeof d===this.BOOLEAN&&(q=d),t(),x(),J(),r="https:"===location.protocol,g.browser=this.getBrowserName(),g.version=parseInt(this.getBrowserMajorVersion()),g.isMobile=this.isMobile(),g.isDesktop=this.isDesktop(),g.os=this.getOS()+"; ver. "+this.getOSVersion(),g.supportsMse=this.hasMediaSourceSupport(),g.isHlsjsEligible=this.canPlayHLSJS(),g.supportsNativeHls=this.canPlayNativeHLS(),g.supportsMp4=this.canPlayH264(),g.supportsDash=this.canPlayDASH(),this.checkBrowserName(this.FIREFOX)&&g.version<=56&&(this.PLACEHOLDER_MP4_URL=this.MP4_BLANK_FILE),this},determineAutoplayCapabilities:function(a){var b;return null!==this.systemInfo.supportsUnmutedAutoplay?void a():(b=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,a()}.bind(this),void(this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:b,testVidPath:this.PLACEHOLDER_MP4_URL})))},setAutoplayInfo:function(a){this.systemInfo.supportsUnmutedAutoplay=a.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=a.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return p.v1().replace(/-/g,"")},checkBrowserName:function(a){return typeof a===this.STRING&&this.getBrowserName()===a},canPlayHTML5Video:function(){var a=document.createElement(this.VIDEO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var a=document.createElement(this.AUDIO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},getBrowserName:function(){return l},getBrowserVersion:function(){return m},getBrowserMajorVersion:function(){return n},getBrowserVendorPrefix:function(){return this.isWebKit()?"webkit":this.isFirefox()?"moz":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(a,b){if(typeof b===this.OBJECT){var c=new RegExp(b),d=c.exec(this.getUserAgent()),e="",f="";if(typeof d===this.OBJECT&&d.length&&d.length>1){if(e=d[1]||"",e.indexOf(".")){var g=e.split(".");"object"==typeof g&&g.length&&g.length>0&&(f=g[0])}else f=e;return l=a,m=e,n=f,!0}}return!1},hasTealium:function(){return o.has(window,"utag")||o.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(a){return typeof a===this.STRING&&(this._detectEnvironment(a),!0)},getUserAgent:function(){return a},getMimeTypesObj:function(){return c?c:(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(c=navigator.mimeTypes),c)},getMimeTypes:function(){if(typeof d===this.OBJECT)return d;var a={length:0},b=this.getMimeTypesObj();if(typeof b===this.OBJECT){for(var c=0;c<this.length;c++){var e=b[c].enabledPlugin&&b[c].enabledPlugin.name?b[c].enabledPlugin.name:"";a[b[c].type]={type:b[c].type,description:b[c].description,suffixes:b[c].suffixes,enabledPlugin:b[c].enabledPlugin,enabledPluginName:e},a.length++}return d=a}},getPlatform:function(){return typeof h===this.STRING?h:null},getOS:function(){return typeof i===this.STRING?i:null},getOSVersion:function(){return typeof j===this.STRING?j:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){var a=this.getUserAgent().toLowerCase();return a.indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof k===this.BOOLEAN?k:k=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return y()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var a='video/mp4; codecs="avc1.42E01E,mp4a.40.2"',b=window.MediaSource||window.WebKitMediaSource,c=window.SourceBuffer||window.WebKitSourceBuffer,d=b&&"function"==typeof b.isTypeSupported&&b.isTypeSupported(a),e=!c||c.prototype&&"function"==typeof c.prototype.appendBuffer&&"function"==typeof c.prototype.remove;this.hasMse=!(!d||!e)}return this.hasMse},canPlayHLSJS:function(a){var b=this.isMobile(),c=!!y(),d=this.hasMediaSourceSupport(),e=this.isFirefox()||this.isChrome(),f=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),g=this.isOpera()&&this.getBrowserMajorVersion()>=30,h=this.isPlaystation();return!(!d||!c||b||h)&&(!!a||(e||f||g))},canPlayNativeHLSAudio:function(){return z()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return y()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(a,b){return y()&&this.canPlayMediaType(this.VIDEO,a,b||!1)},canPlayAudioType:function(a,b){return y()&&this.canPlayMediaType(this.AUDIO,a,b||!1)},canPlayMediaType:function(a,b,c){var d=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return c=1==c,!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(c&&d.canPlayType(b)===this.PROBABLY||!c&&""!==d.canPlayType(b)))},canPlayType:function(a,b){b=1==b;var c=/audio\//,d=c.test(a)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(b&&d.canPlayType(a)===this.PROBABLY||!b&&""!==d.canPlayType(a)))},nativeCanPlayType:function(a,b){var c=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof c===this.OBJECT&&typeof c.canPlayType===this.FUNCTION?c.canPlayType(b)||null:null},canPlayDASHType:function(a){if(typeof a!==this.STRING||a.length<1)return null;var b=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(a)&&this.hasMSE()&&b.isTypeSupported(a)},canPlayDASH264:function(a){return a=typeof a===this.STRING?a:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(a)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var a=this.getUserAgent();return a&&!(this.isChromecast()||this.isIOS()||a.indexOf("Android 2.")>-1||a.indexOf("Android 4.0")>-1||a.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(a){return(!a||!this.supportsAutoplay())&&(!this.isChromecast()&&!this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(a){return a&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(a){return!a&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(a,b){var c=this.getInlinePlayAttribute(),d=c&&c.name;b&&c?c&&a.setAttribute(d,c.value):!b&&d&&a.removeAttribute(d)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return this.isIOS()?this.PLACEHOLDER_M3U8_URL:this.PLACEHOLDER_MP4_URL},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var a="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return a&&!a.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var a,b;return void 0===this._hasFullscreenApiSupport&&(a=document.createElement("div"),b=uvpjs.util,this._hasFullscreenApiSupport=!!(b.isFunction(a.requestFullscreen)||b.isFunction(a.webkitRequestFullscreen)||b.isFunction(a.mozRequestFullScreen)||b.isFunction(a.msRequestFullscreen))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(a){var b=document,c=this.supportsFullscreenApi()&&(b.fullscreenEnabled||b.webkitFullscreenEnabled||b.mozFullScreenEnabled||b.msFullscreenEnabled);return!c&&(c=a&&a.webkitSupportsFullscreen),c},getDevice:function(){return g?g:null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var a=this.isIOS();return!a||a&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(a){var b=/\.m3u|assetType=hls/i,c=b.test(a);return c},isDashUrl:function(a){var b=/\.mpd/i,c=b.test(a);return c},isSecure:function(){return r},setUrlProtocol:function(a){return r?a.replace("http:","https:"):a},getDrmType:function(a){var b="none";return a.enabled?((this.isIOS()||this.isSafari())&&null!==a.fairplay.appCertURL?b="Fairplay":(this.isIE()||this.isEdge())&&null!==a.dash.playreadyURL?b="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==a.dash.widevineURL&&(b="Widevine"),b):b}},t=function(){var a=/\s(\([^)]+\))/,b=new RegExp(a),c=b.exec(s.getUserAgent());c&&c.length&&c.length>1&&(c=c[1].replace(/_/gi,"."),v(c)||w(c)||u(c)||C(c))},u=function(a){if(a.indexOf(s.LINUX)!==-1||a.indexOf(s.ANDROID)!==-1){if(h=s.LINUX,a.indexOf(s.ANDROID)!==-1){var b=/\ Android\ ([^\s]+);/,c=new RegExp(b);a=c.exec(a),g=s.ANDROID,i=s.ANDROID,j=a&&a[1]?a[1]:""}return!0}return!1},v=function(a){var b,c,d="like Mac OS X";if(a.indexOf(s.MAC)!==-1)return h=s.MAC,g=s.DESKTOP,a.indexOf(s.OSX)!==-1&&(b=/Mac\ OS\ X\ ([\d\.]+)/,c=new RegExp(b),a=c.exec(a),i=s.OSX,j=a&&a[1]?a[1]:null),!0;if(a.indexOf(d)!==-1){h=s.MAC,i=s.IOS;var e=/\(iPhone;/,f=/\(iPad;/,k=/\(iPod;/;c=/\sOS\s([^\s]*)\s/;var l=c.exec(a);if(l&&l[1]&&(j=l[1]),e.test(a))g=s.IPHONE;else if(f.test(a))g=s.IPAD;else{if(!k.test(a))return!1;g=s.IPOD}return!0}return!1},w=function(a){var b=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,c=/Windows\ NT\ ([^\s]+)[;\)]/,d=new RegExp(b);if(a=d.exec(s.getUserAgent()),a&&a[2])return h=s.WINDOWS,i=s.WINDOWS_PHONE,j=a[2],g=s.PHONE,!0;if(d=new RegExp(c),a=d.exec(s.getUserAgent()),a&&a[1]){h=s.WINDOWS,i=s.WINDOWS;var e=a[1];return 6==e?i=s.WINDOWS_VISTA:6.1==e?(i=s.WINDOWS7,j=7):6.2==e?(i=s.WINDOWS8,j=8):10==parseInt(e)&&(i=s.WINDOWS10,j=e),g=s.DESKTOP,!0}return!1},x=function(){return!!A()||(!!D()||(!!E()||(!!F()||(!!G()||(!!H()||(!!I()||!!B()))))))},y=function(){return e},z=function(){return f},A=function(){var a=/Chrome\/(\S+)/,b=/CriOS\/(\S+)/,c=/(Opera|OPR)/,d=/Edge/,e=/CrKey/,f=s.getUserAgent(),g=b.test(f),h=(a.test(f)||g)&&!c.test(f)&&!d.test(f)&&!e.test(f);return!!h&&(s.setBrowserVersion(s.CHROME,g?b:a),!0)},B=function(){var a=/Playstation (\S+)/i;return!!a.test(s.getUserAgent())&&(s.setBrowserVersion(s.PLAYSTATION,a),!0)},C=function(){return null!=s.getUserAgent()&&s.getUserAgent().indexOf(s.CHROMECAST_USER_AGENT)>-1&&(h=s.LINUX,g=s.CHROMECAST,i=s.ANDROID,!0)},D=function(){var a=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,b=/\ Edge\/([^\s]+)/,c=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return a.test(s.getUserAgent())?(s.setBrowserVersion(s.IE,a),!0):b.test(s.getUserAgent())?(s.setBrowserVersion(s.EDGE,b),!0):!!c.test(s.getUserAgent())&&(s.setBrowserVersion(s.IE,c),!0)},E=function(){var a=/Firefox\/(\S+)/;return!!a.test(s.getUserAgent())&&(s.setBrowserVersion(s.FIREFOX,a),!0)},F=function(){var a,b=/Version\/(\S+).*Safari\//,c=b.test(s.getUserAgent());return a=i===s.ANDROID?s.ANDROID:s.SAFARI,!!c&&(s.setBrowserVersion(a,b),!0)},G=function(){var a=/Opera|OPR\/(\S+)/,b=new RegExp(a),c=b.exec(s.getUserAgent());if(c){var d=c.indexOf("Opera Mini/")!==-1||c.indexOf("Opera Mobi")!==-1?s.OPERA_MOBILE:s.OPERA;return s.setBrowserVersion(d,/Opera|OPR\/(\S+)/),!0}return!1},H=function(){var a=/Silk/i;return!!a.test(s.getUserAgent())&&(s.setBrowserVersion(s.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},I=function(){var a=/Android/,b=a.test(s.getUserAgent());return!!b&&(l=s.ANDROID_BROWSER,!0)},J=function(){var a=y(),b=function(a,b){a._fullscreenEventName=b?b[0]:null,a._fullscreenEnterEventName=b?b[1]:null,a._fullscreenExitEventName=b?b[2]:null,a._enterFullscreenMethodName=b?b[3]:null,a._exitFullscreenMethodName=b?b[4]:null,a._isFullscreenPropertyName=b?b[5]:null,a._fullscreenElementName=b?b[6]:null,a._fullscreenErrorEventName=b?b[7]:null},c=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullScreen","fullScreenElement","fullscreenError"],d=null;a.requestFullscreen?d=c:a.webkitRequestFullscreen?d=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:a.mozRequestFullScreen?d=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:a.msRequestFullscreen?s.getBrowserVersion()<12?d=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(d=c.slice(),d[5]=null):(s.isIOS()||s.isAndroid())&&(d=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"]),b(s,d)};return s},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",DASHJS_LEVEL:"DASHJS_LEVEL",DASHJS_FRAG:"DASHJS_FRAG",DASHJS_FRAME_DROP:"DASHJS_FRAME_DROP"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(a){var b=uvpjs._,c=uvpjs.mediaCapabilities;return this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,b.isObject(a)?(this.cookie=this._getCookie(),this.CDO=a,this.isEnabled=this.cookie.enabled===!0||this._isEnabled(),this.showAll=this.cookie.showAll===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=this.cookie.showTimestamps===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=this.cookie.showClockTime===!0||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=c.isChrome()||c.isFirefox()||c.isSafari(),void this.setSessionStartTime()):void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.")},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(a,b,c){this.debugCount++;var d=uvpjs._;if(this.isEnabled||d.isUndefined(this.CDO)){if(!d.isString(a)||!d.isString(b)||d.isUndefined(c))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+c,b);if(this.showAll||d.isUndefined(this.CDO)||this.isParamEnabled(b)||this.cookie[b]===!0){var e=this.showTimestamps?"["+this._timestamp()+"] ":"",f=d.drop(arguments,3),g=d.isEmpty(f)?"":f,h={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[a]("%sUVPJS %s %s",e,b,c,g);console[a]("%s%cUVPJS %c%s%c %s",e,h.bold,h.underline,b,h.normal,c,g)}}},isParamEnabled:function(a){return this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,a)===!0},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)===!0},_timestamp:function(){var a=uvpjs._,b=new Date,c=b-this.adjustedStartTime,d=c%1e3;c=(c-d)/1e3;var e=c%60;c=(c-e)/60;var f=c%60;c=(c-f)/60;var g=c%24-this.adjustedTimezone;return a.padStart(g,2,"0")+":"+a.padStart(f,2,"0")+":"+a.padStart(e,2,"0")+"."+a.padStart(d,3,"0")},_getCookie:function(){var a=this._readCookie(this.COOKIE_NAME),b={};if(!a)return b;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",a);try{b=JSON.parse(a)}catch(a){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",a)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",b),b},_readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0,e=c.length;d<e;d++){for(var f=c[d];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return null}},function(a){var b,c=a._;a.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",a),this.mc=null,this._createControls=a.createControls,this._createAds=a.createAds,this._useInlinePlayAttribute=a.useInlinePlayAttribute,this._useMutedAttribute=a.useMutedAttribute,this._usePlaceholderContent=a.usePlaceholderContent,this._DOMReadyCB=a.callback,this._useAutoplayAttribute=a.useAutoplayAttribute,this._userAgent=null,this.dom=b(),this.dom.outer.id=a.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var a=this.dom.video.el;a&&a instanceof HTMLElement&&(a.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),a.removeEventListener(this.PLAY,this._handleEvent,!1),a.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return c.clone(this.dom)},_disableVideoContextMenu:function(){var a=this.dom.video.el;a.addEventListener?a.addEventListener("contextmenu",function(a){a.preventDefault()},!1):a.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var a=this.dom;return a.outer.el=document.getElementById(a.outer.id),c.isNull(this.dom.outer.el)?void(this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",a.outer.id)):(a.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),a.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),a.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),a.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),a.content.el=this._getOrCreateElement("content"),a.outer.el.insertBefore(a.content.el,a.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),a.ad.el=this._getOrCreateElement("ad"),a.outer.el.insertBefore(a.ad.el,a.content.el.nextSibling)),this._createControls?(a.controls.el=this._getOrCreateElement("controls"),a.outer.el.appendChild(a.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._usePlaceholderContent?void this._createPlaceholderContent():void this._DOMReadyCB())},_createVideoElement:function(){var a,b=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),c=document.querySelectorAll(b);if(c instanceof NodeList&&c[0]instanceof HTMLElement&&c[0].id)return void this._checkVideoTagAttributes(c);if(b=[this.dom.outer.id,this.dom.video.id].join(" "),c=document.querySelectorAll(b),c instanceof NodeList&&c[0]instanceof HTMLElement){if(c[0].id)return;return c[0].id=this.dom.video.id,void this.dom.content.el.appendChild(c[0])}a=this._getOrCreateElement("video"),this._checkVideoTagAttributes(a),this.dom.content.el.appendChild(a),this.dom.video.el=a},_createPlaceholderContent:function(){var a=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||c.isNull(this._userAgent)&&this.mc.isIPhone()?a.innerHTML='<source src="'+this.dom.video.url+'">':a.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),a.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY,this._handleEvent,!1),a.addEventListener(this.PLAY,this._handleEvent,!1),a.addEventListener(this.PAUSE,this._handleEvent,!1),a.style.width="100%",this._DOMReadyCB()},_handleEvent:function(a){var b=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",a),!c.isNull(b)){var d=this._useSeparateTags?b.getElementsByTagName("source")[0]:b;if(!c.isNull(d)){if(a.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,a.target),b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),d.src.indexOf(this.dom.video.url)===-1)return b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeEventListener(this.PLAY,this._handleEvent,!1),void b.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",a.type),a.type){case this.CAN_PLAY:b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(b.removeEventListener(this.PLAY,this._handleEvent,!1),b.pause(),!c.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:b.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(a){this._useMutedAttribute&&a.setAttribute("muted","muted"),this._useAutoplayAttribute&&a.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(a,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var a=this.dom.ad.el;a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.left="0",a.style.top="0"}},_getIdByPrefix:function(a){if(!c.isNull(a))return uvpjs.domConstants[a]+this.dom.outer.id},_getOrCreateElement:function(a){var b=this.dom[a],d=document.getElementById(b.id);return c.isNull(d)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+b.type+' id="'+b.id+'">.'),d=document.createElement(b.type),d.id=b.id),d}}),b=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(a){var b=a._,c="NielsenTracking_SDK";a.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null},dash:{widevineURL:null,playreadyURL:null}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,
averageDroppedFPS:0,bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(a,c,d,e){return b.isString(a)&&b.isObject(c)&&b.isObject(d)?(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+a),this.vidContId=a,this.cviMgr=c,this.CDO=d,this.sessionOptions=e,this.eventsMgr=c.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions.capLevelToPlayerSize&&this.setCapLevelToPlayerSize(this.sessionOptions.capLevelToPlayerSize),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),void this.mergeCDOData()):void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN"))},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(a){if(b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+a.payload.newState);var c=a.payload.newState;c!==uvpjs.mediaCapabilities.EMPTY&&c!==uvpjs.mediaCapabilities.LOADING&&c!==uvpjs.mediaCapabilities.STOPPED&&c!==uvpjs.mediaCapabilities.PLAYING&&c!==uvpjs.mediaCapabilities.PAUSED&&c!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=c,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(a){var b=a.payload;a.target===this.vidContId&&(this.isCurrVideoAd=b.isAd,this.playbackState=b.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=b.currentTime,this.adPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.adPlaybackState.duration=b.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=b.playbackStarted,this.adPlaybackState.playbackComplete=b.playbackComplete,this.adPlaybackState.sourceBitrate=b.sourceBitrate,this.adPlaybackState.playbackBitrate=b.playbackBitrate,this.adPlaybackState.errorInfo=b.errorInfo,this.adPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=b.currentTime,this.contentPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=b.playbackStarted,this.contentPlaybackState.playbackComplete=b.playbackComplete,this.contentPlaybackState.sourceBitrate=b.sourceBitrate,this.contentPlaybackState.playbackBitrate=b.playbackBitrate,this.contentPlaybackState.videoFramerate=b.videoFramerate,this.contentPlaybackState.isSeeking=b.isSeeking,this.contentPlaybackState.isHDStreamLive=b.isHDStreamLive,this.contentPlaybackState.isPlayingLive=b.isPlayingLive,this.contentPlaybackState.currentContentSegment=b.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=b.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=b.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.contentPlaybackState.bufferLength=b.bufferLength,this.contentPlaybackState.switchingMode=this.useDynamicSwitching===!0?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=b.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.vol)&&(this.volume=a.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.isFullscreen=a.payload.isFs)},onContextMetadata:function(a){!b.isPlainObject(a)||a.target!==this.vidContId||!b.isPlainObject(a.target.contextMetadata)},onResourceStart:function(a){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){b.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){b.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){b.assign(this.contentVideoState,this.contentVideoStateDefaults)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var a=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof a&&a.length?a:null},isNielsenTrackingEnabled:function(){return this.getModule(c).enabled===!0},getValueForKey:function(a){var c=void 0;return a&&b.isString(a)&&this.hasOwnProperty(a)&&!b.isFunction(this[a])&&(c=this[a]),c},getModule:function(a){if(b.isString(a))return this.CDO.getModule(a)},getModuleParam:function(a,c){if(b.isString(a)&&b.isString(c))return this.CDO.getModuleParam(a,c)},getModules:function(){return this.CDO.getModules()},isModuleEnabled:function(a){return!(!a||!b.isString(a))&&this.CDO.isModuleEnabled(a)},isModuleSet:function(a){return!uvpjs.util.isEmpty(a)&&this.CDO.isModuleSet(a)},getSessionOption:function(a){return a?this.sessionOptions[a]:null},getClass:function(a){if(b.isString(a))return this.CDO.getClass(a)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(a,b){return this.CDO.getClassProperty(a,b)},getClassListItems:function(a){return this.CDO.getClassListItems(a)},getClassListItemProperty:function(a,b,c){return this.CDO.getClassListItemProperty(a,b,c)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var a={};return b.assign(a,this.contentVideoState),a},getAdVideoState:function(){var a={};return b.assign(a,this.adVideoState),a},getContentPlaybackState:function(){var a={};return b.assign(a,this.contentPlaybackState),a},getAdPlaybackState:function(){return b.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(a){this.contentVideoState.abrInfo=a,this.contentPlaybackState.abrInfo=a},setAdVideoState:function(a){this.adVideoState=b.assign({},this.adVideoStateDefaults,a||{})},setContentVideoStateItems:function(a){this._addItemsToInstanceObj("contentVideoState",a)},setContentPlaybackStateItems:function(a){this._addItemsToInstanceObj("contentPlaybackState",a)},setAdVideoStateItems:function(a){this._addItemsToInstanceObj("adVideoState",a)},setAdPlaybackStateItems:function(a){this._addItemsToInstanceObj("adPlaybackState",a)},setNonDefaultContentVideoStateItems:function(a){this.setContentVideoStateItems(this._removeDefaults(a,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(a){this.setAdVideoStateItems(this._removeDefaults(a,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},_getCDOBitrate:function(a){var b=this.VIDEO_PLAYBACK_SETTINGS,c=this.isModuleEnabled(b),d=this.getModuleParam(b,a);if(c&&d)return isNaN(d)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Non-number bitrate value from CDO:",d)):+d},setAbrStartBitrateFromCDO:function(){var a=this._getCDOBitrate(this.START_BITRATE);a&&(this.setStartBitrate(Number(a)),this.debug&&uvpjs.log(this.DEBUG_ID,"Set ABR Start Bitrate from CDO:",a))},setAbrMinBitrateFromCDO:function(){var a=this._getCDOBitrate(this.MIN_BITRATE);a&&(this.setMinBitrate(Number(a)),this.debug&&uvpjs.log(this.DEBUG_ID,"Set ABR Min Bitrate from CDO:",a))},setAbrMaxBitrateFromCDO:function(){var a=this._getCDOBitrate(this.MAX_BITRATE);a&&(this.setMaxBitrate(a),this.debug&&uvpjs.log(this.DEBUG_ID,"Set ABR Max Bitrate from CDO:",a))},setLiveSyncDurationCountFromCDO:function(){var a=this.VIDEO_PLAYBACK_SETTINGS,b=this.isModuleEnabled(a),c=this.getModuleParam(a,this.LIVE_SYNC_DURATION_COUNT);if(b&&c){if(isNaN(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Non-number duration count value from CDO:",c));this.setLiveSyncDurationCount(c),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count from CDO:",c)}},setCapLevelToPlayerSizeFromCDO:function(){var a=this.VIDEO_PLAYBACK_SETTINGS,b=this.isModuleEnabled(a),c=this.getModuleParam(a,this.CAP_LEVEL_TO_PLAYER_SIZE);b&&"boolean"==typeof c&&this.setCapLevelToPlayerSize(c)},setDashJSFastSwitchABRFromCDO:function(){var a=this.VIDEO_PLAYBACK_SETTINGS,b=this.isModuleEnabled(a),c=this.getModuleParam(a,this.DASHJS_FAST_SWITCH_ABR);b&&"boolean"==typeof c&&this.setDashJSFastSwitchABR(c)},setStartBitrate:function(a){this.startBitrate=a,this.setContentPlaybackStateItems({startBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(a){this.minBitrate=a,this.setContentPlaybackStateItems({minBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(a){this.maxBitrate=a,this.setContentPlaybackStateItems({maxBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(a){this.liveSyncDurationCount=a,this.setContentPlaybackStateItems({liveSyncDurationCount:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(a){this.capLevelToPlayerSize=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(a){this.enableDashJSFastSwitchABR=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setUseDynamicSwitching:function(a){this.useDynamicSwitching=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var a=this;b.forOwn(this.sessionOptions,function(c,d){if(b.isString(c))return b.has(a.contentVideoState,d)?void(a.contentVideoState[d]=c):b.has(a.adVideoState,d)?void(a.adVideoState[d]=c):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(a,c){return b.omitBy(a,function(b,d){return a[d]===c[d]})},_addItemsToInstanceObj:function(a,c){var d,e,f;if(d=this[a],!d)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+a));if(!b.isObject(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",c));this.debug;for(e in d)f=c[e],!c.hasOwnProperty(e)||b.isUndefined(f)||b.isFunction(f)||(d[e]=f)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,this.clearInterval(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(a,c,d){var e,f;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",a),this.scriptsLoadedCB=c,this.timeout=d||this.REQUEST_TIMEOUT,b.isString(a)&&this.urls.push(a),b.isArray(a)&&(this.urls=a),f=this.urls.length,e=0;e<f;e++)this._getScript(this.urls[e])},_getScript:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",a);var c=this,d=function(a,d){return!b.isFunction(c._onScriptLoaded)||c._onScriptLoaded.done?void(c.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript _doCallback callback not a function or already called.")):(c.urls=b.without(c.urls,a),void c._onScriptLoaded(d))},e=document.createElement("script");e.src=this._setUrlProtocol(a),e.async=!0,e.onreadystatechange=e.onload=function(){e.readyState&&!/loaded|complete/.test(e.readyState)||d(a)},e.onerror=function(b){uvpjs.error(c.DEBUG_ID,"_getScript "+b.target.src+" is not accessible."),d(a,b)},document.querySelector("head").appendChild(e),this.timeoutHandle=setTimeout(function(a){var e=b.indexOf(c.urls,a)===-1;e||(this.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript request timeout"),d(a,"timeout"))}.bind(this,a),this.timeout)},_onScriptLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var c=b.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),c&&b.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(a))},createCORSRequest:function(a,b){var c=new XMLHttpRequest;return b=this._setUrlProtocol(b),"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=!1,c},loadXHR:function(a,c,d,e){var f,g;return a=this._setUrlProtocol(a),f=this.createCORSRequest("GET",a),f===!1?(g="loadXHR CORS not supported for url = "+a,uvpjs.warn(this.DEBUG_ID,g),void d(f)):(e&&!uvpjs.util.isEmpty(e)&&(f.responseType=e),f.timeout=this.REQUEST_TIMEOUT,f.onload=function(){return b.inRange(f.status,200,400)?void c(f):void d(f)},f.onerror=function(){d(f)},f.ontimeout=function(){d(f)},void f.send())},loadXML:function(a,b,c){this.loadXHR(a,b,c,"document")},loadArrayBuffer:function(a,b,c){this.loadXHR(a,b,c,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a){var b=a.vidContId;if(!a.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=b,this.eventsMgr=a.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=a.readyCallback,this.cachedOptions={suppressFacadePlay:a.suppressFacadePlay,deferLoadingCaptions:a.playerOptions.deferLoadingCaptions},this.cviModel.initialize(b,this,a.CDO,a.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(a){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(a)},setInitialPlaybackType:function(a,b){this.initialPlaybackInfo.isAutoplay=a,this.initialPlaybackInfo.isMuteAtPlayStart=b},setContextMetadata:function(a){this.cviModel.contentVideoState.contextMetadata=a||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var c=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:c.suppressFacadePlay,p2pClient:a||null,multiCdnClient:b||null,deferLoadingCaptions:c.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:c.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(){var a=this.cviModel.getSessionOption("adBlockerCallback"),c=!(!a||!a()),d=this.eventsMgr.eventTypes,e=uvpjs.ErrorInfo,f=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+c),c&&this.eventsMgr.dispatchEvent(d.AD_BLOCKED,{errorInfo:new e({eventType:d.AD_BLOCKED,errorCode:e.errorCodes.AD_BLOCKING_DETECTED,message:e.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),!c&&!f)return void this.eventsMgr.dispatchEvent(d.PLAYER_START_ERROR,{errorInfo:new e({eventType:d.PLAYER_START_ERROR,errorCode:e.errorCodes.IMA_SDK_MISSING,message:e.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId);if(f){if(!b.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var g=this.adsLoader.getSettings();g.setAutoPlayAdBreaks(!0),g.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},_createIMAAdDisplayContainer:function(){var a,b,c,d;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),a=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),b=a.getElementsByTagName("video")[0],c=document.getElementById(uvpjs.domConstants.AD_LEARNMORE_ID_PREFIX+uvpjs.domConstants.ID_SELECTOR_PREFIX+this.vidContId),d=new google.ima.AdDisplayContainer(this.adVideoDiv,b,c),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",c),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",d),d},onAdsManagerLoaded:function(a){var b,c=uvpjs.util,d=c.isEmpty(this.RPM),e=c.isEmpty(this.RPM.currRP),f=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;return this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",a),d||e||f?(b="CVI mgr: onAdsManagerLoaded; ",b+=d?"no RPM found":e?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,b),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+b,isFatal:!1})},this.vidContId)):void this.RPM.currRP.onAdsManagerLoaded(a)},onAdError:function(a){var c=!b.isEmpty(this.RPM)&&this.RPM,d=c&&!b.isEmpty(c.currRP)&&c.currRP;return this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",a),c&&d?void("function"==typeof d.handleAdsLoaderError&&d.handleAdsLoaderError(a)):(this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId))},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),this.RPM.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,{},this.vidContId)},seekToRequest:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+a),b.isNaN(a)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+a)):(a===-1&&this.seekToLiveRequest(),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:a},this.vidContId))},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",a),b.isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:a},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",a),b.isString(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:a},this.vidContId)},showCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},setCaptionsStyleRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",a),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(a):this.captionsMgr.setStyles(a)},setCaptionsCuePropertyRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",a,b),this.captionsMgr.setCueProperty(a,b)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},resizeRequest:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+a+"  height = "+c),!b.isNaN(a)&&!b.isNaN(c)&&a>=0&&c>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:a,height:c},this.vidContId)},fullscreenRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:a},this.vidContId)},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:a},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){var a=this.cviModel.getContentVideoState();return a},getAdVideoData:function(){var a=this.cviModel.getAdVideoState();return a},getPlayerSessionId:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId");var a=this.cviModel.sessionId;return a},setPageContextMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",a),b.isPlainObject(a)},setNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",a),b.isBoolean(a)&&(this.cviModel.nativeControls=a)},createPauseAdRetriever:function(){var a=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),b={eventsMgr:this.eventsMgr,adCallUrl:a,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return a?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(b)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+a))},checkForPauseAd:function(){var a,b=this.cviModel.isModuleEnabled("PauseAd"),c=uvpjs.Configuration.path+"lib/PauseAdRetriever.js";b&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(a=new uvpjs.CodeLoader,a.loadScript(c,this.createPauseAdRetriever.bind(this))))}})}(uvpjs.register("uvpjs")),function(a){a.ErrorInfo=uvpjs.Class.subClass({init:function(a){var b=a||{};this.errorCode=b.errorCode||null,this.eventType=b.eventType||null,this.isFatal=!!b.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=b.message||null,this.adInfo=b.adInfo||null,this.serverCode=b.serverCode||null,this.hlsjsErrorCode=null}}),a.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},a.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",
HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(a){return this.debug=uvpjs.debug,a&&a===c?(this.timerCBOs=[],this.registeredEventsTable={},void this._startUVPJSClock(this.uvpjsClockInterval)):void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance()."))},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(a,c){if(!(a&&b.isString(a)&&c&&b.isFunction(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d=this._returnValidEvtTypeAndNameSpace(a);if(d===!1)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+a},this.internalNS);var e=d[0],f=d[1];return this.registeredEventsTable[e]||(this.registeredEventsTable[e]={}),this.registeredEventsTable[e][f]?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",e," ns = ",f)):(this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",e," ns = ",f),void(this.registeredEventsTable[e][f]=c))},removeEventListener:function(a){if(!a||!b.isString(a))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",a),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var c=this._returnValidEvtTypeAndNameSpace(a);if(c===!1)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",a));var d=c[0],e=c[1];return this.registeredEventsTable[d]&&this.registeredEventsTable[d][e]?(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",a),void delete this.registeredEventsTable[d][e]):void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",a))},dispatchEvent:function(a,c,d){var e={};if(!a||!b.isString(a))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+a+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS);if(!b.isUndefined(c)&&!b.isPlainObject(c))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!b.isUndefined(d)&&!b.isString(d))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var f=this.registeredEventsTable[a];if(f){b.isUndefined(c)&&(c={}),b.isUndefined(d)&&(d=""),e.type=a,e.payload=c,e.target=d;for(var g in f)f.hasOwnProperty(g)&&f[g](e)}},_returnValidEvtTypeAndNameSpace:function(a){var b=[],c=a.split(".");if(c.length<2)return!1;var d=c[0];c.shift();var e=c.join("_");return!(!this._validateEventType(d)||e.indexOf("undefined")>-1)&&(b[0]=d,b[1]=e,b)},_validateEventType:function(a){var b=!1,c=this.eventTypes;for(var d in c)if(c.hasOwnProperty(d)&&c[d]===a){b=!0;break}return b},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(a){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),a)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(a,c,d,e){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",c);var f={};if(!a||!b.isNumber(a)||!c||!b.isString(c)||!d||!b.isFunction(d)||e&&!b.isNumber(e)&&(e>=1||e===-1))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);a<this.uvpjsClockInterval&&(a=this.uvpjsClockInterval);var g=c.split(".");c=g.join("_"),f={freq:a,ns:c,cb:d,rptCnt:-1,nextTime:Date.now()+a},e&&(f.rptCnt=e),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",a),this.timerCBOs.push(f)},removeTimedEventCallback:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",a+" ns = "+c),!(a&&b.isNumber(a)&&c&&b.isString(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d,e,f=c.split(".");for(c=f.join("_"),d=this.timerCBOs.length;d--;)e=this.timerCBOs[d],e.freq===a&&e.ns===c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",e.freq+" CBO.ns = "+e.ns),this.timerCBOs.splice(d,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var a,b,c=Date.now();for(a=this.timerCBOs.length-1;a>=0;a--)b=this.timerCBOs[a],c>=b.nextTime&&(b.cb(),b.nextTime=c+b.freq,b.rptCnt!==-1&&(b.rptCnt=b.rptCnt-1,0===b.rptCnt&&this.timerCBOs.splice(a,1)))},eventTypes:{FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CAPTIONS_ERROR:"onCaptionsError",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),a.EventsManager._instance=null,a.EventsManager.destroyInstance=function(){this._instance=null},a.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(c)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b="www.nielsen.com";a.AbstractId3Parser=uvpjs.Class.subClass({init:function(a){this.findNielsen=a.findNielsen,this.dataCallback=a.dataCallback,this.ownerIds=this.assembleOwnerIds(a.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(a){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(a){for(var b=a.length,c=[];b--;)c[b]=a[b].length;return c},assembleOwnerIds:function(a,c){var d,e,f=[];if("string"==typeof a)for(d=a.split(","),e=d.length;e--;)f.push(d[e].trim());return c&&f.indexOf(b)===-1&&f.push(b),f}})}(uvpjs.register("uvpjs")),function(a){var b="www.nielsen.com",c=249;a.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){var b,c=a.length;for(b=0;b<c;b++)a[b].data&&this.findId3(a[b])},findId3:function(a){var b,c,d,e,f,g,h,i=0,j=a.data;h=this.readStr(j,i,3),i+=3,"ID3"===h&&(i+=3,b=127&j[i++],c=127&j[i++],d=127&j[i++],e=127&j[i++],f=(b<<21)+(c<<14)+(d<<7)+e,g=i+f,this.findId3PrivateFrame(a,i,g))},findId3PrivateFrame:function(a,b,c){for(var d,e,f,g,h=a.data;b+8<=c;)d=this.readStr(h,b,4),b+=4,e=h[b++]<<24+h[b++]<<16+h[b++]<<8+h[b++],g=(h[b++]<<8)+h[b++],f=b,"PRIV"===d&&this.parseFrame(a,b)},parseFrame:function(a,c){for(var d,e,f,g=this.idLengths,h=this.totalIds,i=a.data;h--;)if(f=g[h],e=this.readStr(i,c,f),e===this.ownerIds[h]){c+=f,d=e===b?this.parseNielsen(e,i,c):this.readStr(i,++c,i.length),this.dataCallback({name:e,data:d,pts:a.pts});break}},parseNielsen:function(a,b,d){var e=a+this.readStr(b,d,b.length-(d+2));return e.length===c?e:null},readStr:function(a,b,c){var d="",e=b||0,f=b+c;do d+=String.fromCharCode(a[e++]);while(e<f);return d}})}(uvpjs.register("uvpjs")),function(a){var b="www.nielsen.com";a.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){if(1===a.length){var c=a[0];if("PRIV"===c.value.key)for(var d=0;d<this.ownerIds.length;d++){var e=this.ownerIds[d];c.value.info.indexOf(e)!==-1&&this.dataCallback({name:e,data:e===b?c.value.info:String.fromCharCode.apply(null,new Uint8Array(c.value.data)),pts:c.startTime})}}}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=a.p2pClient||null,this.multiCdnClient=a.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=a.suppressFacadePlay,this.deferLoadingCaptions=a.deferLoadingCaptions,this.playlistPaused=!1,!b.isEmpty(a)&&this.initialize(a.vidContId,a.cviMgr)},initialize:function(a,c){return this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",a),b.isString(a)&&b.isObject(c)?(this.vidContId=a,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,void this._addEventListeners()):void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS"))},setContainers:function(a){this.containers=a},setCaptionStyle:function(a){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(a)},onResourceLoadRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",a.payload.rcObj),this.playlistPaused=!1;var b=this._createResourceProvider(a.payload.rcObj);this.rscProviders.unshift(b),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",a.payload.rcObjs);var c,d,e=a.payload.rcObjs,f=e.length;for(c=0;c<f;c++)d=this._createResourceProvider(e[c]),this.rscProviders.push(d);b.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(a){a.target===this.vidContId&&this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceRemoveRequest this.vidContId = ",this.vidContId)},onResourcePlaylistPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),a.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(a){a.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,b.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),b.isEmpty(this.currRP)||b.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){!b.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(a){var b,c,d={rco:a,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",a),a.type){case this.mc.RP_URL:b=new uvpjs.RP_URL(d);break;case this.mc.RP_PLATFORM:b=new uvpjs.RP_Platform(d);break;case this.mc.RP_DAI:c=a.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider,b=new c(d);break;case this.mc.RP_IMA:b=new uvpjs.RP_IMA(d);break;case this.mc.RP_MDIALOG:b=new uvpjs.RP_Mdialog(d)}return b},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),b.isObject(this.currRP)?void this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay):(this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist())},rpDataLoadErrorCB:function(a){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",a.message),this.eventsMgr.dispatchEvent(a.eventType,{errorInfo:a},this.vidContId),this.advancePlaylist()},resourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:a},this.vidContId)},resourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",a),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:a,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!b.isEmpty(this.currRP)&&b.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr={},this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1},initialize:function(a,c,d,e,f){var g=f.skin===!0;return this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",a),b.isString(a)&&b.isObject(c)&&b.isObject(d)&&b.isFunction(e)?(this.vidContId=a,this.namespace=".vci_"+a,this.eventsMgr=c,this.CDO=d,this.vciReadyCB=e,this._usesIMA=f.usesIMA,this._loadSkinFlag=g,this._isPreviewBtnInternallyManaged=g,this._isUnmutedAutoplay=f.enableUnmutedAutoplay,this._isMutedAutoplay=f.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),void(this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:a,eventsMgr:c,CDO:d,playerOptions:f,suppressFacadePlay:this.checkNativeAutoplay(f.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,f)}))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"-"))},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(a){var b={skin:a.skin===!0,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:a.customCSS,enableReplay:a.enableReplay,previewImage:a.previewImage,themeName:a.themeName};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:a.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),usePlaceholderContent:this.mc.requiresPlaceholderContent(this._autoPlay),callback:this.onDOMReady.bind(this,b)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.handleFirstGesture.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdStart:function(a){this.vidContId===a.target&&(this.checkAutoplayRestriction(a.payload.adData),this.removeEventListener(uvpjs.EventType.AD_START+this.namespace))},checkAutoplayRestriction:function(a){"pre"===a.adType&&"ima"===a.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(a){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,a,this.vidContId)},prepForRestrictedAutoplay:function(a){var b=this.dom.video.el,c=Function.prototype;this.hPrePlay=function(){this.isPreparedForAutoplay=!0,b.removeEventListener("play",this.hPrePlay,!1),a&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this),this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),b.src=this.mc.getPreferredPlaceholderURL(),b.addEventListener("play",this.hPrePlay,!1),b.muted=!0,b.load();var d=b.play();void 0!==d&&d.then(c).catch(function(a){})},handleFirstGesture:function(a){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:a||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(a){return this.dom=this.DOMMgr.getDOM(),addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),this._loadSkinFlag?void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:a})):void this.onVCIReady()},checkNativeAutoplay:function(a){return a&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),b.isString(a)?void this.CVI_Mgr.loadDynamicAdCall(a):void(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)"))},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(a){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(a)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=a,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void a())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(a){var b,c;return a===!0||this.canOverrideUserGesture()?void this.onPreviewButton(this.onVCIReady.bind(this)):(b=uvpjs.ErrorInfo,c=this.eventsMgr,void c.dispatchEvent(c.eventTypes.PLAYER_START_ERROR,{errorInfo:new b({eventType:c.eventTypes.PLAYER_START_ERROR,errorCode:b.errorCodes.USER_GESTURE_REQUIRED,message:b.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId))},addEventListener:function(a,c){return a&&b.isString(a)&&b.isFunction(c)?void this.eventsMgr.addEventListener(a,c):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId)},removeEventListener:function(a){return a&&b.isString(a)?void this.eventsMgr.removeEventListener(a):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(a){var c;return this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone?(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,a),void this.playBlankVideo()):(c=this.createResourceConfig(a),void(b.isObject(c)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:c},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)))},addResourcesToPlaylist:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,a),void this.playBlankVideo();if(b.isArray(a)&&a.length>0){var c,d,e=[];for(c in a)d=this.createResourceConfig(a[c]),b.isObject(d)?e.push(d):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{
msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:e},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(a){var b,c,d,e,f,g,h,i="",j=!1,k=a.type===this.mc.RP_IMA,l="",m=!1,n=!1,o=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",a),h=this.prevalidateRcObj(a),h.error)return i="Resource configuration error: "+h.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(i,null),!1;switch(a.type){case this.mc.RP_URL:c=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:c=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(i="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",j=!0),m=!0,c=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:c=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:m=!a.useSsb,c=uvpjs.DaiRco;break;default:l="Unknown resource type "+a.type,i="VCI createResourceConfig "+l+"; this.vidContId = "+this.vidContId,j=!0}return j?(this.dispatchStartError(i,null),!1):(this.rcoIdIndex++,b=this.rcoIdIndex+"_"+this.vidContId,d=new c(a,b,this.vidContId),h=d.getValidationInfo(),m&&(n=this.checkForAdBlocker())?(h.missingSDK===!0&&(o=k?"IMA":"DAI"),this.dispatchAdBlocked(o,!0),!1):h.error?(i="VCI error initializing RCO: "+h.message,e=uvpjs.ErrorInfo,f=e.errorCodes,h.missingSDK===!0?(g=k?f.IMA_SDK_MISSING:f.DAI_SDK_MISSING,this.dispatchStartError(i,g)):this.dispatchStartError(i,null),!1):(this._replayRco=a,d))},prevalidateRcObj:function(a){var b=uvpjs.util,c="",d=!1;return b.isPlainObject(a)?b.isDefinedString(a.type)||(c="Invalid resource type encountered",d=!0):(c="Invalid resource config object format",d=!0),{error:d,message:c}},dispatchStartError:function(a,b){this.debug&&uvpjs.error(this.DEBUG_ID,a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:b||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+a,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(a,b){var c=a?" (Missing "+a+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+c,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+c,isFatal:!!b})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(a){b.isArray(a)&&a.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:a},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest()},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",a),isNaN(a)||this.CVI_Mgr.seekToRequest(a)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.enableButton(a)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(a){b.isNaN(a)||this.CVI_Mgr.volumeChangeRequest(a)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",a),b.isString(a)&&this.CVI_Mgr.loadCaptionsRequest(a)},showCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},setCaptionsStyle:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",a),this.CVI_Mgr.setCaptionsStyleRequest(a)},setCaptionsStyleProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",a,b),this.CVI_Mgr.setCaptionsStyleRequest([{name:a,value:b}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",a,b),this.CVI_Mgr.setCaptionsCuePropertyRequest(a,b)},setSize:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+a+"  height = "+c),b.isNumber(a)||b.isNumber(c)||this.CVI_Mgr.resizeRequest(a,c)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),!b.isEmpty(a)&&(b.isArray(a)&&a.length>0||uvpjs.util.isDefinedString(a))&&this.CVI_Mgr.setUserGesture(a)},setQosMetadata:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",a),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",c),b.isEmpty(a)||b.isEmpty(c)||!b.isArray(a)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:a,paramsObj:c},this.vidContId))},fullscreen:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.fullscreenRequest(a)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(a){a&&b.isPlainObject(a)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:a},this.vidContId))},removeNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.setNativeControls(a)},useDynamicSwitching:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:a},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(a){return a&&"number"==typeof a?(this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",a),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",a))},switchTo:function(a){var b="up,down",c=null!==a&&void 0!==a&&"string"==typeof a&&b.indexOf(a)!==-1,d=null!==a&&void 0!==a&&"number"==typeof a&&!isNaN(a);return c||d?(this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",a),void(d?this.switchBitrateTo(a):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId))):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",a,c,d,typeof a))},setMinimumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},setMaximumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},pauseAdRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:a||null,height:b||null},this.vidContId)},_dispatchResizeEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:a},this.vidContId)},liveSegmentStart:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)},liveSegmentEnd:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)}})}(uvpjs.register("uvpjs")),function(a){var b=Math.random(),c=a._;a.VideoManager=uvpjs.Class.subClass({init:function(a){return this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance?void console.warn("UVPJS: An instance of VideoManager has already been created."):(uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,void(this.configMgr=null))},destroy:function(){for(var a in this.VCIs)this.destroyVideoPlayer(a);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,uvpjs.VideoManager.destroyInstance()},initialize:function(a,b,c){var d=uvpjs.Configuration,e=uvpjs.VideoManager._instance,f=uvpjs.DebugManager,g=this.validateParams(a,b,c),h=g.message,i=g.isValid;if(!h||(console[i?"warn":"error"](h),!i&&g.errorCb&&g.errorCb(h),i)){if(e){if(e.isInitializing())return void e.addInitCallback(b);if(e.isReady())return void(uvpjs.util.isFunction(b)&&b(this.mc.systemInfo))}console.log([d.name,d.version,d.date].join(" ")),uvpjs.log=f.log.bind(f),uvpjs.warn=f.warn.bind(f),uvpjs.error=f.error.bind(f),f.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!a.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(b),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",a),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(a,this.onCongfigMgrReady.bind(this))}},validateParams:function(a,b,d){var e=uvpjs.util,f=null,g=!1,h="VideoManager.initialize()",i=e.isFunction(d)?d:null;return a&&c.isPlainObject(a)||(f=h+" was invoked with invalid session options.",g=!0),e.isFunction(b)||(f=h+": A success callback function is required.",g=!0),i||(f=h+" did not receive a valid error callback function.",g=!1),{errorCb:i,message:f,isValid:!g}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(a){var b=this.successCallbacks.length;if(uvpjs.util.isFunction(a)){for(;b--;)if(this.successCallbacks[b]===a)return;this.successCallbacks.push(a)}},onCongfigMgrReady:function(a){if(!c.isObject(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=a,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager();var b=new uvpjs.TrackingManager;b.loadAgentPlugins(this.CDO,this.trackingAgentsLoadedCB.bind(this))},checkForForcedHlsjs:function(a){var b,c=a.isModuleEnabled("VideoPlaybackSettings"),d=c&&a.getModuleParam("VideoPlaybackSettings","forceHlsjs"),e="string"==typeof d,f=e&&d.toLowerCase();d&&!uvpjs.util.isEmpty(d)&&(d===!0||1===d||e&&("1"===f||"y"===f||"yes"===f))&&(b=this.mc.canPlayHLSJS(!0),b&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=b)},trackingAgentsLoadedCB:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Tracking agents have loaded; now checking autoplay..."),this.checkAutoplay()},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return this.useNativeAutoplay===!0||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(a,b){if(this.eventsMgr)return a&&c.isString(a)&&c.isFunction(b)?void this.eventsMgr.addEventListener(a,b):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(a){return a&&c.isString(a)?void this.eventsMgr.removeEventListener(a):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS)},getVideoPlayers:function(){var a,b={};for(a in this.VCIs)b[a]=this.VCIs[a];return b},createVideoPlayer:function(a,b,d){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!c.isString(a)||!c.isFunction(b)||d&&!c.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var e=[a,b];d&&e.push(d),this.createMultipleVideoPlayers([e])},destroyVideoPlayer:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),c.isString(a)?c.isEmpty(this.VCIs)||!this.VCIs[a]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+a},this.internalNS),!1):(this.VCIs[a].destroy(),delete this.VCIs[a]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(a){var b,d,e,f,g,h,i,j;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!c.isEmpty(this.VCIs)),!c.isArray(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(f=a.length,e=0;e<f;e++)if(g=a[e],h=g[0],i=g[1],j=g[2],g.length<2||!c.isString(h)||!c.isFunction(i)||!c.isUndefined(j)&&!c.isPlainObject(j))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),e=0;e<f;e++)g=a[e],h=g[0],i=g[1],j=g[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",h),j=this.CDO.getSessionOptions(j),b=this.validateAutoplay(j),this._allowConcurrentPlayback===!1&&b&&(this._disableAutoplay&&(j.enableMutedAutoplay=!1,j.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),d=new uvpjs.VideoControlInterface,this.VCIs[h]=d,d.initialize(h,this.eventsMgr,this.CDO,i,j);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))},validateAutoplay:function(a){var b=a.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),c=!!(a.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||b);return b&&(a.enableMutedAutoplay=!1),c||(a.enableMutedAutoplay=!1,a.enableUnmutedAutoplay=!1),c},overrideSessionOptions:function(a){a&&c.isPlainObject(a)&&this.CDO.overrideSessionOptions(a)},onVideoProgress:function(a){if(!(this._allowConcurrentPlayback||!c.isPlainObject(a)||c.isUndefined(a.target)||c.isUndefined(a.payload)||c.isUndefined(a.payload.playbackState)||a.payload.playbackState!==this.mc.PLAYING)){var b=a.target;c.isEmpty(this.currActiveVCI)&&!c.isUndefined(this.VCIs[b])&&(this.currActiveVCI=this.VCIs[b]),b===this.currActiveVCI.vidContId||c.isUndefined(this.VCIs[b])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",b),this.VCIs[b].pauseVideo())}},onVideoPlaybackInitiated:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",a),!this._allowConcurrentPlayback&&c.isPlainObject(a)&&!c.isUndefined(a.target)){var b=a.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),c.isEmpty(this.VCIs)||c.isUndefined(this.VCIs[b])||this.currActiveVCI&&this.currActiveVCI.vidContId===b||(this.currActiveVCI=this.VCIs[b],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(a){a?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",a.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(a){a?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",a.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),a.VideoManager._instance=null,a.VideoManager.destroyInstance=function(){this._instance=null},a.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(b)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a._;a.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CUE_PSEUDO_CLASS:"::cue",CONFIG_MODULE_NAME:"ClosedCaptions",LOAD_VTT_WAIT:50,BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(a){var b=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,a&&(this._cviModel=a.cviModel,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=d(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=b.getCaptionsLineOffset(),this._lineAlign=b.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=a.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._trackMode="hidden",this._disabled=!1,this.ccDisplayRequested=!1,this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),this._onVideoProgress=this._onVideoProgress.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._trackMode="hidden",this._removeEventListeners()},_finalizeInit:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=a,!this._ccEl&&this._createCaptionsElement()},showCaptions:function(a){return this._deferLoadingCaptions&&!this._hasCaptions()?(this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this))):(this.ccDisplayRequested=!0,this._getActiveTrack()||this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),void this._toggleVisibility(a,"showing"))},hideCaptions:function(a){this.ccDisplayRequested=!1,this._toggleVisibility(a,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:r.clone(this.styles)},setStyles:function(a){var b,c,d,e=this._pageStyles,f=a.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",a);f--;)d=a[f],b=o(d.name),c=d.value,e[b]=c;this._updateStylesObject(e),this._applyStyles()}},setCueProperty:function(a,b){var c;if(!this._disabled){if(c=this._getActiveTrack(),!(a&&b&&c&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",a,b));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",c,a,b),this._props[a]=isNaN(b)?b:Number(b)}},_addEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace,d=this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners",d),a.addEventListener(b.CONTAINER_RESIZE+c,this._onContainerResize.bind(this)),a.addEventListener(b.CONTROL_LOAD_CAPTIONS+c,this._onControlLoadCaptions.bind(this)),a.addEventListener(b.CONTENT_DATA_LOADED+c,this._onContentDataLoaded.bind(this)),a.addEventListener(b.CONTROL_SHOW_CAPTIONS+c,this.showCaptions.bind(this)),a.addEventListener(b.CONTROL_HIDE_CAPTIONS+c,this.hideCaptions.bind(this)),a.addEventListener(b.CONTENT_FACADE_CREATED+c,this._onContentFacadeCreated.bind(this)),a.addEventListener(b.RESOURCE_END+c,this._onVideoComplete.bind(this)),this._addVideoProgressHandler()},_removeEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this._cviModel.contentVideoState.isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),a.removeEventListener(b.CONTAINER_RESIZE+c),a.removeEventListener(b.CONTROL_LOAD_CAPTIONS+c),a.removeEventListener(b.CONTENT_DATA_LOADED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.CONTENT_FACADE_CREATED+c),a.removeEventListener(b.RESOURCE_END+c),this._removeVideoProgressHandler()},_addVideoProgressHandler:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_addVideoProgressHandler"),a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress)},_removeVideoProgressHandler:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeVideoProgressHandler"),a.removeEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress)},_createTrackElement:function(a){var b,c,d=this._videoEl,e=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",a),a.indexOf(window.location.host)===-1&&(this.debug&&uvpjs.log(this.DEBUG_ID,'_createTrackElement adding crossorigin="use-credentials" to <video> element.'),d.setAttribute("crossorigin","use-credentials")),c=document.createElement("track"),c.kind="captions",c.label="English",c.srclang="en",c.id=this._trackId,c.mode=this._trackMode,c.src=a,d.appendChild(c),b=function(){e||(this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement loaded",c),e=!0,this._finalizeCaptions())}.bind(this),c.addEventListener("load",setTimeout(b,this.LOAD_VTT_WAIT)),c.addEventListener("loaded",setTimeout(b,this.LOAD_VTT_WAIT))},_createCaptionsElement:function(){var a=uvpjs.util,b=this._styleEl,c=document.createElement("div"),d=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);return c.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),d?(d.appendChild(c),this._ccEl=c,a.addCSSObject(b,c,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),a.addCSSObject(b,c,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),void a.addCSSObject(b,c,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container."))},_dispatchCaptionsError:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",a),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:a},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(a){a.target===this._containerId&&this._setRect()},_onVideoComplete:function(a){var b,c,d=a.target,e=this._videoEl;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",d),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,e&&e.removeEventListener("loadeddata",this._onLoadedData),e&&e.removeEventListener("timeupdate",this._onTimeUpdate),c=this._getTextTracks(),c&&(c.onaddtrack=null),b=this._getActiveTrack(),i(b)&&(b.mode="disabled",b.oncuechange=null,b.textTrack1&&(b.textTrack1=!1),b.textTrack2&&(b.textTrack2=!1)),this._trackCount++)},_onContentDataLoaded:function(a){var b,c=uvpjs.util,d=a.target,e=a.payload.vidState,f=e.closedCaptionPath,g=e.isLive;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",d),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,b=this._getTextTracks(),b&&(b.onaddtrack=this._onAddTrack),g&&this._addVideoProgressHandler(),this._styleSelector=this._getStyleSelector(),c.isDefinedString(f)&&(this._captionsUrl=f))},_onLoadedData:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",a),this._checkForLiveCaptions()},_onTimeUpdate:function(a){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(a)},_onControlLoadCaptions:function(a){var b;a.target===this._containerId&&(b=a.payload.url,r.isString(b)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",a.target),this._loadCaptionsUrl(b)))},_onContentFacadeCreated:function(a){a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",a.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._removeVideoProgressHandler(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(a){var b=a.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",a);try{b=b.replace(/\n/g,""),b=b.substr(b.indexOf("<?xml"));var c=new DOMParser,d=c.parseFromString(b,"text/xml");this._xmlToCues(d)}catch(a){var e="Error parsing closed captions XML.";this._dispatchCaptionsError(e),this.debug&&uvpjs.error(this.DEBUG_ID,e,a)}},_onLoadError:function(a){var b=a.status,c="Unknown error";switch(b){case 404:c="File not found";break;case 500:c="Server error";break;case 0:c="Request aborted"}c+=" "+b,this._dispatchCaptionsError(c),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",c)},_onAddTrack:function(a){var b=a.track;this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",a),b.id=this._trackId,b.mode=this._trackMode,"captions"===b.kind&&(this._finalizeTrackElement(),this._finalizeLiveCaptions())},_onVideoProgress:function(a){var b;if(a.target===this._containerId){if(!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();var c=this._getActiveTrack();if(c&&c.activeCues&&(b=c.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);b--;)a.payload.currentTime-c.activeCues[b].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!a||!this._liveCaptionsInitalized){try{!a&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(a){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",a),this._dispatchCaptionsError(a)}a&&(this._liveCaptionsInitalized=!0),!!this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){
var a=this._getActiveTrack(),b=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),a&&(a.oncuechange=b)||this._videoEl.addEventListener("timeupdate",b)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var a=r.get(this._captionsJson,"tt.head.styling.style");return a=r.isArray(a)?a[0]:a,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",a),a?void(this._inlineStyles={backgroundColor:a["tts:backgroundColor"],color:a["tts:color"],fontFamily:a["tts:fontFamily"],fontSize:a["tts:fontSize"],fontStyle:a["tts:fontStyle"],fontWeight:a["tts:fontWeight"],textAlign:a["tts:textAlign"],textDecoration:a["tts:textDecoration"]}):void(this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file."))},_applyStyles:function(){var a,b,d,e=uvpjs.util,f=this.styles,g=this._styleSelector,h=[];this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",f);for(b in f){switch(d=f[b],a=!1,b){case"background-opacity":case"font-opacity":a=!0;break;case"text-position":a=!0,this._setPosition(d);break;case"background-color":d=c(d,f["background-opacity"]);break;case"color":case"font-color":b="color",d=c(d,f["font-opacity"]);break;case"text-edge-style":b="text-shadow",d=p(d)}a||(j(b,d)?h.push({name:b,value:d}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",b,d))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",g,h),e.addCSSRules(this._styleEl,g,h)},_updateStylesObject:function(a){var b,c,d;for(b in a){if(c=a[b],!c||!b)return;if(d=o(b),d in this.styles){switch(d){case"font-size":c=e(c)}this.styles[d]=c}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",d)}},_hasCaptions:function(){return i(this._getActiveTrack())},_loadOrDeferCaptions:function(a){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(a)},_loadCaptionsUrl:function(a){var b,c=uvpjs.util.isDefinedString(a),d=c&&".vtt"===a.substr(-4);if(c&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),d)return void this._createTrackElement(a);b=new uvpjs.CodeLoader,b.loadXHR(a,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),this._hasCaptions()?(this._finalizeTrackElement(),void this._finalizeLiveCaptions()):void(this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize."))},_clearAllCaptionTracks:function(){var a=this._ccEl,b=this._getTextTracks(),c=b&&b.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",b);c--;)this._clearCaptionTrack(b[c]);a&&(a.innerHTML="")},_clearCaptionTrack:function(a){var b,c;if(i(a)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",a),b=a&&a.cues,c=b&&b.length||0;c--;)a.removeCue(b[c]);a.cues=null}},_toggleVisibility:function(a,b){this._getActiveTrack(),this._ccEl;a.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",b),this.showCcContainer("hidden"!==b))},showCcContainer:function(a){this._ccEl&&(this._ccEl.style.display=a===!1?"none":"block")},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var a,b,c,d=this._getTextTracks(),e=d&&d.length||0;for(c=0;c<e;c++)if(a=d[c],b=a&&a.cues,b&&b.length&&i(a))return a},enableCaptionsTracks:function(){for(var a,b=this._getTextTracks(),c=b&&b.length||0;c--;)a=b[c],i(a)&&(a.mode="hidden");this._videoEl.webkitClosedCaptionsVisible=!1},_getTrackById:function(a){var b=this._getTextTracks();return b&&b.getTrackById(a||this._trackId)},_getActiveCues:function(){var a=this._getActiveTrack();return a&&a.activeCues},_getAllCues:function(){var a=this._getActiveTrack();return a&&a.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var a,b,c,d=this._cviModel.getModule(this.CONFIG_MODULE_NAME),e={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",d),d?d.enabled!==!0?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):r.isEmpty(d.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(r.each(d.params,function(d){a=d.name,b=d.value,a&&b&&(c=o(a),e[a]=b)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(e,null,2)),void(this._configStyles=e)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(a){var b=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"],c=b.indexOf(a)>-1?a:"bottom-center-floated";this._setPositionCSS(c)},_setPositionCSS:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.util,k=this._styleEl,l=this._ccEl,m=parseInt(this.BASE_CONTROLS_HEIGHT),n=10;k&&l&&(c=a.split("-"),e=c[0],d=c[1],h=parseInt(l.style.marginBottom),i=h>m?n:m-h,f={top:"0",middle:"50%",bottom:"auto"}[e],g={top:"auto",middle:"auto",bottom:i+"px"}[e],b={top:f,bottom:g,"text-align":d,transform:"initial"},"middle"===e&&(b.transform="translateY(-50%)"),j.addCSSObject(k,l,b,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var a=this.styles;a&&this._setPosition(a["text-position"])},_setRect:function(){function a(){r.assign(q.style,k),s&&(r.assign(s.style,k),this._checkBottomPosition())}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this._videoEl,s=this._ccEl,t=q&&q.parentNode;q&&t&&(i=q.videoHeight,j=q.videoWidth,j&&i&&(c=q.getBoundingClientRect(),b=t.getBoundingClientRect(),d=c.height,e=c.width,h=i/j,g=d/e,f=g/h,n=b.height-c.height,m=b.width-c.width,o=f>1||0===m&&0!==n,p=f<1||0!==m&&0===n,k=o?{height:"auto","max-height":"100%",width:"100%",margin:0}:p?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0},k&&a.call(this),c=q.getBoundingClientRect(),b=t.getBoundingClientRect(),n=b.height-c.height,m=b.width-c.width,o?(l=n/2+"px",k={margin:"inherit","margin-top":l,"margin-bottom":l}):p&&(l=m/2+"px",k={margin:"inherit","margin-left":l,"margin-right":l}),s&&(k["font-size"]=this._calculateFontSize(c.width)),k&&a.call(this)))},_calculateFontSize:function(a){var b;try{b=a/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),b=Math.max(b,parseInt(this.MIN_FONT_SIZE))}catch(a){console.error(a)}return b&&b+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(a){var b=a&&a.target,c=b&&b.activeCues||this._getActiveCues();this._setCueProps(c)},_setAllCueProps:function(){var a=this._getAllCues();this._setCueProps(a)},_setCueProps:function(a){this._addCuesToCaptionsElement(a)},_xmlToCues:function(a){var b,c,d,e,h,i,j,k,m,n,o,p=q(a);if(this._captionsJson=p,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",p),!r.isEmpty(p)&&r.isPlainObject(p)){if(c=r.get(p,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",c),r.isUndefined(c)||r.isEmpty(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(b=this._supportsVTTCue?window.VTTCue:window.TextTrackCue,!b)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for(h=this._videoEl.addTextTrack("captions","English","en"),h.id=this._trackId,n=c.length,k=0;k<n;k++)if(m=k+1,j=c[k],e=c[m],i=j.text,!r.isEmpty(i)){for(i=i.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3"),i=i.replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3"),i=i.replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),o=f(i),j._lineCountPrev=j._lineCountPrev||0,j._lineCountNext=j._lineCountNext||0;(e&&e.begin)===j.begin;)e._lineCountPrev=o+j._lineCountNext,j._lineCountNext+=f(e.text),e=c[++m];d=new b(g(j.begin),g(j.end),i),d._lineCount=o,d._lineCountPrev=j._lineCountPrev,d._lineCountNext=j._lineCountNext,d._metadata=j.metadata,d=l.call(this,d),h.addCue(d)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(a){var b,c,d,e=uvpjs.util,f=this._ccEl,g='<div class="{{cntrClass}}">{{spans}}</div>',h="",i=a&&a.length;if(i){for(b=0;b<i;b++)c=a[b],d=c.text,e.isDefinedString(d)&&(d=d.replace(/(\r\n|\n|\r)/g,"<br/>"),h+='<span class="{{txtClass}}">'+d+"</span>",b+1!==i&&(h+="<br/>"));g=g.replace("{{spans}}",h),g=g.replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME),g=g.replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),f&&(f.innerHTML=g)}}}),b=function(a){return a.indexOf("rgba")>-1?a.split(",")[3].replace(")",""):1},c=function(a,b){var c=m(a)||h(a)||h(k(a));return c&&b?n(c.r,c.g,c.b,b):a},d=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},e=function(a){var b="100%";return a.indexOf("px")>-1?(b=a.replace("px",""),b/=18,b=100*b+"%"):a.indexOf("%")>-1&&(b=a),b},f=function(a){return a&&(a.match(/\n/g)||[]).length+1},g=function(a){var b,c,d,e,f,g;if(!r.isNull(a)&&!r.isUndefined(a))return g=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},f=a.split(":"),b=60*Number(f[0])*60,c=60*Number(f[1]),d=Number(f[2]),e=b+c+d,g(e,2)},h=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},i=function(a){return a instanceof window.TextTrack&&"captions"===a.kind},j=function(a,b){if(a&&b)return r.get(window,"CSS.supports")?window.CSS.supports(a,b):"string"==typeof document.createElement("div").style[a]},l=function(a){var b,c=a._metadata;return c&&(a.snapToLines=!0,b=Math.round(c.cccol/35*100),a.position=b,a.align=b<45?"start":b>55?"end":this._lineAlign,a.positionAlign=b<45?"line-left":b>55?"line-right":"center",a.line=c.ccrow-17+this._lineOffset,a._defaults={line:a.line,position:a.position,align:a.align,positionAlign:a.positionAlign}),a},k=function(a){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[a.toLowerCase()]},m=function(a){var b;if(a.indexOf("rgba")!==-1)return b=a.substr(5,a.length).split(","),{r:b[0],g:b[1],b:b[2]}},o=function(a){if(r.isString(a)&&!r.isEmpty(a))return a.replace(/([A-Z])/g,"-$1").toLowerCase()},n=function(a,b,c,d){return"rgba("+[a,b,c,d].join(",")+")"},p=function(a){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[a]||"none"},q=function(a){var b={};if(1===a.nodeType&&a.attributes.length>0)for(var c=0,d=a.attributes.length;c<d;c++){var e=a.attributes.item(c);b[e.nodeName]=e.nodeValue}else 3===a.nodeType&&(b=a.nodeValue);if("p"===a.nodeName&&(b.text="",r.each(a.childNodes,function(a){if("metadata"!==a.nodeName){var c=(new XMLSerializer).serializeToString(a);1===a.nodeType&&(b.text+="br"===a.tagName?"\n":c),3===a.nodeType&&(b.text+=c)}})),a.hasChildNodes())for(var f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes.item(f),i=h.nodeName;if("undefined"!=typeof b[i]){if("undefined"==typeof b[i].push){var j=b[i];b[i]=[],b[i].push(j)}b[i].push(q(h))}else b[i]=q(h)}return b}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.ConfigDataObject=uvpjs.Class.subClass({debug:!0,sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",maxDynamicSwitchingIndex:"",minDynamicSwitchingIndex:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(a)},initialize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",a),this.overrideSessionOptions(a)},destroy:function(){this.modules=null,this.classes=null},overrideSessionOptions:function(a){var c=this.getSessionOptions(a);return c&&b.isPlainObject(c)?void(this.sessionOptions=c):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type."))},getSessionOption:function(a){return this.sessionOptions[a]||null},getSessionOptions:function(a){var c,d,e;if(c=b.clone(this.sessionOptions),!a||!b.isPlainObject(a))return c;if(d=a.skinConfig,d&&!b.isEmpty(d)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object.");for(e in d)c.hasOwnProperty(e)&&(c[e]=d[e])}for(e in c)a.hasOwnProperty(e)&&(c[e]=a[e]);return c},getModule:function(a){return d(this.modules,a)},getModules:function(){return this.modules},getModuleParam:function(a,b){var c=d(this.modules,a),e=d(c.params,b);if(e&&e.hasOwnProperty("value"))return e.value},setModule:function(a){g(this.modules,a,"name",this.DEBUG_ID)},isModuleEnabled:function(a){var b=this.getModule(a);if(!b){var c="ConfigDataObject isModuleEnabled module not found: "+a;return this.debug&&uvpjs.log(this.DEBUG_ID,c),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+a+":",b.enabled),b.enabled},isModuleSet:function(a){return!!this.getModule(a)},getClass:function(a){return d(this.classes,a)},getClasses:function(){return this.classes},getClassProperty:function(a,b){var c=d(this.classes,a),e=f.call(this,c,"properties",this.DEBUG_ID),g=d(e,b);return f.call(this,g,"value",this.DEBUG_ID)},getClassListItems:function(a){var b=d(this.classes,a);return f.call(this,b,"list",this.DEBUG_ID)},getClassListItemProperty:function(a,b,c){var g=this.getClassListItems(a),h=e(g,b),i=f.call(this,h,"properties",this.DEBUG_ID),j=d(i,c);return f.call(this,j,"value",this.DEBUG_ID)},setClass:function(a){g(this.classes,a,"name",this.DEBUG_ID)},isCAN:function(){return b.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()}});var c=function(a,b,c){for(var d in a)if(a[d][b]==c)return a[d];return!1},d=function(a,b){return c(a,"name",b)},e=function(a,b){return c(a,"id",b)},f=function(a,b,c){return a?a.hasOwnProperty(b)?a[b]:(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty no item property:",a,b),!1):(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty item not found:",a),!1)},g=function(a,b,c,d){for(var e in a)if(a[e][c]==b[c])return this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray updating existing item",b),void(a[e]=b);this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray creating item",b),a.push(b)}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.ConfigManager=uvpjs.Class.subClass({init:function(a,b,d){return this.debug=uvpjs.debug,a&&a===c?(this.initCallback=d,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",b),this.CDO=new uvpjs.ConfigDataObject(b),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.CDO.isCAN()&&this.configSources.push(uvpjs.ConfigManager.CAN_CONFIG_PATH),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),void this.loadConfig()):void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance()."))},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(!this.configSources.length)return void(b.isFunction(this.initCallback)&&this.initCallback(this.CDO));var a=this.configSources.shift();if(null!==a&&void 0!==a)switch(a.constructor){case String:if(""===a)break;var c=new uvpjs.CodeLoader;return void c.loadXHR(a,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=a.concat(this.configSources);break;case Object:this.updateCDO(a)}this.loadConfig()},onLoadComplete:function(a){var b,c,d,e=a.responseText,f=a.getResponseHeader("Content-Type");f.indexOf("application/json")>-1?d=JSON.parse(e):f.indexOf("text/xml")>-1||f.indexOf("application/xml")>-1?(b=new DOMParser,c=b.parseFromString(e,"text/xml"),d=this.xmlToCDO(c)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",f),d&&this.updateCDO(d),this.loadConfig()},onLoadError:function(a){var b="unknown error";switch(a.status){case 0:b="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",b,a),this.loadConfig()},updateCDO:function(a){return b.isEmpty(a)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty")):void["classes","modules"].map(function(b){a.hasOwnProperty(b)&&(this.CDO[b]=d(this.CDO[b],a[b]))},this)},xmlToCDO:function(a){var b={},c=function(a){return"y"===a||"n"===a},d=function(a){return"y"===a},g=e(a);return g.hasOwnProperty("player-config")&&(g=g["player-config"]),b.modules=function(){var a,b=[];if(g.modules){a=f(g.modules.module);for(var e in a){var h=a[e],i={name:h.name,category:h.category,enabled:d(h.enabled),params:[]};if(a[e].hasOwnProperty("params")){var j=f(h.params.param);for(var k in j){var l=j[k];l.name&&(c(l.value)&&(l.value=d(l.value)),i.params.push(l))}}h.category||"unknown";b.push(i)}return b}}(b),b.classes=function(){var a=f(g.classes),b=[];for(var c in a){var d=a[c];if(d.hasOwnProperty("classDef")&&(d=d.classDef),d.name){var e={name:d.name,className:d.className,properties:[],list:[]};if(d.hasOwnProperty("list")){var h=f(d.list.listitem);for(var i in h){var j=h[i];j.id&&(j.hasOwnProperty("properties")&&(j.properties=j.properties.property),e.list.push(j))}}d.hasOwnProperty("properties")&&(e.properties=d.properties.property),b.push(e)}}return b}(),b},getCDO:function(){return this.CDO}}),a.ConfigManager.CAN_CONFIG_PATH="//can.cbs.com/thunder/player/chrome/smart_tag/config.php?url=http://can.cbs.com/thunder/player/chromeless/uvp/can.xml",a.ConfigManager._instance=null,a.ConfigManager.destroyInstance=function(){this._instance=null},a.ConfigManager.getInstance=function(a,b){return this._instance||(this._instance=new uvpjs.ConfigManager(c,a,b)),this._instance};var d=function(a,b){for(var c in b){var d=!1;for(var e in a)if(a[e].name===b[c].name){d=!0;break}d||a.push(b[c])}return a},e=function(a){var b,c={};if(1===a.nodeType&&a.attributes.length>0){b=a.attributes.length;for(var d=0;d<b;d++){var f=a.attributes.item(d);c[f.nodeName]=f.nodeValue}}if(a.hasChildNodes()){b=a.childNodes.length;for(var g=0;g<b;g++){var h=a.childNodes.item(g),i=h.nodeName;if(3!==h.nodeType)if("undefined"!=typeof c[i]){if("undefined"==typeof c[i].push){var j=c[i];c[i]=[],c[i].push(j)}c[i].push(e(h))}else c[i]=e(h)}}return c},f=function(a){if("undefined"!=typeof a&&a.constructor!==String)return a.constructor===Object&&(a=[a]),a}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=null,c=null,d=a._;a.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.hasPlaybackStarted=!1},initialize:function(a){var d=a.resourceProvider,e=d.vidContId;this.resourceProvider=d,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=e,this.assetURL=a.assetURL,this.vidContentId=this.PREFIX_CONTENT+e,this.internalNS="."+e+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+e),this.deferLoadingCaptions=a.deferLoadingCaptions,this._updateVolumeSettings(a),d.createWatermark()&&!a.suppressWatermark&&(b=new uvpjs.Watermark({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),d.is360()&&!a.suppress360&&(c=new uvpjs.Kaleidoscope360({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),a.suppressCreatedEvent!==!0&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){return d.isEmpty(this.resourceProvider)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed.")):(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),b&&(b.destroy(),b=null),c&&(c.destroy(),c=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,void(this.hasPlaybackStarted=!1))},_updateVolumeSettings:function(a){var a=a||{},b=a.volume,c=a.isMuted===!0,d=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",a),uvpjs.util.inRange(b,0,1)&&d.volume!==b&&(d.volume=b),"isMuted"in a&&d.muted!==c&&this.muteVideo(c)},_addHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.addEventListener(b[a],this,!1);this.videoTagRef.addEventListener(b[c],this,!1)},_removeHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.removeEventListener(b[a],this,!1);this.videoTagRef.removeEventListener(b[c],this,!1)},handleEvent:function(a){var b=this.eventTypes.HTML5;if(this.videoTagRef)switch(a.type){case b.ABORT:break;case b.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(b.CAN_PLAY,this,!1);break;case b.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(b.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.CLICK:break;case b.DURATION_CHANGE:break;case b.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case b.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case b.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(a.target.error);break;case b.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case b.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case b.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case b.PLAY:break;case b.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case b.PROGRESS:this.videoLoading();break;case b.RATE_CHANGE:break;case b.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",a);break;case b.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",a),this.seeked(a.target.currentTime);break;case b.STALLED:break;case b.SUSPEND:break;case b.TIME_UPDATE:this.timeUpdated();break;case b.VOL_CHANGE:this.volumeChanged();break;case b.WAITING:}},seeked:function(a){var b=this.videoTagRef.paused,c=uvpjs.mediaCapabilities;this.playbackStateChange(b?c.PAUSED:c.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:a,paused:b,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:a})},videoLoading:function(){var a;try{a=this.videoTagRef.buffered.end(0)||0}catch(b){a=0}var b={bufferLength:a,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(b)},volumeChanged:function(){var a=this.videoTagRef.volume;!d.isNumber(a)||a<0?a=0:a>1&&(a=1),this.resourceProvider.facadeVolumeChange(a)},timeUpdated:function(){var a=this.videoTagRef.currentTime;"number"==typeof a&&this.resourceProvider.facadeTimeUpdate(a)},error:function(a){var b=uvpjs.ErrorInfo.messages,c=uvpjs.ErrorInfo.errorCodes,e=b.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,f=c.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,g=!0;if(a)switch(a.code){case a.MEDIA_ERR_ABORTED:g=!1,e=b.MEDIA_ERR_ABORTED,f=c.MEDIA_ERR_ABORTED;break;case a.MEDIA_ERR_NETWORK:e=b.MEDIA_ERR_NETWORK,f=c.MEDIA_ERR_NETWORK;break;case a.MEDIA_ERR_DECODE:e=b.MEDIA_ERR_DECODE,f=c.MEDIA_ERR_DECODE;break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:e=b.MEDIA_ERR_SRC_NOT_SUPPORTED,f=c.MEDIA_ERR_SRC_NOT_SUPPORTED}return this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+e),d.isEmpty(this.resourceProvider)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return.")):void this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:f,message:e,isFatal:g}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var a;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),a=this.videoTagRef.play(),void 0!==a&&a.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+a.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(a.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",a),isNaN(a)||this.videoTagRef&&a>=0&&a<this.videoTagRef.duration&&(this.videoTagRef.currentTime=a)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var a=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(a)&&a>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=a)}},toggleMute:function(){var a;this.videoTagRef&&(a=!this.videoTagRef.muted,this.muteVideo(a))},setFullscreenState:function(a){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(a){var b=a!==!1;this.videoTagRef&&(this.videoTagRef.muted=b,b&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!b&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(a){this.videoTagRef&&a>=0&&a<=1&&(this.videoTagRef.volume=a)},getDuration:function(){var a=0;return this.videoTagRef&&(a=this.videoTagRef.duration,a===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(a=this.videoTagRef.seekable.end(0))),a},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(a){(!this.isAbrStreamingSupported()||"boolean"!=typeof a)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),
-1},setMaxBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(a,b,c){var d=0,e=0,f=a.length-1;if(c)for(;e<f;){if(b<=a[e].bitrate){d=e;break}e++}else for(e=f;e>0;){if(b>=a[e].bitrate){d=e;break}e--}return d},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(a,b){},getBuffered:function(){var a,b=this.videoTagRef,c=b&&b.buffered&&b.buffered.length,d=0,e=0;return c&&(d=c.start&&c.start(0),e=c.end&&c.end(0)),a=e-d,a>0&&a||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(a){if(this.videoTagRef){var b=this.videoTagRef.hasAttribute(this.CONTROLS);a&&!b?this.videoTagRef.setAttribute("controls",this.CONTROLS):!a&&b&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(a){if(a!==this.playbackState){if(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+a),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(a)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var a=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!d.isUndefined(a),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,a=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",a),a}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b="www.nielsen.com";a.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(a){for(var b in a)this.initOptions[b]=a[b];a.suppress360=!0,a.suppressCreatedEvent=!0,this._super(a),this.swfService=a.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.dispatchCreated()},destroy:function(){var a;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(a){this.player&&this.player.setVolume(a)},seekTo:function(a){this.player&&this.player.seekTo(a)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(a){this.swfService.resetSize()},loadCaptions:function(a){this.captionsUrl=uvpjs.util.isEmpty(a)?null:a,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(a)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(a){for(var b,c,d,e=Array.isArray(a)&&a.length||0,f=uvpjs.util,g=uvpjs.VPF_Flash.styleTransform;e--;)b=a[e],c=this.dashToCamel(b.name),d=g[c]?g[c](b.value):b.value,!f.isEmpty(b.value)&&this.player.setStyleAttribute(c,d)},setId3Options:function(a){this.id3Options=a},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(a){var b=a===!1?"false":"true";this.player.enableDynamicStreaming(b)},switchToBitrate:function(a){var b=this.findClosestBitrate(a);b.index!==-1&&this.player.switchStreamingIndex(b.index)},setMinBitrateAllowed:function(a){var b=this.findClosestBitrate(a);b.index!==-1&&(this.bitrateInfo.min=b.bitrate,this.player.setMinimumStreamingIndex(b.index))},setMaxBitrateAllowed:function(a){var b=this.findClosestBitrate(a);b.index!==-1&&(this.bitrateInfo.max=b.bitrate,this.player.setMaximumStreamingIndex(b.index))},switchUp:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a),c=b.index!==-1&&this.bitrateInfo.bitrates.length;b.index!==-1&&b.index<c-1&&this.player.switchStreamingIndex(b.index+1)},switchDown:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a);b.index!==-1&&b.index>0&&this.player.switchStreamingIndex(b.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var a=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return a?this.bitrateInfo.bitrates[a-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(a){for(var b,c=this.bitrateInfo.bitrates,d=c?c.length:0,e={bitrate:0,delta:1/0,index:-1};d--;)b=Math.abs(a-c[d]),b<e.delta&&(e.bitrate=c[d],e.index=d,e.delta=b);return e},hContentEvent:function(a){var b=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(a){case b.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case b.CONTENT_END:}},hPlaybackEvent:function(a,b){var c,d=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(a){case d.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+b);break;case d.VIDEO_PROGRESS:this.processCvioPayload(b);break;case d.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(b);break;case d.VIDEO_ERROR:this.processCvioPayload(b),this.dispatchError();break;case d.VIDEO_DONE:this.processCvioPayload(b),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case d.VIDEO_TRANSITION_COMPLETE:c=this.parsePayload(b),this.resourceProvider.facadeVideoTransitionComplete(c.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case d.VIDEO_TRANSITION_START:c=this.parsePayload(b),this.pendingSwitchMode=c.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(c.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(a){var b,c,d=this.parsePayload(a,"ContentVIO");if(d){c=d.ContentVIO;for(b in c)this.currFlashVideoState[b]=this.getCvioValue(c[b]);null===this.bitrateInfo.bitrates&&c.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var a=[],b=[],c=this.player.getContentBitrateInfo(),d="string"==typeof c&&c.split(","),e=Array.isArray(d)?d.length:0;e--;)a[e]=+d[e],b[e]={bitrate:+d[e]};this.bitrateInfo.bitrates=a,this.bitrateInfo.abrInfo=b},processCuepointPayload:function(a){var c=this.parsePayload(a,"Cuepoint"),d=this.id3Options,e={pts:null};!c||!d.dataCallback||c.text.indexOf("syncbak.cc")>=0||(e.name=d.findNielsen&&c.text.indexOf(b)>-1?b:c.name,e.data=c.text,d.dataCallback(e))},getCvioValue:function(a){var b,c,d,e,f;return"boolean"==typeof a||"number"==typeof a?a:"string"==typeof a?(b="NaN"===a||"null"===a||""===a,c=!b&&"true"===a.toLowerCase(),d=!b&&!c&&"false"===a.toLowerCase(),e=!b&&!c&&!d&&parseInt(a),f=isNaN(e)?a:e,b?-1:!!c||!d&&f):void 0},parsePayload:function(a,b){var c=null;if(0===a.indexOf("{")||0===a.indexOf("[")){try{c=JSON.parse(a)}catch(a){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+b+"as JSON; "+a.message),null}return c}return a},addUvpFlashEventListeners:function(){var a,b,c,d,e,f=uvpjs.VPF_Flash.uvpFlashEvent,g={},h=function(a,b,c){var d=b.charAt(0).toUpperCase()+b.substr(1);return a["h"+d+"Event"].bind(a,c)};for(c in f){b=f[c];for(e in b)d=b[e],g[d]=h(this,c,d)}a=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(g);for(c in a)this.player.addEventJSCallback(c,a[c])},loadVideo:function(){var a={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(a.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,a)},initializeCaptionStyles:function(){var a,b={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(a in b)this.player.setStyleAttribute(a,b[a])},dashToCamel:function(a){return a.replace(/(-\w)/g,function(a){return a[1].toUpperCase()})}}),a.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},a.VPF_Flash.styleTransform={_opacity:function(a){return 100*+a},backgroundOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontSize:function(a){var b=a.substr(0,a.indexOf("%")),c=.01*+b;return Math.round(14*c)}}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(a){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",a.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",a)),this._super(a),a.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:a.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(a.startTime)&&(this.startTime=Math.floor(a.startTime)),this.addEvents(),this.setSource(),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",a)},handleEvent:function(a){var b=this.eventTypes.HTML5;this.videoTagRef&&(this._super(a),a.type===b.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(a,b){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:b,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(a){console.log("Error caught at setSource: ",a)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(a.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),a.track.mode="hidden",this.activeMetadataTrack=a.track)},onCueChange:function(a){a&&a.target&&a.target.activeCues&&a.target.activeCues.length>=1&&this.resourceProvider.facadeId3Data(a.target.activeCues)},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(a){if(b.isEmpty(this.resourceProvider)||b.isEmpty(this.resourceProvider.cviModel))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",a));var c=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",a,c)}})}(uvpjs.register("uvpjs")),function(a){a.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"production"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isLiveStreamKnown=!1,this._isHdStreamLive=!1,this._isPlayingLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:function(a,b){this.withCredentials=this.withCredentials||b.indexOf("akamaihd")>-1&&b.indexOf("csmil")>-1,this.debug&&this.withCredentials&&uvpjs.log(this.FRAG_DEBUG_ID,"init xhrSetup withCredentials",this.withCredentials),a.withCredentials=this.withCredentials,b.indexOf(".m3u8")!==-1&&a.addEventListener("readystatechange",function(){a.readyState===XMLHttpRequest.DONE&&200===a.status&&(this._isHdStreamLive=a.responseText.indexOf("STREAM-INF")===-1&&a.responseText.indexOf("EXT-X-ENDLIST")===-1,!this._isLiveStreamKnown&&this._isHdStreamLive&&(this._isPlayingLive=!0,this._isLiveStreamKnown=!0))}.bind(this))}.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy"),this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null},initialize:function(a){this._super(a),this.id3HandlingEnabled=a.enableId3Handling,"number"==typeof a.liveSyncDurationCount&&a.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=a.liveSyncDurationCount),a.capLevelToPlayerSize===!0&&(this.libConfig.capLevelToPlayerSize=a.capLevelToPlayerSize),uvpjs.util.isEmpty(a.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=a.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof a.startBitrate&&a.startBitrate>-1&&(this.startBitrate=a.startBitrate),"number"==typeof a.maxBitrate&&a.maxBitrate>-1&&(this.maxBitrate=a.maxBitrate),"number"==typeof a.minBitrate&&a.minBitrate>-1&&(this.minBitrate=a.minBitrate),a.startTime&&(this.startTime=Math.round(a.startTime)),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef)},seekToLive:function(){var a=this.player,b=this.player.liveSyncPosition,c=this.isHDStreamLive();c&&a&&b?this.seekTo(b):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+c)},seekTo:function(a){var b=this.player,c=this.player.liveSyncPosition,d=this.isHDStreamLive();this._isPlayingLive=b&&d&&c&&a===c,this._super(a)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(a){this._super(),this.player?this.player.nextLevel=a?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(a){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,a,!1))},switchToIndex:function(a){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var b=this.player.autoLevelCapping!==-1?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,c=isNaN(b)?this.bitrateList.length-1:b;a>=0&&a<=c?this.player.nextLevel=a:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",c," : Index=",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},getStartBitrate:function(){var a=this.player;return this.startBitrate||this.minBitrate||a&&a.levels&&a.levels[0]&&a.levels[0].bitrate||-1},setStartBitrate:function(a){this.player?(a<this.getMinBitrateAllowed()&&(a=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,a,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var a=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(a){if(this.player){this.player.config.minAutoBitrate=a-1;var b=this.getIndexForBitrate(this.bitrateList,a,!0);this.player.currentLevel<b&&(this.player.nextAutoLevel=b),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var a=this.player.maxAutoLevel;return void 0!==a?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(a){return this.player?(this.player.autoLevelCapping=a===-1?a:this.getIndexForBitrate(this.bitrateList,a,!1),void uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",a)):(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super())},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var a=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(a=this.bitrateList[this.player.currentLevel].bitrate),a},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var a,b,c,d=this.player;if(d)return a=this.player.media,b=a.getVideoPlaybackQuality,b&&"function"==typeof b?b.call(a).droppedVideoFrames:(c=a.webkitDroppedFrameCount,c?c:0)},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var a=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,b=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(b,a)},getFacadeState:function(){var a={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(a.player=this.player,a.abrInfo=this.bitrateList,a.currentAbr=this.bitrateList[this.player.currentLevel],a.cappedAbrInfo=this.getCappedAbrInfo(),a.startBitrate=this.getStartBitrate(),a.currentBitrate=this.getCurrentBitrate(),a.minBitrate=this.getMinBitrateAllowed(),a.maxBitrate=this.getMaxBitrateAllowed()),a},getStreamType:function(){return"HLS"},isPlayingLive:function(){return this._isPlayingLive},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onFragmentEvent;this.player.on(a.MEDIA_ATTACHING,b,!1),this.player.on(a.MEDIA_ATTACHED,b,!1),this.player.on(a.MEDIA_DETACHING,b,!1),this.player.on(a.MANIFEST_PARSED,b,!1),this.player.on(a.MANIFEST_LOADED,b,!1),this.player.on(a.MANIFEST_LOADING,b,!1),this.player.on(a.FPS_DROP,b,!1),this.player.on(a.LEVEL_SWITCHING,c,!1),this.player.on(a.LEVEL_SWITCHED,c,!1),this.player.on(a.LEVEL_LOADING,c,!1),this.player.on(a.LEVEL_LOADED,c,!1),this.player.on(a.LEVEL_UPDATED,c,!1),this.player.on(a.LEVEL_PTS_UPDATED,c,!1),this.player.on(a.FRAG_LOADING,d,!1),this.player.on(a.FRAG_LOAD_PROGRESS,d,!1),this.player.on(a.FRAG_LOADED,d,!1),this.player.on(a.FRAG_PARSED,d,!1),this.player.on(a.FRAG_BUFFERED,d,!1),this.player.on(a.FRAG_CHANGED,d,!1),this.player.on(a.FRAG_PARSING_DATA,d,!1),this.id3HandlingEnabled&&this.player.on(a.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(a.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onFragmentEvent;this.player.off(a.MEDIA_ATTACHING,b),this.player.off(a.MEDIA_ATTACHED,b),this.player.off(a.MEDIA_DETACHING,b),this.player.off(a.MANIFEST_PARSED,b),this.player.off(a.MANIFEST_LOADED,b),this.player.off(a.MANIFEST_LOADING,b),this.player.off(a.FPS_DROP,b),this.player.off(a.LEVEL_SWITCHING,c),this.player.off(a.LEVEL_SWITCHED,c),this.player.off(a.LEVEL_LOADING,c),this.player.off(a.LEVEL_LOADED,c),this.player.off(a.LEVEL_UPDATED,c),this.player.off(a.LEVEL_PTS_UPDATED,c),this.player.off(a.FRAG_LOADING,d),this.player.off(a.FRAG_LOAD_PROGRESS,d),this.player.off(a.FRAG_LOADED,d),this.player.off(a.FRAG_PARSED,d),this.player.off(a.FRAG_BUFFERED,d),this.player.off(a.FRAG_CHANGED,d),this.player.off(a.FRAG_PARSING_DATA,d),this.id3HandlingEnabled&&this.player.off(a.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(a.ERROR,this.onError)},handleManifestData:function(a){this.bitrateList=this.player.levels;for(var b,c=a.levels,d=c.length,e=[];d--;)b=c[d],e.unshift({name:b.name||null,rate:b.bitrate,width:b.width,height:b.height});e.sort(function(a,b){var c=a.rate,d=b.rate;return c<d?-1:c>d?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:e})},onLibraryEvent:function(a,b){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.MEDIA_ATTACHING:case c.MEDIA_ATTACHED:case c.MEDIA_DETACHING:case c.MANIFEST_LOADING:break;case c.MANIFEST_PARSED:this.handleManifestData(b);break;case c.FPS_DROP:break;case c.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime)}},onLevelEvent:function(a,b){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(b.details);break;case c.LEVEL_LOADING:case c.LEVEL_UPDATED:case c.LEVEL_PTS_UPDATED:break;case c.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[b.level].bitrate);break;case c.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[b.level].bitrate)}},onFragmentEvent:function(a,b){var c,d,e=Hls.Events;switch(a){case e.FRAG_LOAD_PROGRESS:break;case e.FRAG_PARSING_DATA:"video"===b.type&&(this._playbackFramerate=b.nb/(b.endPTS-b.startPTS));break;case e.FRAG_LOADED:d=b.stats,c=8e3*d.loaded/Number(window.performance.now()-d.trequest),this._currentBandwidth=c,this._currentMaxBandwidth=Math.max(c,this._currentMaxBandwidth);break;case e.FRAG_CHANGED:}},onID3Event:function(a,b){this.resourceProvider.facadeId3Data(b.samples)},onError:function(a,b){var c=(uvpjs.ErrorInfo,Hls.ErrorDetails),d=Hls.ErrorTypes,e=b.details||"Details N/A.",f=b.fatal,g=b.type,h=!1,i=[c.MANIFEST_LOAD_ERROR,c.MANIFEST_PARSING_ERROR];if(this.debug&&uvpjs.error(this.LEVEL_DEBUG_ID,a,g,e,f),f)switch(g){case d.NETWORK_ERROR:i.indexOf(e)===-1&&(h=!0,this.player.startLoad(this.startTime));break;case d.MEDIA_ERROR:}else e===c.BUFFER_APPENDING_ERROR&&this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Handling Firefox buffer appending error."),h=!0,this.player.recoverMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100));h||this.resourceProvider.facadeError(this._getErrorInfoForType(g,e,f))},_getErrorInfoForType:function(a,b,c){var d=uvpjs.ErrorInfo,e=Hls.ErrorTypes,f=uvpjs.ErrorInfo.errorCodes;switch(a){case e.NETWORK_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_NETWORK_ERROR,message:d.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",b),isFatal:c});case e.MEDIA_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MEDIA_ERROR,message:d.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",b),isFatal:c});case e.MUX_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MUX_ERROR,message:d.messages.HLSJS_MUX_ERROR.replace("{INFO}",b),isFatal:c});case e.OTHER_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_OTHER_ERROR,message:d.messages.HLSJS_OTHER_ERROR.replace("{INFO}",b),isFatal:c})}}})}(uvpjs.register("uvpjs")),function(a){"use strict";function b(a){if(!isNaN(a))return a<1048576?(a/1024).toFixed(2)+"k":a<1073741824?(a/1048576).toFixed(2)+"M":(a/1073741824).toFixed(2)+"G"}a.Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(a){var b,c=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),a&&(b=a.videoEl,this._videoEl=b,this._containerEl=a.containerEl,this._eventsMgr=a.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":c.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),this._diagEl&&this._contentEl?(this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,void(this._params=null)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window."))},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=a,this._createDiag(),this._addEventListeners()},_createDiag:function(){var a,b,c,d=uvpjs.util,e=this._styleEl,f=this._contentEl;this._template,this._params;f&&(a=document.createElement("div"),a.id=this._diagnosticId,f.insertBefore(a,f.firstChild),c=uvpjs.util.htmlToElement("<span>x</span>"),c.addEventListener("click",this._handleCloseButton.bind(this),!0),a.appendChild(c),b=document.createElement("table"),a.appendChild(b),d.addCSSObject(e,a,{
background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),d.addCSSObject(e,a,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),d.addCSSObject(e,a,{color:"#fff"},"span:hover"),d.addCSSObject(e,a,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),d.addCSSObject(e,a,{background:"transparent"},"table td"),d.addCSSObject(e,a,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),d.addCSSObject(e,a,{width:"60px"},"table td:last-child"),this._diagEl=a,this._diagTableEl=b,this._hideDiagBtn=c)},_removeDiag:function(){var a=this._diagEl,b=this._hideDiagBtn;b&&b.removeEventListener("click",this._handleCloseButton.bind(this)),a&&a.remove()},_hideDiag:function(){var a=this._diagEl,b=this._eventsMgr;a&&(a.style.display="none"),b.dispatchEvent(b.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var a=this._diagEl;a&&(a.style.display="block")},_toggleDiag:function(){var a=this._diagEl;if(a)return"block"===a.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var a=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),a.dispatchEvent(a.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;return b&&a?(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),b.addEventListener(c.VIDEO_PROGRESS+a,this._onVideoProgress.bind(this)),b.addEventListener(c.VIDEO_STATE_CHANGE+a,this._onVideoStateChange.bind(this)),b.addEventListener(c.VIDEO_TRANSITION_START+a,this._onVideoTransitionStart.bind(this)),void b.addEventListener(c.VIDEO_TRANSITION_COMPLETE+a,this._onVideoTransitionComplete.bind(this))):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners."))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;return b&&a?(b.removeEventListener(c.VIDEO_PROGRESS+a),b.removeEventListener(c.VIDEO_STATE_CHANGE+a),b.removeEventListener(c.VIDEO_TRANSITION_START+a),void b.removeEventListener(c.VIDEO_TRANSITION_COMPLETE+a)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners."))},_updateTableHtml:function(){var a,b,c="",d=this._params;for(a in d)b=d[a],null!==b&&void 0!==b&&(c+="<tr><td>"+a+"</td><td>"+b+"</td></tr>");this._diagTableEl.innerHTML=c},_onVideoProgress:function(a){var c=a.payload,d=c.facadeState,e=this._params,f=d.minABRLevel,g=d.maxABRLevel;a.target===this._containerId&&(e["stream type"]=c.streamType,e.duration=c.duration,e["current time"]=c.currentTime.toFixed(2),e["buffer length"]=c.bufferLength.toFixed(2),e["total dropped frames"]=c.droppedFrames>=0&&c.droppedFrames||null,e["average dropped (fps)"]=c.averageDroppedFPS>=0&&c.averageDroppedFPS.toFixed(2)||null,e["playback framerate (fps)"]=c.playbackFramerate>=0&&c.playbackFramerate.toFixed(2)||null,e["current bandwidth (B/s)"]=c.currentBandwidth>=0&&b(c.currentBandwidth)||null,e["switching mode"]=c.switchingMode,e["current index bitrate (B/s)"]=b(d.currentAbr&&d.currentAbr.bitrate),e["start index bitrate (B/s)"]=b(d.startBitrate),void 0!==f&&void 0!==g&&(e["available indexes"]=f+" to "+g),this._updateTableHtml())},_onVideoStateChange:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(c["playback state"]=b.newState,this._updateTableHtml())},_onVideoTransitionStart:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",b),c["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",b),c["transition state"]="complete",this._updateTableHtml())}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){return this._imgEl&&this._contentEl?(this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,void(this._imgEl=null)):void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark."))},_createImage:function(){var a;this._contentEl&&(a=document.createElement("img"),a.id=this._watermarkId,a.src=this.IMAGE,a.style.position="absolute",a.style.display="none",this._imgEl=a,this._contentEl.appendChild(a))},_removeImage:function(){var a=this._imgEl;a&&a.parentNode&&a.parentNode.removeChild(a)},_ensureImage:function(){var a=document.getElementById(this._watermarkId);a||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var a=this._imgEl;a&&(a.style.display="none")},_showImage:function(){var a=this._imgEl;a&&(a.style.display="block")},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;return b&&a?(b.addEventListener(c.AD_START+a,this._hideImage.bind(this)),b.addEventListener(c.CONTENT_START+a,this._showImage.bind(this)),b.addEventListener(c.CONTENT_END+a,this._hideImage.bind(this)),b.addEventListener(c.CONTAINER_RESIZE+a,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),void b.addTimedEventCallback(b.HALF_SECOND,a,this._ensureImage.bind(this))):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;return b&&a?(b.removeEventListener(c.AD_START+a),b.removeEventListener(c.CONTENT_START+a),b.removeEventListener(c.CONTENT_END+a),b.removeEventListener(c.CONTAINER_RESIZE+a),b.removeTimedEventCallback(this.TIMER_INTERVAL,a),void this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."))},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(a){a.target===this._containerId&&this._setPosition()},_setPosition:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;b=this._contentEl,c=this._videoEl,a=this._imgEl,a&&c&&b&&(n=c.videoHeight,o=c.videoWidth,o&&n&&(f=this.OFFSET,j=this.SIZE,g=c.getBoundingClientRect(),p=b.getBoundingClientRect(),h=g.height,i=g.width,m=n/o,l=h/i,k=l/m,d=i*m,e=h/m,q=p.bottom-g.bottom,r=p.right-g.right,k>1?(s=(h-d)/2,t=0,v=i*j+"px",u="auto"):(s=0,t=(i-e)/2,v="auto",u=h*j*(this.RATIO/m)+"px"),a.style.width=v,a.style.height=u,a.style.bottom=s+q+f+"px",a.style.right=t+r+f+"px"))}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){return this._360El&&this._kaleidoscopeViewer?(this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,void(this._360El=null)):void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360."))},_loadKaleidoscope:function(a){return"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;return b&&a?(b.addEventListener(c.CONTAINER_RESIZE+a,this._handleContainerResize.bind(this)),void b.addEventListener(c.CONTENT_START+a,this._startKaleidoscopeRender.bind(this))):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;return b&&a?(b.removeEventListener(c.CONTAINER_RESIZE+a),void b.removeEventListener(c.CONTENT_START+a)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."))}})}(uvpjs.register("uvpjs")),function(a){a.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(a,b,c){this.debug=uvpjs.debug,this.validationInfo=null,this.id=b,this.vidContId=c,this.rcoSeed={},this.initialize(a)},initialize:function(a){this.validationInfo=this.validateUserRco(a),this.validationInfo&&(this.rcoSeed=a,this.populateSelf(a))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},has:function(a){return!uvpjs.util.isEmpty(this[a])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(a){return{error:!1,message:""}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a),c=uvpjs.util.isDefinedString(a.assetURL);return{error:b.error||!c,message:b.error?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(a,b,c)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(a){this.cmsRefGuid=a,this.daiParams.daiVideoId=a},canMakePlatformCall:function(a){var b=uvpjs.util.isDefinedString(a),c=this.has("selectorCall")&&this.selectorCall||b&&a;return!!c&&(c.indexOf("$PID$")>-1?this.has("pid"):!(c.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){return this.has("cmsRefGuid")?this.cmsRefGuid:null},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(a){var b=window.google&&google.ima&&google.ima.dai,c=this.validateDaiConfig(a),d=this._super(a),e=(a.useSsb||b)&&c&&!d.error,f=b?c?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!e,missingSDK:!b,message:d.error?d.message:f}},populateSelf:function(a){var b,c;for(b in a)c=a.hasOwnProperty(b),c&&void 0!==this.daiParams[b]?this.daiParams[b]=a[b]:c&&(this[b]=a[b]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(a){var b=uvpjs.util,c=!b.isEmpty(a.adTagParameters),d=!b.isEmpty(a.contentSourceId);return a.useSsb||c&&d?a.useSsb?!b.isEmpty(a.assetURL):c&&d:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),c&&d)},checkCustomAdTagParams:function(){var a,b=uvpjs.util,c=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;c&&"string"!=typeof c&&b.isPlainObject(c)&&(a=b.queryStrFromObj(c),this.daiParams.adTagParameters.cust_params=encodeURIComponent(a))}})}(uvpjs.register("uvpjs")),function(a){a.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=window.google&&google.ima,c=this._super(a),d=b&&!c.error;return{error:!d,missingSDK:!b,message:c.error?c.message:"IMA SDK is missing."}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a);return{error:b.error||!uvpjs.util.isDefinedString(a.assetURL),message:b.err?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=uvpjs.util,c=b.isDefinedString(a.pid),d=!c&&b.isDefinedString(a.cmsRefGuid)&&!b.isDefinedString(a.assetURL),e=this._super(a),f=!e.error&&(c||d||b.isDefinedString(a.selectorCall));return{error:!f,message:e.error?e.message:"Supplied RCO is not valid for type rp_platform"}}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.UvpSwfService=uvpjs.Class.subClass({init:function(a){this.debugId=a.debugId,this.debug=uvpjs.debug,this.containerId=a.containerId,this.dom=a.contentVideoDom,this.playerDom=a.playerDom,this.callback=a.readyCallback,this.id3OwnerIds=a.id3OwnerIds||"",this.capLevelToPlayerSize=a.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var a;this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var a=this.getContainerSize(),b=a.width,c=a.height;this.swf&&this.swf.setSize(b,c,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=navigator.appName.indexOf("Microsoft")!==-1?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(a){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(a){return a.success?void this.startTimer():void this.callback(null,this.svcC.error.EMBED_FAILED)},embed:function(a){var b=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,a,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:b.jsReady,playerReady:b.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var a,b,c=this.dom;return this.svcC.hasFlash()?(this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),a=document.createElement("div"),a.id=this.swfName,b=c.querySelector("video"),b.style.display="none",c.style.height="100%",this.playerDom.style.height="100%",c.insertBefore(a,b),void this.embed(a)):void this.callback(null,this.svcC.error.FLASH_NOT_DETECTED)}}),a.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"//vidtech.cbsinteractive.com/uvpjs/uvpjsf/js_falback.swf",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},a.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},a.UvpSwfService.hasFlash=function(){var a=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(a)&&parseInt(a)>0},a.UvpSwfService.setWindowMethods=function(a){var b,c,d,e="f_",f=uvpjs.util;for(b in a)c=a[b],d=e+f.uid8(),window[d]=c,a[b]=d;return a},a.UvpSwfService.swfobject=function(){function a(){if(!T&&document.getElementsByTagName("body")[0]){try{var a,b=r("span");b.style.display="none",a=M.getElementsByTagName("body")[0].appendChild(b),a.parentNode.removeChild(a),a=null,b=null}catch(a){return}T=!0;for(var c=P.length,d=0;d<c;d++)P[d]()}}function b(a){T?a():P[P.length]=a}function c(a){if(typeof L.addEventListener!=E)L.addEventListener("load",a,!1);else if(typeof M.addEventListener!=E)M.addEventListener("load",a,!1);else if(typeof L.attachEvent!=E)t(L,"onload",a);else if("function"==typeof L.onload){var b=L.onload;L.onload=function(){b(),a()}}else L.onload=a}function d(){var a=M.getElementsByTagName("body")[0],b=r(F);b.setAttribute("style","visibility: hidden;"),b.setAttribute("type",I);var c=a.appendChild(b);if(c){var d=0;!function f(){if(typeof c.GetVariable!=E)try{var g=c.GetVariable("$version");g&&(g=g.split(" ")[1].split(","),X.pv=[s(g[0]),s(g[1]),s(g[2])])}catch(a){X.pv=[8,0,0]}else if(d<10)return d++,void setTimeout(f,10);a.removeChild(b),c=null,e()}()}else e()}function e(){var a=Q.length;if(a>0)for(var b=0;b<a;b++){var c=Q[b].id,d=Q[b].callbackFn,e={success:!1,id:c};if(X.pv[0]>0){var j=q(c);if(j)if(!u(Q[b].swfVersion)||X.wk&&X.wk<312)if(Q[b].expressInstall&&g()){var k={};k.data=Q[b].expressInstall,k.width=j.getAttribute("width")||"0",k.height=j.getAttribute("height")||"0",j.getAttribute("class")&&(k.styleclass=j.getAttribute("class")),j.getAttribute("align")&&(k.align=j.getAttribute("align"));for(var l={},m=j.getElementsByTagName("param"),n=m.length,o=0;o<n;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));h(k,l,c,d)}else i(j),d&&d(e);else w(c,!0),d&&(e.success=!0,e.ref=f(c),e.id=c,d(e))}else if(w(c,!0),d){var p=f(c);p&&typeof p.SetVariable!=E&&(e.success=!0,e.ref=p,e.id=p.id),d(e)}}}function f(a){var b=null,c=q(a);return c&&"OBJECT"===c.nodeName.toUpperCase()&&(b=typeof c.SetVariable!==E?c:c.getElementsByTagName(F)[0]||c),b}function g(){return!U&&u("6.0.65")&&(X.win||X.mac)&&!(X.wk&&X.wk<312)}function h(a,b,c,d){var e=q(c);if(c=p(c),U=!0,A=d||null,B={success:!1,id:c},e){"OBJECT"==e.nodeName.toUpperCase()?(y=j(e),z=null):(y=e,z=c),a.id=J,(typeof a.width==E||!/%$/.test(a.width)&&s(a.width)<310)&&(a.width="310"),(typeof a.height==E||!/%$/.test(a.height)&&s(a.height)<137)&&(a.height="137");var f=X.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(L.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+f+"&MMdoctitle="+encodeURIComponent(M.title.slice(0,47)+" - Flash Player Installation");if(typeof b.flashvars!=E?b.flashvars+="&"+g:b.flashvars=g,X.ie&&4!=e.readyState){var h=r("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",n(e)}l(a,b,c)}}function i(a){if(X.ie&&4!=a.readyState){a.style.display="none";var b=r("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(j(a),b),n(a)}else a.parentNode.replaceChild(j(a),a)}function j(a){var b=r("div");if(X.win&&X.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(F)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;f<e;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function k(a,b){var c=r("div");return c.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+a+"'>"+b+"</object>",c.firstChild}function l(a,b,c){var d,e=q(c);if(c=p(c),X.wk&&X.wk<312)return d;if(e){var f,g,h,i=r(X.ie?"div":F);typeof a.id==E&&(a.id=c);for(h in b)b.hasOwnProperty(h)&&"movie"!==h.toLowerCase()&&m(i,h,b[h]);X.ie&&(i=k(a.data,i.innerHTML));for(f in a)a.hasOwnProperty(f)&&(g=f.toLowerCase(),"styleclass"===g?i.setAttribute("class",a[f]):"classid"!==g&&"data"!==g&&i.setAttribute(f,a[f]));X.ie?R[R.length]=a.id:(i.setAttribute("type",I),i.setAttribute("data",a.data)),e.parentNode.replaceChild(i,e),d=i}return d}function m(a,b,c){var d=r("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=q(a);b&&"OBJECT"==b.nodeName.toUpperCase()&&(X.ie?(b.style.display="none",function a(){if(4==b.readyState){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}else setTimeout(a,10)}()):b.parentNode.removeChild(b))}function o(a){return a&&a.nodeType&&1===a.nodeType}function p(a){return o(a)?a.id:a}function q(a){if(o(a))return a;var b=null;try{b=M.getElementById(a)}catch(a){}return b}function r(a){return M.createElement(a)}function s(a){return parseInt(a,10)}function t(a,b,c){a.attachEvent(b,c),S[S.length]=[a,b,c]}function u(a){a+="";var b=X.pv,c=a.split(".");return c[0]=s(c[0]),c[1]=s(c[1])||0,c[2]=s(c[2])||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]}function v(a,b,c,d){var e=M.getElementsByTagName("head")[0];if(e){var f="string"==typeof c?c:"screen";if(d&&(C=null,D=null),!C||D!=f){var g=r("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),C=e.appendChild(g),X.ie&&typeof M.styleSheets!=E&&M.styleSheets.length>0&&(C=M.styleSheets[M.styleSheets.length-1]),D=f}C&&(typeof C.addRule!=E?C.addRule(a,b):typeof M.createTextNode!=E&&C.appendChild(M.createTextNode(a+" {"+b+"}")))}}function w(a,b){if(V){var c=b?"visible":"hidden",d=q(a);T&&d?d.style.visibility=c:"string"==typeof a&&v("#"+a,"visibility:"+c)}}function x(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=E?encodeURIComponent(a):a}var y,z,A,B,C,D,E="undefined",F="object",G="Shockwave Flash",H="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",J="SWFObjectExprInst",K="onreadystatechange",L=window,M=document,N=navigator,O=!1,P=[],Q=[],R=[],S=[],T=!1,U=!1,V=!0,W=!1,X=function(){var a=typeof M.getElementById!=E&&typeof M.getElementsByTagName!=E&&typeof M.createElement!=E,b=N.userAgent.toLowerCase(),c=N.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),e=c?/mac/.test(c):/mac/.test(b),f=!!/webkit/.test(b)&&parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),g="Microsoft Internet Explorer"===N.appName,h=[0,0,0],i=null;if(typeof N.plugins!=E&&typeof N.plugins[G]==F)i=N.plugins[G].description,i&&typeof N.mimeTypes!=E&&N.mimeTypes[I]&&N.mimeTypes[I].enabledPlugin&&(O=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=s(i.replace(/^(.*)\..*$/,"$1")),h[1]=s(i.replace(/^.*\.(.*)\s.*$/,"$1")),h[2]=/[a-zA-Z]/.test(i)?s(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof L.ActiveXObject!=E)try{var j=new ActiveXObject(H);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[s(i[0]),s(i[1]),s(i[2])]))}catch(a){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();(function(){X.w3&&((typeof M.readyState!=E&&("complete"===M.readyState||"interactive"===M.readyState)||typeof M.readyState==E&&(M.getElementsByTagName("body")[0]||M.body))&&a(),T||(typeof M.addEventListener!=E&&M.addEventListener("DOMContentLoaded",a,!1),X.ie&&(M.attachEvent(K,function b(){"complete"==M.readyState&&(M.detachEvent(K,b),a())}),L==top&&!function b(){if(!T){try{M.documentElement.doScroll("left")}catch(a){return void setTimeout(b,0)}a()}}()),X.wk&&!function b(){if(!T)return/loaded|complete/.test(M.readyState)?void a():void setTimeout(b,0)}()))})();P[0]=function(){O?d():e()};(function(){X.ie&&window.attachEvent("onunload",function(){for(var a=S.length,b=0;b<a;b++)S[b][0].detachEvent(S[b][1],S[b][2]);for(var c=R.length,d=0;d<c;d++)n(R[d]);for(var e in X)X[e]=null;X=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(X.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,Q[Q.length]=e,w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(X.w3)return f(a)},embedSWF:function(a,c,d,e,f,i,j,k,m,n){var o=p(c),q={success:!1,id:o};X.w3&&!(X.wk&&X.wk<312)&&a&&c&&d&&e&&f?(w(o,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===F)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var r={};if(k&&typeof k===F)for(var s in k)r[s]=k[s];if(j&&typeof j===F)for(var t in j)if(j.hasOwnProperty(t)){var v=W?encodeURIComponent(t):t,x=W?encodeURIComponent(j[t]):j[t];typeof r.flashvars!=E?r.flashvars+="&"+v+"="+x:r.flashvars=v+"="+x}if(u(f)){var y=l(b,r,c);b.id==o&&w(o,!0),q.success=!0,q.ref=y,q.id=y.id}else{if(i&&g())return b.data=i,void h(b,r,c,n);w(o,!0)}n&&n(q)})):n&&n(q)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(a){W=typeof a===E||a},ua:X,getFlashPlayerVersion:function(){return{major:X.pv[0],minor:X.pv[1],release:X.pv[2]}},hasFlashPlayerVersion:u,createSWF:function(a,b,c){return X.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){X.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){X.w3&&n(a)},createCSS:function(a,b,c,d){X.w3&&v(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=M.location.search||M.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return x(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return x(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var a=q(J);a&&y&&(a.parentNode.replaceChild(y,a),z&&(w(z,!0),X.ie&&(y.style.display="block")),A&&A(B)),U=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.containers=a.containers,
this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=a.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=a.p2pClient,this.multiCdnClient=a.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(a.rco,a.cviMgr,a.vidContId)},initialize:function(a,c,d){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",a),this.rco=a,this.vidContId=d,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",e=this.cviModel.contentVideoState,e.sendResumeEvent=!1,e.startTime=0,e.elapsedTime=0,e.showPreroll=!0,e.playedChapterTime=0,e.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({defaults:this.cviModel.contentVideoStateDefaults,eventsManager:this.eventsMgr}),b.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var a=this.eventsMgr;this._removeTimers(),a.addTimedEventCallback(a.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),a.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(a){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(a)},_removeTimers:function(){var a=this.eventsMgr;a.removeTimedEventCallback(a.TENTH_SECOND,this.internalNS),a.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var a=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(a)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.CONTAINER_RESIZE+this.internalNS),this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(a){var b=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),b.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),b.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),b.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=a,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(a){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.cviModel.contentVideoState.cdn=uvpjs.UvpSwfService.constant.CDN,this.prepForCaptionEvents(),this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:this.rco.capLevelToPlayerSize===!0,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,a)}),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTAINER_RESIZE+this.internalNS,this.handleContainerResizeForFlash.bind(this))):this.finishLoadVideoAndBeginPlayback(a)},handleContainerResizeForFlash:function(){this.uvpSwfService.resetSize()},handleUvpFlashPlayerLoaded:function(a,b,c){var d,e=uvpjs.ErrorInfo;return c?(d=new e({errorCode:e.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+c,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:d},this.vidContId)):void setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,a),2)},handleCdnDecision:function(a,b){this.setNewAssetUrlAndCdn(b),this.doFlashCheck(a)},shouldUseFlash:function(){var a=this.mc.systemInfo,b=this.cviModel.getSessionOption("preventFlashPlayback"),c=a.supportsNativeHls||a.isHlsjsEligible,d=!b&&a.isDesktop&&uvpjs.UvpSwfService.hasFlash(),e=this.mc.isHlsUrl(this._getAssetUrl()),f=uvpjs.Configuration.env;return!("local"!==f&&"dev"!==f&&"stage"!==f||!window.forceFlash||!d)||e&&!c&&d},prepForCaptionEvents:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY],c=b.length;c--;)this.eventsMgr.addEventListener(b[c]+this.internalNS,this.hCaptionEventForUvpFlash.bind(this))},removeCaptionEventListeners:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY],c=b.length;c--;)this.eventsMgr.removeEventListener(b[c]+this.internalNS)},hCaptionEventForUvpFlash:function(a){var b=this.eventsMgr.eventTypes;if(this._hasFacade()&&a.target===this.vidContId)switch(a.type){case b.CAPTIONS_READY:this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case b.CONTROL_SHOW_CAPTIONS:this.facade.showCaptions();break;case b.CONTROL_HIDE_CAPTIONS:this.facade.hideCaptions()}},finishLoadVideoAndBeginPlayback:function(a){var b,c=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),c.incrementMedNum(),this.createFacade(),b=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(b),this.suppressFacadePlay!==!0&&(this.facade.showVideo(),this.facade.playVideo()),b===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(a){var b,c,d,e=a&&a.providers||null,f=e&&e[0]?e[0]:null,g=f&&f.host||null,h=f&&f.provider||null;g&&(b=this._getAssetUrl(),c=uvpjs.util.parseUrl(b),g!==c.host&&(d=c.protocol+"//"+g+c.pathname+c.search,this.cviModel.contentVideoState.assetURL=d)),h&&(this.cviModel.contentVideoState.cdn=h)},setModelRcoOverrides:function(){var a=this.cviModel,b=Number(a.getSessionOption("startBitrate"))||-1,c=Number(a.getSessionOption("minBitrate"))||-1,d=Number(a.getSessionOption("maxBitrate"))||-1,e=Number(a.getSessionOption("liveSyncDurationCount"))||-1,f=!!a.getSessionOption("capLevelToPlayerSize"),g=!!a.getSessionOption("enableDashJSFastSwitchABR"),h=a.getSessionOption("useDynamicSwitching"),i=Number(this.rco.startBitrate)||-1,j=Number(this.rco.minBitrate)||-1,k=Number(this.rco.maxBitrate)||-1,l=Number(this.rco.liveSyncDurationCount)||-1,m=this.rco.capLevelToPlayerSize,n=this.rco.enableDashJSFastSwitchABR,o=this.rco.useDynamicSwitching;i>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",i),a.setStartBitrate(i)):a.setStartBitrate(b),j>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",j),a.setMinBitrate(j)):a.setMinBitrate(c),k>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",k),a.setMaxBitrate(k)):a.setMaxBitrate(d),l>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",l),a.setLiveSyncDurationCount(l)):a.setLiveSyncDurationCount(e),"boolean"==typeof m?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",m),a.setCapLevelToPlayerSize(m)):a.setCapLevelToPlayerSize(f),"boolean"==typeof n?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",n),a.setDashJSFastSwitchABR(n)):a.setDashJSFastSwitchABR(g),"boolean"==typeof o?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",o),a.setUseDynamicSwitching(o)):a.setUseDynamicSwitching(h)},createId3Parser:function(a){this.id3EventQueue=[];var b={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(a){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(b);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(b);break;case this.mc.FLASH_HLS:b.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(b)}},handleId3Metadata:function(a){this.id3EventQueue&&this.id3EventQueue.push(a)},checkId3Events:function(a){for(var b,c=this.id3EventQueue,d=c&&c.length||0;d--;)b=c[d],a>=b.pts&&(this.dispatchCuepointEvent(b),this.id3EventQueue.splice(d,1))},dispatchCuepointEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,a,this.vidContId)},createFacade:function(){var a=this.cviModel,b=a.getContentVideoState(),c=this._getAssetUrl(),d={enableId3Handling:this.id3HandlingEnabled,assetURL:c,isMuted:a.isMuted,resourceProvider:this,startTime:b.startTime,startBitrate:a.startBitrate,maxBitrate:a.maxBitrate,minBitrate:a.minBitrate,useDynamicSwitching:a.useDynamicSwitching,liveSyncDurationCount:a.liveSyncDurationCount,volume:a.volume,capLevelToPlayerSize:a.capLevelToPlayerSize,enableDashJSFastSwitchABR:a.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,drm:b.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",d),this.facade=this.getFacade(c),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(d.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(d.swfService=this.uvpSwfService),this.facade.initialize(d),this.facade.manageNativeControls(a.nativeControls)},destroyFacade:function(){var a=this._hasFacade()&&"function"==typeof this.facade.destroy;return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),a?(this.facade.destroy(),void(this.facade={})):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up."))},muteContentForAdPlay:function(a){var b=this.cviModel,c=this.facade;this._hasFacade()&&(a!==!1?c.muteVideo():b.isMuted||c.unMuteVideo())},getModule:function(a){return this.cviModel.getModule(a)},getModuleParam:function(a,b){return this.cviModel.getModuleParam(a,b)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:a},this.vidContId)},dispatchContentEnd:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:a},this.vidContId)},dispatchSeekDone:function(){var a=this.eventsMgr;a.dispatchEvent(a.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var a=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,b=a?"Fatal ERROR encountered":"";this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+b),!a&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId)},dispatchVideoStateChange:function(a){isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:a,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+a,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(a){a&&a.abrInfo&&this.cviModel.setAbrInfo(a.abrInfo)},facadeProgress:function(a){!uvpjs.util.isEmpty(a)&&"object"==typeof a&&a.currentTime&&a.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:a.currentTime}),this.setModelDuration(parseInt(a.duration)))},facadeDurationChanged:function(a){uvpjs.util.isEmpty(a)||"object"!=typeof a||!a.duration},setModelDuration:function(a){a>0&&this.cviModel.contentVideoState.duration!==a&&(this.cviModel.setContentVideoStateItems({duration:a}),this.cviModel.setContentPlaybackStateItems({duration:a}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",a),this._seekFromTime?(this._seekToTime=a.seekToTime,void this.dispatchSeekDone()):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE."))},facadeError:function(a){var b,c,d,e,f=uvpjs.util,g=this.RPM&&this.RPM.currRP,h=this.eventsMgr,i=this.cviModel,j=!f.isEmpty(i),k=a.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+a.message),j&&k&&(b=this.cviModel.getContentVideoState(),c=b.playbackStarted,d=f.isDefinedString(b.overrideAssetURL),!c&&d&&!this._overrideAssetUrlFailure))return void this._handleOverrideAssetURLError(a);if(j||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),f.isEmpty(h)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(e=a.eventType||h.eventTypes.VIDEO_PLAYBACK_ERROR,a.eventType=e,h.dispatchEvent(e,{errorInfo:a},this.vidContId)),k){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),j&&(i.contentPlaybackState.fatalError=!0),g&&g.rco&&g.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void g.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+a),this.dispatchVideoStateChange(a)},facadeVideoLevelLoaded:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:a},this.vidContId)},facadeVideoTransitionStart:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:a,mode:c},this.vidContId)},facadeVideoTransitionComplete:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:a,mode:c},this.vidContId)},facadeId3Data:function(a){this.id3Parser&&this.id3Parser.parse(a)},facadeMinimumBitrateAllowedChanged:function(a){this.cviModel.setMinBitrate(a)},facadeMaximumBitrateAllowedChanged:function(a){this.cviModel.setMaxBitrate(a)},getFacade:function(a){var b,c=this.mc.STREAMING,a=a||this._getAssetUrl(),d=this.mc.isHlsUrl(a),e=this.mc.isDashUrl(a),f=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(f||d||e)&&this._setDeliveryType(c),!f&&d)this.mc.canPlayHLSJS()&&(b=new uvpjs.VPF_HLSJS);else if(!f&&e){if(!uvpjs.VPF_DASHJS)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS not available."));b=new uvpjs.VPF_DASHJS}else f&&(b=new uvpjs.VPF_Flash);return b||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",d),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,a.addEventListener(b.CONTROL_SEEK+c,this.onVideoSeekTo.bind(this)),a.addEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c,this.onVideoSeekToLive.bind(this)),a.addEventListener(b.CONTROL_PAUSE+c,this.onPauseVideo.bind(this)),a.addEventListener(b.CONTROL_PLAY+c,this.onPlayVideo.bind(this)),a.addEventListener(b.CONTROL_MUTE+c,this.onMuteVideo.bind(this)),a.addEventListener(b.CONTROL_UNMUTE+c,this.onUnMuteVideo.bind(this)),a.addEventListener(b.CONTROL_VOLUME_SET+c,this.onChangeVideoVolume.bind(this)),a.addEventListener(b.CONTROL_FULLSCREEN+c,this.onFullscreen.bind(this)),a.addEventListener(b.SWITCH_REQUEST+c,this.onSwitchRequest.bind(this)),a.addEventListener(b.USE_DYNAMIC_SWITCHING+c,this.onUseDynamicSwitching.bind(this)),a.addEventListener(b.MAXIMUM_BITRATE_ALLOWED+c,this.onMaximumBitrateAllowed.bind(this)),a.addEventListener(b.MINIMUM_BITRATE_ALLOWED+c,this.onMinimumBitrateAllowed.bind(this)))},_removeUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",d),a.removeEventListener(b.CONTROL_SEEK+c),a.removeEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c),a.removeEventListener(b.CONTROL_PAUSE+c),a.removeEventListener(b.CONTROL_PLAY+c),a.removeEventListener(b.CONTROL_MUTE+c),a.removeEventListener(b.CONTROL_UNMUTE+c),a.removeEventListener(b.CONTROL_VOLUME_SET+c),a.removeEventListener(b.SWITCH_REQUEST+c),a.removeEventListener(b.USE_DYNAMIC_SWITCHING+c),a.removeEventListener(b.MAXIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.MINIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.CONTROL_LOAD_CAPTIONS+c)},_getAssetUrl:function(a){var b=uvpjs.util,c=a||this.cviModel.getContentVideoState(),d=c.overrideAssetURL,e=b.isDefinedString(d)&&!this._overrideAssetUrlFailure,f=e?d:c.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+e+")",f),f},_setDeliveryType:function(a){this.cviModel.setContentVideoStateItems({deliveryType:a})},_handleOverrideAssetURLError:function(a){var b=uvpjs.ErrorInfo,c=this.eventsMgr,d=c.eventTypes.VIDEO_START_ERROR,e=b.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,e+" Error using overrideAssetURL; will use assetURL."),a.eventType=d,a.message=e,a.isFatal=!1,a.errorCode=b.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,c.dispatchEvent(d,{errorInfo:a},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.bitrate,e=this.cviModel,f=this.facade;if(b===this.vidContId&&d&&this._hasFacade())switch(typeof d){case"string":if("up"===d)e.setUseDynamicSwitching(!1),f.switchUp();else if("down"===d)e.setUseDynamicSwitching(!1),f.switchDown();else{if(d=Number(d),isNaN(d))return;e.setUseDynamicSwitching(!1),f.switchToBitrate(d)}break;case"number":e.setUseDynamicSwitching(!1),f.switchToBitrate(d);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",d)}},onUseDynamicSwitching:function(a){if(a&&a.target===this.vidContId&&a.payload){var b=a.payload.data;this.cviModel.setUseDynamicSwitching(b),this._hasFacade()&&(this.facade.useDynamicSwitching(b),b&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",b)}},onMinimumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMinBitrate(c),this._hasFacade()&&d.setMinBitrateAllowed(c)}},onMaximumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMaxBitrate(c),this._hasFacade()&&d.setMaxBitrateAllowed(c)}},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.cviModel.contentVideoState.duration,f=this.cviModel.contentPlaybackState.currentTime,g=this.facade;if("number"==typeof d&&b===this.vidContId){if(d<0||d>e)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||f,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&g.seekTo(d)}},onVideoSeekToLive:function(){var a=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&a.seekToLive()},facadeVolumeChange:function(a){!b.isNaN(a)&&b.isNumber(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:a},this.vidContId)},facadeLoading:function(a){var b={data:a};a&&(a.bufferLength||a.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,b,this.vidContId)},facadeTimeUpdate:function(a){this.cviModel.setContentPlaybackStateItems({currentTime:a})},onFullscreen:function(a){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(a.payload.isFs)},onPauseVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.pauseVideo()},onPlayVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.playVideo()},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted,g=this.facade;b===this.vidContId&&e&&!f&&this._hasFacade()&&g.setVolume(d)},onMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.muteVideo()},onUnMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var a={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),a=this.cviModel.getContentVideoState(),!b.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:a},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var c=this.getVideoProgressPayload();this.setModelDuration(c.duration),this.id3HandlingEnabled&&this.checkId3Events(c.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},checkBuffering:function(a){var b,c=this.cviModel?this.cviModel.contentPlaybackState:null;c&&c.playbackStarted&&c.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(b=a||c.currentTime||0,!this.bufferingDetected&&b<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&b>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=b)},getVideoProgressPayload:function(){var a=(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),b={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:a,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(b),b},setFacadeStateOnProgressPayload:function(a){var b=this.facade,c=this._hasFacade()&&b.getFacadeState();return c?(a.facadeState=c,a.averageDroppedFPS=b.getAverageDroppedFPS(),a.bufferLength=b.getBuffered()||0,a.currentTime=b.getCurrentTime()||0,a.currentBandwidth=b.getCurrentBandwidth(),a.currentMaxBandwidth=b.getCurrentMaxBandwidth(),a.droppedFrames=b.getDroppedFramesCount(),a.playbackFramerate=b.getPlaybackFramerate(),a.playbackState=b.getPlaybackState(),a.streamType=b.getStreamType(),a.isHDStreamLive=b.isHDStreamLive(),a.isPlayingLive=b.isPlayingLive(),void(a.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual")):a},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var a=this.cviModel.contentVideoState,b=localStorage.getItem("UVPJS.resumePid")||null,c=localStorage.getItem("UVPJS.resumeContentTime")||null,d=localStorage.getItem("UVPJS.resumeEpochTime")||null,e=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(b&&(a.resumePid=b),c&&(a.resumeContentTime=c),d&&(a.resumeEpochTime=d),e&&(a.resumeSessionId=e))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var a=this.cviModel;a&&(a.resetAdVideoState(),a.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(a){var b=a._,c={DOUBLECLICK_IMA:"pubads.g.doubleclick.net",DOUBLECLICK:"ad.doubleclick.net",PHP:"request.php",JSP:"Request.jsp"};a.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(a){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=a||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.opts.defaults&&this.populateDefaults(this.opts.defaults),this.eventsMgr=this.opts.eventsManager,delete this.opts.defaults,this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(a){var b;for(b in a)this.opts[b]=a[b]},getModel:function(){return this.mdl},getProperty:function(a){return this.mdl[a]},setProperty:function(a,b){this.mdl[a]=b},loadData:function(a,b){var c,d="callback=uvpHandleJsonpResult",e=b||this.opts.queryParams,f=!1,g=!uvpjs.util.isEmpty(e);if(this.opts.url=a,this.opts.queryParams=b,g){a+=a.indexOf("?")<0?"?":"&";for(c in e)a+=(f?"&":"")+c+"="+e[c],f=!0}a.indexOf(d)<0&&(a+=(a.indexOf("?")<0?"?":"&")+d),this.selectorCall=a,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var a=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),a.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(a){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(a)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(a){var b,c,d,e,f,g,h,i,j,k=a.getElementsByTagName("ref"),l=null,m=k[0],n=!1,o=this.mdl,p=m&&this.checkForPlatformError(m);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",a),p&&p.error)return p;if(b=a.getElementsByTagName("switch"),c=b[0]?b[0].getElementsByTagName("video"):a.getElementsByTagName("video"),null===c[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(o.chapterTimesString="",m)for(d=0,e=k.length;d<e;d++)f=k[d],h=f.attributes.src.nodeValue,this.isAdCallURL(h)?(!n&&(o.imaAdCall=h),n=!0):l||(l=f,o.assetURL=l.getAttribute("src"),i=f.getElementsByTagName("param")),null!==f.getAttribute("clipEnd")&&(o.chapterTimesString+=f.getAttribute("clipEnd")+",");for(d=0,e=c.length;d<e&&(g=c[d],h=g.attributes.src.nodeValue,l||(l=g,o.assetURL=l.getAttribute("src"),i=g.getElementsByTagName("param"),null!==g.getAttribute("clipEnd")));d++)null!==g.getAttribute("clipEnd")&&(o.chapterTimesString+=g.getAttribute("clipEnd")+",");return j=i&&this.extractParams(i)||{},this.populateModelFromContentNodeAndParams(l,j),{error:!1}},populateModelFromContentNodeAndParams:function(a,b){var c,d,e=this.mdl,f=uvpjs.mediaCapabilities,g={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},h={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},i="true";for(q in g)e[q]=a.getAttribute(g[q])||"";for(q in h)e[q]=b[h[q]]||"";e.mediaId=this.getMediaId(b),e.duration=this.getDuration(a),e.sourceOwner=this.getSourceOwner(b),e.cmsRefGuid=a.getAttribute("guid")||a.getAttribute("vid")||"",e.isEmbedable=b.Embeddable===i,e.isLive=b.IsLive===i,e.episodeFlag=b.EpisodeFlag===i,
e.useWatermark=b.WatermarkPlayback===i,e.chapterTimesString.length>0?(c=e.chapterTimesString,d=c.length-1,c.lastIndexOf(",")===d&&(e.chapterTimesString=c.substring(0,d)),e.chapterStartTimes=this.convertChapterTimesToSeconds(e.chapterTimesString)):e.chapterStartTimes=[],e.assetURL.indexOf(f.M3U)>-1?(e.cdn="akamai_hd",e.fileType=f.M3U):e.assetURL.indexOf(f.MP3)>-1?e.fileType=f.MP3:e.fileType=f.MP4},handleData:function(a){var b=a.responseText,c=uvpjs.util,d=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1),e=this.isValidJsonStr(d)&&JSON.parse(d)||null,f=c.isEmpty(e)?null:e.metafile,g=f&&new DOMParser,h=g&&g.parseFromString(f,"application/xml"),i=h&&this.parseSmilXML(h);if(this.callAttempts=0,i){if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+i.errorInfo.message),void this.signalError(i.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(a){return"string"==typeof a&&("{"===a.charAt(0)&&"}"===a.charAt(a.length-1)||"["===a.charAt(0)&&"]"===a.charAt(a.length-1))},handleError:function(a){var b,c="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(a.status);this.debug&&uvpjs.error(this.DEBUG_ID,c,this.selectorCall),this.shouldRetryCall(a)?(b=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+b,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),b)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:c+" URL: "+this.selectorCall,isFatal:!0,serverCode:a.status})))},shouldRetryCall:function(a){var b=a.status,c=this.selectorCall.indexOf("link.theplatform")>-1;return c&&this.callAttempts<this.retryLimit&&500!==b&&404!==b&&403!==b&&0!==b},defineProperties:function(){},checkForPlatformError:function(a){var b=a&&this.parseSmilRefNodeForException(a);return b?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(b),serverCode:b.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(a){var b=a.responseCode||"n/a",c="; PID: "+(this.opts.pid||"n/a")+"; ",d=this.opts&&this.opts.cmsRefGuid+"; "||"",e=a.abstract?a.abstract+" ":"",f=a.exception||"Resource Unavailable.";return"Platform Error; code: "+b+c+d+f+" "+e},populateDefaults:function(a){!uvpjs.util.isEmpty(a)&&b.assign(this.mdl,a)},parseSmilRefNodeForException:function(a){var b,c=a.getElementsByTagName("param"),d={};if(c&&c.length){for(b=c.length;b--;)d[c[b].getAttribute("name")]=c[b].getAttribute("value");if("true"===d.isException)return d.abstract=a.getAttribute("abstract")||"",d}return null},extractParams:function(a){var b,c,d,e,f={};if(uvpjs.util.isEmpty(a))return f;for(e=a.length;e--;)b=a[e],c=b.getAttribute("name"),d=b.getAttribute("value"),c&&d&&(f[c]=d);return f},isAdCallURL:function(a){return a.indexOf(c.DOUBLECLICK)>-1||a.indexOf(c.DOUBLECLICK_IMA)>-1||a.indexOf(c.PHP)>-1||a.indexOf(c.JSP)>-1},getMediaId:function(a){var b,c,d,e="",f=a.trackingData;if(uvpjs.util.isEmpty(f))return"";for(b=f.split("|"),c=0,d=b.length;c<d;c++)b[c].indexOf("cid=")>-1&&(e=b[c].split("=")[1]);return e},getSourceOwner:function(a){var b=a.Source;return uvpjs.util.isEmpty(b)&&"true"===a.WatermarkPlayback?"Entertainment":b||""},getDuration:function(a){var b=parseInt(a.getAttribute("dur"))||0;return b>0?.001*b:b},convertChapterTimesToSeconds:function(a){for(var b=[],c=a.split(","),d=c.length,e=function(a){var b,e=parseInt;switch(a=c[d].split(":"),b=a.length){case 1:return e(a[0]);case 2:return 60*e(a[0])+e(a[1]);case 3:return 3600*e(a[0])+60*e(a[1])+e(a[2])}};d--;)b.unshift(e(c[d]));return b}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(a,b,c){this._super(a,b,c)},loadData:function(a,c){return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),b.isFunction(a)&&b.isFunction(c)?(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,this.dataLoadErrorCB=c,void this.dataLoadedCB()):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS)},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(a)}})}(uvpjs.register("uvpjs")),function(a){a.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(a,b){var c=this.getSelectorCall(),d=c.url||null,e=null;return c.error?(this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+c.message),void("function"==typeof b&&b(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+c.message,isFatal:!0})))):(this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,uvpjs.util.isDefinedString(this.rco.sig)&&(e={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:b}),void this.contentDataProxy.loadData(d,e))},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(a)},getSelectorCall:function(){var a,b,c,d,e,f,g,h,i,j=this.rco,k=j.has("selectorCall")&&j.selectorCall||null;if(!k){if(k=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"),d=k&&k.indexOf("$PID$")>-1,e=k&&k.indexOf("$GUID$")>-1,a=j.has("pid")&&j.pid||null,b=j.has("cmsRefGuid")&&j.cmsRefGuid||null,f=!d&&!e,c=!a&&!b,f||c)return h="Config error: "+(f?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(d?"pid":"cmsRefGuid")),{error:!0,message:h};g=d?a:b,i=d?/\$PID\$/g:/\$GUID\$/g,k=k.replace(i,g),k=k.replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:k}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var a=uvpjs.util;a.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),a.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var a,b,c,d,e,f,g,h,i=this.cviModel.contentVideoState,j=this.contentDataProxy,k=this.rco,l=function(){var a=j.getProperty("duration"),b=!uvpjs.util.isEmpty(k.globalResumeTime)&&k.globalResumeTime>0;return b&&a>0&&a-k.globalResumeTime>20};this.populateContentVideoStateFromLocalStorage(),b=Date.now()-+i.resumeEpochTime,j.setProperty("resumePid",i.resumePid),j.setProperty("resumeEpochTime",+i.resumeEpochTime),j.setProperty("resumeSessionId",i.resumeSessionId),j.setProperty("resumeContentTime",+i.resumeContentTime),j.setProperty("playedChapterTime",+i.playedChapterTime),j.setProperty("showPreroll",i.showPreroll),j.setProperty("sendResumeEvent",!1),j.getProperty("episodeFlag")&&i.isLive!==!0&&(c=l(),e=!c&&k.pid===i.resumePid,c||e?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),d=c?k.globalResumeTime:+i.resumeContentTime||0,a=c?0:b||0,h=!c&&b>this.ONE_HOUR_MS,g=c?this.cviModel.sessionId:"",f=this.getPlayedChapterTimeForContentResume(d),j.setProperty("sendResumeEvent",!0),j.setProperty("startTime",d),j.setProperty("elapsedTime",a),j.setProperty("showPreroll",h),j.setProperty("playedChapterTime",f),j.setProperty("previousSessionId",g),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(e?"local":"global")+"Resume"]},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(a){var b,c=0,d=this.contentDataProxy.getProperty("chapterStartTimes"),e=d.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",d),e)for(;e--;)if(b=d[e],a>=b){a-b>=4?c=b:(this.contentDataProxy.setProperty("startTime",a-4),e>0&&(c=d[e-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",c),c}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(a,b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",c),this._super(a,b,c)},loadData:function(a,c){return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),b.isFunction(a)?(this.dataLoadedCB=a,this.dataLoadErrorCB=c,void this.dataLoadedCB()):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS)}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,init:function(a){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(a,b,c){var d,e;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",a),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",c)),this.playbackState=this.mc.EMPTY,this.vidContId=c,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=a,this.isContentScenario=!1,this._super(a,b,c),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(d=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(d.eventType,{errorInfo:d},c)):(e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=e.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(a,b){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:a();break;case this.PLATFORM:this._super(a,b);break;case this.CONTENT_AND_AD_CALL:a()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(a){var b=this.rco,c=this.cviModel,d=uvpjs.util.isDefinedString(b.adCall)?b.adCall:null,e=this.imaScenario===this.PLATFORM,f=d||(e?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(c.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(f)):(c.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),c.setContentVideoStateItems(b),c.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,f)):this.doFlashCheck(f))},finishLoadVideoAndBeginPlayback:function(a){var b="",c=uvpjs.adUtil,d=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,d.incrementMedNum(),this.isContentScenario=!0),a?(b=c.populateImaAdCallValues(a,d,this.isContentScenario),this.viewGuid=c.getDwViewGuid(d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",b)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(b)},requestAdsManagerOrResume:function(a){b.isString(a)&&!b.isEmpty(a)?this._requestAdsManager(a):this._onContentResumeRequested()},setImaAdUrl:function(){var a=this.checkForAdCallOverride();a?(this.contentDataProxy.setProperty("imaAdCall",a),this.imaAdCall=a):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var a=this.cviModel.getModule(this.AD_SETTINGS),c=null!=a&&1==a.enabled,d=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),e=null;return c&&!b.isUndefined(d)&&(e=d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(e||"null")),e},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var a,b="",c=this.contentDataProxy,d=c.getProperty("chapterStartTimes");return c.getProperty("showPreroll")||(b="1"),d.length>0&&(a=d.indexOf(c.getProperty("playedChapterTime")),a>=0&&(a+=2,b=b.length>0?b+","+String(a):String(a))),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",b),b},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},onAdEvent:function(a){var c,d,e,f=a.getAdData(),g=a.getAd(),h=google.ima.AdEvent.Type;switch(this.cviModel.isCurrVideoAd===!0&&this.trackAdEvent(a.type),a.type){case h.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",g),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(a)}),this._dispatchAdLoaded(),!this.adPodInProgress){this.adPodInProgress=!0;var i=g.getAdPodInfo();if(e=i.getPodIndex(),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA ima.AdEvent.Type.LOADED podIdx = ",e),uvpjs.log(this.DEBUG_ID,"RP_IMA ima.AdEvent.Type.LOADED podInfo = ",i)),0===e?d="pre":e===-1?d="post":e>=1&&(d="mid_"+e),this.currAdPod=this.APM.getAdPodById(d),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"AdEvent.Type.LOADED currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(g)}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.currAdPod.adCount=i.getTotalAds(),this.currAdPod.podDuration=i.getMaxDuration(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdEvent.Type.LOADED this.currAdPod = ",this.currAdPod),(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}break;case h.STARTED:var j,k,l=g.getContentType();this.ad=g,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=g.getDuration(),this._populateAdVideoState(g,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(a)}),this.cviModel.mergeCDOData(),"application/javascript"!==l&&"application/x-shockwave-flash"!==l||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===l&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(g),this.trackAdEvent(h.STARTED),j=g.getAdPodInfo(),j&&(k=j.getTotalAds()),this._dispatchAdStart(k),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case h.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case h.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case h.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case h.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd();break;case h.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||b.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case h.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),c=this.cviModel.getAdVideoState(),c.paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:c},this.vidContId);break;case h.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case h.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case h.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case h.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,c=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:c,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case h.LOG:var m,n=f&&f.adError,o=uvpjs.ErrorInfo,p=null===g,q=this.eventsMgr.eventTypes.AD_ERROR,r="Unknown error - IMA.AdEvent.Type.LOG ",s=o.errorCodes.IMA_AD_ERROR,t=null,u=null;!n&&p?(r+=o.messages.UNEXPECTED_NULL_VALUE_FOR_AD,m=this.cviModel.getSessionOption("adBlockerCallback"),m&&"function"==typeof m&&m()&&this.dispatchAdBlockedEvent()):n&&"function"==typeof n.getMessage&&(r+=n.getMessage(),t=n.getErrorCode(),u=n.getVastErrorCode()),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent; Non-fatal; AdEvent.Type.LOG; "+r),this.eventsMgr.dispatchEvent(q,{errorInfo:new uvpjs.ErrorInfo({eventType:q,errorCode:s,serverCode:null,imaErrorCode:t,imaVastErrorCode:u,message:r,adInfo:this.extractAdInfo(g),isFatal:!1})},this.vidContId),this.checkForAdBlocker(),p&&!n&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",h))}},_populateAdVideoState:function(a,c){var d,e;if(!b.isObject(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN"));if(e=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.IMA),c)for(d in c)e[d]=c[d];this.cviModel.setAdVideoState(e),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())},_requestAdsManager:function(a){var b=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",a),this.adStartEventReceived=!1,this.adCallUrl=a,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var c=new google.ima.AdsRequest;c.adTagUrl=a,this._updateAdSize(),c.linearAdSlotWidth=this.containerWidth,c.linearAdSlotHeight=this.containerHeight,c.nonLinearAdSlotWidth=this.containerWidth,c.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof c.setAdWillAutoPlay&&(c.setAdWillAutoPlay(b.isAutoplay),c.setAdWillPlayMuted(b.isMuteAtPlayStart&&!b.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(c)},onAdsManagerLoaded:function(a){var c,d,e,f=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,g=this.cviModel.contentPlaybackState.facadeState.currentBitrate,h=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",a),this._dispatchAdResponse(),h.isEmpty(this.RPM)||h.isEmpty(this.RPM.currRP)||h.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var i=this.renderSettings;i.bitrate=g>0&&g/1e3||750,i.restoreCustomPlaybackStateOnAdBreakComplete=!1,i.enablePreloading=!1,i.loadVideoTimeout=this._returnIMATimeout(),c=this.adsManager=a.getAdsManager(f,i),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",c.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",c.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",c.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(d=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",d)),this.imaCuePoints=this.adsManager.getCuePoints(),b.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",d),this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,e),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},startAds:function(){var a,b,c=null,d=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(e){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),b=uvpjs.ErrorInfo,a=b.messages.NO_AD_CONTENT,e&&"function"==typeof e.getMessage&&(a+=": "+e.getMessage(),c=e.getErrorCode(),d=e.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new b({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:b.errorCodes.IMA_AD_ERROR,message:a,imaErrorCode:c,imaVastErrorCode:d,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var a,c=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),b.isEmpty(this.facade)||(c=this.cviModel.contentVideoState.isLive,a=this.imaUsesContentVideoTag(),!a&&this.facade.hideVideo(),c&&!a?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),a&&(this.savedSeekToTime=c?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!b.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),!b.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN"));if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),b.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!b.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}},facadePlaybackStateChange:function(a){this.seekPending&&a===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(a)},_updateIMAPlaybackState:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",a),a!==this.playbackState&&(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(a){var b=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:a||1,adData:b,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(a){var b;this.uvpjsAdStartOpened&&(b=this.cviModel.getAdVideoState(),b.skipped=a===!0,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:b,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(a){var b="function"==typeof a.getAdData?a.getAdData():{},c="function"==typeof a.getAd?a.getAd():{},d="function"==typeof c.getMediaUrl?c.getMediaUrl():b.mediaUrl;return d||null},_dispatchAdLoaded:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId)},_dispatchAdRequest:function(){
this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(a,b){var c,d,e;a&&(this.containerWidth=a),b&&(this.containerHeight=b),this.mc.isChromecast()||(c=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),d=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),c===this.containerWidth&&d===this.containerHeight||(this.containerWidth=c,this.containerHeight=d,this.adsManager&&(e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,e))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var a=this.adsManager.getRemainingTime();this._checkForStuckAd(a),this.currImaAdTime=Math.floor(this.duration-a),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime})}},_checkForStuckAd:function(a){if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, remainingTime: "+a),null===this.previousRemainingTime)return this.previousRemainingTime=a,!1;var b=this.previousRemainingTime-a;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+b),0===b?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var c="Ad playback stuck for "+this.stuckIntervals+" intervals.",d=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:c,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,c,d),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:d,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=a,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(a){var b=a&&a.getAd&&a.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(a.getError(),b),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(a){this.dispatchAdErrorEvent(a.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(a,b){var c,d,e,f=null,g=null,h=null,i="Unknown",j=uvpjs.ErrorInfo,k=uvpjs.util.isFunction.bind(uvpjs.util),l="n/a",m=" Unspecified IMA ad error.";a&&k(a.getMessage)&&(f=a.getMessage(),g=a.getErrorCode,h=a.getVastErrorCode(),i="ima code: "+g+"; vast code: "+h),a&&k(a.getInnerError)&&(c=a.getInnerError(),c&&(!f&&(f=""),d=k(c.getMessage)?c.getMessage():c.message||l,e=k(c.getErrorCode)?c.getErrorCode():l,f+=" Inner error: "+d+"; IMA error code: "+e)),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+f),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new j({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:j.errorCodes.IMA_AD_ERROR,message:j.messages.IMA_AD_ERROR_EVENT_RECEIVED+(f||m),isFatal:!1,imaErrorCode:g,imaVastErrorCode:h,adInfo:this.extractAdInfo(b)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),b.isEmpty(this.facade)?(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA()):(this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),void this.facade.playVideo())},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var a=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(a)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(a){var b;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",a),null!==this.adsManager?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call")):(this.dynamicMidRollPodCount++,b=uvpjs.adUtil.populateImaAdCallValues(a,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=b,void this._requestAdsManager(b))},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(a)))},onPlayVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(a)))},onVideoSeekTo:function(a){var c,d,e,f=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",a),a.target!==this.vidContId||b.isEmpty(this.facade)||!this.canSeek(a&&a.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):b.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(a)):(c=a.payload.seekTime,this._seekFromTime=f,d=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(c):c,e=this.APM.returnPrecedingUnplayedAdPod(d),void(b.isEmpty(e)||e.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(a)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",e.startTime),this.savedSeekToTime=d,e.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=e.startTime)))},canSeek:function(a){return void 0!==a.seekTime&&null!==a.seekTime&&a.seekTime>=0&&a.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(a){var b=a;return b},onChangeVideoVolume:function(a){b.has(a,"target")&&a.target===this.vidContId&&!this.cviModel.isMuted&&a.payload.vol>=0&&a.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(a.payload.vol):this._super(a))},onMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},onUnMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var a,b=this.adsManager,c=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),a=this.onAdEvent,b.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),b.addEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.addEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.addEventListener(c.LOADED,a),b.addEventListener(c.STARTED,a),b.addEventListener(c.FIRST_QUARTILE,a),b.addEventListener(c.MIDPOINT,a),b.addEventListener(c.THIRD_QUARTILE,a),b.addEventListener(c.COMPLETE,a),b.addEventListener(c.ALL_ADS_COMPLETED,a),b.addEventListener(c.CLICK,a),b.addEventListener(c.PAUSED,a),b.addEventListener(c.RESUMED,a),b.addEventListener(c.USER_CLOSE,a),b.addEventListener(c.SKIPPED,a),b.addEventListener(c.LOG,a),b.addEventListener(c.VOLUME_CHANGED,a),b.addEventListener(c.VOLUME_MUTED,a)},_removeAdsManagerEventListeners:function(){var a=this.onAdEvent,b=this.adsManager,c=google.ima.AdEvent.Type;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),b.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,a),b.removeEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.removeEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.removeEventListener(c.LOADED,a),b.removeEventListener(c.STARTED,a),b.removeEventListener(c.FIRST_QUARTILE,a),b.removeEventListener(c.MIDPOINT,a),b.removeEventListener(c.THIRD_QUARTILE,a),b.removeEventListener(c.COMPLETE,a),b.removeEventListener(c.ALL_ADS_COMPLETED,a),b.removeEventListener(c.CLICK,a),b.removeEventListener(c.PAUSED,a),b.removeEventListener(c.RESUMED,a),b.removeEventListener(c.USER_CLOSE,a),b.removeEventListener(c.SKIPPED,a),b.removeEventListener(c.LOG,a),b.removeEventListener(c.VOLUME_CHANGED,a),b.removeEventListener(c.VOLUME_MUTED,a))},onUVPJSTimerTick:function(){var a,b,c,d,e,f=uvpjs.util,g=this.cviModel.contentPlaybackState.facadeState.currentBitrate,h=!f.isEmpty(g)&&g>0,i=g/1e3!==this.renderSettings.bitrate,j=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,k=!f.isEmpty(this.adsManager),l=!f.isEmpty(this.facade);if(k&&h&&i&&(this.renderSettings.bitrate=g/1e3,this.adsManager.updateAdsRenderingSettings(this.renderSettings)),j&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:l?(a=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=a):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return d=k&&j&&(this.cviModel.sessionOptions.adBlockerCallback||null),b=d&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),e=d&&(c=(new Date).getTime())&&(this.lastAdBlockCheckTime<c||b),e&&(this.lastAdBlockCheckTime=c+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&l&&this.checkId3Events(a),this.playbackState===this.mc.PLAYING){var m=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,m,this.vidContId)}},_checkForCloseToMidrollPod:function(a){var b,c,d,e=this.APM.getMidRollPods();if(a<=0)return!1;for(b=e.length;b--;)if(d=e[b],c=d.startTime-a,c>0&&c<1&&!d.hasPlayed&&!d.hasBeenChecked)return d.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){var a={isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}};return a},_determineIMAScenario:function(a){var b=uvpjs.util,c=this._getAssetUrl(a),d=b.isDefinedString(a.pid),e=b.isDefinedString(a.cmsRefGuid),f=b.isDefinedString(a.selectorCall),g=b.isDefinedString(a.assetURL);return d||e&&!g||f?this.PLATFORM:b.isDefinedString(c)?this.CONTENT_AND_AD_CALL:b.isDefinedString(a.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var a=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return a&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),a},_checkForContentPreload:function(){var a=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,b=this.adsManager.isCustomPlaybackUsed(),c=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!b;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&a&&this.duration>5&&c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var a=-1,b=this.cviModel.getModule(this.AD_SETTINGS),c=b&&b.enabled,d=c&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return d&&(a=parseInt(d),a=a>0?1e3*a:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+a),a},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c=(a._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),d=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];a.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(a){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,c,d){var e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+d),f=e.getElementsByTagName("video")[0];!b&&(b=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new b.StreamManager(f),this.adClickElement=this.createAdClickElement(f),this.streamManager.setClickElement(this.adClickElement),this._super(a,c,d),this.resetAdStates(),this.contentVideoDiv=e,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(a,b){var c=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(c)?this._super(a,b):(this.dataLoadedCB=a,this.onDataProxyComplete())},onDataProxyComplete:function(){var a=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(a)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(a),this._super()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel,e=this.contentDataProxy.getModel();return this.suppressFacadePlayOnLoad=a===!0,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(e),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),(b=this.assembleResourceDefinition())?void this.requestStream(b):(this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0))},requestStream:function(a){var c=this.cviModel.contentVideoState.isLive,d=c?b.LiveStreamRequest:b.VODStreamRequest,e=new d,f=a||testRsrcDef;e.apiKey=f.apiKey||null,e.adTagParameters=f.adTagParameters,c?(e.assetKey=f.assetKey,e.attemptPreroll=!0,this.id3HandlingEnabled=!0):(e.contentSourceId=f.contentSourceId,e.videoId=f.videoId),this.streamManager.requestStream(e)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(a){var b=a.getStreamData().url;return uvpjs.util.isDefinedString(b)?(this.cviModel.contentVideoState.assetURL=b,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),void(this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo()))):(this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0))},hStreamInitialized:function(a){this.daiStreamId=a.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(a){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(a){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null},hCuePointsChanged:function(a){this.currAdPod=this.getNewPod(a.getStreamData().cuepoints)},hAdStarted:function(a){var b=a.getAd();this.resetAdStates(),this.updateAdModel(b),this.currAd=b,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.currAdPod?(this.trackAdEvent(a.type),this.dispatchAdPodStart()):this.dispatchError(this.eventsMgr.eventTypes.AD_ERROR,uvpjs.ErrorInfo.messages.DAI_ADPOD_ERROR,uvpjs.ErrorInfo.errorCodes.DAI_AD_ERROR)),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(a){var c,d,e,f=a.type,g=b.StreamEvent.Type,h=null;switch(f){case g.FIRST_QUARTILE:h=25;break;case g.MIDPOINT:h=50;break;case g.THIRD_QUARTILE:h=75;break;case g.AD_PROGRESS:c=a.getStreamData(),d=c&&c.adProgressData,e=d&&this.createAdProgressPayload(d),e&&this.dispatchVideoProgress(e)}h&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=h,this.dispatchAdQuartile(h))},hStreamError:function(a){var b=a.getStreamData(),c=b&&b.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+c,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,c||"Uknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(a){},hStreamEvent:function(a){this.isAdPlaying()&&this.trackAdEvent(a.type),this[this.hMap[a.type]](a)},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.facade,f=this._hasFacade(),g=e.getDuration(),h=this.facade.getCurrentTime();if("number"==typeof d&&b===this.vidContId){if(d=this.streamManager.streamTimeForContentTime(d),d<0||d>g)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||h,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),f&&e.seekTo(d)}},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:d===!0,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(a){var b,c,d=null,e=a&&a.length;for(e&&!this.adPods&&this.createAdPods(a);e--;)b=a[e],c=this.adPods["t_"+b.start],d||c.hasPlayed===b.played||(d=c),c.hasPlayed=b.played;return d},createAdPods:function(a){var b,c,d,e,f=function(a){return a===i-1?"post":0===a?"pre":"mid"},g=0,h=[],i=a.length;for(this.adPods={},c=0;c<i;c++)b=a[c],d=f(c),e=b.start,h.push(e),this.adPods["t_"+e]={startTime:e,hasPlayed:!1,adPodId:d+("mid"===d?"_"+g++:"_0"),adCount:0,podDuration:b.end-e};this.cviModel.contentVideoState.chapterStartTimes=h},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(a){var b=a.getAdPodInfo();this.populateAdVideoState(a),b&&this.currAdPod&&(this.currAdPod.adCount=b.getTotalAds(),this.currAdPod.podDuration=b.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(a){var b=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.DAI);this.cviModel.setAdVideoState(b)},createAdProgressPayload:function(a){var b=this.getVideoProgressPayload(),c=a.currentTime;return b.isAd=!0,b.duration=a.duration,b.currentTime=c,b.absoluteStreamTime=this.facade.getCurrentTime(),b.lastSecondCompleted=Math.floor(c),b.lastPercentageCompleted=this.currAdPercentComplete,b},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&a!=b.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var a,b,c,d=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying();d&&(b=this.facade.getCurrentTime(),this.checkForAdBlocker(b,!1),a=this.streamManager.contentTimeForStreamTime(b),!this.contentStartOpen&&a>0&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(a),c=this.createVideoProgressPayload(a,b),this.dispatchVideoProgress(c))},createVideoProgressPayload:function(a,b){var c=this.getVideoProgressPayload();return c.currentTime=a,c.absoluteStreamTime=b,c.duration=this.contentDuration||-1,c},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(a,b){var c=a-this.lastAdBlockCheckTime>this.adBlockCheckInterval,d=b||c,e=d&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return d&&(this.lastAdBlockCheckTime=a),e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!e},assembleResourceDefinition:function(){var a=this.rco.getAdTagParameters(),b=this.rco.getVideoId(),c=this.rco.getContentSourceId();return a&&b&&c?{adTagParameters:a,videoId:b,contentSourceId:c}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(a){for(var e,f="add"===a?"addEventListener":"removeEventListener",g="addEventListener"===f,h=b.StreamEvent.Type,i=c.length,j=[];i--;)e=h[c[i]],j.push(e),g&&(this.hMap[e]=d[i]);this.streamManager[f](j,this.hStreamEvent,!1)},createAdClickElement:function(a){var b,c,d,e,f="uvpjsDaiContainer",g=a.nextSibling;if(g&&g.getAttribute("data-role")===f)return g;b=document.createElement("div"),b.setAttribute("data-role","uvpjsDaiContainer"),c={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},e=b.style;for(d in c)e[d]=c[d];return a.insertAdjacentElement("afterend",b),b},onPauseVideo:function(a){var b=a&&a.target;b===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onPlayVideo:function(a){var b=a&&a.target;b===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted;b===this.vidContId&&e&&!f&&this._hasFacade()&&(this.facade.setVolume(d),this.isAdPlaying()&&this.trackAdEvent(a.type))},onMuteVideo:function(a){var b=a&&a.target;b===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onUnMuteVideo:function(a){var b=a&&a.target;b===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},facadeId3Data:function(a){var b,c,d;for(b=a.length,d=0;d<b;d++)c=a[d],this.streamManager.processMetadata("ID3",c.data,c.pts)},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){this.contentDuration=this.streamManager.contentTimeForStreamTime(a.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&this.cviModel.isCurrVideoAd===!0},showAdClickEl:function(a){this.adClickElement&&(this.adClickElement.style.display=a!==!1?"block":"none")},log:function(a,b,c){var d=c?c:"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};a.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.isLiveStream=!1,
this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,b,c){this._super(a,b,c),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+c),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(a){a()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel;return this.suppressFacadePlayOnLoad=a===!0,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),this.contentDuration=d.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),(b=this.assembleAssetUrl(c))?(this.cviModel.contentVideoState.assetURL=b,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(c.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),void(!this.suppressFacadePlayOnLoad&&this.facade.playVideo())):void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0)},assembleAssetUrl:function(a){var b,c,d=a.assetURL,e=uvpjs.util;return e.isEmpty(d)?null:d.indexOf("?")>-1?d:(c=a.getAdTagParameters(),b=c?e.queryStrFromObj(c):null,e.isEmpty(b)?d:d+"?"+b)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(a){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(a),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(a){var b=this.getPrerollPod(a);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:b})},dispatchAdPodEnd:function(){var a=this.getPrerollPod();a.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:a})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b,isFatal:d===!0,adInfo:null})})},getPrerollPod:function(a){return this.adPod||(this.adPod={startTime:a,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var a=uvpjs.adUtil.getAdStateBlank();a.adServerName="dai_ssb",a.duration=this.getPrerollAdDuration(),a.adClipID="pre_0",a.adPosition=1,a.adType="pre",this.cviModel.setAdVideoState(a)},getPrerollAdDuration:function(){return this.absoluteDuration>0&&this.contentDuration>0?this.absoluteDuration-this.contentDuration:-1},createAdProgressPayload:function(){var a,b,c=this.getVideoProgressPayload(),d=this.facade.getCurrentTime(),e=this.getPrerollAdDuration(),f=Math.floor(d/e*100);switch(f){case 25:a=this.quartiles[25],b=25;break;case 50:a=this.quartiles[50],b=50;break;case 75:a=this.quartiles[75],b=75}return b&&!a&&this.dispatchAdQuartile(b),b&&(this.quartiles[String(b)]=1),c.isAd=!0,c.duration=e,c.currentTime=d,c.absoluteStreamTime=this.facade.getCurrentTime(),c.lastSecondCompleted=Math.floor(d),c.lastPercentageCompleted=f,c},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var a,b=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,c=this.isAdPlaying(),d=this.contentStartOpen,e=b&&this.facade.getCurrentTime();b&&(a=c?this.createAdProgressPayload():d?this.createVideoProgressPayload():null,e>1&&!d&&!c&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+e),this.contentStartTime=e,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(e),a&&this.dispatchVideoProgress(a))},createVideoProgressPayload:function(){var a=this.getVideoProgressPayload(),b=this.facade.getCurrentTime(),c=b-this.contentStartTime;return a.currentTime=c,a.absoluteStreamTime=b,a.duration=this.contentDuration||-1,a},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.facade,f=this._hasFacade(),g=f&&(this.absoluteDuration||e.getDuration()),h=this.getPrerollAdDuration(),i=this.facade.getCurrentTime();if("number"==typeof d&&b===this.vidContId&&g){if(d+=h>0?h:0,d<0||d>g)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),f&&e.seekTo(d)}},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){!this.absoluteDuration&&(this.absoluteDuration=a.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){this.vidEl.textTracks.removeEventListener("addtrack",this.hAddTextTrack,!1)},hAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(a.track.addEventListener("cuechange",this.hCueChange.bind(this),!1),a.track.mode="hidden")},hCueChange:function(a){a.target&&a.target.activeCues&&1==a.target.activeCues.length&&this.handleId3Cue(a.target.activeCues[0])},handleId3Cue:function(a){var c,d,e=a.value.key;"TXXX"===e&&(c=a.value.data,d=b[c],d&&this[d](a.startTime))},isAdPlaying:function(){return this.cviModel&&this.cviModel.isCurrVideoAd===!0},log:function(a,b,c){var d=c?c:"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=2e3;a.P2pClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var a=uvpjs.P2pClient.clientMap[this.clientName];return a&&a.getHlsjsLoader&&(a.getHlsjsLoader()||null)}}),a.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,a.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(a,c){var d;this.getHlsjsLoader()?a():c.apiKey?(d=this.loadHlsLoader.bind(this,a),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+c.apiKey,d,b)):a(!0)},loadHlsLoader:function(a,c){return c?(uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",c),void a(!0)):void uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,a,b)}}}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=2e3;a.MultiCdnClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(a){var c;this.inFlight||(this.inFlight=!0,this.decisionCallback=a,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),b),c=new uvpjs.CodeLoader,c.loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(a){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(a.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),a.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(a){return a&&a.customerId&&a.appId?this.decisionUrl.replace("{customerId}",a.customerId).replace("{appId}",a.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(a){a()}}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a,b){var c=uvpjs.VideoDeliveryPluginService.clientType;this.model=b,this.callback=a,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(c.P2P),this.multiCdnClientOptions=this.getClientOptions(c.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var a=null,b=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(a=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(b=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(a,b))},handleMcdnReady:function(a){var b=this.multiCdnClientOptions,c=!a&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,b.clientName);c||(b.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+b.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var a=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,a.clientName,this.handleMcdnReady.bind(this),a.requiredParams)},handleP2pReady:function(a,b){var c=this.p2pClientOptions,d=!b&&this.validateScriptLoad(this.staticSvc.clientType.P2P,c.clientName);d||(c.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+c.clientName)),a?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var a=this.p2pClientOptions,b=this.multiCdnClientOptions,c=b.canUse;a.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,a.clientName,this.handleP2pReady.bind(this,c),a.requiredParams):c?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(a,b,c,d){var e=this.getClientObject(a,b);e||c(!0),e.loadScripts(c,d)},validateScriptLoad:function(a,b){var c=this.getClientObject(a,b);return c&&c.validateScriptLoad()||!1},createClient:function(a,b){return new a(b)},getClientOptions:function(a){var b,c,d,e,f,g,h,i,j,k=this.model,l=this.getSupportedClients(a),m={canUse:!1,clientName:null};if(a===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return m;for(b in l)if(c=b,d=l[c],i=d&&d.uvpcModuleName,i&&k.isModuleEnabled(i)){for(e=d.requiredParams,f=e&&e.length||0,h={},j=!0;f--;){if(g=k.getModuleParam(i,e[f]),uvpjs.util.isEmpty(g)){j=!1;break}h[e[f]]=g}return{canUse:j,clientName:c,requiredParams:h}}return m},getSupportedClients:function(a){var b,c,d={},e=a.clientMap;if(!e)return d;for(b in e)c=e[b],d[b]={uvpcModuleName:c.uvpcModuleName,requiredParams:c.requires};return d},getClientObject:function(a,b){return a.clientMap[b]||null}});var b=a.VideoDeliveryPluginService;b.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},b.load=function(a,b,c){var d=new uvpjs.CodeLoader;d.loadScript(a,b,c)}}(uvpjs.register("uvpjs")),function(a){var b="loadedmetadata";a.FullscreenManager=uvpjs.Class.subClass({init:function(a){var b=uvpjs.util,c=a||{},d=uvpjs.mediaCapabilities;return this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,c.videoElement&&c.container?(this.videoEl=c.videoElement,this.container=c.container,this.fullscreenChangeCallback=b.isFunction(c.fullscreenChangeCallback)&&c.fullscreenChangeCallback,this.readyCallback=b.isFunction(c.readyCallback)&&c.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=d.getEnterFullscreenMethodName(),this.exitMethod=d.getExitFullscreenMethodName(),this.fsElementName=d.getFullScreenElementName(),this.isFullscreenProperty=d.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),void this.initialize()):void uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.")},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(a){var b=this.isFullscreen();a.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(b)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(b,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var a=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return a&&uvpjs.util.isFunction(a[this.exitMethod])?a:null},validateEntryAndExitMethods:function(){var a=this.fsElement&&this.fsElement[this.enterMethod],b=this.exitScope&&this.exitScope[this.exitMethod],c=uvpjs.util;this.hasValidEntryMethod=c.isFunction(a),this.hasValidExitMethod=c.isFunction(b)},initialize:function(){var a,c,d,e,f=uvpjs.mediaCapabilities;return this.hasFsApiSupport=f.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(e=f.getFullscreenEventName(),a=f.isFirefox()||f.isIE()?document:this.container,a.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,c=f.getFullscreenEnterEventName(),d=f.getFullscreenExitEventName(),this.fsElement.addEventListener(c,this.hFullScreenEvent,!1),this.fsElement.addEventListener(d,this.hFullScreenEvent,!1),this.enterEvt=c,this.exitEvt=d),this.validateEntryAndExitMethods(),this.hasValidEntryMethod?(this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(b,this.hMetadataLoaded,!1),void(this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo()))):void(this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo()))}}),a.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f=a._;a.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]},{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]}],init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=a.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=a.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(a.skinConfig)},destroy:function(){var a=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=a,this._replayCB=a,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(a){var b=uvpjs.util,c=uvpjs.Configuration.path,d=this._containerId,e=a.customCSS;this._namespace="."+d+".skin",this._autoPlay=a.isMutedAutoplay||a.isUnmutedAutoplay,this._isMutedAutoplay=a.isMutedAutoplay,this._previewImage=a.previewImage,this._enableReplay=a.enableReplay,this._themeName=a.themeName,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=b.isDefinedString(e)&&e||c+this.DEFAULT_SKIN_PATH,this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(a)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),f.includes(this._disabledButtons,a)||this._disabledButtons.push(a),this._disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),f.pull(this._disabledButtons,a),this._enableButton(a)},_handleFullscreenMgrReady:function(a){a&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(a){var b=this.fullscreenMgr.usesFullscreenApi(),c=this._isIOS&&void 0!==this._videoEl.webkitClosedCaptionsVisible,d=c&&this._hasActive(this.css.CLOSED_CAPTION_BTN);this._hide(this.css.VOLUME_SLIDER),a?(this.vci.fullscreen(!0),b&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),c&&(this.monitorMuting(!0),d&&this.vci.hideCaptions(),this._videoEl.webkitClosedCaptionsVisible=d)):(this.vci.fullscreen(!1),b&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),c&&(this._videoEl.webkitClosedCaptionsVisible||d?(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()):(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.hideCaptions()),this._videoEl.webkitClosedCaptionsVisible=!1,this.monitorMuting(!1,!0),this._updateVolumeUI()))},_disableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",a),this._disable(a),b&&(b.disabled=!0)},_enableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",a),f.includes(this._disabledButtons,a)||(this._enable(a),b&&(b.disabled=!1))},_addUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a.addEventListener(c.AD_START+b,this._onAdStart.bind(this)),a.addEventListener(c.AD_END+b,this._onAdEnd.bind(this)),a.addEventListener(c.CAPTIONS_READY+b,this._onCaptionsReady.bind(this)),a.addEventListener(c.CONTENT_START+b,this._onContentStart.bind(this)),a.addEventListener(c.CONTENT_END+b,this._onContentEnd.bind(this)),a.addEventListener(c.VIDEO_PROGRESS+b,this._onVideoProgress.bind(this)),a.addEventListener(c.VIDEO_STATE_CHANGE+b,this._onVideoStateChange.bind(this)),a.addEventListener(c.VIDEO_LOADING+b,this._onVideoLoading.bind(this)),a.addEventListener(c.CONTROL_MUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.CONTROL_UNMUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.RESOURCE_START+b,this._onResourceStart.bind(this)),a.addEventListener(c.RESOURCE_END+b,this._onResourceEnd.bind(this)),a.addEventListener(c.CONTAINER_RESIZE+b,this._onUVPJSResize.bind(this)),a.addEventListener(c.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+b,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a&&a instanceof uvpjs.VideoControlInterface&&(a.removeEventListener(c.AD_START+b),a.removeEventListener(c.AD_END+b),a.removeEventListener(c.CAPTIONS_READY+b),a.removeEventListener(c.CONTENT_START+b),a.removeEventListener(c.CONTENT_END+b),a.removeEventListener(c.VIDEO_PROGRESS+b),a.removeEventListener(c.VIDEO_STATE_CHANGE+b),a.removeEventListener(c.VIDEO_LOADING+b),a.removeEventListener(c.CONTROL_MUTE+b),a.removeEventListener(c.CONTROL_UNMUTE+b),a.removeEventListener(c.RESOURCE_END+b),a.removeEventListener(c.CONTAINER_RESIZE+b))},_addUIEventListeners:function(){for(var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this.css,d=this.shouldTrapTaps(),e=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],f=e.length;f--;)this[e[f]]=this[e[f]].bind(this);var g=this._onUVPJSGestureEvent,h=this._hNonTap,i=this._onProgressSliderEvent,j=this._onVolumeSliderEvent,k=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",h),b.addEventListener("mouseenter",g,!0),b.addEventListener("mouseleave",g,!0),b.addEventListener("mousemove",g,!0),b.addEventListener("mousedown",g,!1),b.addEventListener("mouseup",g,!1),b.addEventListener("click",g,!1),b.addEventListener("touchstart",g,!0),b.addEventListener("touchend",g,!0),this._previewBtn=this._queryByElementName(c.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",h),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(c.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(c.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(c.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(c.PROGRESS_SLIDER),this._progressSlider.addEventListener(a,i,!1),this._progressSlider.addEventListener("mousedown",i,!1),this._progressSlider.addEventListener("mouseup",i,!1),this._progressSlider.addEventListener("touchstart",i,!0),this._progressSlider.addEventListener("touchend",i,!0),this._volumeSlider=this._queryByElementName(c.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(a,j,!1),this._volumeSlider.addEventListener("mouseover",j,!1),this._volumeSlider.addEventListener("mouseout",j,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(c.LARGE_PLAY_BTN),!d&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(c.PLAYSTATE_BTN),!d&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(c.VOLUME_BTN),!d&&this._volumeBtn.addEventListener("click",k,!1),this._volumeBtn.addEventListener("mouseover",k,!1),this._volumeBtn.addEventListener("mouseout",k,!1),this._ccBtn=this._queryByElementName(c.CLOSED_CAPTION_BTN),!d&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn=this._queryByElementName(c.SETTINGS_BTN),!d&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),
this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,c.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(c.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this._hNonTap,d=this._onUVPJSGestureEvent,e=this._onProgressSliderEvent,f=this._onVolumeSliderEvent,g=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",c,!1),b.removeEventListener("mouseenter",d,!0),b.removeEventListener("mouseleave",d,!0),b.removeEventListener("mousemove",d,!0),b.removeEventListener("mousedown",d,!1),b.removeEventListener("mouseup",d,!1),b.removeEventListener("click",d,!1),b.removeEventListener("touchstart",d,!0),b.removeEventListener("touchend",d,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",c,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(a,e,!1),this._progressSlider.removeEventListener("mousedown",e,!1),this._progressSlider.removeEventListener("mouseup",e,!1),this._progressSlider.removeEventListener("touchstart",e,!0),this._progressSlider.removeEventListener("touchend",e,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(a,f,!1),this._volumeSlider.removeEventListener("mouseover",f,!1),this._volumeSlider.removeEventListener("mouseout",f,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",g,!1),this._volumeBtn.removeEventListener("mouseover",g,!1),this._volumeBtn.removeEventListener("mouseout",g,!1)),this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var a=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(a,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var a=!0;for(var b in this._controlList)this._checkControlOnDOM(this._controlList[b])||(a=!1);return a},_waitForControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void a.call(this):void this._waitForControls(a)}.bind(this),50)},_clearMouseMoveInterval:function(a){var b=this._getClassName(a,this.ACTIVE_MODIFIER);this._intervals&&this._intervals[b]!==-1&&(clearInterval(this._intervals[b]),this._intervals[b]=-1)},_clearIntervals:function(){var a,b=this._intervals;for(a in b)b[a]!==-1&&(clearInterval(b[a]),b[a]=-1)},_setupDom:function(){var a=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),b(this._containerEl,this.PRIMARY_BLOCK),b(this._contentEl,this._getClassName(a.CONTENT)),b(this._controlsEl,this._getClassName(a.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&b(this._adEl,this._getClassName(a.AD)),this._hide(a.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(a.BUFFERING_FRAME),this._hide(a.LARGE_PLAY_BTN),this._hide(a.CONTROL_BAR),this._hide(a.PROGRESS),this._hide(a.VOLUME_SLIDER),this._hide(a.AD_LEARNMORE),this._show(a.CONTROLS),this._hide(a.BUFFERING_FRAME),this._hide(a.SETTINGS_MENU),this._hide(a.PREVIEW_BTN),this._hide(a.REPLAY_BTN),this._autoPlay!==!0&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(a){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a]=a},_setupControlsContainer:function(){var a=[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(a)},_generateSettingsMenu:function(a,b){function c(a){var b=a.value,c=a.property,d=c&&q[c];return!((d&&d.toLowerCase())!==(b&&b.toLowerCase()))}function d(a,b){var d={};if(a.enabled!==!1)return void 0===a.value?(d.el="SETTINGS_MENU_ITEM",d.type="button",d.label=a.label,d.target=b):(d.el="SETTINGS_MENU_INPUT",d.type="menu",d.label=a.label||a.value,d.value=a.value,d.property=b&&f.last(b.split(":")),d.selected=c(d)),d}var e,g,h,i,j,k,l,m,n,o=this._queryByElementName(this.css.SETTINGS_MENU),p=this._getClassName(this.css.SETTINGS_MENU_ITEM),q=f.assign({},this._menuSelections,this._getCaptionsStyle()),r=document.createRange(),s=uvpjs.util,t=[],u=this.shouldTrapTaps();for(n=a&&a.length,m=0;m<n;m++)k=a[m],j=k.name,i=b,j&&(i=s.isDefinedString(b)&&[b,j].join(":")||j),t.push(d(k,i));for(b&&(h=this._findMenuItem(b),i=b.split(":").slice(0,-1).join(":"),l=d(h,i),l.cls=p+"--back",t.unshift(l)),r.selectNodeContents(o),r.deleteContents(),o.insertAdjacentHTML("beforeend",this._templateToHTML(t)),e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),g=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),m=e&&e.length;m--;)!u&&e[m].addEventListener("click",this._onSettingsMenuBtnClick);for(m=g&&g.length;m--;)!u&&g[m].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var a,b=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),c=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(a=b&&b.length;a--;)b[a].removeEventListener("click",this._onSettingsMenuBtnClick);for(a=c&&c.length;a--;)c[a].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(a){var b={items:this.settingsMenu};if(f.isEmpty(a))return b;var c=this,d=a.split(":");return f(d).each(function(a){c.debug&&uvpjs.log(c.DEBUG_ID,"_findMenuItem key",a),b=f.find(b.items,function(b){return b.name===a})}),b},_createAdLearnMoreButton:function(){var a=document.createElement("button");a.id=uvpjs.domConstants.AD_LEARNMORE_ID_PREFIX+this.ID_SELECTOR_PREFIX+this._containerId,a.className=this._getClassName(this.css.AD_LEARNMORE),a.innerHTML=this.AD_LEARNMORE_TEXT,a.setAttribute("aria-label",this.AD_LEARNMORE_TEXT),this._controlsEl.appendChild(a)},_setupPreview:function(){var a=uvpjs.util,b=this.css.PREVIEW_BTN,c=this._previewImage,d=this._queryByElementName(b);uvpjs.log(this.DEBUG_ID,"_setupPreview",c),a.isDefinedString(c)&&(d.style.backgroundImage="url('"+c+"')"),this._show(b)},_setupReplay:function(){var a=uvpjs.util,b=this.css,c=b.REPLAY_BTN,d=this._previewImage,e=this._queryByElementName(c);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),a.isDefinedString(d)&&(e.style.backgroundImage="url('"+d+"')"),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.BUFFERING_FRAME),this._show(b.CONTROLS),this._hide(b.CONTROL_BAR),this._hide(b.PROGRESS),this._show(c),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var a=this._getClassName(this.css.BUFFERING_FRAME),b={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:a,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(b).spin(this._controlsEl)},_disableInactiveButtons:function(){this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(a){var b=this.css;if(this._containerId===a.target)return this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._disableButton(b.SETTINGS_BTN),this._disableButton(b.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._hasActive(b.CLOSED_CAPTION_BTN)&&this.vci.hideCaptions(),a.payload.adData.isCustomClickTrackingUsed?(this._show(b.AD_LEARNMORE),void this._addModifier(this.PRIMARY_BLOCK,b.AD_LEARNMORE)):void this._disable(b.LARGE_PLAY_BTN)},_onAdEnd:function(a){this._containerId===a.target&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,a.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._hide(this.css.AD_LEARNMORE),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",a),this._containerId===a.target&&this._enableCaptions()},_onCaptionsUnavailable:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",a),this._containerId===a.target&&this._disableCaptions()},_onContentStart:function(a){var b=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",a),this._containerId===a.target&&(this._isWaitingForFirstTouch=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._captionsLoaded&&this._enableButton(b.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(b.LARGE_PLAY_BTN),this._hide(b.AD_LEARNMORE)),this._isLive()?this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER):this._isStreaming()&&this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._hasActive(b.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===a.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider())},_onControlMuteUnmute:function(a){var b="controlMute"===a.type;this._containerId===a.target&&this._updateVolumeUI(this._volumeSlider.value,b)},_onDiagCloseButton:function(a){this._containerId===a.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",a),this._menuSelections.debug=null)},_onResourceStart:function(a){var b=a&&a.target;b===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(a){var b=a.target,c=a.payload,d=0===c.playlistLength;this._containerId===b&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",a),this._hide(this.css.CONTROLS),this._enableReplay&&d?this._setupReplay():this._captionsLoaded=!1,this._resetProgressSlider())},_onVideoProgress:function(a){var b,c,d=a.payload,e=d.playbackState,f=this.vci.getVolume(),g=this.css.TIME_DURATION,h=this.css.TIME_CURRENT,i=!1;this._containerId===a.target&&(f!==Number(this._volumeSlider.value)&&this._updateVolumeUI(f),e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(d),e!==this.mc.PLAYING||this._isSliding||d.duration!==1/0&&(b=this._queryByElementName(g),c=this._queryByElementName(h),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&d.duration>=3600&&(this.durationChecked=i=!0):(this.durationChecked=!0,d.duration>=3600&&(i=!0)),i&&(c.parentNode.style.width="100px"),b.innerHTML=this._formatTimestampByType(g,d.duration),c.innerHTML=this._formatTimestampByType(h,d.currentTime),this._updateProgressUI(d)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(a){f.has(a,"target")&&this._containerId===a.target&&f.isObject(a)&&f.has(a,"payload.data")&&this._updateProgressLoad(a.payload.data)},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",a),f.isObject(a)&&this._containerId===a.target&&f.isObject(a.payload)&&f.isNumber(parseInt(a.payload.newState))){var b=a.payload.newState;b!==this._playbackState&&(this._playbackState=b,this._updatePlaybackStateUI(this._playbackState)),b===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(a,b,c){null!==a&&(this.isMonitoringMuting=a),b&&clearInterval(this.muteMonitorIntervalId),c&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var a=this._videoEl.muted;a!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=a,a?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(a){var b=!1;switch(a.type){case"mouseenter":this._onUVPJSMouseEnter(a);break;case"mouseleave":this._onUVPJSMouseLeave(a);break;case"mousemove":this._onUVPJSMouseMove(a);break;case"mousedown":this._onUVPJSMouseDown(a);break;case"mouseup":this._onUVPJSMouseUp(a);break;case"click":this._showControlBar(a),b=!0;break;case"touchstart":this._onUVPJSTouchStart(a);break;case"touchend":this._onUVPJSTouchEnd(a),b=!0}!this._hasFirstTouch&&b&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(a)))},_getTargetInfo:function(a){var b=a.target,c=b.className.indexOf(this.css.VOLUME_BTN)!==-1,d=b.className.indexOf(this.css.PLAYSTATE_BTN)!==-1;return{isVolumeButton:c,isPlayPauseToggle:d}},_onProgressSliderEvent:function(a){switch(a.type){case"input":case"change":this._onProgressSliderChange(a);break;case"touchstart":case"mousedown":this._onProgressSliderStart(a);break;case"touchend":case"mouseup":this._onProgressSliderEnd(a)}},_onVolumeSliderEvent:function(a){switch(a.type){case"input":case"change":this._onVolumeSliderChange(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onVolumeBtnEvent:function(a){switch(a.type){case"click":case"touchend":this._onVolumeBtnClick(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onUVPJSMouseEnter:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._showControlBar(a))},_onUVPJSMouseDown:function(a){a.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(a){var b,c=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),this._touchStartTime=a.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||c!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),a.target===this._progressSlider&&(b=1-(a.target.clientWidth-a.layerX)/a.target.clientWidth,this._onProgressSliderChange(a,b)))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet."))},_onUVPJSTouchEnd:function(a){function b(){this._hasPaused()||(c=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}var c,d,e,f,g=this.css,h=this._isTap(a.timeStamp),i=[g.CLOSED_CAPTION_BTN,g.VOLUME_BTN,g.PLAYSTATE_BTN,g.SETTINGS_BTN,g.SETTINGS_MENU,g.SETTINGS_MENU_ITEM,g.SETTINGS_MENU_INPUT,g.LARGE_PLAY_BTN,g.FULLSCREEN_BTN],j=i.length,k=a.target.className;if(!this._hasDisabled(g.CONTROLS)){for(;j--&&!(d=d||k.indexOf(i[j])>-1););if(this.shouldTrapTaps()&&d&&j<i.length-1)return a.stopPropagation(),a.preventDefault(),void this.handleTap(i[j],a);e=!(d||this._isTouchActive&&h),e&&a.preventDefault(),e&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),f=c||e?this.HIDE_DELAY:0,c&&clearTimeout(c),c=setTimeout(b.bind(this),f)}},handleTap:function(a,b){var c=this.css,d=this._queryByElementName(a);if(!d.hasAttribute("disabled"))switch(a){case c.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(b);break;case c.VOLUME_BTN:this._onVolumeBtnEvent(b);break;case c.PLAYSTATE_BTN:case c.LARGE_PLAY_BTN:this._onPlayToggle(b);break;case c.SETTINGS_BTN:this._onSettingsBtnClick(b);break;case c.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(b);break;case c.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(b)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(a){a.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(a){var b=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);this._intervals[b]===-1&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[b]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(a){this._isMouseActive||(this._clearMouseMoveInterval(a),this._removeModifier(a,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(a){a.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var a=this._containerEl.offsetWidth;a>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),a<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(a){var b=this.vci,c=b.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(c?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(a){var b=parseFloat(a.target.value),c=this.vci.getPlayerMuted();c&&b>0&&this.vci.unMute(),this.vci.setVolume(b),this._updateVolumeUI(b,c)},_onFullscreenBtnClick:function(a){a.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),a.stopPropagation(),a.preventDefault();var b=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",b),b===this.mc.PAUSED||b===this.mc.EMPTY||b===this.mc.LOADING?void this.vci.playVideo():void(b!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()))},_onPreviewBtn:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(a.timeStamp)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback.")):(a.stopPropagation(),void this.vci.onPreviewButton(this._skinReadyCB.bind(this)))},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),a.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),a.stopPropagation();var b=this.css.CLOSED_CAPTION_BTN,c=this._hasActive(b);return c?(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions()):(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),void this._setCCPosition())},_onSettingsBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),a.stopPropagation();var b=this.css.SETTINGS_MENU,c=this._hasHidden(b);return uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",c),c?(this._addModifier(b,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(b)):(this._removeModifier(b,this.ACTIVE_MODIFIER),void this._hide(b))},_onSettingsMenuBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",a);var b=a.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",b),a.target.parentNode.setAttribute("data-target",b);var c=this._findMenuItem(b);this._generateSettingsMenu(c.items,b)},_onSettingsMenuInputClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",a);var b=a.target,c=b.parentNode,d=c.getAttribute("data-target"),e=d&&d.split(":")[0];switch(e){case"cc":this._onSettingsCaptionsChange(a);break;case"controls":this._onSettingsControlsChange(a);break;case"debug":this._onSettingsDiagWindowChange(a)}},_onSettingsCaptionsChange:function(a){var b=a.target,c=b.parentNode,d=b.getAttribute("data-property"),e=b.getAttribute("data-value").toLowerCase();return this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",d,e),f(c.children).each(function(a){a.setAttribute("data-selected","false")}.bind(this)),b.setAttribute("data-selected","true"),"text-position"===d?void this._setCCPosition(e):void this.vci.setCaptionsStyleProperty(d,e)},_onSettingsControlsChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",a);var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value").toLowerCase(),e="#"+this._containerId+" ";if("background-opacity"===c){c="background-color";var f=this._queryByElementName(this.css.CONTROL_BAR),g=getComputedStyle(f).getPropertyValue(c);if(g.indexOf("rgba")===-1)return;d=g.split(",").slice(0,-1).join(",")+", "+d+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",d),e+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(e,c,d)},_onSettingsDiagWindowChange:function(a){var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value"),e="true"===b.getAttribute("data-selected"),f=!e;this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",a),this._menuSelections[c]=d,b.setAttribute("data-selected",f),f?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(a){this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",a),this.vci.setCaptionsStyle(a))},_setCaptionsStyleProperty:function(a,b){this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",a,b),this.vci.setCaptionsStyleProperty(a,b))},_setCueProperty:function(a,b){if(this._captionsLoaded){var c=this._videoEl.textTracks;c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",a,b),this.vci.setCaptionsCueProperty(a,b))}},_setCCPosition:function(a){var b="text-position";this._captionsLoaded&&(a=a||this._getCaptionsStyle()[b],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",b,a),this.vci.setCaptionsStyleProperty(b,a))},_showControlBar:function(a){var b=this.vci.getCurrentPlaybackState().playbackState,c=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&b!==this.mc.EMPTY&&(f.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[c.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(c.CONTROL_BAR),this._show(c.PROGRESS))},_hideMenu:function(a){this._hasHidden(this.css.SETTINGS_MENU)||a.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(a){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=f.debounce(function(){return this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch?void this._hideControlBar.hide.cancel():(this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),void this._hide(this.css.PROGRESS))},a||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(a){var b,c=this.css;this._hasDisabled(c.VOLUME_BTN)||this._hasDisabled(c.CONTROLS)||(this._hasActive(c.SETTINGS_MENU)&&this._hide(c.SETTINGS_MENU),this._setDataAttribute(this._containerEl,c.VOLUME_SLIDER,!0),this._addModifier(c.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(c.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(b=this._controlsEl.querySelector(".uvpjs__volume-slider"),b&&b.setAttribute("style","bottom: 62px")))},_hideVolumeSlider:function(a){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._captionsLoaded=!0,this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._hasModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER)&&this.vci.showCaptions()},_disableCaptions:function(){this._captionsLoaded=!1,this._disableButton(this.css.SETTINGS_BTN),this._disableButton(this.css.CLOSED_CAPTION_BTN)},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn");var a=f.some(this.settingsMenu,"enabled");a&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(a,b){var c,d=uvpjs.util,e=this._containerEl,f=this.vci.getPlayerMuted();f===!0?c="mute":a>.85?c="full":d.inRange(a,.5,.85)?c="high":d.inRange(a,.15,.5)?c="medium":d.inRange(a,0,.15)&&(c="low"),this._volumeSlider.value=a||this._videoEl.volume,this._setDataAttribute(e,"volume-level",c),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,a)},_onProgressSliderChange:function(a,b){var c,d,e=this.vci.getContentVideoData(),f=this.vci.getCurrentPlaybackState(),g=this.css.TIME_CURRENT,h=this._queryByElementName(g),i=b||this._progressSlider.value;i=i>1?1:i<0?0:i,c=Math.ceil(i*e.duration*1e4)/1e4,d=Math.abs((f.currentTime-c)/c),this._updateProgressSlider(i),h.innerHTML=this._formatTimestampByType(g,c),this._hasActive(this.css.PROGRESS_SLIDER)||d<=.02||this.vci.seekTo(c)},_onProgressMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(a){var b=this.css;return this._hasAd()||this._hasDisabled(b.PROGRESS)?(a.stopPropagation(),void a.preventDefault()):(this._addModifier(b.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),void(this._isSliding=!0))},_onProgressSliderEnd:function(a){return this._hasAd()||this._hasDisabled(this.css.PROGRESS)?(a.stopPropagation(),void a.preventDefault()):(this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,void this._onProgressSliderChange(a))},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(a){var b,c;this._isLive()||(b=Math.ceil(a.bufferLength/a.duration*1e4)/1e4,f.isNaN(b)||b===1/0||b<=0||(this._downloaded=b,this._hasAd()||(c=this._queryByElementName(this.css.PROGRESS_LOADED),c.value=this._downloaded)))},_updatePlaybackStateUI:function(a){var b=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",a),a){case this.mc.PLAYING:this._show(b.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER);break;case this.mc.PAUSED:this._show(b.CONTROLS),this._showControlBar(),this._hide(b.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(b.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(b.CONTROLS);break;case this.mc.BUFFERING:this._show(b.CONTROLS),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.LARGE_PLAY_BTN),this._show(b.BUFFERING_FRAME);break;case this.mc.LOADING:this._show(b.CONTROLS),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.LARGE_PLAY_BTN),this._show(b.BUFFERING_FRAME)}},_updateProgressUI:function(a){var b=Math.ceil(a.currentTime/a.duration*1e4)/1e4;this._updateProgressSlider(b)},_updateSliderUI:function(a,b,c){var d=this,e={};if(!f.isUndefined(this._vendorPrefix)&&!f.isUndefined(a)){if(e.id="#"+this._containerId,e.cls=d._getClass(b),e.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[d._vendorPrefix],this._isMSEdge&&(e.pseudo=""),e.add=function(a,b,c){if(!f.isUndefined(this.pseudo)){var e=this.id+(b||"")+" "+this.cls+(c||"")+this.pseudo;d._addCSSRule(e,"background-size",100*a+"% 100%")}},e.before=function(a,b){
var c=d._getClass(d.PRIMARY_BLOCK);b&&(c+=d._getClass(d.PRIMARY_BLOCK,b)),this.add(a,c,null)},e.after=function(a,b){this.add(a,null,b)},b===d.css.VOLUME_SLIDER)return void e.add(c);var g=c*a.offsetWidth,h=(.5-c)*a.offsetHeight,i=g/a.offsetWidth,j=(g+h)/a.offsetWidth;a.value=c;var k=d._hasAd();e.before(i,k?d.AD_MODIFIER:null),k||e.after(j,":hover"),this._isTouch&&e.before(j,d.TOUCH_MODIFIER)}},_checkControlOnDOM:function(a){var b=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a;return!!this._controlCache[b]},_getClassName:function(a,b){var c=this.PRIMARY_BLOCK;return a!==this.PRIMARY_BLOCK&&(c+=this.BLOCK_ELEMENT_DELIMITER+a),b&&(c+=this.ELEMENT_MODIFIER_DELIMITER+b),c},_getClass:function(a,b){return this.CLASS_SELECTOR_PREFIX+this._getClassName(a,b)},_queryByClassName:function(a){var b,c;if(this._containerId)return b=this.ID_SELECTOR_PREFIX+this._containerId,a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),c=this._controlCache[b]||document.querySelector(b),c&&(this._controlCache[b]=c),c},_queryAllByClassName:function(a){var b=this.ID_SELECTOR_PREFIX+this._containerId;return a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),document.querySelectorAll(b)},_queryByElementName:function(a){return this._queryByClassName(this._getClassName(a))},_queryAllByElementName:function(a){return this._queryAllByClassName(this._getClassName(a))},_show:function(a){if(a===this.css.PROGRESS&&!this._isLive()){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="block"),c&&(c.style.display="block"),d&&(d.style.display="block")}this._removeModifier(a,this.HIDDEN_MODIFIER)},_hide:function(a){if(a===this.css.PROGRESS){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="none"),c&&(c.style.display="none"),d&&(d.style.display="none")}this._addModifier(a,this.HIDDEN_MODIFIER)},_enable:function(a){this._removeModifier(a,this.DISABLED_MODIFIER)},_disable:function(a){this._addModifier(a,this.DISABLED_MODIFIER)},_enableMenuItem:function(a){var b;a&&(b=this._findMenuItem(a),b&&(b.enabled=!0))},_hasHidden:function(a){return this._hasModifier(a,this.HIDDEN_MODIFIER)},_hasActive:function(a){return this._hasModifier(a,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(a){return this._hasModifier(a,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){var a=this.vci.getContentVideoData();return a.isLive&&this._isStreaming()},_isPlaying:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.PLAYING},_isStreaming:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.STREAMING},_hasModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,b),e=this._queryByElementName(a);return!!e&&c(e,d)},_addModifier:function(a,c){f.isArray(c)&&(c=c.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,c),e=this._queryByElementName(a);e&&b(e,d)},_removeModifier:function(a,b){var c,e=this._queryByElementName(a);f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER)),c=this._getClassName(a,b),e&&d(e,c)},_toggleModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var c=this._getClassName(a,b),d=this._queryByElementName(a);d&&e(d,c)},_setDataAttribute:function(a,b,c){a.setAttribute("data-"+b,c)},_removeDataAttribute:function(a,b){a.removeAttribute("data-"+b)},_formatTimestamp:function(a){var b,c;return uvpjs.util.isEmpty(a)||a===1/0?this.NULL_TIME:(isNaN(a)&&(a=0),b=new Date(null),b.setSeconds(Math.round(a)),c=b.toISOString(),a>=3600?c.substr(11,8):c.substr(14,5))},_formatTimestampByType:function(a,b){if("undefined"==typeof b||b<0){if(a===this.css.TIME_DURATION)return this.NULL_TIME;if(a===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(b)},_addCSSRule:function(a,b,c){var d=this._styleEl.sheet,e=d.cssRules.length;if(!f.isUndefined(this._cssRules[a])){var g=d.rules||d.cssRules;if(g.length>0)return void(g[this._cssRules[a]].style[b]=c)}this._cssRules[a]=e,uvpjs.util.addCSSRule(this._styleEl,a,b,c)},_setStyleSheet:function(a){var b=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(c){this._styleEl=c,b||"function"!=typeof a||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),b=!0,a())}.bind(this))},_templateToHTML:function(a){function b(a){var e="";return f(a).each(function(a){a&&(a.cls=f.isUndefined(a.cls)?c(a.el):[a.cls,c(a.el)].join(" "),a.children&&(a.children=b(a.children)),e+=f.template(d[a.type],{variable:"o"})(a))}),e}if(f.isArray(a)&&!f.isEmpty(a)){var c=function(a){return this._getClassName(this.css[a])}.bind(this),d={button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'};return b(a)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(a){return!!this._touchStartTime&&a-this._touchStartTime<this.TAP_THRESHOLD}}),c=function(a,b){return!f.isNull(a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)")))},b=function(a,b){c(a,b)||(a.className=(a.className+=" "+b).trim())},d=function(a,b){a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," ").trim()},e=function(a,e){return c(a,e)?void d(a,e):void b(a,e)}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(a,c,d,e){return this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",c),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",d)),b.isArray(c)?(this.vidContId=a,void this._generateAdPods(c,d,e)):void(this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN"))},_generateAdPods:function(a,b,c){var d,e,f,g=b.length,h=function(a,b,c){return{hasBeenChecked:!1,startTime:c||0,hasPlayed:!1,adPodId:a,adCount:0,podDuration:0,adCallURL:b}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",b)),this.adPods={},g>0&&(b.indexOf(0)>-1&&(this.adPods[this.PRE]=h(this.PRE+"_0",c)),b.indexOf(-1)>-1&&(this.adPods[this.POST]=h(this.POST+"_0",c))),d=0;d<g;d++)e=0===b[0]?d:d+1,f=b[d],isNaN(f)||0===f||f===-1||(this.adPods[this.MID_+e]=h(this.MID_+e,c,f));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",a),b.isString(a)){var c=this.adPods[a];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",c),c}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var a=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",a),a},getMidRollPods:function(){var a,b=[];if(!this.midRollPods){b=[];for(a in this.adPods)a.indexOf(this.MID)>=0&&b.push(this.adPods[a]);this.midRollPods=b}return this.midRollPods},isPreRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.MID)>-1},isPostRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var a in this.adPods)if(a.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(a){var b,c,d,e=null,f="No eligible ad pod found.";for(d in this.adPods)this.adPods.hasOwnProperty(d)&&(b=this.adPods[d],this.isPreRoll(b)||this.isPostRoll(b)||b.startTime<=a&&(e?a-b.startTime<a-e.startTime&&(e=b):e=b));return e&&(c=e.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",f="Found Ad pod; adPodId = "+e.adPodId+"; "+c),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+a+";  "+f),e}})}(uvpjs.register("uvpjs")),function(a){var b,c=a._;a.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,a&&this.initialize(a.vidContId,a.cviMgr)},destroy:function(){for(var a,b=this.agents.length;b--;)this.agents[b]&&"function"==typeof this.agents[b].destroy&&this.agents[b].destroy(),this.agents.splice(b,1);for(a in this.eventCBs)this.eventsMgr.removeEventListener(a+this.internalNS+".agent"),delete this.eventsMgr[a];for(a in this.progressEvents)delete this.progressEvents[a];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),c.isString(a)&&c.isObject(b)&&(this.vidContId=a,this.eventsMgr=b.getEventsMgr(),this.cviModel=b.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._createAgentsArray(),this._addTrackingEventListeners(),this._initializeAgents())},hasTrackingConfigOverrides:function(a){return null!==a&&a.hasOwnProperty("trackingConfigOverrides")&&null!==a.trackingConfigOverrides},getAgentConfig:function(a,b){for(var c=null,d=a.length;d-- >0;){var e=a[d];if(e.name===b){c=e;break}}return c},doTrackingConfigOverrides:function(a){if(!this.hasTrackingConfigOverrides(a))return void(this.agentConfigs=a.getModules().slice(0));for(var b=a.getModules().slice(0),c=b.length;c-- >0;){var d=b[c],e=this.getAgentConfig(a.trackingConfigOverrides,d.name);null!==e&&(b[c]=e)}this.agentConfigs=b},isTrackingAgentEnabled:function(a){var b=this.getAgentConfig(this.agentConfigs,a);return null!==b&&b.enabled},_createAgentsArray:function(a){var b,c,d,e,f,g,h;this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),c=a||this.cviModel,this.doTrackingConfigOverrides(c),e=c.isModuleEnabled.bind(c),f=c.isModuleSet.bind(c),d={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr},h=this.getPlayerName(),this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),d.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,d.playerName=h,b=new uvpjs.AdobeHeartbeatAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),d.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,b=new uvpjs.AkamaiAnalyticsAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),d.moduleName=this.COMSCORE_SS_MODULE_NAME,d.playerName=this.getPlayerName("|","_"),b=new uvpjs.ComScoreAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),d.moduleName=this.CONVIVA_MODULE_NAME,d.playerName=h,b=new uvpjs.ConvivaAgent(d),this.agents.push(b)),g=e(this.DW_MODULE_NAME),(g||e(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),d.moduleName=g?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,d.playerName=this.getPlayerName(";"),b=new uvpjs.DWAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),d.moduleName=this.NIELSEN_MODULE_NAME,d.playerName=h,b=new uvpjs.NielsenAgent(d),this.agents.push(b)),f(this.MUX_MODULE_NAME)&&!e(this.MUX_MODULE_NAME)?this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC"):(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent"),d.moduleName=this.MUX_MODULE_NAME,d.playerName=this.PLAYER_NAME_ONLY,d.playerVersion=this.PLAYER_VERSION_ONLY,e(this.MUX_MODULE_NAME)?d.useDefaultProperty=!1:(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Using default property"),d.useDefaultProperty=!0),b=new uvpjs.MuxAgent(d),this.agents.push(b));var i=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(i&&i.params&&i.params.length>0)for(var j=i.params.length;j-- >0;)this.beaconEndPoint[i.params[j].name]=i.params[j].value},_onPluginLoaded:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onPluginLoaded");var a=c.every(this.agents,"isPluginLoaded");this.debug&&uvpjs.log(this.DEBUG_ID,"pluginLoadedCB pluginsLoaded",a),a&&c.isFunction(this.agentsLoadedCB)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAgentPlugins _pluginsLoaded all loaded."),this.agentsLoadedCB())},_addTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress.bind(this)),a.addEventListener(b.RESOURCE_START+c,this._onResourceStart.bind(this)),a.addEventListener(b.PLAYBACK_DURATION_RESUME+c,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.removeEventListener(b.VIDEO_PROGRESS+c),a.removeEventListener(b.AD_QUARTILE+c),a.removeEventListener(b.RESOURCE_START+c)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents"),c.isEmpty(this.agents))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."));for(var a=this.agents.length;a--;)this.agents[a].initialize();this._addAgentEventListeners()},loadAgentPlugins:function(a,b){var d,e,f;if(this._createAgentsArray(a),c.isEmpty(this.agents))return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."),void b();for(d=this.mc.hasTealium(),d&&this.debug&&uvpjs.log(this.DEBUG_ID,"Tealium detected on the page."),this.agentsLoadedCB=b,f=this.agents.length;f--;)e=this.agents[f],c.isFunction(e.loadPlugin)?e.loadPlugin(this._onPluginLoaded.bind(this),a):this._onPluginLoaded.call(this)},fireTrackingPixel:function(a){var b=document.createElement("img");b.setAttribute("src",a),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("border","0"),b.style.position="absolute",b.style.bottom="0",b.style.right="0",this._beaconElement.appendChild(b)},registerEventCallbacks:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.eventCBs[b]=this.eventCBs[b]||[],this.eventCBs[b].push(a[b])},registerProgressEvents:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",b),this.progressEvents[b]=this.progressEvents[b]||[],this.progressEvents[b].push(a[b])},getContentPlayhead:function(){var a=this.cviModel.contentPlaybackState.currentTime;return parseInt(a)},getPlayerName:function(a,b){var d=this.PLAYER_NAME;return c.isEmpty(d)?"UVPJS":(a&&(d=d.replace("_",a)),b&&(d=d.replace(/\./g,b)),d)},getAdLength:function(){return this._adLength=b(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=b(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var a in this.eventCBs)this.eventsMgr.addEventListener(a+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(a){if(a.target===this.vidContId){var b,d=this.eventCBs[a.type];if(!c.isEmpty(d)){b=d.length;for(var e=0;e<b;e++)d[e](a)}}},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(a){var b,d=this.progressEvents[a];if(!c.isEmpty(d))for(b=d.length,i=0;i<b;i++)d[i]()},_onPlaybackDurationResume:function(b){var c=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),d=this.cviModel.getContentVideoState(),e={ts:Math.floor(Date.now()/1e3),contentid:d.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:c("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:d.isPaidContent,affiliate:d.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},f=(new a.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(e).devMode(this.debug).buildUrl();this.fireTrackingPixel(f)},_onVideoProgress:function(a){var b,d=a.payload,e=Math.floor(d.currentTime),f=d.duration;if(e&&f&&!d.isAd&&!(this._lastContentSecondCompleted>=e)){if(this._lastContentSecondCompleted=e,e%15===0&&e<=60||e%60===0){if(this._contentTimeFired[e])return;this._contentTimeFired[e]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",e),this._onProgressEvent(this.progressEvents.TIMED)}d.isPlayingLive||f<=10||(b=Math.floor(e/f*100),b!==this.percentDone&&(this.percentDone=b),c.inRange(b,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),c.inRange(b,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),b>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),b=function(a,b){var c=1e3,d=b>0?Math.floor(b*c):0,e=uvpjs.util.inRange(a,d-c,d+c);return e?a:d}}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f,g;g=a._,a.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata={},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),g.isUndefined(this._visitorData.marketingCloudOrgId)?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID.")):void this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a,b){var c;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),!g.isFunction(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"));c=b?b.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),this._usesTealium=c.usesTealium;var d=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];return this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),d=g.without(d,this.scriptPaths.APP_MEASUREMENT)),e()&&!this.isPluginLoaded?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(d,this.pluginLoadedCB)):(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),void this.pluginLoadedCB())},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var a=this._qosObject;return b.createQoSObject(a.bitrate,a.startupTime,a.fps,a.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),b=a(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),c=a(this.TRACKING_SERVER_PARAM_NAME);this.mc.isSecure()&&(g.isString(c)&&0!==c.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(c=this.TRACKING_SERVER_SSL_PREFIX+c),g.isString(b)&&(b=b.replace("heartbeats.omtrdc.net","cbsinteractive.hb.omtrdc.net"))),this._appMeasurementData={account:a(this.ACCOUNT_PARAM_NAME),charSet:a(this.CHAR_SET_PARAM_NAME),trackingServer:c},this._heartbeatData={publisher:a(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:b},this._visitorData={marketingCloudOrgId:a(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:c},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var a=this.cviModel.sessionOptions;this._usesTealium=a.usesTealium;var b={ftag:"ftag",netwk:"Network"};g.each(b,function(b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",b,c);var d=a[c];g.isNull(d)||g.isUndefined(d)||g.isEmpty(d)||(this._sessionMetadata[b]=d)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_POD_END]=this._onAdPodEnd.bind(this),b[a.AD_CLICK]=this._onAdClick.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_SEEK]=this._onControlSeek.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),b[a.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),b[a.PLAYER_LOADED]=this._updateVideoInfo.bind(this),b[a.RESOURCE_START]=this._updateVideoInfo.bind(this),b[a.VIDEO_RESUME]=this._updateVideoInfo.bind(this),b[a.VIDEO_DONE]=this._updateVideoInfo.bind(this),this._contextMetadataCBSetup||(b[a.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(b)},_setupContextMetadataEventCallback:function(){var a={};a[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(a),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function a(a){this._agent=a}var h,i,j,k;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded."));if(this._mediaHeartbeat)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used."));if(b=ADB.va.MediaHeartbeat,c=ADB.va.MediaHeartbeatConfig,d=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!f(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)i=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(h=this._appMeasurementData.account,g.isString(h)&&g.isEmpty(h))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));k=new Visitor(this._visitorData.marketingCloudOrgId),k.trackingServer=this._visitorData.trackingServer,k.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),i=new AppMeasurement(h),i.visitor=k,i.account=h,i.trackingServer=this._appMeasurementData.trackingServer,i.pageName=this._appMeasurementData.pageName,i.charSet=this._appMeasurementData.charSet,i.visitorID=this._appMeasurementData.visitorID}return g.isNull(i)?void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed.")):(j=new c,j.trackingServer=this._heartbeatData.trackingServer,j.playerName=this._playerName,j.channel=this._heartbeatData.channel,j.debugLogging=this._heartbeatDebug,j.appVersion=this.SDK_VERSION,j.ssl=this.mc.isSecure(),j.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",j),g.extend(a.prototype,d.prototype),a.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},a.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new b(new a(this),j,i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),void(this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()))},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),f(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),g.has(window,"s")&&f(window.s)?(this._s=window.s,
this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(a,c){if(g.isNull(this._mediaHeartbeat))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined"));switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",a),a){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(b.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(b.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(b.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(b.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(b.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(b.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(c)}},_getContentVideoMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),d=this._contextMetadata,e=this._sessionMetadata,f={};for(a in d)d.hasOwnProperty(a)&&(f[a]=d[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);if(c.contextMetadata){b=c.contextMetadata;for(a in b)b.hasOwnProperty(a)&&(f[a]=b[a])}return f.tl=c.videoTitle,f.mediaAutoPlay=this.cviModel.isAutoplay,f.mediaMuted=this.cviModel.isMuteAtPlayStart,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",f),f},_onContextMetadata:function(a){var b,c=a.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",a),!g.isEmpty(c)&&(this._contextMetadata=c,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),!g.isEmpty(c[this.PAGE_REPORT_SUITE_ID_KEY]),b=c[this.PAGE_SITE_ACCOUNT_KEY],!g.isEmpty(b))){var d=g.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=b,d&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+b),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(a){var c,d,e,f,g,h=a.chapterStartTimes,i=h&&h.length||0,j=parseInt(a.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",a),isNaN(j)&&(j=1),c=j<0?0:j-1,d=c<=0?0:h[c],e=c+1>i?a.duration:h[c+1],g=e-d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e,d),f={},f.name="",f.length=isNaN(g)?0:g,f.position=j,f.startTime=h[c],this._chapterObject=b.createChapterObject(f.name,f.position,f.length,f.startTime),this._chapterInfo=f,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(a){var c,d,e,f,h,i;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",a),i=a.payload.adData,h=i.adClipID.split("_"),f=h[0],"pre"===f?e=1:"mid"===f?e=parseInt(h[1])+1:"post"===f&&(e=this.cviModel.getNumberOfAdPods()),d={},d.name=g.isEmpty(i.adVideoTitle)?"na":i.adVideoTitle,d.position=e,d.playerName=this._playerName,d.startTime=this.getCurrentPlaybackTime(),c={},c.id=g.isEmpty(i.adVideoId)?g.isEmpty(i.adVatId)?"na":i.adVatId:i.adVideoId,c.name=d.name,c.length=i.duration,c.position=i.adPosition,this._adObject=b.createAdObject(c.name,c.id,c.position,c.length),this._adBreakObject=b.createAdBreakObject(d.name,d.position,d.startTime),this._adInfo=c,this._adBreakInfo=d,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(a){var b=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(b)},_onAdClick:function(a){var b=a.payload.adData.paused===!0;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),b&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",b),this._contentStarted=!0,this._sendInitialPlay(),b.chapterStartTimes.length>0&&(this._setChapterInfo(b),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",b),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&b.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(a){var b=this._videoInfo,c=this._contentStarted&&b&&Math.ceil(b.playhead)>=.95*b.length;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",c),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,c&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(a){var b=a.payload.newState;uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",b),this._videoLoaded&&(this._isBuffering||b!==this.mc.BUFFERING?this._isBuffering&&b!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),b===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY))},_updateVideoInfo:function(){var a,c=this.cviModel.getCurrentPlaybackState(),d=this.cviModel.getContentVideoState(),e=b.StreamType,f=d.duration,h=d.isLive,i=d.episodeFlag,j={};g.isEmpty(d.cmsRefGuid)?g.isEmpty(d.mediaId)?g.isEmpty(d.pid)?g.isEmpty(d.assetURL)?j.id="na":j.id=d.assetURL:j.id=d.pid:j.id=d.mediaId:j.id=d.cmsRefGuid,j.name=d.videoTitle,j.playerName=this._playerName,j.length=h?-1:isNaN(f)?0:f,j.playhead=c.currentTime,h?a=e.LIVE:(a=e.VOD,a+=":"+(i?this.FULL_EPISODES:this.CLIPS)),j.streamType=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",b),this._mediaObject=b.createMediaObject(j.name,j.id,j.length,j.streamType),this._videoInfo=j,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(a){var b=a&&a.facadeState,c=this._qosObject;b&&c&&(c.bitrate=b.currentBitrate||0,c.droppedFrames=b.droppedFrames||0,c.fps=b.playbackFramerate||0)},_updatePlayhead:function(a){var b=a.payload;this._videoInfo&&b&&(b.isAd||(this._updateQosObj(b),this._videoInfo.playhead=b.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)}}),e=function(){return"undefined"==typeof ADB||"undefined"===g.get(ADB,"va.Heartbeat")},f=function(a){return g.isObject(a)&&!g.isEmpty(a)&&g.isFunction(a.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(a){var b,c=a._,d=function(a){return(a>0&&a<10?"0":"")+a.toString()},e="lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js",f="3005086",g="*null",h={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};a.ComScoreAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,SCRIPT_PATH:uvpjs.Configuration.path+e,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.streamingTag=null,this._isAd=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._loadConfigData(),this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent loadPlugin"),c.isFunction(a)?(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),b()&&!this.isPluginLoaded?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.SCRIPT_PATH,this.pluginLoadedCB)):(this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent loadPlugin plugin already loaded into the page"),void this.pluginLoadedCB())):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent loadPlugin no callback supplied."))},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:a("c2")||f,ns_st_pu:a("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.RESOURCE_START]=this._onResourceStart.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),b[a.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){return b()?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded.")):void this._setupEventCallbacks()},_createStreamingTag:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",a),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(a)},_getContentMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),e=(this.cviModel.getContentPlaybackState(),uvpjs.util),f=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),i=this.cviModel.getContentVideoState().isLive,j=parseInt(c.episodeNumber),k=parseInt(c.seasonNumber),l=(c.seriesTitle,c.videoTitle),m=l&&l.split("-")[1],n=!isNaN(j),o=!isNaN(k),p=null!==c.contextMetadata&&c.contextMetadata.comscore_c4,q=l;return n&&o&&(a=d(j),b=d(k),q+="--"+b+a),{ns_st_ci:e.getDefinedString(c.cmsRefGuid,c.mediaId,"0"),ns_st_cl:i?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[h.publisherBrand],ns_st_pr:e.getDefinedString(c.seriesTitle,c.videoTitle),ns_st_ep:m,ns_st_sn:o&&b||g,ns_st_en:n&&a||g,ns_st_ge:c.category||g,ns_st_ia:i?1:0,ns_st_ddt:g,ns_st_tdt:g,ns_st_st:f("c4")||g,ns_st_ce:c.episodeFlag?1:0,c3:f("c3")||this._playerName,c4:p||f("c4")||g,c6:f("c6")||q}},_onAdStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",a),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",a),this._isAd=!1,this._trackStop()},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",a);var b=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?b.Live:b.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",a),this._trackStop()},_onControlPlay:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",a),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",a),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",a),this.streamingTag=null},_onLiveSegmentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",a),this._isLiveEvent(a)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=a.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",a),this._trackStop()},_onVideoProgress:function(a){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=a.util.copyObjectWithKeyMap(h).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(a){return this.cviModel.getContentVideoState().isLive&&a.payload&&a.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof a.payload.liveSegmentData},_isSameLiveStation:function(a){return a.stationTitle===this._contentMetadata[h.stationTitle]},_getAdType:function(){var a,b=ns_.ReducedRequirementsStreamingAnalytics.AdType,c=this.cviModel.getAdVideoState().adClipID.split("_")[0];return a="pre"===c?b.LinearOnDemandPreRoll:"mid"===c?b.LinearOnDemandMidRoll:b.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(a=b.LinearLive),a}}),b=function(){return"undefined"==typeof ns_||c.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(a){"use strict";a.ConvivaAgent=uvpjs.Class.subClass({init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",a),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.currAdPodInfo=null,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.playStates={},this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.adPodInProgress=!1,this.adPodStartSent=!1,this.startEvents={ad:0,content:0}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a){return"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent loadPlugin: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),void 0!==window.Conviva||this.isPluginLoaded?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(uvpjs.ConvivaAgent.SDK_PATH,this.pluginLoadedCB)))},_initializePlugin:function(){return void 0===window.Conviva?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent _initializePlugin Conviva SDK not properly loaded.")):void(this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client."))))},_getAdType:function(a){var b="string"==typeof a?a.toLowerCase():null,c=Conviva.Client.AdPosition,d=uvpjs.ConvivaAgent.adPositions;return b?b.indexOf(d.PRE)>=0?c.PREROLL:b.indexOf(d.MID)>=0?c.MIDROLL:b.indexOf(d.POST)>=0?c.POSTROLL:void 0:"N/A"},_getArgsForStartAd:function(a){var b=Conviva.Client.AdStream,c=Conviva.Client.AdPlayer,d="ima"==a.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(a.adType),stream:d?b.SEPARATE:b.CONTENT,player:d?c.SEPARATE:c.CONTENT}},_onAdEvent:function(a){var b,c,d,e=this.eventTypes,f=a.type,g=null;if(this.startEvents.content=0,this.hasConvivaSession){switch(f){case e.AD_POD_START:this.currAdPodInfo=this._buildAdPodInfo(a.payload.adPod),this.adPodInProgress=!0,this.adPodStartSent=!1;break;case e.AD_START:b=a.payload.adData,c=this._buildAdInfo(b),this.adPodInProgress&&!this.adPodStartSent&&(this.adPodStartSent=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo)),this.startEvents.ad=1,d=this._getArgsForStartAd(b),this.convivaClient.adStart(d.key,d.stream,d.player,d.pos),g="adStart";break;case e.AD_POD_END:this.adPodInProgress=!1,this.adPodStartSent=!1,c=this.currAdPodInfo||{},this.currAdPodInfo=null,g="Conviva.PodEnd";break;case e.AD_END:c=this._buildAdInfo(a.payload.adData),g="adEnd",this.startEvents.ad=0,this.convivaClient.adEnd(this.convivaSessionKey)}g&&this._sendCustomEvent(g,c),this._setConvivaPlayerState()}},_onContentEvent:function(a){var b=!1;this.startEvents.ad=0,a.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),b=!0):(a.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,b=!0),this._setConvivaPlayerState()),b&&(this.adPodInProgress=!1,this.adPodStartSent=!1,this.currAdPodInfo=null)},_onVideoEvent:function(a){var b=this.eventTypes,c=a.type;if(this.hasConvivaSession)switch(c){case b.VIDEO_STATE_CHANGE:case b.VIDEO_TRANSITION_COMPLETE:case b.VIDEO_DONE:this._setConvivaPlayerState();break;case b.RESOURCE_END:this._setConvivaPlayerState(),this._killConvivaSession()}},_onError:function(a){var b=a.payload.errorInfo;b.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(b.message,Conviva.Client.ErrorSeverity.FATAL),this._killConvivaSession()):this._sendError(b.message,Conviva.Client.ErrorSeverity.WARNING)},_createConvivaSession:function(){if(this.convivaClient){var a=this.cviModel,b=this._getMediaCapabilities(),c=Conviva.PlayerStateManager.PlayerState,d={userId:a.getSessionOption("userId"),userPPID:a.getSessionOption("userPPID"),userStatus:a.getSessionOption("userStatus")},e=new Conviva.ContentMetadata;this._setContentMetadata(e,d),this.convivaSessionKey=this.convivaClient.createSession(e),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.playStates[b.EMPTY]=c.UNKNOWN,this.playStates[b.LOADING]=c.UNKNOWN,this.playStates[b.STOPPED]=c.STOPPED,this.playStates[b.PLAYING]=c.PLAYING,this.playStates[b.PAUSED]=c.PAUSED,this.playStates[b.BUFFERING]=c.BUFFERING,this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.adPodInProgress=!1,this.adPodStartSent=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_setConvivaPlayerState:function(){var a=this.cviModel,b=a.isCurrVideoAd,c=b?a.adPlaybackState:a.contentPlaybackState,d=!b&&a.contentPlaybackState.facadeState,e=d&&d.currentAbr||null,f=e?e.bitrate:b?0:a.contentPlaybackState.playbackBitrate,g=c.playbackState,h=this.playStates[g];this.hasConvivaSession&&("PLAYING"==h&&(b&&!this.startEvents.ad||!b&&!this.startEvents.content)&&(h=Conviva.PlayerStateManager.PlayerState.UNKNOWN),h&&(this.convivaPlayerStateManager.setPlayerState(h),f>0&&(f*=.001),this.convivaPlayerStateManager.setBitrateKbps(f)),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _setConvivaPlayerState stateLabel",h))},_sendCustomEvent:function(a,b){var c=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.convivaClient.sendCustomEvent(c,a,b)},_sendError:function(a,b){this.hasConvivaSession&&(this.convivaPlayerStateManager.sendError(a,b),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sending ERROR: "+a))},_setContentMetadata:function(a,b){var c=this.cviModel,d=Conviva.ContentMetadata.StreamType,e=c.contentVideoState,f=e.defaultBitrate;a.applicationName=this.playerName,a.assetName=this._validateStr(e.videoTitle,"N/A"),a.defaultBitrateKbps=f&&f>0?f:700,a.defaultResource=this._validateStr(e.cdn,"N/A"),a.duration=e.duration,a.streamType=e.isLive?d.LIVE:d.VOD,a.streamUrl=this._validateStr(e.assetURL,"N/A"),a.viewerId=this._validateStr(b.userId,"N/A"),a.custom={accessType:this._validateStr(b.userStatus,"anon"),contentId:this._validateStr(e.cmsRefGuid,"N/A"),contentType:e.isLive?"Live":"VOD",isEpisode:e.episodeFlag?"true":"false",Partner_ID:this._validateStr(c.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(e.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._validateStr(e.episodeTitle,e.videoTitle),appRegion:this._validateStr(c.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:e.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(e.drm),isAd:c.isCurrVideoAd.toString(),connectionType:this._validateStr(c.sessionOptions.userConnectionType,"unknown")}},_getWinDimension:function(){var a=this.cviModel.contentVideoState.sourceWidth,b=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(a=window.screen.width),window.screen.height&&(b=window.screen.height)),a+"x"+b},_createConvivaClient:function(){var a=this._getConvivaClientSettings();return a?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(a,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var a,b=this.moduleParams;return this._isValidStr(b.customerKey)&&this._isValidStr(b.serviceUrl)?(a=new Conviva.ClientSettings(b.customerKey),a.heartbeatInterval=b.heartbeatInterval||this.defaultHeartbeatInterval,a.gatewayUrl=b.serviceUrl,a):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(a){var b="development"===uvpjs.Configuration.env,c=Conviva.SystemSettings.LogLevel;a.allowUncaughtExceptions=b,a.logLevel=b?c.WARNING:c.NONE},_createConvivaSystemFactory:function(){var a=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),b=new Conviva.SystemSettings;return this._setConvivaSystemProps(b),new Conviva.SystemFactory(a,b)},_buildAdPodInfo:function(a){var b,c,d,e,f,g={},h=uvpjs.ConvivaAgent.adPositions;if(!a)return null;if(void 0!==a.podDuration&&(g.podDuration=String(a.podDuration)),!a.adPodId)return g;switch(b=a.adPodId.split("_"),c=b[0].toLowerCase(),d=c.charAt(0).toUpperCase()+c.slice(1),e=+b[1],c){case h.PRE:f=1;break;case h.MID:f=e+1;break;case h.POST:f=this.cviModel.getNumberOfAdPods()}return g.podPosition=d+"-roll",g.podIndex=String(f),g},_buildAdInfo:function(a){var b={},c=this.cviModel.getSessionOption("partner");return a?(b.adTitle="("+a.adVideoId+")"+a.adVideoTitle,b.adClipId=this._validateStr(a.adClipID,"N/A"),b.Partner_ID=this._validateStr(c,"N/A"),b.adServerName=this._validateStr(a.adServerName,"N/A"),b):null},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_isDynamicStreaming:function(a){var b=a.split("?"),c=b[0].substr(b[0].lastIndexOf(".")+1);return"mp4"===c?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var a,b=this.cviModel,c=b.getModule(this.moduleName),d=c.params,e=d.length,f={};e--;)a=d[e],f[a.name]=a.value;this.moduleParams=f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onAdEvent.bind(this),d=this._onContentEvent.bind(this),e=this._onVideoEvent.bind(this),f=this._onError.bind(this);b[a.AD_START]=c,b[a.AD_POD_START]=c,b[a.AD_END]=c,b[a.AD_POD_END]=c,b[a.CONTENT_DATA_LOADED]=d,b[a.CONTENT_START]=d,b[a.CONTENT_END]=d,b[a.VIDEO_STATE_CHANGE]=e,b[a.VIDEO_TRANSITION_COMPLETE]=e,b[a.VIDEO_DONE]=e,b[a.RESOURCE_END]=e,b[a.PLAYER_START_ERROR]=f,b[a.VIDEO_START_ERROR]=f,b[a.VIDEO_PLAYBACK_ERROR]=f,b[a.AD_ERROR]=f,this.trackingMgr.registerEventCallbacks(b),window.addEventListener("beforeunload",function(){this._killConvivaSession()}.bind(this),!1)}}),a.ConvivaAgent.SDK_PATH=uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js",a.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(a){"use strict";a.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,SCRIPT_PATH:"//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js",NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",a),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent loadPlugin"),"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent loadPlugin no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),b()&&!this.isPluginLoaded?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.SCRIPT_PATH,this.pluginLoadedCB)):(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent loadPlugin plugin already loaded into the page"),void this.pluginLoadedCB()))},_initializeParams:function(){var a,b,c,d=this.cviModel,e=this._metadata,f=d.sessionOptions.partner,g=d.getModule(this._moduleName),h=g.params,i=h.length,j={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");i--;)a=h[i],""!==a.value&&(j[a.name]=a.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:j[this.NIELSEN_SFCODE_PARAM_NAME],apid:j[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:j[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},
f){case"chow":b="us-700144",c="c06";break;case"tvcom":b="us-200330",c="c03";break;case"cbs":b="us-700144",c="c01";break;case"can":b="us-700144",c="c01";break;case"cbssports":b="us-201669",c="c02";break;case"cbssports_test":b="us-201669",c="c02";break;case"news":b="us-700144",c="c03";break;case"gamespot":b="us-200330",c="c13";break;case"cnettv":b="us-200330",c="c05";break;default:b="us-700144",c="c01"}e.ci=j.clientid||b,e.c6=j.vcid||c,e.iag_sid=j.iag_sid,e.iag_tfid=j.iag_tfid,e.channelName=j.channelName,e.segB=j.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",j,e)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){return b()?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded.")):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams),void this._setupEventCallbacks())},_notifySDK:function(a,b){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",a,b),this._gg.ggPM(a,b))},_onContentDataLoaded:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.mediaCapabilities.isMobile(),k=this._metadata,l=a.payload;l&&(b=a.payload.vidState,d=b.chapterStartTimes.length>0?"lf":"sf",f=b.episodeNumber,g=b.seasonNumber,h=b.seriesTitle,i=b.videoTitle,c=b.duration,e=[i,g,f,d].join("|"),""===g&&(g="0"),""===f&&(f="0"),b.isAffiliateFeed&&(k.tv="true"),(b.isLive||c===-1)&&(c=this.NIELSEN_LIVE_VIDEO_DURATION),k.pc=k.ci+k.c6+k.cmsRefGuid,k.c10="plt,"+(j?"MBL":"DSK"),k.sd=c,k.dur=c,k.cg=h,k.tl=e,k.videotype="content",k.guid=b.cmsRefGuid,k.seriestitle=h,k.episodetitle=i,k.isfullepisode=b.episodeFlag?"y":"n",k.crossId1=b.mediaId,k.iag_pgm=i,k.iag_epi=e,k.iag_pd=location.hostname,k.iag_fp=d,k.iag_cte="na",k.iag_oad="na",k.iag_seg=1,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",k))},_onAdStart:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.cviModel.getContentVideoState(),m=a.payload;m&&(this._metadata.hasAds=1,this._adDisplayed=!0,k=uvpjs._.clone(this._metadata),b=m.adData,c=b.adClipID.split("_"),e=c[0],i=this.cviModel.getNumberOfAdPods(),j="post"===e?i:++c[1],d=["dav0",l.videoTitle,l.seasonNumber,l.episodeNumber].join("-"),h=[i,j,this._numAdsInPod,c[2]].join("_"),f=b.adVatId,g=b.adVideoUrl,""!==f&&(g+="|"+f),k.videotype=e+"roll",k.iag_cte=g,k.iag_pod=h,k.iag_apt="na",k.tl=d,k.c3="st,a","pre"===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",k),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,k))},_onAdPodStart:function(a){var b=a.payload;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",b.adPod.adCount),this._numAdsInPod=b.adPod.adCount)},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(a){var b,c=a.payload;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),c)return this._metadata.iag_seg&&this._metadata.iag_seg++,b=a.payload.contentData,b.duration>0&&Math.abs(b.duration-this._lastContentSecond)<=5?void this._notifySDK(this.events.END,this._lastContentSecond):void this._notifySDK(this.events.STOP,this._lastContentSecond)},_onControlPlay:function(a){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(a){var b,c=a.payload;if(c&&(b=Math.floor(c.currentTime),!(b<0))){if(c.isAd){if(this._lastAdSecond===b)return;this._lastAdSecond=b}else{if(this._lastContentSecond===b)return;this._lastContentSecond=b}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,b)}},_onVideoCuepoint:function(a){var b=a.payload,c=b.data;b.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&c&&"string"==typeof c&&this._notifySDK(this.events.SEND_ID3,c)},_hasAds:function(){var a=this.cviModel.getNumberOfAdPods();return a===-1?2:0===a?0:1},_isDisabled:function(){var a=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===a||a===!0}});var b=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e=a._;a.DWAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"//dw.cbsi.com/levt/video/e.gif?",RESUME_BEACON_URL:"//dw.cbsi.com/levt/beacon/e.gif?",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),a.componentid=this.trackingMgr.componentid,a.device=this._getDevice(),a.mapp=this._playerName,a.part=this.cviModel.getSessionOption("partner"),a.playertime=0,a.siteid=this.trackingMgr.DEFAULT_SITEID,a.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var a=this.cviModel,b=a.getSessionOption("cms"),c=a.getContentVideoState(),d=a.getCurrentPlaybackState(),e=uvpjs.mediaCapabilities,f=this._tags.content,g=this._tags.ad,h=this.trackingMgr;g.adastid=b===h.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(f.medastid)||0===f.medastid||"0"===f.medastid)&&(c.isLive?c.isAffiliateFeed?f.medastid="cbsnews"===a.getSessionOption("playerId")?"601":"600":d.isHDStreamLive||e.isChromecast()?f.medastid="601":f.medastid="0":f.medastid=b===h.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",f.medastid,g.adastid))},_loadConfigParams:function(){for(var a,b,c,d=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),f=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],g=f.length;g--;)b=f[g],a=this._getTagType(b),c=d(b),e.isUndefined(a)||e.isEmpty(c)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",b,c),this._tags[a][b]=c);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var a,b,c,d=window.DW&&window.DW.pageParams||{};this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams");for(a in d)d.hasOwnProperty(a)&&(c=d[a],e.isEmpty(c)||(this._pageParams[a]=c,b=this._getTagType(a),e.isUndefined(b)||(this._tags[b][a]=c)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_BLOCKED]=this._onAdBlocked.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.AD_ERROR]=this._onAdError.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.USER_GESTURE]=this._onUserGesture.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(b),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var a=this.trackingMgr.progressEvents,b={};b[a.FIRST_QUARTILE]=this._onProgressEvent.bind(this,a.FIRST_QUARTILE),b[a.MID_QUARTILE]=this._onProgressEvent.bind(this,a.MID_QUARTILE),b[a.THIRD_QUARTILE]=this._onProgressEvent.bind(this,a.THIRD_QUARTILE),b[a.TIMED]=this._onProgressEvent.bind(this,a.TIMED),this.trackingMgr.registerProgressEvents(b)},_sendDWEvent:function(a){var b=this._tags.content,e=b.event,f=e===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),b.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:d(this._gestval),e!==this.events.INIT&&(b.playertime=this._getPlayerTime()),b.ts=+new Date,f+=c(b),a&&(f+="&"+c(this._tags.ad)),this.trackingMgr.fireTrackingPixel(f),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",f),this._gestval={},b.gestval="",b.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var a=window.location,b=uvpjs.mediaCapabilities,c=b.isMobile()?"mobile%20web":"desktop%20web",d=this.cviModel.getSessionOption("userStatus"),f=this.cviModel.getSessionOption("userId"),g=this._tags.content,h=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,g.event=this.events.INIT,g.mso=this.trackingMgr.mso,g.pageurl=a.href,g.srchost=a.host,g.ursuid=f,g.v16=h.viewguid,g.v17=h.topic,g.v18=h.topicbrcrm,g.v19=h.pagetype,g.v20=h.assetguid,g.v21=b.isChromecast()?"chromecast":c,g.v23=h.rsid,g.v25=e.isEmpty(d)?"anon":d,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(a){var b=this.trackingMgr.progressEvents,c=this._tags.content,d=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",a),a)switch(a){case b.FIRST_QUARTILE:d.pct=25;break;case b.MID_QUARTILE:d.pct=50;break;case b.THIRD_QUARTILE:d.pct=75}c.event=this.events.PLAY,this._sendDWEvent(),delete d.pct}},_onAdBlocked:function(a){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(a){var b=this._tags.ad,c=a.payload.adData,d=c.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),b.adid=e.isEmpty(c.adVideoId)?"999":c.adVideoId,b.adnum=this.cviModel.adNum,b.adtime=0,b.adtitle=c.adVideoTitle,b.adtype=c.isLinear?1:2,b.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),b.adbreak="",b.adpos=d[0],b.adpod=d[1],b.adpodpos=d[2],this._sendDWEvent(!0)},_onAdQuartile:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",a),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(a){var b=a.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",a),this._tags.content.event=this.events.END,this._tags.ad.adtime=b.duration,this._sendDWEvent(!0)},_onAdError:function(a){var b=a.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",a),b===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(a){var b=this.cviModel,c=b.getContentVideoState(),d=this._tags.content,f=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",a),d.event=this.events.START,d.codec=c.fileType,d.distntwrk=b.getSessionOption("netwk"),d.playersz=this._getPlayerSize(),d.sdlvrytype=this._getStreamType(),d.v22=c.cmsRefGuid,d.medid=c.mediaId,d.medlength=this.trackingMgr.getContentLength()/1e3,d.mednum=b.medNum,d.medrls=c.pid,d.medtitle=c.videoTitle,d.contsessid=c.previousSessionId,e.isEmpty(c.contPlayState)||(f.autoplay=c.contPlayState),f.paywall=c.isPaidContent?"1":"0",f.caption_available=c.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",a),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(a),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(a.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),a.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(a){var b=a&&a.payload,c=b&&b.seekFromTime,d=b&&b.seekToTime,e=d-c,f=this._tags.content;f.eventdur=Math.floor(Math.abs(e)),f.event=e>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:c,seekToTime:d,seekDuration:e,event:f.event,eventdur:f.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(a){var b,c,d,f,g,h,i,j=this._tags.content,k=this._gestval,l=a.payload.gestureInfo,m=this.cviModel.contentVideoState,n=m.elapsedTime,o="",p=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",a),"string"==typeof l&&l.indexOf("event=")===-1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");if(e.isArray(l)){if(l.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");o=l[0]}if(m=this.cviModel.contentVideoState,"string"==typeof l)f=/event=([^&]*)(?:&gestval=(.*))?/,g=f.exec(l),h=g[1],i=g[2],j.event=h,j.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr="undefined"==typeof i?"":i;else if(o===p.GLOBAL_RESUME||o===p.LOCAL_RESUME)k.prevcomponentid=m.previousSessionId,k.eventdur=n>0?Math.round(n/1e3):0,k.paywall=m.isPaidContent?"1":"0",j.event=this.events.RESUME,j.medtime=m.resumeContentTime;else if(o===p.CONT_CANCEL)k.action=this.events.PROMPT;else switch(j.medtime=this.cviModel.contentPlaybackState.currentTime,o){case p.RELATED_OVERLAY:j.event=p.RELATED_OVERLAY;break;case p.RELATED_CLICK_GESTURE:l.length>=2&&(k.related_pid=l[1]),j.event=p.RELATED_CLICK_GESTURE;break;case p.SHARE_OVERLAY:j.event=p.SHARE_OVERLAY;break;case p.SHARE_NETWORK_GESTURE:l.length>=2&&(k.network=l[1]),j.event=p.SHARE_NETWORK_GESTURE;break;case p.SEND_GESTURE:l.length>=2&&(b=l[1].split(","),c=b.shift(),d=b.join(","),k.sender=c,k.recipient=d),j.event=p.SEND_GESTURE;break;case p.EMBED_GESTURE:j.event=p.EMBED_GESTURE;break;case p.LINK_GESTURE:j.event=p.LINK_GESTURE;break;case p.REPLAY_GESTURE:j.event=p.REPLAY_GESTURE;break;case p.END_CARD_OVERLAY:j.event=p.END_CARD_OVERLAY;break;case p.ERROR_OVERLAY:j.event=p.ERROR_OVERLAY;break;case p.RECOMMEND_NOW:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NOW;break;case p.RECOMMEND_NEXT:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NEXT;break;case p.RECOMMEND_CLOSE:j.event=p.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",o)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",j),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",k)),this._sendDWEvent()},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(a){return e.has(this._tags.ad,a)?"ad":e.has(this._tags.content,a)?"content":void 0},_getStreamType:function(){var a=this.cviModel.getContentVideoState(),b=uvpjs.mediaCapabilities,c=a.deliveryType,d=a.isLive;return c===b.STREAMING?d?5:4:c===b.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var a=this._agentStartTime,b=e.isDate(a)&&parseInt((new Date-a)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",b),b},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var a=uvpjs.mediaCapabilities,b=window.screen,c={type:(a.getDevice()||"").toLowerCase(),os:(a.getOS()||"").toLowerCase(),ver:a.getOSVersion(),screensz:[b.width,b.height].join("x")};return d(c)},_getPlayerSize:function(){var a=this.cviModel.getContentVideoState();return[a.sourceWidth,a.sourceHeight].join("x")}}),b=function(a,b,c){var d,f,g=[];for(d in a)a.hasOwnProperty(d)&&(f=e.isUndefined(a[d])?"":encodeURIComponent(a[d]),g.push([d,f].join(b)));return g.join(c)},c=function(a){return b(a,"=","&")},d=function(a){return b(a,":",";")}}(uvpjs.register("uvpjs")),function(a){var b,c;c=a._,a.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"production"!==uvpjs.Configuration.env,LIB_PATH:"//79423.analytics.edgesuite.net/js/csma.js",CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this.isPluginLoaded=!1,this.buffering=!1,this.pluginLoadedCB=Function.prototype,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.isPluginLoaded=!1,this.buffering=!1,this.pluginLoadedCB=Function.prototype,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a,d){var e=d&&d.getModuleParam(this._moduleName,"libpath")||this.LIB_PATH;return uvpjs.mediaCapabilities.isSecure()&&(e=e.replace("edgesuite","edgekey")),this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent loadPlugin CDO = ",d),c.isFunction(a)?(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent loadPlugin libpath = ",e),b()&&!this.isPluginLoaded?(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(e,this.pluginLoadedCB)):(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent loadPlugin plugin already loaded into the page"),void this.pluginLoadedCB())):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent loadPlugin no callback supplied."))},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){var a={};return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),b()?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded.")):(a.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,a.streamHeadPosition=this.getStreamHeadPosition.bind(this),a.streamLength=this.getStreamLength.bind(this),a.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(a),void this._setupEventCallbacks())},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var a=this.cviModel.adVideoState,b={};b.adTitle=a.adVideoTitle,b.adDuration=a.duration,b.id=a.adVideoId,b.adPartnerId=this.cviModel.sessionOptions.partner,b.adServer=a.adServerName,this.akamaiPlugin.handleAdLoaded(b)},setContentMetaData:function(){var a=this.cviModel,b=a.sessionOptions,c=this.akamaiPlugin,d=a.getContentVideoState(),e=a.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),c.setData("viewerId",a.getModuleParam(this._moduleName,"viewerID")),c.setData("partnerId",b.partner),c.setData("playerId",this.trackingMgr.getPlayerName("|")),c.setData("Host",b.host),c.setData("Referrer",b.referrer),c.setData("title",d.title),c.setData("category",d.category),c.setData("subCategory",d.sourceOwner),c.setData("show",d.title),c.setData("contentLength",1e3*e.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",a),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",a.payload),this.akamaiPlugin&&a.payload)switch(a.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",a),this.akamaiPlugin){var b=a.payload.newState;b!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),b===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",a),this.akamaiPlugin){var b="Play.End.Detected";this.akamaiPlugin.handlePlayEnd(b)}},_onQosMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",a);var b,c;if(this.akamaiPlugin&&a.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI)!==-1){c=a.payload.paramsObj;for(b in c)this.akamaiPlugin.setData(b,c[b])}}}),b=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(a){this.cviModel=a.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",a),this.trackingMgr=a.trackingMgr,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.playerVersion=a.playerVersion,this.useDefaultProperty=a.useDefaultProperty,this.moduleParams=null,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&this.muxMonitor.destroy(),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a){return"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent loadPlugin: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),void 0!==window.mux||this.muxMonitor?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(uvpjs.MuxAgent.SDK_PATH,this.pluginLoadedCB)))},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var a=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!a&&a[uvpjs.DebugManager.configParams.MUX_DEBUG]===!0},_initializePlugin:function(){return void 0===window.mux?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded.")):void(this.cviModel&&this._setupEventCallbacks())},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var a=this.cviModel,c=this.moduleParams,d=b.assign({page_type:"",viewer_user_id:a.getSessionOption("userId"),experiment_name:c&&!uvpjs.util.isEmpty(c.experimentName)?c.experimentName:"",sub_property_id:this.useDefaultProperty!==!1||uvpjs.util.isEmpty(c.subPropertyId)?a.getSessionOption("partner"):c.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:a.initTime},this._getMuxVideoData());return this.useDefaultProperty?d.property_key=this.MUX_DEFAULT_PROPERTY_KEY:d.property_key=c.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:d}),this.videoElement.mux},_getMuxVideoData:function(){var a=this.cviModel.contentVideoState;return{video_id:this._validateStr(a.cmsRefGuid,""),video_title:this._validateStr(a.videoTitle,""),video_series:this._validateStr(a.seriesTitle,""),video_producer:"",video_content_type:a.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:a.duration,video_stream_type:a.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(a.cdn,""),video_source_url:this._validateStr(a.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_onContentEvent:function(a){a.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onError:function(a){var b=a.payload.errorInfo;b&&b.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:b.errorCode,player_error_message:b.message}))},_gatherModuleParams:function(a){var b,c=this.cviModel,d=c.getModule(a),e=d.params,f={};if(!e)return null;for(var g=e.length;g--;)b=e[g],f[b.name]=b.value;return f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onContentEvent.bind(this),d=this._onError.bind(this),e=this._onAdEvent.bind(this);b[a.CONTENT_DATA_LOADED]=c,b[a.PLAYER_START_ERROR]=d,b[a.VIDEO_START_ERROR]=d,b[a.VIDEO_PLAYBACK_ERROR]=d,b[a.AD_ERROR]=d,b[a.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=e,b[a.AD_PLUGIN_CONTENT_RESUME_REQUEST]=e,b[a.AD_LOADED]=e,b[a.AD_START]=e,b[a.VIDEO_STATE_CHANGE]=e,b[a.AD_SKIPPED]=e,
b[a.AD_END]=e,b[a.AD_ERROR]=e,b[a.AD_REQUEST]=e,b[a.AD_RESPONSE]=e,b[a.AD_QUARTILE]=e,this.trackingMgr.registerEventCallbacks(b)},_getMuxAdData:function(a){var b=a.payload.adData?a.payload.adData.adAssetUrl:a.payload.adAssetUrl;return{ad_tag_url:a.payload.adCallUrl,ad_asset_url:b}},_dispatchMuxAdEvent:function(a,b){a&&(b||(b={ad_tag_url:"",ad_asset_url:""}),b.ad_tag_url||(b.ad_tag_url=""),b.ad_asset_url||(b.ad_asset_url=""),window.mux.emit(this.videoElement,a,b))},_dispatchMuxEvent:function(a){window.mux.emit(this.videoElement,a)},_onAdEvent:function(a){var b=this.eventTypes,c=this.MUX_AD_EVENTS,d=this.MUX_EVENTS;switch(a.type){case b.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(d.PAUSE),this._dispatchMuxAdEvent(c.AD_BREAK_START);break;case b.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(c.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(d.PLAY),this._dispatchMuxEvent(d.PLAYING));break;case b.AD_LOADED:this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a));break;case b.AD_START:this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a));break;case b.VIDEO_STATE_CHANGE:if(!a.payload.isAd)return;var e=a.payload.newState,f=a.payload.currentState;e===this.mc.PAUSED?this._dispatchMuxAdEvent(c.AD_PAUSE,this._getMuxAdData(a)):f==this.mc.PAUSED&&e===this.mc.PLAYING&&(this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a)),this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a)));break;case b.AD_SKIPPED:this._dispatchMuxAdEvent(c.AD_ENDED,this._getMuxAdData(a));break;case b.AD_END:this._dispatchMuxAdEvent(c.AD_ENDED,this._getMuxAdData(a));break;case b.AD_ERROR:this._dispatchMuxAdEvent(c.AD_ERROR,this._getMuxAdData(a));break;case b.AD_REQUEST:this._dispatchMuxAdEvent(c.AD_REQUEST,this._getMuxAdData(a));break;case b.AD_RESPONSE:this._dispatchMuxAdEvent(c.AD_RESPONSE,this._getMuxAdData(a));break;case b.AD_QUARTILE:var g=a.payload.percent;switch(g){case 25:this._dispatchMuxAdEvent(c.AD_FIRST_QUARTILE,this._getMuxAdData(a));break;case 50:this._dispatchMuxAdEvent(c.AD_MIDPOINT,this._getMuxAdData(a));break;case 75:this._dispatchMuxAdEvent(c.AD_THIRD_QUARTILE,this._getMuxAdData(a))}}}}),a.MuxAgent.SDK_PATH=uvpjs.Configuration.path+"lib/tracking/mux.js"}(uvpjs.register("uvpjs")),function(a){var b={concurrencyBeacon:{prodUrl:"//sparrow.cbs.com",stageUrl:"//stage-sparrow.cbs.com",path:"/streamer/v1.0/ingest/beacon.json"}},c=!1,d=null,e=null,f=function(a){return a=a.replace(/\s/g,""),a.search(/^\/\//)>-1?a:"//"+a};a.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(a){return e=b.concurrencyBeacon,a&&a.prodUrl&&a.stageUrl&&(e.prodUrl=f(a.prodUrl),e.stageUrl=f(a.stageUrl)),this},queryParams:function(b){return d=a.util.queryStrFromObj(b,!1),this},devMode:function(a){return c=a,this},buildUrl:function(){return null===e?"Unable to build url.":(c?e.stageUrl:e.prodUrl)+e.path+(null===d?"":"?"+d)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=a.drm,this.videoTagRef=a.videoTagRef,this.eventTypes=a.eventTypes,this.errorCallback=a.errorCallback,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this._loadAppCert(),this._addEvents()},destroy:function(){this._removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},_loadAppCert:function(){var a=this.drm.fairplay.appCertURL;if(a){var b=new uvpjs.CodeLoader;b.loadArrayBuffer(a,this._onAppCertLoaded.bind(this),this._onAppCertError.bind(this))}},_addEvents:function(){this._onWebKitNeedKeyBound=this._onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this._onWebKitNeedKeyBound,!1)},_removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this._onWebKitNeedKeyBound,!1),this._onWebKitNeedKeyBound=null},_onWebKitNeedKey:function(a){this.webKitNeedKeyCalled=!0,this.initData=a.initData,this.appCertLoaded&&this._initializeFairPlayCDM()},_initializeFairPlayCDM:function(){var a=this._getLicenseServerUrl(this.initData),b=this._getContentId(a);if(this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM _onWebKitNeedKey. licenseServerUrl = "+a+", contentId = "+b,event),!b)return this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onWebKitNeedKey. No ContentId in URI"),void(this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID));if(!this.videoTagRef.webkitKeys){var c;if(!WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4"))return this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onWebKitNeedKey. Key System not supported"),void(this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED));c="com.apple.fps.1_0",this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(c))}if(!this.videoTagRef.webkitKeys)return this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onWebKitNeedKey. Could not create MediaKeys"),void(this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS));var d=this._concatInitDataIdAndCertificate(this.initData,b,this.appCertData),e=this.videoTagRef.webkitKeys.createSession("video/mp4",d);return e?(e.contentId=b,e.addEventListener("webkitkeymessage",this._onLicenseRequestReady.bind(this,a),!1),e.addEventListener("webkitkeyadded",this._onKeyAdded.bind(this),!1),void e.addEventListener("webkitkeyerror",this._onKeyError.bind(this),!1)):(this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onWebKitNeedKey. Could not create key session"),void(this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION)))},_onAppCertLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM _onAppCertLoaded",a),this.appCertData=new Uint8Array(a.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this._initializeFairPlayCDM()},_onAppCertError:function(a){this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onAppCertError",a),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_APP_CERT_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD)},_concatInitDataIdAndCertificate:function(a,b,c){if("string"==typeof b){for(var d=b,e=new ArrayBuffer(2*d.length),f=new Uint16Array(e),g=0,h=d.length;g<h;g++)f[g]=d.charCodeAt(g);b=f}var i=0,e=new ArrayBuffer(a.byteLength+4+b.byteLength+4+c.byteLength),j=new DataView(e),k=new Uint8Array(e,i,a.byteLength);k.set(a),i+=a.byteLength,j.setUint32(i,b.byteLength,!0),i+=4;var l=new Uint16Array(e,i,b.length);l.set(b),i+=l.byteLength,j.setUint32(i,c.byteLength,!0),i+=4;var m=new Uint8Array(e,i,c.byteLength);return m.set(c),new Uint8Array(e,0,e.byteLength)},_onLicenseRequestReady:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM _onLicenseRequestReady, licenseServerUrl = "+a,b);var c=b.target,d=b.message,e=new XMLHttpRequest;b.sessionId;e.responseType="arraybuffer",e.session=c,e.addEventListener("load",this._onLicenseRequestLoaded.bind(this),!1),e.addEventListener("error",this._onLicenseRequestError.bind(this),!1);var f="spc="+encodeURIComponent(this._base64EncodeUint8Array(d));e.open("POST",a,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(f)},_base64EncodeUint8Array:function(a){var b=String.fromCharCode.apply(null,a);return btoa(b)},_onLicenseRequestLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM _onLicenseRequestLoaded",a);var c=a.target;b.inRange(c.status,200,400)||(this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onLicenseRequestLoaded, error response code for license request",c.status),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE));var d=c.session;d.update(new Uint8Array(c.response))},_onLicenseRequestError:function(a){this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onLicenseRequestError",a),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST)},_onKeyAdded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM _onKeyAdded",a)},_onKeyError:function(a){this.debug&&uvpjs.error(this.DEBUG_ID,"FairPlayDRM _onKeyError",a),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR)},_getLicenseServerUrl:function(a){var b=String.fromCharCode.apply(null,new Uint16Array(a.buffer)),c=b.split("://"),d="https://"+c[1],e=this.drm.sessionId,f=this.drm.ticket;return e&&(d+="&SessionId="+e),f&&(d+="&Ticket="+f),d},_getContentId:function(a){var b=uvpjs.util.objFromQueryStr(a);return b.ContentId||null}})}(uvpjs.register("uvpjs"))}();
})();