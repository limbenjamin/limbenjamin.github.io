!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Vidy=e()}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t,e){t.exports=function(){var t=/(^|;|\s+)import\s*['"]([^'"]+)['"](?=($|;|\s))/gi,e=/(^|[;\s]+)?import\s*(\*\s*as)?\s*(\w*?)\s*,?\s*(?:\{([\s\S]*?)\})?\s*from\s*['"]([^'"]+)['"];?/gi;function n(t,e){for(var n=[];t.length;)n.push(t.shift().trim().replace(/ as /g,":"));return"const { "+n.join(", ")+" } = "+e+";"}var o={};function i(o,i){window.dimport=r;var s,a=[],p=[],u={exports:{}},d=function(o,i){return o.replace(t,"$1"+(i=i||"require")+"('$2')").replace(e,(function(t,e,o,r,s,a){return(e||"")+function(t,e,o,i){return e=i+"('"+e+"')",t.length&&!o?n(t,e):"const "+o+" = "+e+";"+(t.length?"\n"+n(t,o):"")}(s?s.split(","):[],a,r,i)}))}(i.replace(/(^|\s|;)(import\s*)(\(|.*from\s*|)['"]([^'"]+)['"];?/gi,(function(t,e,n,i,r){return r="'"+new URL(r,o).href+"'",e+n+i+("("==i?r:"'$dimport["+(p.push(r)-1)+"]';")})).replace(/(^|\s|;)(import)(?=\()/g,"$1window.dimport").replace(/export default/,"module.exports =").replace(/export\s+(const|function|class|let|var)\s+(.+?)(?=(\(|\s|=))/gi,(function(t,e,n){return a.push(n)&&e+" "+n})).replace(/export\s*\{([\s\S]*?)\}/gi,(function(t,e){for(var n,o="",i=e.split(",");n=i.shift();)o+="exports."+((n=n.trim().split(" as "))[1]||n[0])+" = "+n[0]+";\n";return o})),"eval");for(a.sort();s=a.shift();)d+="\nexports."+s+" = "+s+";";return Promise.resolve(new Function("module","exports",p.length?"return Promise.all(["+p.join()+"].map(window.dimport)).then(function($dimport){"+d+"});":d)(u,u.exports)).then((function(){return u.exports.default=u.exports.default||u.exports,u.exports}))}function r(t){t=function(t,e,n,o){return/^https?:\/\//.test(t)?t:((n=document.createElement("a")).href=e,"/"==t[0]||"/"===n.pathname?n.origin+"/"+t:(o=n.pathname.split("/"),e=t.split("../"),n.origin+o.slice(0,o.length-Math.max(e.length-1,1)).concat(e.pop()).join("/")))}(t,location.href);try{return new Function("return import('"+t+"')").call()}catch(e){return o[t]?Promise.resolve(o[t]):new Promise((function(e,n,r){(r=new XMLHttpRequest).onerror=n,r.open("GET",t,!0),r.onload=function(){r.status>=400?n(new TypeError("Failed to fetch dynamically imported module: "+t)):i(t,r.responseText).then((function(n){return e(o[t]=n)}))},r.send()}))}}var s=void 0!==document&&document.querySelector("script[data-main]");return s&&(s.text?i(location.href,s.text):(s=s.getAttribute("data-main"))&&r(s)),r}()}));function e(t,e){e.headers=t.headers||{},e.statusMessage=t.statusText,e.statusCode=t.status,e.data=t.response}class n{constructor(t={}){if(this.currentScript=document.currentScript,this.appid=t.appid||this.currentScript&&this.currentScript.getAttribute("data-appid"),this.postid=t.postid||this.currentScript&&this.currentScript.getAttribute("data-postid"),this.content=t.content||this.currentScript&&this.currentScript.getAttribute("data-content"),this.autoload=t.autoload,window.Promise)this._load();else{const t=document.createElement("script");t.src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise",t.onload=this._load.bind(this),document.head.appendChild(t)}}_lookup(){const t=window.location.hostname;var n,o,i;(n="GET",o=`https://api.vidy.com/apps?domain=${t}`,new Promise((function(t,r){i=i||{};var s,a,p,u=new XMLHttpRequest,d=i.body,c=i.headers||{};for(s in i.timeout&&(u.timeout=i.timeout),u.ontimeout=u.onerror=function(t){t.timeout="timeout"==t.type,r(t)},u.open(n,o.href||o),u.onload=function(){for(p=u.getAllResponseHeaders().trim().split(/[\r\n]+/),e(u,u);a=p.shift();)a=a.split(": "),u.headers[a.shift().toLowerCase()]=a.join(": ");if((a=u.headers["content-type"])&&~a.indexOf("application/json"))try{u.data=JSON.parse(u.data,i.reviver)}catch(t){return e(u,t),r(t)}(u.status>=400?r:t)(u)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(c["content-type"]="application/json",d=JSON.stringify(d)),u.withCredentials=!!i.withCredentials,c)u.setRequestHeader(s,c[s]);u.send(d)}))).then((t=>{if(!t.data.data.uuid)throw!1;this.appid=t.data.data.uuid,this._load()})).catch((()=>{}))}_load(){if("auto"===this.appid)return this._lookup();this.module=t("https://static.vidy.com/0.38.5/index.js").then((t=>new(t.default||t)({appid:this.appid,postid:this.postid,content:this.content,autoload:this.autoload})))}load(){this.module.then((t=>{t.load()}))}init(t){this.module.then((e=>{e.init(t)}))}}return document.currentScript&&document.currentScript.getAttribute("data-appid")&&new n,n}));
